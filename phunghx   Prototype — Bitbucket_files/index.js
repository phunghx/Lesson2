define("components/clone/clone-dialog",["jquery","aui"],function(e,t){function i(i,n,r){return function(o){var s=e(i),a=function(e,i,r){var o=t.InlineDialog.current;s.appendTo(e).removeClass("hidden"),r(),setTimeout(function(){return o&&o.id===n?void t.InlineDialog.current.hide():void s.find("input").trigger("select")},0)};t.InlineDialog(o,n,a,r)}}return i}),define("components/clone/clone-url-dropdown",["jquery","aui","data/current-user"],function(e,t,i){return function(t,n){var r=t.find(".aui-dropdown2-trigger"),o=t.find("input");n=n||{};var s=function(e){r.attr("href",e.attr("href")),r.find(".dropdown-text").text(e.text()),o.val(e.attr("data-command")),e.hasClass("ssh")?t.addClass("ssh"):t.removeClass("ssh")};t.find("a.item-link").click(function(t){t.preventDefault(),s(e(this)),o.select(),n.onItemClicked&&n.onItemClicked()}),i.isSshEnabled&&s(t.find("a.item-link.ssh")),o.focus(function(){var t=e(this);t.one("mouseup",function(e){e.preventDefault()}),t.select()})}}),define("components/clone/clone-in-sourcetree",["jquery","aui","utils/exists","utils/api-helper","data/current-user"],function(e,t,i,n,r){return function(t){var i=t.attr("data-https-url"),o=t.attr("data-ssh-url");t.find("a.hide").click(function(i){i.preventDefault(),e.ajax({type:"DELETE",dataType:"json",url:n.toString("feature-help","clone-in-sourcetree")}),t.hide()}),t.find("button").click(function(){window.location.href="sourcetree://cloneRepo/"+(r.isSshEnabled?o:i)})}}),define("data/has-sidebar",["jquery"],function(e){return e(document.body).hasClass("aui-page-sidebar")}),define("utils/dialog-positions",["aui","jquery"],function(e){function t(t){return function(i,n,r,o){var s=e.InlineDialog.opts.calculatePositions(i,n,r,o),a=n.target,l=a.offset(),c=i.outerWidth(),d=a.outerWidth(),h=l.left+d/2;return s.popupCss.right="auto",s.popupCss.left=t(a,l,c,d,o),s.arrowCss.right="auto",s.arrowCss.left=h-s.popupCss.left-8,s}}var i=34;return{alignCenter:function(){return t(function(e,t,i,n,r){return t.left+n/2-i/2+r.offsetX})},alignRight:function(){return t(function(e,t,i,n,r){return t.left+n-i+r.offsetX})},alignLeft:function(){return t(function(e,t,i,n,r){return t.left+r.offsetX})},alignTo:function(e){return t(e)},sidebarOffsetY:function(e,t){var n=t.target.height()/2,r=e.height()/2;return r-n-i},sidebarArrowOffsetY:function(e,t){var n=t.target.height()/2,r=e.height()/2;return-r+n+i},replaceExisting:function(t,i,n,r){var o,s,a=e.InlineDialog.opts.calculatePositions(t,i,n,r),l=i.target.closest(".aui-inline-dialog");return l.length&&(s=l.offset(),a.popupCss.left=s.left,a.popupCss.top=s.top,o=l.find(".aui-inline-dialog-arrow"),o.length&&(a.arrowCss.top=o.offset().top-a.popupCss.top)),a}}}),define("clone",["jquery","underscore","components/clone/clone-dialog","components/clone/clone-url-dropdown","components/clone/clone-in-sourcetree","data/has-sidebar","utils/dialog-positions","utils/exists"],function(e,t,i,n,r,o,s,a){function l(){return setTimeout(function(){c=!0},0),c}var c=!0,d={width:360,preHideCallback:l,useLiveEvents:!0};o&&t.extend(d,{gravity:"w",offsetY:s.sidebarOffsetY,arrowOffsetY:s.sidebarArrowOffsetY,calculatePositions:s.replaceExisting}),a("#repo-clone-button",i("#repo-clone-dialog","repo-clone-dialog",d)),a("#clone-wiki-contextual",i("#wiki-clone-dialog","clone-wiki-dialog",{preHideCallback:l})),e(".clone-url").each(function(t,i){n(e(i),{onItemClicked:function(){c=!1}})}),e(".clone-in-sourcetree").each(function(t,i){r(e(i))})}),function(e,t){"function"==typeof define&&define.amd?define("data/client",t):t({initialize:!0})}(this,function(e){var t={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv:"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};t.init();var i={os:t.OS,browser:t.browser};return e.initialize&&(document.body.className+=" "+i.os.toLowerCase()+" "+i.browser.toLowerCase()),i}),define("components/key-navigation",["jquery","data/client"],function(e,t){var i=function(i,n){function r(e){return{tab:9===e.which,enter:13===e.which,up:38===e.which,down:40===e.which,j:74===e.which,k:75===e.which,o:79===e.which,home:36===e.which,end:35===e.which}}function o(e,t){n.clear(),e.length&&(e.addClass("focused"),n.scroll(e,t))}function s(){var e=n.getFirstItem();o(e),i.trigger("navigate:first",e)}function a(){var e=n.getLastItem();o(e),i.trigger("navigate:last",e)}function l(){var e,t=n.getSelectedItem();t.length&&(e=n.getNextItem(t)),e&&e.length||(e=n.getFirstItem()),o(e),i.trigger("navigate:next",e)}function c(){var e,t=n.getSelectedItem();t.length&&(e=n.getPrevItem(t)),e&&e.length||(e=n.getLastItem()),o(e,!0),i.trigger("navigate:previous",e)}function d(){i.trigger("navigate:select",n.getSelectedItem())}var h={defaultAction:function(){},getNextItem:function(e){return e.next()},getPrevItem:function(e){return e.prev()},scroll:function(e){var t=e.offsetParent(),i=t.innerHeight(),n=e.position().top,r=n+e.innerHeight(),o=t.scrollTop();0>n?t.scrollTop(o+n):r>=i&&t.scrollTop(o+r-i)}};return n=e.extend({},h,n),i.on("keyup",function(e){var i=r(e),o="Mac"===t.os,h=o&&e.ctrlKey||!o&&e.altKey,u=i.up||i.k&&h||i.tab&&e.shiftKey,f=i.down||i.j&&h||i.tab&&!e.shiftKey,p=i.enter||i.o&&h,m=i.home,g=i.end;u?c():f?l():p?d():m?s():g?a():n.defaultAction(e)}),{next:l,prev:c,first:s,last:a,select:d}},n=function(t,n,r){var o={getSelectedItem:function(){return n.find(".active-pane .filter-item.focused")},getFirstItem:function(){return n.find(".active-pane .filter-item a:visible").first().parent()},getLastItem:function(){return n.find(".active-pane .filter-item a:visible").last().parent()},getNextItem:function(e){return e.nextAll().find("a:visible").first().parent()},getPrevItem:function(e){return e.prevAll().find("a:visible").first().parent()},clear:function(){n.find(".active-pane .focused").removeClass("focused")}};return t.on("navigate:select",function(t,i){var n=e(i),r=n.find("a");r.length&&r[0].click()}),i(t,e.extend({},o,r))};return{keyNavigation:i,tabbedFilter:n}}),define("components/file-search/file-search",["jquery","components/key-navigation","data/current-repo","utils/api-helper","utils/mustache"],function(e,t,i,n,r){function o(e,i,n,r,o){this.$queryInput=e,this.$resultsContainer=i,this.revision=n,this.branch=r?encodeURIComponent(r):r,this.template=o,this.charLimit=80,this.resultLimit=100,this.nextPageStart=0,this.isLastPage=!0,this.loading=!1,this.files=[],this.getFiles(),this.initialized=!0,this.keyNavigator=t.keyNavigation(e,{getSelectedItem:this.getSelectedItem.bind(this),getFirstItem:this.getFirstItem.bind(this),getLastItem:this.getLastItem.bind(this),clear:this.clear.bind(this),defaultAction:this.executeSearch.bind(this),scroll:this.scroll.bind(this)}),e.on("navigate:select",function(){this.selectResult()}.bind(this)),e.on("keydown",function(e){9===e.which&&e.preventDefault()})}function s(e){return e.replace(/(^\s*)|(\s*$)/gi,"").replace(/[ ]{2,}/gi," ")}function a(e){if(!e)return null;var t="",i=s(e).split(/\*|\s|(?=[A-Z0-9]|\/|\.|-|_)/g);i=_.filter(i,function(e){return 0!==e.length});var n=i.length;if(n){t+="("+_.map(i[0].split(""),l).join("")+")";for(var r=1;n>r;r++)t+=".*?("+_.map(i[r].split(""),l).join("")+")";return new RegExp("("+t+")","g")}}function l(e){return e!=e.toUpperCase()?"["+c(e.toUpperCase()+e)+"]":c(e)}function c(e){return e.replace(/[\-\[\]{}()+?.,\\\^$|#\s]/g,"\\$&")}return o.prototype.getPositions=function(e){var t=e.position().top,i=this.$resultsContainer.scrollTop();return{itemStart:t,itemEnd:t+e.height(),containerStart:i,containerEnd:i+this.$resultsContainer.height()}},o.prototype.isVisible=function(e){var t=this.getPositions(e);return t.itemStart>=t.containerStart&&t.itemEnd<=t.containerEnd},o.prototype.makeVisible=function(e){var t=this.getPositions(e);if(t.itemEnd<=t.containerEnd)this.$resultsContainer.scrollTop(t.itemStart);else{var i=t.containerEnd-t.containerStart;this.$resultsContainer.scrollTop(t.itemEnd-i)}},o.prototype.scroll=function(e,t){this.isVisible(e)||this.makeVisible(e,t)},o.prototype.clear=function(){return this.$resultsContainer.find(".focused").removeClass("focused")},o.prototype.getSelectedItem=function(){return this.$resultsContainer.find(".focused")},o.prototype.getFirstItem=function(){return this.$resultsContainer.find(".iterable-item:first")},o.prototype.getLastItem=function(){return this.$resultsContainer.find(".iterable-item:last")},o.prototype.selectResult=function(){if(this.$resultsContainer.find(".focused").length){var e=this.$resultsContainer.find(".focused a.execute").attr("href");window.location.href=e}},o.prototype.executeSearch=function(){var e=this.$queryInput.val();if(e){var t=this.filterFiles(e);t.length<this.resultLimit&&!this.isLastPage&&this.getFiles({start:this.nextPageStart}),this.$resultsContainer.html(r.toHtml(this.template,{files:t,node:this.revision,branch:this.branch})).show(),0===t.length?this.$resultsContainer.hide():this.keyNavigator.first()}else this.$resultsContainer.hide()},o.prototype.getFiles=function(t){var r=n.concat("repositories",i.owner.username,i.slug,"directory");r=this.revision?r.toString(this.revision):r,this.loading||(this.$queryInput.addClass("loading"),e.ajax({url:r,type:"GET",data:t,dataType:"json"}).success(function(e){this.isLastPage=e.isLastPage,this.nextPageStart=e.nextPageStart,this.revision=e.revision,_.each(e.values,function(e){this.files.push({name:e})}.bind(this)),this.loading=!1,this.$queryInput.removeClass("loading"),this.executeSearch()}.bind(this)))},o.prototype.filterFiles=function(e){var t=this.files,i=a(e);return t=_.filter(this.files,function(e){return i.lastIndex=0,i.test(e.name)}),i.lastIndex=0,_.each(t,function(e){e.isDirectory="/"===e.name.slice(-1);var t=e.name;if(e.name.length>this.charLimit){var n=Math.floor(this.charLimit/2);t=e.name.slice(0,n)+"&hellip;"+e.name.slice(-n)}e.highlightedName=t.replace(i,"<strong>$1</strong>")}.bind(this)),t.slice(0,this.resultLimit)},o}),define("components/file-search/dialog",["aui","jquery","components/file-search/file-search","utils/when-i-type","data/client"],function(e,t,i,n,r){function o(){var n,o=t(document),s=new e.Dialog({width:680,height:"auto",id:"file-search-dialog",closeOnOutsideClick:!0});s.addPanel("Search",a,"panel-body"),a.show(),a.on("submit",function(){return!1});var l=t("#file-search-query"),c=t("#filtered-files"),d=a.find(".tip"),h=Math.round(Math.random()*d.length-2);return"Mac"===r.os?d.closest(".mod-win").remove():d.closest(".mod-osx").remove(),e.bind("show.dialog",function(e,t){"file-search-dialog"!==t.dialog.id||n||(n=new i(l,c,a.attr("data-revision"),a.attr("data-branch"),"filtered-files-template"),d.addClass("hidden").eq(h).removeClass("hidden"))}),o.on("click","#inline-dialog-branch-dialog .filter-list a",function(){o.one("pjax:end",function(e,i,r){if(e.target&&"source-container"===e.target.id){var o,s=t(e.relatedTarget).text().trim();o=/src\/(.*)\//.exec(r.url),o=o?o[1]:s,n&&n.initialized?(n.revision=o,n.files=[],n.getFiles(),n.$queryInput.val("")):(a.attr("data-revision",o),a.attr("data-branch",s))}})}),s}var s,a=t("#file-search-form");return a.length&&n.fromJSON([{section:gettext("Repository actions"),shortcuts:[{keys:["f"],description:gettext("Search for file"),op:"execute",params:[function(){s||(s=o()),s.show()}]}]}]),{exists:function(){return!!a.length},getDialog:function(){return s||(s=o()),s}}}),define("components/repo-watch/model",["jquery","backbone"],function(e,t){var i=t.Model.extend({initialize:function(e,t){this.url=t.url,this.repository=t.repository}}),n=t.Model.extend({initialize:function(e,t){this.watchUrl=t.watchUrl,this.unwatchUrl=t.unwatchUrl},loadUnwatch:function(){return e.get(this.unwatchUrl).done(function(e){this.trigger("load:unwatch",e)}.bind(this))},unwatchKind:function(t){return e.ajax({url:this.unwatchUrl+"/"+t,type:"DELETE",data:{kind:[t]},dataType:"json"})},watch:function(){this.set("watching",!0),e.post(this.watchUrl)},toggle:function(){this.set("watching",!this.get("watching"))}});return{RepoPreferences:i,RepoWatchState:n}}),define("components/repo-watch/view",["aui","jquery","backbone","underscore","data/has-sidebar","components/repo-watch/model","utils/dialog-positions","utils/gaq-push","utils/mustache"],function(e,t,i,n,r,o,s,a,l){var c=i.View.extend({events:{'click input[type="checkbox"]':"togglePreference","follow:repo a.follow":"toggleWatching"},initialize:function(i){n.bindAll(this,"togglePreference","toggleWatching","toggleDialog","watchingChanged","onHideWatchDialog"),this.watchState=i.watchState,this.listenTo(this.watchState,"change:watching",function(){setTimeout(this.watchingChanged,0)}.bind(this)),this.watchId="watch-info-"+this.model.repository.replace(/\//,"-");var r={width:450,cacheContent:!1,calculatePositions:s.alignRight()};this.watchDialog=e.InlineDialog(i.target,this.watchId,this.toggleDialog,r),this.dialogLoaded=!1,this.dataLoaded=!1,this.model.once("sync",function(){this.dataLoaded=!0}.bind(this)),this.model.once("error",function(){this.dataLoaded=!0,this.showError=!0}.bind(this)),this.unsubscribed={},t(document).bind("hideLayer",this.onHideWatchDialog)},renderDialog:function(e,t){this.setElement(e),this.showError?this.renderError():this.render(),this.dialogLoaded=!0,t()},toggleDialog:function(t,i,n){if(e.InlineDialog.current){if(e.InlineDialog.current.id===this.watchId)return setTimeout(this.watchDialog.hide,0);e.InlineDialog.current.hide()}if(this.dialogLoaded)return void n();if(this.dataLoaded)this.renderDialog(t,n);else{var r=setTimeout(function(){this.trigger("loading")}.bind(this),300),o=function(){this.renderDialog(t,n),this.trigger("loaded"),clearTimeout(r)}.bind(this);this.model.once("sync",o),this.model.once("error",function(){this.showError=!0,o()}.bind(this))}},onHideWatchDialog:function(e,t,i){"inlineDialog"==t&&i==this.watchDialog[0].popup&&((this.unsubscribed.issues||this.unsubscribed.pullrequests)&&this.model.trigger("unsubscribe"),this.unsubscribed={})},render:function(){var e=n.extend({showRepo:this.model.get("has_repo"),showWiki:this.model.get("has_wiki"),showIssues:this.model.get("has_issues")},this.watchState.attributes);return this.watchState.get("watching")&&n.extend(e,this.model.attributes),this.$el.html(l.toHtml("watch-preferences-template",e)),this.$('input[type="checkbox"]').attr("disabled",!this.watchState.get("watching")),this.$("h4.subscribe-title").toggleClass("disabled",!this.watchState.get("watching")),this.$("a.follow").attr("href",this.watchState.watchUrl),this},renderError:function(){this.$el.html(l.toHtml("preference-error-template"))},togglePreference:function(e){var i=t(e.target),n=i.attr("name"),r=i.is(":checked");i.addClass("loading"),this.model.set(n,r),this.model.save(),this.unsubscribed[n]=!r,setTimeout(function(){i.removeClass("loading")},300),a(["atl._trackEvent","Repo Preferences",n,r?"Enabled":"Disabled"])},hideDialog:function(){this.watchDialog.hide()},watchingChanged:function(){this.render()},toggleWatching:function(){this.watchState.toggle()}}),d=i.View.extend({events:{"click a.unwatch":"unwatchObjects"},initialize:function(t){n.bindAll(this,"unwatchObjects","watchingChanged","createDialogContent","unsubscribed"),this.unwatchId="unwatch-info-"+this.model.repository.replace(/\//,"-"),this.unwatchDialog=new e.Dialog({width:500,height:"auto",id:this.unwatchId,closeOnOutsideClick:!1}),this.setElement("#"+this.unwatchId,!0),this.unwatchDialog.addHeader(gettext("You're still watching a few things")),this.unwatchDialog.addPanel("panel-watching"),this.unwatchDialog.addLink(gettext("Manage all notifications"),function(){return!0},"link-manage-all"),this.unwatchDialog.addButton(gettext("Okay"),function(){this.unwatchDialog.hide()}.bind(this),"confirm-stop-watch"),this.watchState=t.watchState,this.dataLoaded=!1,this.watchState.on("change:watching",this.watchingChanged),this.watchState.on("load:unwatch",this.createDialogContent),this.model.on("unsubscribe",this.unsubscribed)},createDialogContent:function(e){var i=n.extend({},e,this.watchState.attributes),r=t(l.toHtml("stop-watching-template",i));r.appendTo(this.unwatchDialog.getCurrentPanel().body),this.$(".link-manage-all").attr("href",r.data("manageAllUrl")),this.dataLoaded=!0},showUnwatchDialog:function(){if(!this.dataLoaded||0!==this.$(".watching li:not(.hidden)").length)if(this.dataLoaded)this.trigger("show:unwatch"),this.unwatchDialog.show();else{var e=setTimeout(function(){this.trigger("loading")}.bind(this),300);this.watchState.once("load:unwatch",function(){this.trigger("loaded"),clearTimeout(e),this.trigger("show:unwatch"),this.unwatchDialog.show()}.bind(this))}},unsubscribed:function(){(!this.model.get("pullrequests")||this.model.get("has_issues")&&!this.model.get("issues"))&&this.showUnwatchDialog()},watchingChanged:function(){this.watchState.get("watching")||this.showUnwatchDialog()},unwatchObjects:function(e){function i(){clearTimeout(n),r.removeClass("loading"),r.prop("disabled",!1),r.closest("li").addClass("hidden");var e=t("."+o+"-list .follow");e.length&&e.each(function(){t(this).trigger("toggle-follow",{isNowFollowing:!1})})}e.preventDefault();var n,r=t(e.target),o=r.data("kind");r.prop("disabled")||(r.prop("disabled",!0),n=setTimeout(function(){r.addClass("loading")},300),this.watchState.unwatchKind(o).done(i))}}),h=i.View.extend({events:{mouseover:"loadData","follow:repo a.follow":"toggleWatching"},initialize:function(e){n.bindAll(this,"render","loadData","toggleWatching"),this.preferencesLoaded=!1,this.$follow=this.$("a.follow"),this.model=new o.RepoPreferences({},{url:this.$follow.data("prefsUrl"),repository:e.repository}),this.watchState=new o.RepoWatchState({watching:this.$follow.hasClass("following"),urlPullrequests:this.$follow.data("urlPullrequests"),urlIssues:this.$follow.data("urlIssues")},{watchUrl:this.$follow.attr("href"),unwatchUrl:this.$follow.data("unwatchUrl")}),this.watchState.on("change:watching",this.render)},render:function(){var e=this.watchState.get("watching"),t=gettext(e?"Stop watching this repository":"Watch this repository");return this.$follow.toggleClass("following",e).attr("title",t),this},loadData:function(){this.preferencesLoaded||(this.watchView=new c({model:this.model,watchState:this.watchState,target:this.$("a.repo-watch")}),this.unwatchView=new d({model:this.model,watchState:this.watchState}),this.unwatchView.on("show:unwatch",function(){this.watchView.hideDialog()}.bind(this)),this.model.fetch(),this.watchView.once("loading",function(){this.$follow.addClass("loading")}.bind(this)),this.watchView.once("loaded",function(){this.$follow.removeClass("loading")}.bind(this)),this.watchState.loadUnwatch(),this.unwatchView.once("loading",function(){this.$follow.addClass("loading")}.bind(this)),this.unwatchView.once("loaded",function(){this.$follow.removeClass("loading")}.bind(this)),this.preferencesLoaded=!0)},toggleWatching:function(){this.watchState.toggle()}});return{Widget:h,UnwatchView:d,PreferencesView:c}}),define("components/repo-watch/setup",["jquery","components/repo-watch/view","utils/exists"],function(e,t,i){function n(i){var r,s;i.length>o?(r=i.slice(0,o),s=i.slice(o)):(r=i,s=[]),r.each(function(i,n){var r=e(n);new t.Widget({el:r.closest(".aui-buttons"),repository:r.attr("data-repository")})}),s.length&&setTimeout(function(){n(s)},0)}function r(){n(e(".repo-watch a.follow"))}var o=50,s=e(document);s.ready(r),i("#profile",function(){s.on("pjax:end",r)})}),define("components/repo-sidebar",["aui","jquery","on-ready","data/client","data/current-user","utils/event-tracking-helper","utils/preferences"],function(e,t,i,n,r,o,s){return e.I18n.keys=e.I18n.keys||{},e.I18n.keys["aui.sidebar.expand.tooltip"]=gettext("Expand sidebar ( [ )"),e.I18n.keys["aui.sidebar.collapse.tooltip"]=gettext("Collapse sidebar ( [ )"),i(function(){function i(){return a.isCollapsed()?"Collapsed":"Expanded"}var a=e.sidebar(".aui-sidebar"),l=t(document),c=o("Repo Sidebar");t("#repo-avatar-link").on("click",function(){c("Repo Avatar - Clicked",i())}),t("#repo-owner-link").on("click",function(){c("Repo Owner - Clicked",i())}),l.on("click","#repo-clone-button",function(){c("Clone Dialog",i())}),l.on("click","#repo-fork-link",function(){c("Fork",i())}),l.on("click","#repo-compare-link",function(){c("Compare",i())}),l.on("click","#repo-create-pull-request-link",function(){c("Create Pull Request",i())}),l.on("click","#repo-create-branch-link",function(){c("Create Branch",i())}),l.on("click","#repo-clone-dialog .clone-in-sourcetree button",function(){c("Clone in Sourcetree",n.os)}),t("#repo-overview-link").on("click",function(){c("Overview",i())}),t("#repo-source-link").on("click",function(){c("Source",i())}),t("#repo-commits-link").on("click",function(){c("Commits",i())}),t("#repo-branches-link").on("click",function(){c("Branches",i())}),t("#repo-pullrequests-link").on("click",function(){c("Pull Requests",i())}),t("#repo-patch-series-link").on("click",function(){c("Patch Queue",i())}),t("#repo-issues-link").on("click",function(){c("Issues",i())}),t("#repo-wiki-link").on("click",function(){c("Wiki",i())}),t("#repo-downloads-link").on("click",function(){c("Downloads",i())}),t("#repo-settings-link").on("click",function(){c("Settings",i())}),r.isAuthenticated&&("false"!==a.$el.attr("data-aui-responsive")&&a.isViewportNarrow()&&s.set("sidebar-collapsed",a.isCollapsed()),a.on("expand-end collapse-end",function(){s.set("sidebar-collapsed",a.isCollapsed()),c("Sidebar Toggled",i())}))})}),define("repo/create-branch",["aui","jquery","on-ready","utils/loading"],function(e,t,i){return i(function(){function i(i){var n=new e.Dialog({width:600,height:"auto",id:"create-branch-dialog",closeOnOutsideClick:!0});return n.addHeader("Create branch"),n.addPanel("panel-create"),n.addButton("Create",function(){var e=t(o.popup.element);e.find(".dialog-button-panel button").loading(),e.find("#create-branch-form").submit()},"aui-button"),n.addCancel("Cancel",function(e){e.hide()}),r=t.ajax({type:"get",url:i.attr("href"),dataType:"html"}),n}function n(e){var n=t(e.target).closest(".create-branch-button");e.preventDefault(),o=o||i(n),n.loading(r).done(function(e){var i=t(e);i.find(".buttons").remove(),o.getCurrentPanel().body.html(i),require(["branches/create"],function(e){e.onReady()})}).fail(function(){t(o.getCurrentPanel().body).append('<p class="error">An unexpected error occurred.</p>')}).always(function(){o.show()})}var r,o;t(document).on("click",".create-branch-button",n)})}),define("components/share/repo-share-detail",["jquery","underscore","components/share/share-detail","utils/mustache"],function(e,t,i,n){return i.extend({events:{"click .permission":"setPermission"},initialize:function(){i.prototype.initialize.call(this),t.bindAll(this,"setPermission")},render:function(){var e=this.model.toJSON();return e[this.model.get("permission")]=!0,this.$el.html(n.toHtml(this.template,e)),this},setPermission:function(t){this.model.set({permission:e(t.target).data("permission")})}})}),define("components/share/repo-share-form",["aui","components/share/repo-share-detail","components/share/share-form","data/current-repo","utils/gaq-push"],function(e,t,i,n,r){return i.extend({initialize:function(e){this.DetailView=t,this.modelSkeleton={permission:"read"},this.shareType="repo",i.prototype.initialize.call(this,e)},add:function(e){var t=this.$userOrEmail.val();if(n.owner&&t===n.owner.username||n.creator&&t===n.creator.username){var r=gettext('User "%(user_or_email)s" already has access to this repository');return this.showError(interpolate(r,{user_or_email:t},!0)),!1}i.prototype.add.call(this,e)},send:function(){this.on("success",function(){r(["atl._trackEvent","Share","Share repo"]),e.messages.success({body:gettext("You have successfully shared this repository")})}),i.prototype.send.call(this)}})}),define("components/share/panel/repo",["backbone","underscore","components/share/repo-share-form","utils/mustache"],function(e,t,i,n){return e.View.extend({className:"share-panel-repo",display:gettext("Repository"),action:gettext("Share"),manageText:gettext("Manage this repository"),template:"share-repo-template",render:function(){return this.$el.html(n.toHtml(this.template)),this.form=new i({el:this.$(".share-form")}).render(),this.form.on("all",function(e,t){this.trigger(e,t)},this),this},share:function(){this.form.send()},getManageLink:function(){return this.$(".manage-repo-link").attr("data-manage-link")}})}),define("repo/share",["jquery","on-ready","components/share/share-dialog","components/share/panel/repo","components/share/panel/team"],function(e,t,i,n,r){return t(function(){var t=e("#repo-share-link"),o=!!t.attr("data-team-name"),s=new i({id:"share-repo"}),a=[new n];o&&a.unshift(new r({name:t.attr("data-team-name"),display:t.attr("data-team-display"),avatar:t.attr("data-team-avatar"),manageUrl:t.attr("data-team-manage-link")})),e("a.share").on("click",function(e){e.preventDefault(),s.show()}).one("mouseover",function(){s.renderPanels(a)})})}),define("utils/filter",["jquery","utils/repo-filter"],function(e,t){return function(i,n,r){function o(){i.toggleClass("empty",!s.$items.filter(":visible").length)}r=e.extend({delay:200},r);var s={};return{handler:function(a){function l(){function n(t,i){return e(i).text().match(r)}if(c.val()==d){i.trigger("filter",d);var r=t.getRegExp(d);s.$items.addClass("hidden"),s.$items.filter(n).removeClass("hidden"),o()}}var c=e(a.target),d=c.val();return s.$items=s.$items||i.find(n),s.val===d?void o():(s.val=d,void setTimeout(l,r.delay))},update:function(){s.$items=i.find(n),o()}}}}),define("utils/quick-filter",["jquery","utils/filter"],function(e,t){return function(i,n){function r(e){var i=e.find("input.filter-box"),r=t(e,".filter-item a",n);i.bind("keyup input propertychange",r.handler),i.val()&&i.trigger("input")}n=e.extend({delay:200},n),r(i)}}),define("components/form-dialog",["jquery","aui","utils/mustache"],function(e,t,i){e(document).on("keydown",".aui-dialog .button-panel-button, .aui-dialog .button-panel-link",function(t){13===t.keyCode&&e(this).click()});var n=function(t,i){i=i||{},"function"==typeof i&&(i={onUpdateContents:i}),this.useLiveEvents=!!i.useLiveEvents,this.useLiveEvents?this.trigger=t:this.$trigger_=e(t),this.onUpdateContents_=i.onUpdateContents,this.template_=i.template,this.templateData_=i.templateData,this.boundClick_=null,this.timeout_=null,this.success=i.success,this.complete=i.complete,this.error=i.error,this.onSubmit=i.submit,this.isStaticContent=!!i.isStaticContent,this.dataType=i.dataType,this.width=i.width||600,this.height=i.height||"auto",this.id=this.useLiveEvents?i.id:i.id||this.$trigger_.attr("id")};return n.prototype=function(){var r=n.prototype;return r.bind=function(){if(this.boundClick_=this.open.bind(this),this.useLiveEvents){var t=e("body");t.off("click.disabled",this.trigger),t.on("click.formdialog",this.trigger,this.boundClick_)}else this.$trigger_.unbind("click.disabled").click(this.boundClick_);return this},r.unbind=function(){return this.boundClick_&&(this.useLiveEvents?e("body").off("click.formdialog",this.trigger,this.boundClick_):this.$trigger_.unbind("click",this.boundClick_),this.boundClick_=null),this},r.disable=function(){this.unbind();var t=function(e){e.preventDefault()};this.useLiveEvents?e("body").on("click.disabled",this.trigger,t()):this.$trigger_.bind("click.disabled",t)},r.open=function(n){var r;if(n.preventDefault(),this.useLiveEvents){if(e(this.trigger).attr("aria-disabled"))return}else if(this.$trigger_.attr("aria-disabled"))return;if(this.$dialog_||(this.$dialog_=new t.Dialog({width:this.width,height:this.height,id:"bb-"+this.id+"-dialog"}),this.$dialog_.addPanel("main"),this.$element_=this.$dialog_.popup.element,this.$errorContainer_=this.$element_.find(".error-container")),this.$dialog_.initialized&&this.isStaticContent)this.$dialog_.show();else{var o=this.useLiveEvents?e(n.target):this.$trigger_;if(o.addClass("loading"),this.template_)r="function"==typeof this.templateData_?this.templateData_():this.templateData_,this.open_(i.toHtml(this.template_,r||{}),o);else{var s={type:"get",url:o.attr("href"),success:this.open_.bind(this)};this.dataType&&(s.dataType=this.dataType),e.ajax(s)}}this.clearErrors()},r.open_=function(e,t){"string"==typeof e&&(e={html:e}),this.useLiveEvents?t.removeClass("loading"):this.$trigger_.removeClass("loading"),e.redirect?window.location=e.redirect:(this.updateContents(e.html,t),this.$dialog_.initialized=!0,this.$dialog_.show())},r.updateContents=function(e,t){this.$dialog_.getCurrentPanel().html(e),this.$form_=this.$element_.find("form"),this.$form_.find(".submit").hide(),this.$originalSubmit_=this.$form_.find("input[type=submit]"),this.$form_.find("input").keypress(this.submitOnEnter.bind(this)),this.$element_.find(".dialog-button-panel").empty(),this.$dialog_.addHeader(this.$form_.attr("title")||this.$form_.attr("data-title")).addButton(this.$originalSubmit_.attr("value")||"Submit",this.submit.bind(this),"aui-button aui-style").addCancel("Cancel",function(e){e.hide()});var i=this.$originalSubmit_.attr("value");this.$submit_=this.$element_.find(".dialog-button-panel").find('button:contains("'+i+'")'),this.$errorContainer_=this.$element_.find(".error-container"),this.onUpdateContents_&&this.onUpdateContents_(this.$dialog_,t)},r.submitOnEnter=function(e){"keypress"===e.type&&13===e.keyCode&&(e.preventDefault(),this.submit())},r.submit=function(){var t=this.$submit_;this.clearErrors(),this.timeout_=setTimeout(function(){t.addClass("loading")},300),t.attr("aria-disabled",!0).addClass("disabled"),this.onSubmit?this.onSubmit(this.$form_):e.ajax({type:this.$form_.attr("method")||"POST",url:this.$form_.attr("action"),data:this.$form_.serialize(),success:this.submit_.bind(this),error:this.error_.bind(this)})},r.complete_=function(){clearTimeout(this.timeout_),this.$dialog_.enable(),this.$submit_.attr("aria-disabled",!1).removeClass("loading disabled")},r.submit_=function(e){"string"==typeof e&&(e={html:e}),e.success?e.redirect?window.location=e.redirect:this.success&&(this.success(this.$element,e),this.complete?this.complete():this.complete_()):e.html?(this.updateContents(e.html),this.complete?this.complete():this.complete_()):this.success&&(this.success(this.$element,e),this.complete?this.complete():this.complete_())},r.error_=function(e){this.error&&this.error(this.$element,e),this.complete_()},r.close=function(){this.$dialog_.hide()},r.remove=function(){this.$dialog_&&this.$dialog_.remove()
},r.displayError=function(e){this.clearErrors(),t.messages.error(this.$errorContainer_,e)},r.clearErrors=function(){this.$errorContainer_.empty()},r}(),n}),define("components/merge-dialog",["jquery","components/form-dialog","utils/check-task"],function(e,t,i){return function(n,r){r=e.extend({getData:function(){},success:function(e){window.location=e},width:700},r),new t(n,{success:function(e,t){t.result?r.success.call(this,t.result):t.error?this.error(t.error,t):setTimeout(function(){i(t.url).done(r.success.bind(this)).fail(this.error.bind(this))}.bind(this),1e3)},error:function(e,t){if(this.complete_(),t.conflicts&&r.conflictUrl)var i=gettext("View the conflicts");e+=' <a href="{}">{}</a>.'.format(r.conflictUrl,_.escape(i)),this.displayError({title:gettext("Unable to merge"),body:e,closeable:!1})},complete:function(){},onUpdateContents:function(e){var t=e.popup.element,i=-(new Date).getTimezoneOffset(),n=t.find("form").data("hasConflicts");t.find('input[name="tzoffset"]').val(i),n&&(t.find(".dialog-button-panel").empty(),e.addCancel(gettext("Close"),function(e){e.hide()}))},id:r.id,template:"merge-form-template",templateData:r.getData,width:r.width}).bind()}}),define("repo/getting-started",["jquery","on-ready","components/clone/clone-in-sourcetree","data/client","utils/gaq-push"],function(e,t,i,n,r){return t(function(){function t(t){var i=e(t.target),n=i.attr("href").substring(1),a=o.find('[href="#'+n+'"]').closest("li");t.preventDefault(),a.length||(a=o.filter(":first")),o.removeClass("aui-nav-selected"),a.closest("li").addClass("aui-nav-selected"),s.removeClass("selected"),e("#"+n).addClass("selected");var l=["atl._trackEvent","Repo Getting Started",n];i.hasClass("next")&&l.push("Next"),r(l)}var n=e("#repo-getting-started"),o=n.find("nav li"),s=n.find(".tab-pane"),a=n.find('#invite-friends [href="#share"]'),l=e("#start-from-scratch");n.find("nav li a, a.tab-jump").click(t),a.on("click",function(){r(["atl._trackEvent","Repo Getting Started","Send an Invitation"])}),l.on("click","a",function(t){r(e(t.target).hasClass("set-up")?["atl._trackEvent","Repo Getting Started","Set Up DVCS",l.attr("data-scm")]:["atl._trackEvent","Repo Getting Started","Bitbucket 101"])}),e("#commit-and-push").on("click","a.readme",function(){r(["atl._trackEvent","Repo Getting Started","Learn Readme"])}),e(".getting-started-choice").on("click",function(t){t.preventDefault();var i=e(this);i.toggleClass("collapsed"),i.find(".aui-icon").toggleClass("aui-iconfont-expanded").toggleClass("aui-iconfont-collapsed");var n=i.hasClass("collapsed")?"closed":"open";r(["atl._trackEvent","Repo Blank Slate",i.attr("href"),n])}),e(".getting-started-choice:visible:first").click(),e("#sourcetree-download").on("click",function(){r(["atl._trackEvent","Repo Blank Slate","Download SourceTree"])}),i(e(".clone-in-sourcetree"))})}),define("repo/overview",["aui","jquery","underscore","utils/dialog-positions","utils/exists","utils/event-tracking-helper","utils/gaq-push","utils/message-helper","utils/mustache","utils/preferences","utils/quick-filter","components/confirm-dialog","components/key-navigation","components/merge-dialog","repo/getting-started","repo/index"],function(e,t,i,n,r,o,s,a,l,c,d,h,u,f){function p(e,i){var n=400,r=setTimeout(function(){e.addClass("loading"),i&&i(),i=t.noop()},n);return{complete:function(){clearTimeout(r),e.removeClass("loading"),i&&i()}}}function m(e){i.each(e.branches||[],function(e){e.encodedName=encodeURIComponent(e.name)}),i.each(e.tags||[],function(e){e.encodedName=encodeURIComponent(e.name)})}function g(i){function n(e,n,o){var s,a=e.find("input.filter-box");e.find(".repo-stats-dialog").length?o&&o():(s=p(e,o),t.ajax({type:"get",url:i.attr("data-url"),dataType:"json"}).done(function(t){s.complete(),m(t),e.append(l.toHtml(i.attr("data-template"),t)),d(e),a=e.find("input.filter-box"),u.tabbedFilter(a,e)})),_("Stats Dialog - Displayed",r),setTimeout(function(){a.focus()},0)}var r=i.attr("id"),o={width:y};r=r.substring(0,r.length-"-trigger".length),e.InlineDialog(i,"overview-"+r,n,o)}function v(i){function n(e,n,r){var o,s=e.find(".repo-stats-dialog");s.length&&i.attr("data-cached")?r&&r():(s.empty(),o=p(e,r),t.ajax({type:"get",url:i.attr("data-url"),dataType:"json"}).done(function(t){var n=l.toHtml(i.attr("data-template"),t);o.complete(),e.removeClass("loading"),s.length?s.replaceWith(n):e.append(n),i.attr("data-cached",!0)})),_("Stats Dialog - Displayed","followers-dialog"),r&&r()}var r={width:y};e.InlineDialog(i,"overview-followers-dialog",n,r)}var b=t("#repo-stats"),_=(b.find(".stats"),o("Repo Overview")),y=292;r("#branches-dialog-trigger",g),r("#forks-dialog-trigger",g),r("#tags-dialog-trigger",g),r("#followers-dialog-trigger",v),r("#sync-repo-box",function(e){var t=e.find('a[href="#sync-repo"]'),i=e.find("a.close"),n=t.attr("data-conflict-url"),r=t.attr("data-source-repo"),o=t.attr("data-dest-repo");f(t,{getData:function(){var e,i=t.attr("data-source-branch"),n=t.attr("data-dest-branch");return e=i==n?r:"{}/{}".format(r,i),{action:t.attr("data-compare-url"),source:t.attr("data-source-value"),sourceBranch:i,sourceRepo:r,sourceAvatar:t.attr("data-source-avatar"),sourceAvatarAltText:t.attr("data-source-repo-name"),dest:t.attr("data-dest-value"),destBranch:n,destRepo:o,destAvatar:t.attr("data-dest-avatar"),destAvatarAltText:t.attr("data-dest-repo-name"),sameRepo:!1,canCloseBranch:!1,hasConflicts:!1,mergeCommands:"",commitMessageSlug:e,syncRepo:!0}},success:function(){a.addMessage("{} successfully synced with {}.".format(o,r)),window.location.reload(!0)},conflictUrl:n}),i.on("click",function(t){t.preventDefault();var n=i.attr("data-pref"),r=i.attr("data-pref-value");c.set(n,r).done(function(){e.animate({opacity:0},200,function(){e.animate({height:0},200,function(){e.remove()})}),_("Sync Repo Box - Dismissed")})})}),r("#invite-repo-box",function(e){var i=e.find('a[href="#invite-repo"]'),n=e.find("a.close");i.on("click",function(){s(["atl._trackEvent","Share","Repo overview invite user button"])}),n.on("click",function(e){e.preventDefault();var i="dismiss-invite-box-"+n.data("repo-id");c.set(i,"True").done(function(){t("#invite-repo-box").animate({opacity:0},200,function(){t(this).animate({height:0},200,function(){t("#invite-repo-box").remove()})}),s(["atl._trackEvent","Share","Dismiss repo overview invite panel"])})})}),r("#repo-stats",function(){var e=window.location.hash;if(e&&e.length>1){var i=e.substring(1);t("#"+i+"-dialog-trigger").click()}});var w=t("#followers-dialog-trigger");if(w.length){var x=t("a.follow"),k=t("#followers-list"),C=x.hasClass("following");t(document).on("follow:repo","a.follow",function(e,t){if(C!==t){C=t,k.find("li.current-user").toggleClass("hidden",!t);var i=w.find(".value"),n=+i.text();t?n++:n--,w.removeAttr("data-cached"),k.find("ol").toggleClass("empty",0===n),i.text(n);var r=w.html();w.html(1===n?r.replace(/Watchers/,"Watcher"):r.replace(/Watcher\b/,"Watchers"))}})}r("#cloud-ide",function(e){t("#cloud-ide-vendors").on("click",".ide-option",function(i){i.preventDefault();var n=t(i.target);e.find(".launch-ide").replaceWith(l.toHtml("cloud-ide-button",n.data("ide")))}),e.on("click",".launch-ide",function(i){var n=t(i.target).attr("data-id");t.ajax({url:e.attr("data-api-url"),type:"POST",data:{id:n}})})});var $=b.find("a.revoke"),D={title:$.attr("data-revoke-title"),content:$.attr("data-revoke-confirm"),buttonText:$.attr("data-revoke-button")};$.on("click",function(e){e.preventDefault(),h(D).done(function(){window.location.href=$.attr("href")})}),t(".clone-url-input",b).on("focus",function(){_("Clone Url - Focused")}),e.InlineDialog("#repo-clone-sourcetree-trigger","sourcetree-clone-dialog",function(e,i,n){t("#repo-clone-sourcetree-dialog").appendTo(e).removeClass("hidden"),n()},{width:360,closeOnTriggerClick:!0}),t("#repo-overview-download").on("click",function(){_("Download Shortcut - Link Clicked")}),t("#repo-activity").on("click",".newsfeed a",function(){_("Newsfeed - Link Clicked")}).on("click",".subscribe",function(){_("Newsfeed - Subscribe Link Clicked")}),t(".page-actions").on("click","#repo-share-link",function(){_("Share Button - Clicked")}).on("click","a.repo-watch",function(){_("Watch Prefs Dialog")}).on("follow:repo","a.follow",function(e,t){_(t?"Watch Repo":"Unwatch Repo")}),t("#repo-clone-sourcetree-trigger").on("click",function(){_("Clone in SourceTree Dialog - Displayed")}),t("#repo-clone-sourcetree-dialog").on("click",".aui-button",function(){_("Clone in SourceTree - Clicked")})}),define("components/branches/checkout-button",["underscore","utils/gaq-push"],function(e,t){return function(i,n){i.click(function(i){var r,o=e.isFunction(n.cloneUrl)?n.cloneUrl(i):n.cloneUrl,s=e.isFunction(n.branchName)?n.branchName(i):n.branchName;r=n&&"hg"===n.scm?s:"refs/heads/{}".format(s),t(["atl._trackEvent","Repo","Checkout Branch",n&&n.scm]),window.location.href="sourcetree://checkoutRef?ref={}&cloneUrl={}&type=bitbucket".format(r,o)})}}),define("utils/query-params",["jquery","underscore","utils/ready"],function(e,t,i){function n(e){if(!e)return{};for(var t={},i=0;i<e.length;++i){var n=e[i].split("=");2===n.length&&(t[n[0]]=decodeURIComponent(n[1].replace(/\+/g," ")))}return t}function r(e,t){e&&-1===a.indexOf(t)?s[t]=e:delete s[t]}function o(){}var s={},a=[];return i(function(){var e=n(window.location.search.substr(1).split("&"));s={},t.each(e,r)}),o.prototype.update=function(){var e=Array.prototype.slice.apply(arguments);return 1===e.length?t.each(e[0],r):2===e.length&&r(e[1],e[0]),this},o.prototype.get=function(){var e=Array.prototype.slice.apply(arguments);return 1===e.length?t.has(s,e[0])?s[e[0]]:null:s},o.prototype.ignore=function(e){return e&&(delete s[e],a.push(e)),this},o.prototype.asUrl=function(i){if(!t.keys(s).length)return i;var n=i.match(/([^?]*)\??/)[1];return"{url}?{query}".format({url:n,query:e.param(s)})},new o}),define("components/branches/checkout-dialog",["aui","jquery","components/branches/checkout-button","data/current-user","data/current-repo","utils/mustache","utils/query-params"],function(e,t,i,n,r,o){return function(s,a){function l(e){var i=t(e.target).closest(".sourcetree-callout");return i.attr(n.isSshEnabled?"data-ssh-url":"data-https-url")}function c(n,s,c){var h,u=e.InlineDialog.current,f=t("#checkout-branch-contents"),p=o.toHtml("branch-checkout-template",{branchName:a()});f.length?f.replaceWith(p):n.append(p),i(n.find("button"),{cloneUrl:l,branchName:a,scm:r.scm}),h=n.find("input"),h.focus(function(){var e=t(this);e.one("mouseup",function(e){e.preventDefault()}),e.select()}),c(),setTimeout(function(){return u&&u.id===d?void e.InlineDialog.current.hide():void h.select()},0)}var d="checkout-branch-dialog";t("#inline-dialog-checkout-branch-dialog").remove(),e.InlineDialog(s,d,c,{width:360})}}),define("components/code-editor/modes",[],function(){return[{label:"APL",exts:["apl"],mime:"text/apl"},{label:"ASP.NET",exts:["aspx"],mime:"application/x-aspx"},{label:"Asterisk",exts:[],mime:"text/x-asterisk"},{label:"C",exts:["c"],mime:"text/x-csrc"},{label:"C++",exts:["cpp"],mime:"text/x-c++src"},{label:"C#",exts:["cs"],mime:"text/x-csharp"},{label:"Clojure",exts:["clj"],mime:"text/x-clojure"},{label:"CoffeeScript",exts:["coffee"],mime:"text/x-coffeescript"},{label:"Common Lisp",exts:["lisp"],mime:"text/x-common-lisp"},{label:"CSS",exts:["css"],mime:"text/css"},{label:"D",exts:["d"],mime:"text/x-d"},{label:"diff",exts:["diff"],mime:"text/x-diff"},{label:"ECL",exts:[],mime:"text/x-ecl"},{label:"EJS",exts:["ejs"],mime:"application/x-ejs"},{label:"ERB",exts:["erb"],mime:"application/x-erb"},{label:"Erlang",exts:["erl"],mime:"text/x-erlang"},{label:"Gas",exts:[],mode:"gas"},{label:"GO",exts:["go"],mime:"text/x-go"},{label:"Groovy",exts:["groovy"],mime:"text/x-groovy"},{label:"Haskell",exts:["hs","lhs"],mime:"text/x-haskell"},{label:"Haxe",exts:["hx"],mime:"text/x-haxe"},{label:"HTML",exts:["html","htm"],mime:"text/html"},{label:"HTTP",exts:[],mime:"message/http"},{label:"Java",exts:["class","jar","java"],mime:"text/x-java"},{label:"JavaScript",exts:["js"],mime:"text/javascript"},{label:"Jinja2",exts:[],mode:"jinja2"},{label:"JSON",exts:["json"],mime:"application/json"},{label:"JSP",exts:["jsp"],mime:"application/x-jsp"},{label:"LESS",exts:["less"],mime:"text/x-less"},{label:"LaTeX",exts:["tex"],mime:"text/x-latex"},{label:"LiveScript",exts:["ls"],mime:"text/x-livescript"},{label:"Lua",exts:["lua"],mime:"text/x-lua"},{label:"Markdown",exts:["md",".markdown",".mkd",".mkdn",".mdown",".text"],mime:"text/x-markdown"},{label:"mIRC",exts:["mrc"],mime:"text/mirc"},{label:"N-Triples",exts:["nt"],mime:"text/n-triples"},{label:"OCaml",exts:["ml"],mime:"text/x-ocaml"},{label:"Pascal",exts:["pas"],mime:"text/x-pascal"},{label:"Perl",exts:["pl"],mime:"text/x-perl"},{label:"PHP",exts:["php"],mime:"application/x-httpd-php"},{label:"Pig",exts:[],mime:"text/x-pig"},{label:"Plain text",exts:["txt"],mime:"text/plain"},{label:"Properties files",exts:["ini"],mime:"text/x-properties"},{label:"Python",exts:["py"],mime:"text/x-python"},{label:"R",exts:["r"],mime:"text/x-rsrc"},{label:"reStructuredText",exts:["rst"],mime:"text/x-rst"},{label:"Ruby",exts:["rb"],mime:"text/x-ruby"},{label:"Rust",exts:["rs"],mime:"text/x-rustsrc"},{label:"Sass",exts:["sass"],mime:"text/x-sass"},{label:"Scala",exts:["scala"],mime:"text/x-scala"},{label:"Scheme",exts:["ss","scm"],mime:"text/x-scheme"},{label:"SCSS",exts:["scss"],mime:"text/x-scss"},{label:"Shell",exts:["sh"],mime:"text/x-sh"},{label:"Sieve",exts:[],mime:"application/sieve"},{label:"Smalltalk",exts:["sll"],mime:"text/x-stsrc"},{label:"Smarty",exts:["tpl"],mime:"text/x-smarty"},{label:"SPARQL",exts:[],mime:"application/x-sparql-query"},{label:"SQL",exts:["sql"],mime:"text/x-sql"},{label:"sTeX",exts:[],mime:"text/x-stex"},{label:"Tcl",exts:["tcl"],mime:"text/x-tcl"},{label:"TiddlyWiki ",exts:[],mime:"text/x-tiddlywiki"},{label:"TikiWiki",exts:[],mime:"text/tiki"},{label:"TypeScript",exts:["ts"],mime:"text/typescript"},{label:"VB.NET",exts:["vb"],mime:"text/x-vb"},{label:"VBScript",exts:["vbs"],mime:"text/vbscript"},{label:"Velocity",exts:["vtl"],mime:"text/velocity"},{label:"Verilog",exts:[],mime:"text/x-verilog"},{label:"XML",exts:["xml"],mime:"text/xml"},{label:"XQuery",exts:["xq","xqy","xquery"],mime:"application/xquery"},{label:"YAML",exts:["yaml"],mime:"text/x-yaml"},{label:"Z80",exts:[],mime:"text/x-z80"}]}),define("js/pullrequests/models/task",["backbone"],function(e){return e.Model.extend({defaults:{completed:!1,content:""},toJSON:function(){var e={content:{raw:this.get("content")},comment:{id:this.get("comment").id,path:this.get("comment").path},completed:this.get("completed"),creator:this.get("creator"),state:this.get("completed")?"RESOLVED":"UNRESOLVED"};return this.id&&(e.id=this.id),e},parse:function(e){return{completed:"RESOLVED"===e.state,content:e.content.raw,creator:e.creator,comment:{id:e.comment.id,path:e.comment.inline&&e.comment.inline.path},id:e.id}}})}),define("components/comments/comment",["jquery","backbone","js/pullrequests/models/task","data/current-user","data/flags"],function(e,t,i,n,r){return t.Model.extend({initialize:function(e,t){this.urlRoot=t.urlRoot},idAttribute:"comment_id",parse:function(t){return t.isAuthenticated=n.isAuthenticated,t.isEditable=t.username===n.username,t.isAdmin="admin"===e("#user-repo-privilege-data").data().priv,t.utc_created_on=t.utc_created_on.replace(" ","T"),t.convert_markup="True"===t.convert_markup,t.show_tasks=t.pull_request_id&&r.prTasks,t.allow_task_creation=e("#pullrequest").data("allow-task-creation"),t}})}),define("components/drop-target",[],function(){return function(e,t){t=t||{},t.onDrop=t.onDrop||function(){},t.canDrop=t.canDrop||function(){return!0},e.on("dragover dragenter",function(i){t.canDrop(i)&&(e.addClass("file-hover"),i.preventDefault(),i.stopPropagation())}),e.on("dragend dragleave",function(i){t.canDrop(i)&&(e.removeClass("file-hover"),i.preventDefault(),i.stopPropagation())}),e.on("drop",function(i){t.canDrop(i)&&(e.removeClass("file-hover"),t.onDrop(i),i.preventDefault(),i.stopPropagation())})}}),define("utils/browser-support",[],function(){return{ajaxUpload:"upload"in new XMLHttpRequest,formData:!!window.FormData,dragAndDrop:"draggable"in document.createElement("span"),fileReader:!!window.FileReader}}),define("components/upload-handler",["jquery","components/drop-target","utils/browser-support"],function(e,t,i){return function(n,r){function o(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);l(t.toString())}}function s(t){var i=e('<div class="upload-progress-container"></div>');return e('<div class="progress-bar"><div class="progress"></div></div>').appendTo(i),e('<div class="filename"></div>').text(t).appendTo(i),i}function a(){var e=n.parent();e.toggleClass("hidden"),s(g.name).insertAfter(e),v.find(".error-container").empty()}function l(e){v.find(".progress-bar .progress").css("width",(e||0)+"%")}function c(){n.parent().removeClass("hidden"),v.find(".upload-progress-container").remove()}function d(t){var i=v.find(".error-container");i.length||(i=e('<div class="error-container"></div>').insertBefore(n.parent())),c(),i.empty().text(t)}function h(e){c(),r.complete&&r.complete(e.target)}function u(e){r.error&&r.error(e.target),d("There was an error attempting to upload the file.")}function f(e){r.cancel&&r.cancel(e.target),d("The upload has been canceled by the user or the browser dropped the connection.")}function p(e){if(!g)return void e.preventDefault();var t=new XMLHttpRequest;if(t.upload){var i=n.parent();n.detach();var r=new FormData(v[0]);return i.append(n),r.append(n.attr("name"),g),a(),t.upload.addEventListener("progress",o,!1),t.addEventListener("load",h,!1),t.addEventListener("error",u,!1),t.addEventListener("abort",f,!1),t.open("POST",v.attr("action")),t.send(r),e.preventDefault(),!1}}function m(e){var t=e.originalEvent.dataTransfer,i=t.files;g=i[0],r.fileSelected&&r.fileSelected(g),r.uploadOnDrop&&p(e)}r=r||{};var g,v=n.closest("form"),b=r.$dropTarget||e();return i.fileReader&&n.on("change",function(){g=n.prop("files")[0],r.fileSelected&&r.fileSelected(g)}),i.ajaxUpload&&v.on("submit",p),b.length&&i.dragAndDrop&&t(b,{canDrop:r.canSelect,onDrop:m}),{selectFile:function(e){g=e,r.fileSelected&&r.fileSelected(g)}}}}),define("utils/edit-content",["jquery"],function(){return function(e,t){t.removeClass("previewing"),e.removeAttr("aria-pressed")}}),define("utils/preview-content",["jquery","data/current-repo","utils/api-helper","utils/edit-content"],function(e,t,i,n){return function(r,o){if(r.attr("aria-pressed"))n(r,o);else{var s=setTimeout(function(){o.find(".mask").show()},300),a={content:o.find("textarea").val()};t.id&&(a.repo_id=t.id),a.markup_type=o.attr("data-markup-type"),e.ajax({type:"POST",url:i.toString("content-preview"),data:a,dataType:"json",success:function(e){o.addClass("previewing"),r.attr("aria-pressed",!0),o.find(".preview-container").html(e.markup),window.MathJax&&window.MathJax.Hub.Typeset(),clearTimeout(s),o.find(".mask").hide()},error:function(){alert("There was an error rendering your preview."),clearTimeout(s),o.find(".mask").hide()}})}}}),function(root){define("jquery-plugins/jquery.jeditable",[],function(){return function(){!function($){$.fn.editable=function(e,t){if("disable"==e)return void $(this).data("disabled.editable",!0);if("enable"==e)return void $(this).data("disabled.editable",!1);if("destroy"==e)return void $(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");var i=$.extend({},$.fn.editable.defaults,{target:e},t),n=$.editable.types[i.type].plugin||function(){},r=$.editable.types[i.type].submit||function(){},o=$.editable.types[i.type].buttons||$.editable.types.defaults.buttons,s=$.editable.types[i.type].content||$.editable.types.defaults.content,a=$.editable.types[i.type].element||$.editable.types.defaults.element,l=$.editable.types[i.type].reset||$.editable.types.defaults.reset,c=i.callback||function(){},d=i.onedit||function(){},h=i.onsubmit||function(){},u=i.onreset||function(){},f=i.onerror||l;return i.tooltip&&$(this).attr("title",i.tooltip),i.autowidth="auto"==i.width,i.autoheight="auto"==i.height,this.each(function(){var e=this,t=$(e).width(),p=$(e).height();$(this).data("event.editable",i.event),$.trim($(this).html())||$(this).html(i.placeholder),$(this).bind(i.event,function(u){if(!0!==$(this).data("disabled.editable")&&!e.editing&&!1!==d.apply(this,[i,e])){u.preventDefault(),u.stopPropagation(),i.tooltip&&$(e).removeAttr("title"),0==$(e).width()?(i.width=t,i.height=p):("none"!=i.width&&(i.width=i.autowidth?$(e).width():i.width),"none"!=i.height&&(i.height=i.autoheight?$(e).height():i.height)),$(this).html().toLowerCase().replace(/(;|"|\/)/g,"")==i.placeholder.toLowerCase().replace(/(;|"|\/)/g,"")&&$(this).html(""),e.editing=!0,e.revert=$(e).html(),$(e).html("");var m=$("<form />");i.cssclass&&("inherit"==i.cssclass?m.attr("class",$(e).attr("class")):m.attr("class",i.cssclass)),i.style&&("inherit"==i.style?(m.attr("style",$(e).attr("style")),m.css("display",$(e).css("display"))):m.attr("style",i.style));var g,v=a.apply(m,[i,e]);if(i.loadurl){var b=setTimeout(function(){v.disabled=!0,s.apply(m,[i.loadtext,i,e])},100),_={};_[i.id]=e.id,$.isFunction(i.loaddata)?$.extend(_,i.loaddata.apply(e,[e.revert,i])):$.extend(_,i.loaddata),$.ajax({type:i.loadtype,url:i.loadurl,data:_,async:!1,success:function(e){window.clearTimeout(b),g=e,v.disabled=!1}})}else i.data?(g=i.data,$.isFunction(i.data)&&(g=i.data.apply(e,[e.revert,i]))):g=e.revert;s.apply(m,[g,i,e]),v.attr("name",i.name),o.apply(m,[i,e]),$(e).append(m),n.apply(m,[i,e]),$(":input:visible:enabled:first",m).focus(),i.select&&v.select(),v.keydown(function(t){27==t.keyCode&&(t.preventDefault(),l.apply(m,[i,e]))});var b;v.blur("cancel"==i.onblur?function(){b=setTimeout(function(){l.apply(m,[i,e])},500)}:"submit"==i.onblur?function(){b=setTimeout(function(){m.submit()},200)}:$.isFunction(i.onblur)?function(){i.onblur.apply(e,[v.val(),i])}:function(){}),m.submit(function(t){if(b&&clearTimeout(b),t.preventDefault(),!1!==h.apply(m,[i,e])&&!1!==r.apply(m,[i,e]))if($.isFunction(i.target)){var n=i.target.apply(e,[v.val(),i]);$(e).html(n),e.editing=!1,c.apply(e,[e.innerHTML,i]),$.trim($(e).html())||$(e).html(i.placeholder)}else{var o={};o[i.name]=v.val(),o[i.id]=e.id,$.isFunction(i.submitdata)?$.extend(o,i.submitdata.apply(e,[e.revert,i])):$.extend(o,i.submitdata),"PUT"==i.method&&(o._method="put"),$(e).html(i.indicator);var s={type:"POST",data:o,dataType:"html",url:i.target,success:function(t){"html"==s.dataType&&$(e).html(t),e.editing=!1,c.apply(e,[t,i]),$.trim($(e).html())||$(e).html(i.placeholder)},error:function(t){f.apply(m,[i,e,t])}};$.extend(s,i.ajaxoptions),$.ajax(s)}return $(e).attr("title",i.tooltip),!1})}}),this.reset=function(t){this.editing&&!1!==u.apply(t,[i,e])&&($(e).html(e.revert),e.editing=!1,$.trim($(e).html())||$(e).html(i.placeholder),i.tooltip&&$(e).attr("title",i.tooltip))}})},$.editable={types:{defaults:{element:function(){var e=$('<input type="hidden"></input>');return $(this).append(e),e},content:function(e){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(e,t){var i=this;if(e.submit){if(e.submit.match(/>$/))var n=$(e.submit).click(function(){"submit"!=n.attr("type")&&i.submit()});else{var n=$('<button type="submit" />');n.html(e.submit)}$(this).append(n)}if(e.cancel){if(e.cancel.match(/>$/))var r=$(e.cancel);else{var r=$('<button type="cancel" />');r.html(e.cancel)}$(this).append(r),$(r).click(function(){if($.isFunction($.editable.types[e.type].reset))var n=$.editable.types[e.type].reset;else var n=$.editable.types.defaults.reset;return n.apply(i,[e,t]),!1})}}},text:{element:function(e){var t=$("<input />");return"none"!=e.width&&t.width(e.width),"none"!=e.height&&t.height(e.height),t.attr("autocomplete","off"),$(this).append(t),t}},textarea:{element:function(e){var t=$("<textarea />");return e.rows?t.attr("rows",e.rows):"none"!=e.height&&t.height(e.height),e.cols?t.attr("cols",e.cols):"none"!=e.width&&t.width(e.width),$(this).append(t),t}},select:{element:function(){var e=$("<select />");return $(this).append(e),e},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}if($("select",this).children().each(function(){($(this).val()==json.selected||$(this).text()==$.trim(original.revert))&&$(this).attr("selected","selected")}),!settings.submit){var form=this;$("select",this).change(function(){form.submit()})}}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery)}.apply(root,arguments)})}(this),define("config/markitup",["jquery","aui","underscore","components/drop-target","components/upload-handler","data/current-repo","data/current-user","data/flags","utils/browser-support","utils/mustache","utils/preview-content","jquery-plugins/jquery.jeditable"],function(e,t,i,n,r,o,s,a,l,c,d){function h(e,t,i){var n=Array(e+1).join(t.header);return{name:"Heading "+e,className:[t.classname,"heading-"+e,i].join(" "),openWith:n+" ",closeWith:" "+n,placeHolder:"Your title here..."}}function u(e){return{name:"Section",className:[e.classname,"heading-single","first","last"].join(" "),placeHolder:"Section",closeWith:function(t){var i=7;t.selection&&t.selection.length&&(i=t.selection.length);var n=Array(i+1).join(e.header);return"\n"+n+"\n"}}}function f(e,t,i){return{name:"Heading "+e,className:[t.classname,"heading-"+e,i].join(" "),openWith:"h"+e+". ",placeHolder:"Your title here..."}}function p(e){return{name:"Bold",className:[e.classname,"bold","first","separator"].join(" "),openWith:e.bold,closeWith:e.bold}}function m(e){return{name:"Italic",className:[e.classname,"italic","last"].join(" "),openWith:e.italic,closeWith:e.italic}}function g(e){return{name:"Bulleted list",className:[e.classname,"bulleted-list","first","separator"].join(" "),openWith:e.ul,multiline:!0}}function v(e){return{name:"Numeric list",className:[e.classname,"numeric-list","last"].join(" "),openWith:e.ol,multiline:!0}}function b(e){return{name:"Code",className:[e.classname,"code","first","last","separator"].join(" "),openBlockWith:e.codeOpenBlock,closeBlockWith:e.codeCloseBlock,openWith:e.codeOpen,closeWith:e.codeClose,multiline:!0}}function _(e,t,i,n){return n.unshift(e.classname),{name:t,className:n.join(" "),replaceWith:i}}function y(e){return{name:"Image",className:[e.classname,"image","last"].join(" "),replaceWith:C(e)}}function w(){return M||(M=k()),M}function x(e){var t=e.originalEvent.dataTransfer;return i.contains(t.types,"Files")}function k(){function n(){f.closest("form").submit()}function o(){g.hide(),f.val(""),a.remove(),h.removeClass("hidden error")}var s=e(c.toHtml("image-upload-template")),a=e("<img>").addClass("preview centered"),d=s.find(".drop-target"),h=d.find("p"),u=s.find(".click-target"),f=s.find(".file-target"),p=f.attr("accept").split(", "),m=r(f,{$dropTarget:d,complete:function(e){200===e.status?(o(),I(e)):e.status>=400&&e.status<500&&h.addClass("error").text(e.response)},canSelect:x,fileSelected:function(e){if(e){if(e.size>1048576)return h.addClass("error").removeClass("hidden").text(gettext("File cannot be larger than 1 MB.")),m.selectFile(null),void a.remove();if(!i.contains(p,e.type))return h.addClass("error").removeClass("hidden").text(gettext("Only images are allowed.")),m.selectFile(null),void a.remove();h.removeClass("error").addClass("hidden"),a.attr("src",window.URL.createObjectURL(e)),d.prepend(a)}}});l.fileReader||(d.addClass("hidden"),f.removeClass("hidden")),u.on("click",function(e){e.preventDefault(),f.click()});var g=new t.Dialog({id:"upload-image",width:450,height:"auto"});return g.addHeader("Upload image"),g.addPanel("main",s),g.addButton("Upload",n),g.addLink("Cancel",o,"left"),g.selectFile=m.selectFile,g}function C(e){return function(t){var i=t.textarea,n=i.selectionStart,r=i.selectionEnd,o=i.value.substring(n,r);I=function(t){var s=JSON.parse(t.response),a=e.customImage.replace("url",s.href).replace("name",o||s.filename);if(document.selection){var l=document.selection.createRange();l.text=a}else i.value=i.value.substring(0,n)+a+i.value.substring(r,i.value.length)},w().show()}}function $(){return{name:"Preview",className:"preview first last right no-icon",beforeInsert:function(t){var i=e(t.textarea),n=i.closest(".textarea-preview"),r=n.find(".markItUpHeader .markItUpButton.preview a");r.text(r.attr("aria-pressed")?"Preview":"Edit"),d(r,n)}}}function D(){return{name:"Language",className:"language first last right no-icon hidden",call:function(){e("#dropdown-wiki-lang ul").show()}}}function T(e,t){return{name:"Help",className:[e.classname,"help","first","last","right"].join(" "),call:function(){var e="https://confluence.atlassian.com/x/jIAuEg";t&&(e="https://confluence.atlassian.com/x/FA4zDQ"),window.open(e,"_blank")}}}function j(){return[h(1,A,"first"),h(2,A),h(3,A,"last"),p(A),m(A),g(A),v(A),b(A),_(A,"Link",A.link,["first","link"])]}function E(){return[h(1,L,"first"),h(2,L),h(3,L,"last"),p(L),m(L),g(L),v(L),b(L),_(L,"Link",L.link,["first","link"])]}function S(){return[u(B),p(B),m(B),g(B),v(B),b(B),_(B,"Link",B.link,["first","link"])]}function q(){return[f(1,F,"first"),f(2,F),f(3,F,"last"),p(F),m(F),g(F),v(F),b(F),_(F,"Link",F.link,["first","link"])]}function P(t,i){var r=[];return r=i.isWiki?r.concat(j(),E(),S(),q()):H[i.syntax](),a.uploadImage&&l.formData&&s.isAuthenticated?(r.push(y(A)),i.isWiki&&(r.push(y(L)),r.push(y(B)),r.push(y(F))),t.each(function(t,i){n(e(i),{canDrop:x,onDrop:function(e){var t=e.originalEvent.dataTransfer;w().selectFile(t.files[0]),C(A)({textarea:i})}})})):(r.push(_(A,"Image",A.image,["image"])),i.isWiki&&(r.push(_(L,"Image",L.image,["image"])),r.push(_(B,"Image",B.image,["image"])),r.push(_(F,"Image",F.image,["image"])))),r.push($()),i.isWiki&&r.push(D()),r.push(T(A,i.isWiki)),i.isWiki&&(r.push(T(L,!0)),r.push(T(B,!0)),r.push(T(F,!0))),r}e.fn.editable.defaults.placeholder="";var M,R=o.pygmentsLanguage||"python",I=function(){},A={classname:"markdown",header:"#",bold:"**",italic:"*",ul:"(!(* |!|*)!)",ol:"(!(1. |!|1.)!)",codeOpenBlock:"(!(\n```\n#![![Language:!:"+R+"]!]\n\n|!|<pre>)!)",codeCloseBlock:"\n```\n",link:"[[![Link Text]!]]([![Link URL]!])",image:"![[![Image Alt Text]!]]([![Image URL]!])",customImage:"![name](url)"},L={classname:"creole",header:"=",bold:"**",italic:"//",ul:"(!(* |!|*)!)",ol:"(!(# |!|#)!)",codeOpenBlock:"(!({{{\n#![![Language:!:"+R+"]!]\n\n|!|<pre>)!)",codeCloseBlock:"(!(\n}}}|!|</pre>)!)",link:"[[[![Link URL]!]|[![Link Text]!]]]",image:"{{[![Image URL]!]|[![Image Title]!]}}",customImage:"{{url|name}}"},B={classname:"rest",header:"=",bold:"**",italic:"*",ul:"(!(* |!|*)!)",ol:"(!(#. |!|#.)!)",codeOpenBlock:"\n.. sourcecode:: [![Language:!:"+R+"]!]\n\n",codeOpen:"    ",codeCloseBlock:"\n",link:"`[![Link Text]!] <[![Link URL]!]>`_",image:".. image:: [![Image URL]!]\n   :alt: [![Image Alt Text]!]",customImage:".. image:: url\n   :alt: name"},F={classname:"textile",bold:"*",italic:"_",ul:"(!(* |!|*)!)",ol:"(!(# |!|#)!)",codeOpenBlock:"\npre. \n",codeCloseBlock:"\n",link:'"[![Link Text]!]":[![Link URL]!]',image:"![![Image URL]!]([![Image Title:!: ]!])!",customImage:"!url(title)!"},H={markdown:j,creole:E,rest:S,textile:q};return function(e){return e=e||{},e.syntax=e.syntax||"markdown",function(t){return{nameSpace:"markup-type-"+e.syntax,previewParserPath:"",resizeHandle:!1,onShiftEnter:{keepDefault:!1,replaceWith:"\n\n"},markupSet:P(t.element,e)}}}}),function(root){define("jquery-plugins/jquery.markitup",[],function(){return function(){!function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;return ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),"function"==typeof settings&&(settings=settings({element:this})),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])
}),this.each(function(){function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&$.browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,i,n=$$.height(),r=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+n-r)+"px"),!1},i=function(){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",i),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",i)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){t.target!==!1&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton '+(button.className||"")+'"><a href="" '+key+' title="'+title+'" tabindex="-1">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("mouseup.markItUp",function(e){e.preventDefault()}).bind("focusin.markItUp",function(){$$.focus()}).bind("click.markItUp",function(e){e.preventDefault(),button.call?eval(button.call)():setTimeout(function(){markup(button)},1)}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){if(e){e=e.toString(),e=e.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var i=t.split("|!|");return altKey===!0?void 0!==i[1]?i[1]:i[0]:void 0===i[1]?"":i[0]});var t={};return e=e.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,i){var n=i.split(":!:"),r=n[0];return Object.prototype.hasOwnProperty.call(t,r)?t[r]:abort===!0?!1:(value=prompt(n[0],n[1]?n[1]:""),null===value&&(abort=!0),t[r]=value,value)})}return""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),i=prepare(clicked.placeHolder),n=prepare(clicked.replaceWith),r=prepare(clicked.closeWith),o=prepare(clicked.openBlockWith),s=prepare(clicked.closeBlockWith),a=clicked.multiline;if(""!==n)block=t+n+r;else if(""===selection&&""!==i)block=t+i+r;else{e=e||selection;var l=[e],c=[];a===!0&&(l=e.split(/\r?\n/));for(var d=0;d<l.length;d++){line=l[d];var h;c.push((h=line.match(/ *$/))?t+line.replace(/ *$/g,"")+r+h:t+line+r)}block=c.join("\n")}return block=o+block+s,{block:block,openBlockWith:o,openWith:t,replaceWith:n,placeHolder:i,closeWith:r,closeBlockWith:s}}function markup(e){var t,i,n,r,o;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),i=0,n=lines.length,r=0;n>r;r++)""!==$.trim(lines[r])?($.extend(hash,{line:++i,selection:lines[r]}),lines[r]=build(lines[r]).block):lines[r]="";string={block:lines.join("\n")},o=caretPosition,t=string.block.length+($.browser.opera?n-1:0)}else ctrlKey===!0?(string=build(selection),o=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),o=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),o=caretPosition+string.block.length,t=0,o-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),o=caretPosition+string.openBlockWith.length+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length-string.openBlockWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&abort===!1?(insert(string.block),set(o,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return $.browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return $.browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){if(document.selection){var t=document.selection.createRange();t.text=e}else textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(textarea.focus(),scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,$.browser.msie){var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){var e=options.previewParser($$.val());writeInPreview(localize(e,1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(t){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=e.altKey&&e.ctrlKey?!1:e.ctrlKey||e.metaKey,"keydown"===e.type){if(ctrlKey===!0&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,setTimeout(function(){li.triggerHandler("mouseup")},1),!1;if(13===e.keyCode||10===e.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1==shiftKey||1==ctrlKey||1==altKey?!1:-1!==caretOffset?(get(),caretOffset=$$.val().length-caretOffset,console.log("caret offset"),set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault)}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init()})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};return $.extend(t,e),t.target?$(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])}):void $("textarea").trigger("insertion",[t])}}(jQuery)}.apply(root,arguments)})}(this),define("components/comments/comment-form",["jquery","data/current-user","config/markitup","utils/edit-content","utils/mustache","jquery-plugins/jquery.markitup"],function(e,t,i,n,r){var o=function(e){this.comment=e,this.$elem=null,this.$editor=null,this.$textarea=null,this.$submit=null,this.$cancel=null,this.$preview=null,this.$error=null,this.$convertMarkupWarning=null};return o.prototype.errorMessages={400:gettext("There was a problem submitting your comment."),403:gettext("You are not permitted to comment."),404:gettext("This comment has been deleted.")},o.prototype.decorate=function(e){return this.$elem=e,this.renderInternal(),this.enterDocument(),this},o.prototype.renderInternal=function(){this.$editor=this.$elem.find("form.editor"),this.$textarea=this.$editor.find("textarea"),this.$submit=this.$editor.find("button[type=submit]"),this.$cancel=this.$editor.find("a.cancel"),this.$preview=this.$editor.find("a.preview"),this.$error=this.$elem.find(".error"),this.$convertMarkupWarning=this.$elem.find(".convert-markup")},o.prototype.createDom=function(){var i=e.extend({user_avatar_url:t.avatarUrl,display_name:t.displayName},this.comment?this.comment.attributes:{});this.$elem=e(r.toHtml("new-comment-template",i))},o.prototype.render=function(e){return this.createDom(),this.renderInternal(),e.prepend(this.$elem),this.enterDocument(),this},o.prototype.enterDocument=function(){this.$textarea.on("focus",e.proxy(this.expandSize,this)),this.$submit.on("click keydown",e.proxy(this.save,this)),this.$cancel.on("click",e.proxy(this.cancel,this)),this.$preview.on("click",e.proxy(this.preview,this))},o.prototype.expandSize=function(){var e=this.$textarea;this.$editor.addClass("focused"),this.$textarea.hasClass("markItUpEditor")||(this.$editor.addClass("textarea-preview"),this.$textarea.markItUp(i()),setTimeout(function(){e.trigger("focus")},0))},o.prototype.shrinkSize=function(){this.$textarea.markItUpRemove(),this.$editor.removeClass("textarea-preview"),this.$editor.removeClass("focused")},o.prototype.cancel=function(t){t&&t.preventDefault(),this.clearContents(),n(this.$preview,this.$editor),this.shrinkSize(),e(this).trigger("comment-form/cancel")},o.prototype.clearContents=function(){this.$textarea.val(""),this.clearError()},o.prototype.showAndFocus=function(){this.$editor.show(),this.$elem.show(),this.$textarea.focus(),this.$convertMarkupWarning.toggle(this.comment.get("convert_markup"))},o.prototype.isSubmitDisabled=function(){return this.$submit.prop("disabled")},o.prototype.disableSubmit=function(){this.$submit.prop("disabled",!0).attr("aria-disabled","true")},o.prototype.enableSubmit=function(){this.$submit.prop("disabled",!1).removeAttr("aria-disabled")},o.prototype.save=function(e){if("keydown"!==e.type||13===e.keyCode){e.preventDefault();var t=this;if(!t.isSubmitDisabled()){var i=setTimeout(function(){t.clearError(),t.$editor.addClass("loading")},300);t.disableSubmit();var r=function(){clearTimeout(i),t.$editor.removeClass("loading"),t.enableSubmit(),n(t.$preview,t.$editor)};t.comment.save({content:t.$textarea.val()},{wait:!0,complete:r,error:function(e,i){t.displayError(t.errorMessages[i.status])}})}}},o.prototype.displayError=function(e){this.$error.text(e)},o.prototype.clearError=function(){this.$error.text("")},o}),function(e,t){if("function"==typeof define&&define.amd)define("marionette-lib",["backbone","underscore"],function(i,n){return e.Marionette=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=t(e,e.Backbone,e._)}(this,function(e,t,i){function n(e,t){var i=new Error(e);throw i.name=t||"Error",i}!function(e,t){var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.4",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};return e.Wreqr.VERSION="1.3.1",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),i}(),n.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,i)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,i,n){var r=this.storage.getCommands(e);t.each(r.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n),n.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.hasHandler(e)?this.getHandler(e).apply(this,t):void 0}})}(n),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(){var i=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var r="vent"===e?"on":"setHandler";t.each(i,function(i,o){this[e][r](o,t.bind(i,n))},this)}}}),i}(n),n.radio=function(e){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(e,t,i){return function(n){var r=e._getChannel(n)[t],o=Array.prototype.slice.call(arguments,1);return r[i].apply(r,o)}};return new i}(n),e.Wreqr}(t,i);var r=e.Marionette,o=t.Marionette={};o.VERSION="2.0.3",o.noConflict=function(){return e.Marionette=r,this},t.Marionette=o,o.Deferred=t.$.Deferred;var s=Array.prototype.slice;return o.extend=t.Model.extend,o.getOption=function(e,t){if(e&&t){var i;return i=e.options&&void 0!==e.options[t]?e.options[t]:e[t]}},o.proxyGetOption=function(e){return o.getOption(this,e)},o.normalizeMethods=function(e){var t,n={};return i.each(e,function(e,r){t=e,i.isFunction(t)||(t=this[t]),t&&(n[r]=t)},this),n},o.normalizeUIKeys=function(e,t){return"undefined"!=typeof e?(i.each(i.keys(e),function(i){var n=/@ui.[a-zA-Z_$0-9]*/g;i.match(n)&&(e[i.replace(n,function(e){return t[e.slice(4)]})]=e[i],delete e[i])}),e):void 0},o.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),r=[e].concat(i.toArray(arguments));return i[n].apply(i,r)}})},o.triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi,n=function(n){var r,o="on"+n.replace(t,e),s=this[o];return i.isFunction(s)&&(r=s.apply(this,i.tail(arguments))),i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),r};return n}(),o.MonitorDOMRefresh=function(e){function t(e){e._isShown=!0,r(e)}function n(e){e._isRendered=!0,r(e)}function r(e){e._isShown&&e._isRendered&&o(e)&&i.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}function o(t){return e.contains(t.el)}return function(e){e.listenTo(e,"show",function(){t(e)}),e.listenTo(e,"render",function(){n(e)})}}(document.documentElement),function(e){function t(e,t,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=e[i];o||n('Method "'+i+'" was configured as an event handler, but does not exist.'),e.listenTo(t,r,o)})}function r(e,t,i,n){e.listenTo(t,i,n)}function o(e,t,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=e[i];e.stopListening(t,n,r)})}function s(e,t,i,n){e.stopListening(t,i,n)}function a(e,t,n,r,o){t&&n&&(i.isFunction(n)&&(n=n.call(e)),i.each(n,function(n,s){i.isFunction(n)?r(e,t,s,n):o(e,t,s,n)}))}e.bindEntityEvents=function(e,i,n){a(e,i,n,r,t)},e.unbindEntityEvents=function(e,t,i){a(e,t,i,s,o)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(o),o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),o.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,t.Events,{destroy:function(){var e=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.triggerMethod.apply(this,["destroy"].concat(e)),this.stopListening(),this.off()},triggerMethod:o.triggerMethod,getOption:o.proxyGetOption}),o.Region=function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,this.el||n('An "el" must be specified for a region.',"NoElError"),this.$el=this.getEl(this.el),this.initialize){var i=Array.prototype.slice.apply(arguments);this.initialize.apply(this,i)}},i.extend(o.Region,{buildRegion:function(e,r){var o=i.isString(e),s=i.isString(e.selector),a=i.isUndefined(e.regionClass),l=i.isFunction(e);l||o||s||n("Region must be specified as a Region class,a selector string or an object with selector property");var c,d;o&&(c=e),e.selector&&(c=e.selector,delete e.selector),l&&(d=e),!l&&a&&(d=r),e.regionClass&&(d=e.regionClass,delete e.regionClass),(o||l)&&(e={}),e.el=c;var h=new d(e);return e.parentEl&&(h.getEl=function(n){if(i.isObject(n))return t.$(n);var r=e.parentEl;return i.isFunction(r)&&(r=r()),r.find(n)}),h}}),i.extend(o.Region.prototype,t.Events,{show:function(e,t){this._ensureElement();var n=t||{},r=e!==this.currentView,o=!!n.preventDestroy,s=!!n.forceShow,a=!!this.currentView,l=!o&&r;l&&this.empty();var c=r||s;return c?(e.once("destroy",i.bind(this.empty,this)),e.render(),a&&this.triggerMethod("before:swap",e),this.triggerMethod("before:show",e),i.isFunction(e.triggerMethod)?e.triggerMethod("before:show"):this.triggerMethod.call(e,"before:show"),this.attachHtml(e),this.currentView=e,a&&this.triggerMethod("swap",e),this.triggerMethod("show",e),i.isFunction(e.triggerMethod)?e.triggerMethod("show"):this.triggerMethod.call(e,"show"),this):this},_ensureElement:function(){i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),this.$el&&0!==this.$el.length||n('An "el" '+this.$el.selector+" must exist in DOM")},getEl:function(e){return t.$(e)},attachHtml:function(e){this.el.innerHTML="",this.el.appendChild(e.el)},empty:function(){var e=this.currentView;e&&(this.triggerMethod("before:empty",e),this._destroyView(),this.triggerMethod("empty",e),delete this.currentView)},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&e.remove()},attachView:function(e){this.currentView=e},reset:function(){this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el},getOption:o.proxyGetOption,triggerMethod:o.triggerMethod}),o.Region.extend=o.extend,o.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.call(this,t)},addRegions:function(e,t){var n={};return i.each(e,function(e,r){i.isString(e)&&(e={selector:e}),e.selector&&(e=i.defaults({},e,t));var o=this.addRegion(r,e);n[r]=o},this),n},addRegion:function(t,n){var r,o=i.isObject(n),s=i.isString(n),a=!!n.selector;return r=s||o&&a?e.Region.buildRegion(n,e.Region):i.isFunction(n)?e.Region.buildRegion(n,e.Region):n,this.triggerMethod("before:add:region",t,r),this._store(t,r),this.triggerMethod("add:region",t,r),r},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){i.each(this._regions,function(e,t){this._remove(t,e)},this)},emptyRegions:function(){i.each(this._regions,function(e){e.empty()},this)},destroy:function(){this.removeRegions(),e.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete this._regions[e],this._setLength(),this.triggerMethod("remove:region",e,t)},_setLength:function(){this.length=i.size(this._regions)}});return e.actAsCollection(t.prototype,"_regions"),t}(o),o.TemplateCache=function(e){this.templateId=e},i.extend(o.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new o.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=s.call(arguments),i=t.length;if(i>0)for(e=0;i>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var i=t.$(e).html();return i&&0!==i.length||n('Could not find template: "'+e+'"',"NoTemplateError"),i},compileTemplate:function(e){return i.template(e)}}),o.Renderer={render:function(e,t){e||n("Cannot render the template since its false, null or undefined.","TemplateNotFoundError");var i;return(i="function"==typeof e?e:o.TemplateCache.get(e))(t)}},o.View=t.View.extend({constructor:function(e){i.bindAll(this,"render"),this.options=i.extend({},i.result(this,"options"),i.isFunction(e)?e.call(this):e),this.events=this.normalizeUIKeys(i.result(this,"events")),i.isObject(this.behaviors)&&new o.Behaviors(this),t.View.apply(this,arguments),o.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return i.isFunction(t)&&(t=t.call(this)),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"ui"),n=i.result(this,"_uiBindings");return o.normalizeUIKeys(e,n||t)},configureTriggers:function(){if(this.triggers){var e={},t=this.normalizeUIKeys(i.result(this,"triggers"));return i.each(t,function(t,n){var r=i.isObject(t),o=r?t.event:t;e[n]=function(e){if(e){var i=e.preventDefault,n=e.stopPropagation,s=r?t.preventDefault:i,a=r?t.stopPropagation:n;s&&i&&i.apply(e),a&&n&&n.apply(e)}var l={view:this,model:this.model,collection:this.collection};this.triggerMethod(o,l)}},this),e}},delegateEvents:function(e){this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,i.isFunction(e)&&(e=e.call(this)),e=this.normalizeUIKeys(e);var n={},r=i.result(this,"behaviorEvents")||{},o=this.configureTriggers();i.extend(n,r,e,o),t.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);t.View.prototype.undelegateEvents.apply(this,e),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"))},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed){var e=new Error("Cannot use a view thats already been destroyed.");throw e.name="ViewDestroyedError",e}},destroy:function(){if(!this.isDestroyed){var e=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.remove()}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(e),function(t){var i=e[t];this.ui[t]=this.$(i)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},triggerMethod:o.triggerMethod,normalizeMethods:o.normalizeMethods,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this._ensureViewIsIntact(),this.triggerMethod("before:render",this);var e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate(),i=o.Renderer.render(t,e);return this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render",this),this},attachElContent:function(e){return this.$el.html(e),this},destroy:function(){this.isDestroyed||o.View.prototype.destroy.apply(this,arguments)}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",constructor:function(e){var t=e||{};this.sort=i.isUndefined(t.sort)?!0:t.sort,this._initChildViewStorage(),o.View.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&i.invoke(this._bufferedChildren,"triggerMethod","before:show")},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,function(e){i.isFunction(e.triggerMethod)?e.triggerMethod("show"):o.triggerMethod.call(e,"show")
}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e){this.destroyEmptyView();var t=this.getChildView(e),i=this.collection.indexOf(e);this.addChild(e,t,i)},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},onShowCalled:function(){this.children.each(function(e){i.isFunction(e.triggerMethod)?e.triggerMethod("show"):o.triggerMethod.call(e,"show")})},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},_sortViews:function(){var e=this.collection.find(function(e,t){var i=this.children.findByModel(e);return i&&i._index!==t},this);e&&this.render()},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var e;this.collection.each(function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.destroyChildren(),delete this._showingEmptyView)},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(n)&&(n=n.call(this));var r=this.buildChildView(e,t,n);this._isShown&&this.triggerMethod.call(r,"before:show"),this.children.add(r),this.renderChildView(r,-1),this._isShown&&this.triggerMethod.call(r,"show")},getChildView:function(){var e=this.getOption("childView");return e||n('A "childView" must be specified',"NoChildViewError"),e},addChild:function(e,t,n){var r=this.getOption("childViewOptions");i.isFunction(r)&&(r=r.call(this,e,n));var o=this.buildChildView(e,t,r);return this._updateIndices(o,!0,n),this._addChildView(o,n),o},_updateIndices:function(e,t,i){this.sort&&(t?(e._index=i,this.children.each(function(t){t._index>=e._index&&t._index++})):this.children.each(function(t){t._index>=e._index&&t._index--}))},_addChildView:function(e,t){this.proxyChildEvents(e),this.triggerMethod("before:add:child",e),this.children.add(e),this.renderChildView(e,t),this._isShown&&!this.isBuffering&&(i.isFunction(e.triggerMethod)?e.triggerMethod("show"):o.triggerMethod.call(e,"show")),this.triggerMethod("add:child",e)},renderChildView:function(e,t){e.render(),this.attachHtml(this,e,t)},buildChildView:function(e,t,n){var r=i.extend({model:e},n);return new t(r)},removeChildView:function(e){e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1))},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},attachHtml:function(e,t,i){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i,n=this.sort&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),i?(i.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){this.isDestroyed||(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){this.children.each(this.removeChildView,this),this.checkEmpty()},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=Array.prototype.slice.call(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+r,n.splice(1,0,e),"undefined"!=typeof o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)},this)}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))})},getChildView:function(){var e=this.getOption("childView")||this.constructor;return e||n('A "childView" must be specified',"NoChildViewError"),e},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderRoot(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&o.CollectionView.prototype._renderChildren.call(this)},_renderRoot:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=o.Renderer.render(t,e);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this);t.append(e.el)},getChildViewContainer:function(e){if("$childViewContainer"in e)return e.$childViewContainer;var t,r=o.getOption(e,"childViewContainer");if(r){var s=i.isFunction(r)?r.call(e):r;t="@"===s.charAt(0)&&e.ui?e.ui[s.substr(4)]:e.$(s),t.length<=0&&n('The specified "childViewContainer" was not found: '+e.childViewContainer,"ChildViewContainerMissingError")}else t=e.$el;return e.$childViewContainer=t,t},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),o.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){this.isDestroyed||(this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(e,t){this.triggerMethod("before:region:add",e);var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return this.triggerMethod("before:region:remove",e),delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t=this,i={regionClass:this.getOption("regionClass"),parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,i)},_initializeRegions:function(e){var t;this._initRegionManager(),t=i.isFunction(this.regions)?this.regions(e):this.regions||{};var n=this.getOption.call(e,"regions");i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.emptyRegions(),this.regionManager.each(function(e){e.reset()})},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})}}),o.Behavior=function(e,t){function i(t,i){this.view=i,this.defaults=e.result(this,"defaults")||{},this.options=e.extend({},this.defaults,t),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return e.extend(i.prototype,t.Events,{initialize:function(){},destroy:function(){this.stopListening()},triggerMethod:o.triggerMethod,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),i.extend=o.extend,i}(i,t),o.Behaviors=function(e,t){function i(e,r){r=i.parseBehaviors(e,r||t.result(e,"behaviors")),i.wrap(e,r,t.keys(n))}var n={setElement:function(e,i){e.apply(this,t.tail(arguments,2)),t.each(i,function(e){e.$el=this.$el},this)},destroy:function(e,i){var n=t.tail(arguments,2);e.apply(this,n),t.invoke(i,"destroy",n)},bindUIElements:function(e,i){e.apply(this),t.invoke(i,e)},unbindUIElements:function(e,i){e.apply(this),t.invoke(i,e)},triggerMethod:function(e,i){var n=t.tail(arguments,2);e.apply(this,n),t.each(i,function(t){e.apply(t,n)})},delegateEvents:function(i,n){var r=t.tail(arguments,2);i.apply(this,r),t.each(n,function(t){e.bindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.bindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this)},undelegateEvents:function(i,n){var r=t.tail(arguments,2);i.apply(this,r),t.each(n,function(t){e.unbindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.unbindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this)},behaviorEvents:function(i,n){var r={},o=t.result(this,"ui");return t.each(n,function(i,n){var s={},a=t.clone(t.result(i,"events"))||{},l=t.result(i,"ui"),c=t.extend({},o,l);a=e.normalizeUIKeys(a,c),t.each(t.keys(a),function(e){var r=new Array(n+2).join(" "),o=e+r,l=t.isFunction(a[e])?a[e]:i[a[e]];s[o]=t.bind(l,i)}),r=t.extend(r,s)}),r}};return t.extend(i,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored.See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(e,n){return e.behaviorClass?e.behaviorClass:t.isFunction(i.behaviorsLookup)?i.behaviorsLookup.apply(this,arguments)[n]:i.behaviorsLookup[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,r){var o=i.getBehaviorClass(n,r),s=new o(n,e),a=i.parseBehaviors(e,t.result(s,"behaviors"));return[s].concat(a)}).flatten().value()},wrap:function(e,i,r){t.each(r,function(r){e[r]=t.partial(n[r],e[r],i)})}}),i}(o,i),o.AppRouter=t.Router.extend({constructor:function(e){t.Router.apply(this,arguments),this.options=e||{};var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){var n=i.invert(this.appRoutes)[e];i.isFunction(this.onRoute)&&this.onRoute(e,n,t)},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,r){var o=e[r];o||n('Method "'+r+'" was not found on the controller'),this.route(t,r,i.bind(o,e))},getOption:o.proxyGetOption}),o.Application=function(e){this._initRegionManager(),this._initCallbacks=new o.Callbacks;var n=t.Wreqr.radio.channel("global");this.vent=n.vent,this.commands=n.commands,this.reqres=n.reqres,this.submodules={},i.extend(this,e)},i.extend(o.Application.prototype,t.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){this._regionManager.emptyRegions()},removeRegion:function(e){this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var i=o.Module.getClass(t),n=s.call(arguments);return n.unshift(this),i.create.apply(i,n)},_initRegionManager:function(){this._regionManager=new o.RegionManager,this.listenTo(this._regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this._regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this._regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},triggerMethod:o.triggerMethod}),o.Application.extend=o.extend,o.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,t.Events,{initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,o,t.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(e,t,n){var r=e,o=s.call(arguments);o.splice(0,3),t=t.split(".");var a=t.length,l=[];return l[a-1]=n,i.each(t,function(t,i){var s=r;r=this._getModule(s,t,e,n),this._addModuleDefinition(s,r,l[i],o)},this),r},_getModule:function(e,t,n,r){var o=i.extend({},r),s=this.getClass(r),a=e[t];return a||(a=new s(t,n,o),e[t]=a,e.submodules[t]=a),a},getClass:function(e){var t=o.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,o)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof o.Module?(n=t.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(e)?(n=e.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof o.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),o}),define("marionette",["marionette-lib","mustache"],function(e,t){return e.TemplateCache.prototype.compileTemplate=function(e){return t.compile(e)},e}),define("js/pullrequests/app",["marionette"],function(e){return new e.Application}),define("js/pullrequests/collections/tasks",["backbone","js/pullrequests/models/task","data/current-repo"],function(e,t,i){return e.Collection.extend({model:t,initialize:function(e,t){t=t||{},this.pullrequest=t.pullrequest},parse:function(e){return e.values},getUnsaved:function(){return this.findWhere({id:void 0})},url:function(){return"/api/internal/repositories/{owner}/{slug}/pullrequests/{pullRequestId}/tasks/".format({owner:i.owner.username,slug:i.slug,pullRequestId:this.pullrequest.id})}})}),define("js/pullrequests/events",["backbone.wreqr"],function(e){return e.radio.channel("pullrequests")}),define("js/pullrequests/data/can-manage-tasks",["jquery"],function(e){var t="admin"===e("#user-repo-privilege-data").attr("data-priv"),i=e("#pullrequest-author").data("currentUserIsAuthor");return t||i}),define("js/pullrequests/views/task",["underscore","marionette","data/current-user","js/pullrequests/events","js/pullrequests/data/can-manage-tasks"],function(e,t,i,n,r){return t.ItemView.extend({tagName:"li",template:"#task-template",className:function(){var e=["task","iterable-item"];return e=e.concat(this.getClassNames()),e.join(" ")},getClassNames:function(){var e=[];return this.model.get("completed")&&e.push("completed"),e},initialize:function(){this.listenTo(n.vent,"keypress:32",this.toggleStatusWithSpacebar)},events:{"click @ui.contextLink":"goToTaskContext","click @ui.deleteLink":"deleteTask","click @ui.editLink":"editTask","click @ui.saveLink":"saveTask","click @ui.cancelLink":"cancelEdit","click @ui.status":"changeCompleted","input @ui.input":"setInputHeight","keydown @ui.input":"keyInput"},modelEvents:{"change:completed":"onChangeCompleted","change:content":"render",edit:"editTask"},editing:!1,ui:{status:".task-status",contextLink:".context-link",deleteLink:".delete-task",editLink:".edit-task",saveLink:".save-task",cancelLink:".cancel-edit",input:".edit-description"},templateHelpers:function(){var e=this.model.get("creator");return{editing:this.editing,isAuthenticated:i.isAuthenticated,isEditable:e&&i.username===e.username||r,hasReadAccess:"None"!==$("#user-repo-privilege-data").data("priv")}},goToTaskContext:function(){n.vent.trigger("taskContextLinkClicked",this.model)},deleteTask:function(){this.model.destroy()},editTask:function(){this.editing||(this.editing=!0,this.$el.toggleClass("editing",!0),this.render()),this.focusDescription()},stopEditing:function(){this.editing=!1,this.$el.toggleClass("editing",!1),this.render()},saveTask:function(){return this.ui.input.val()?(this.model.set("content",this.ui.input.val()),this.model.hasChanged("content")&&(this.model.get("creator")||this.model.set("creator",{username:i.username}),this.model.save({},{wait:!0})),void this.stopEditing()):void this.model.destroy()},cancelEdit:function(){return this.model.get("content")?void this.stopEditing():void this.model.destroy()},setInputHeight:e.debounce(function(){var e=this.ui.input[0];e.clientHeight===e.scrollHeight&&(e.style.height=""),e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+"px")},50),focusDescription:function(){this.editing&&(this.setInputHeight(),this.ui.input.focus())},changeCompleted:function(e){return this.editing?void e.preventDefault():void this.model.save("completed",this.ui.status.is(":checked"))},onChangeCompleted:function(){var e=this.model.get("completed");this.$el.toggleClass("completed",e),this.ui.status.prop("checked",e)},keyInput:function(e){13===e.which&&this.saveTask()},isFocusedForKBShortcuts:function(){return this.$el.hasClass("focused")},toggleStatusWithSpacebar:function(e){!this.editing&&this.isFocusedForKBShortcuts()&&(this.model.save("completed",!this.ui.status.is(":checked")),e.preventDefault())}})}),define("js/pullrequests/views/linkable-task",["js/pullrequests/views/task"],function(e){return e.extend({id:function(){return this.model.id?"task-{}".format(this.model.id):void 0},initialize:function(){e.prototype.initialize.call(this,arguments),this.listenTo(this.model,"sync",function(){this.$el.attr("id",this.id())})}})}),define("js/pullrequests/views/task-list",["marionette","js/pullrequests/views/task"],function(e,t){return e.CollectionView.extend({tagName:"ul",className:"task-list",childView:t,onAddChild:function(e){e.model.get("content")||e.editTask()},attachHtml:function(e,t){t.model.id?e.$el.append(t.el):e.$el.prepend(t.el)}})}),define("js/pullrequests/views/comment-task-list",["js/pullrequests/views/linkable-task","js/pullrequests/views/task-list"],function(e,t){return t.extend({childView:e,initialize:function(e){this.comment=e.comment},shouldCreateChild:function(e){return e.get("comment").id===this.comment.id},getChildElement:function(e){return this.$("#task-{}".format(e.id))},addChild:function(e){if(this.shouldCreateChild(e)){var i=this.getChildElement(e);if(i.length){var n=new this.childView({el:i,model:e});this.proxyChildEvents(n),this.children.add(n),n.bindUIElements()}else t.prototype.addChild.apply(this,arguments)}}})}),define("js/pullrequests/views/comment",["jquery","marionette","js/pullrequests/views/comment-task-list"],function(e,t,i){return t.ItemView.extend({template:!1,tagName:"li",className:"comment",events:{"click @ui.createTask":"createTask"},ui:{createTask:"> article .task-link"},initialize:function(){new i({el:this.$("> .task-list"),comment:this.model,collection:this.model.pullrequest.tasks}).render()},_getSelectedText:function(){var t=window.getSelection();if(t.isCollapsed)return"";var i=e(t.anchorNode),n=!!i.closest(".comment-content").length,r=this.$el.is(i.closest(".comment"));return n&&r?t.toString():""},createTask:function(e){e&&e.preventDefault(),this.model.pullrequest.createTask({content:this._getSelectedText(),comment:this.model})}})}),function(e){"function"==typeof define&&define.amd?define("jquery-plugins/jquery.scrollTo",["jquery"],e):e(jQuery)}(function(e){function t(t){return e.isFunction(t)||"object"==typeof t?t:{top:t,left:t}}var i=e.scrollTo=function(t,i,n){return e(window).scrollTo(t,i,n)};return i.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},i.window=function(){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,i=!t.nodeName||-1!=e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!i)return t;var n=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==n.compatMode?n.body:n.documentElement})},e.fn.scrollTo=function(n,r,o){return"object"==typeof r&&(o=r,r=0),"function"==typeof o&&(o={onAfter:o}),"max"==n&&(n=9e9),o=e.extend({},i.defaults,o),r=r||o.duration,o.queue=o.queue&&o.axis.length>1,o.queue&&(r/=2),o.offset=t(o.offset),o.over=t(o.over),this._scrollable().each(function(){function s(e){c.animate(h,r,o.easing,e&&function(){e.call(this,d,o)})}if(null!=n){var a,l=this,c=e(l),d=n,h={},u=c.is("html,body");switch(typeof d){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(d)){d=t(d);break}if(d=u?e(d):e(d,this),!d.length)return;case"object":(d.is||d.style)&&(a=(d=e(d)).offset())}var f=e.isFunction(o.offset)&&o.offset(l,d)||o.offset;e.each(o.axis.split(""),function(e,t){var n="x"==t?"Left":"Top",r=n.toLowerCase(),p="scroll"+n,m=l[p],g=i.max(l,t);if(a)h[p]=a[r]+(u?0:m-c.offset()[r]),o.margin&&(h[p]-=parseInt(d.css("margin"+n))||0,h[p]-=parseInt(d.css("border"+n+"Width"))||0),h[p]+=f[r]||0,o.over[r]&&(h[p]+=d["x"==t?"width":"height"]()*o.over[r]);else{var v=d[r];h[p]=v.slice&&"%"==v.slice(-1)?parseFloat(v)/100*g:v}o.limit&&/^\d+$/.test(h[p])&&(h[p]=h[p]<=0?0:Math.min(h[p],g)),!e&&o.queue&&(m!=h[p]&&s(o.onAfterFirst),delete h[p])}),s(o.onAfter)}}).end()},i.max=function(t,i){var n="x"==i?"Width":"Height",r="scroll"+n;if(!e(t).is("html,body"))return t[r]-e(t)[n.toLowerCase()]();var o="client"+n,s=t.ownerDocument.documentElement,a=t.ownerDocument.body;return Math.max(s[r],a[r])-Math.min(s[o],a[o])},i}),define("components/comments/line-comment",["jquery","underscore","components/comments/comment","components/comments/comment-form","utils/localize","utils/mustache","data/flags","js/pullrequests/app","js/pullrequests/collections/tasks","js/pullrequests/views/comment","jquery-plugins/jquery.scrollTo"],function(e,t,i,n,r,o,s,a,l,c){function d(t,i){s.prTasks&&a.addInitializer(function(n){var r=n.pullrequest;t.children(".task-list").find(".task").each(function(){var t=e(this);r.tasks.add({id:t.data("taskId"),content:t.find(".description").text().trim(),completed:t.find(".task-status").prop("checked"),comment:i,creator:{username:t.attr("data-creator-username")}})}),i.pullrequest=r,new c({el:t,model:i}).bindUIElements()})}var h=function(e){this.comment=e,this.editCommentForm=new n(e),this.replyCommentForm=new n,this.children=[],this.$elem=null,this.$comment=null,this.$content=null,this.$replies=null,this.$edit=null,this.$reply=null,this.$delete=null};return h.decorateThreads=function(t,n,r){for(var o=[],s=0;s<n.length;s++){var a=n[s],l=e("#comment-{}".format(a));if(l.length){var c={comment_id:l.data("comment-id"),content:l.data("content"),convert_markup:"True"===l.data("convert-markup")};r&&(c.filename=r);var d=new i(c,{urlRoot:t});o.push(new h(d).decorate(l,r,t))}}return o},h.prototype.decorate=function(t,n,r){this.$elem=t.parent(".comment"),this.$elem.data("modelobj",this),this.findInternal(),this.enterDocument();var o=t.parent("li.comment").children(".child-comments").children("li.comment").children("article, .deleted-comment-message"),s=this;return o.each(function(){var t=e(this),o={comment_id:t.data("comment-id"),content:t.data("content"),convert_markup:"True"===t.data("convert-markup")};n&&(o.filename=n);var a=new i(o,{urlRoot:r}),l=new h(a).decorate(t,n,r);s.children.push(l),e(l).bind("line-comment/thread-deleted",e.proxy(s.cleanUpThread,s))}),d(this.$elem,this.comment),this},h.prototype.scrollTo=function(t){var i=e.extend({axis:"y",offset:0-(e(window).height()/2-this.$elem.height()/2)},t);return e.scrollTo(this.$elem,500,i),this},h.prototype.createDom=function(){this.$elem=e('<li class="comment">').html(o.toHtml("comment-template",this.comment.attributes)),this.$elem.data("modelobj",this),this.findInternal()},h.prototype.hasReplies=function(){return!!this.$elem.closest(".child-comments").length},h.prototype.findInternal=function(){this.$comment=this.$elem.children("article"),this.$replies=this.$elem.children(".child-comments"),this.hasReplies()||(this.$contextDiff=this.$elem.closest("#comments-list > li.comment:has(.bb-udiff)")),this.$content=this.$comment.find(".comment-content"),this.$edit=this.$comment.find(".edit-link"),this.$reply=this.$comment.find(".reply-link"),this.$delete=this.$comment.find(".delete-link"),this.$time=this.$comment.find("time")},h.prototype.render=function(e,t){return this.createDom(),"before"===t?this.$elem.insertBefore(e):"after"===t?this.$elem.insertAfter(e):this.$elem.appendTo(e),this.enterDocument(),this.$elem.trigger("comment-count/create"),d(this.$elem,this.comment),this},h.prototype.enterDocument=function(){this.comment.on("change",this.updateContent,this),this.comment.on("destroy",this.removeComment,this),this.$edit.on("click",e.proxy(this.edit,this)),this.$reply.on("click",e.proxy(this.reply,this)),this.$delete.on("click",e.proxy(this.deleteComment,this)),e(this.editCommentForm).bind("comment-form/cancel",e.proxy(this.cancelEdit,this)),e(this.replyCommentForm).bind("comment-form/cancel",e.proxy(this.cancelReply,this)),this.$elem.removeClass("highlight"),r(this.$time)},h.prototype.edit=function(e){e.preventDefault(),this.$comment.addClass("editing"),this.editCommentForm.$elem||this.editCommentForm.render(this.$elem),this.editCommentForm.$textarea.val(this.comment.get("content")),this.editCommentForm.$elem.insertAfter(this.$content),this.editCommentForm.showAndFocus()},h.prototype.reply=function(e){e.preventDefault();var n=new i({parent_id:this.comment.get("comment_id"),filename:this.comment.get("filename"),content:""},{urlRoot:this.comment.urlRoot});this.replyCommentForm.comment=n,this.replyCommentForm.$elem?this.replyCommentForm.$elem.prependTo(this.$replies):this.replyCommentForm.render(this.$replies),this.replyCommentForm.showAndFocus(),n.on("sync",t.once(this.insertReply),this)},h.prototype.insertReply=function(t){this.replyCommentForm.$elem.detach();var i=new h(t).render(this.$replies).scrollTo();e(i).bind("line-comment/deleted",e.proxy(this.cleanUpThread,this)),this.replyCommentForm.clearContents(),this.$elem.trigger("comment-count/create"),e(document).trigger("comment-added")},h.prototype.deleteErrorMessages={404:gettext("Comment has been deleted already."),403:gettext("You do not have permission to delete this message.")},h.prototype.deleteComment=function(e){e.preventDefault(),confirm(gettext("Are you sure you want to delete this comment?"))&&this.comment.destroy({wait:!0,error:function(e,t){var i=this.deleteErrorMessages[t.status];alert(i||gettext("A problem occurred processing your request."))}.bind(this)})},h.prototype.cleanUpThread=function(){this.$elem.find("article:not(:has(div.deleted-comment-message))").length||(this.$elem.remove(),e(this).trigger("line-comment/thread-deleted")),this.$contextDiff&&!this.$contextDiff.find(".bb-udiff .comment").length&&this.$contextDiff.remove()},h.prototype.removeComment=function(){this.$comment.replaceWith(o.toHtml("comment-template",{deleted:!0,comment_id:this.comment.comment_id})),this.$elem.addClass("deleted"),this.$edit.unbind(),this.$delete.unbind(),this.$reply.unbind(),this.$edit=null,this.$delete=null,this.$reply=null,e(this).trigger("line-comment/deleted"),this.$elem.trigger("comment-count/delete"),this.cleanUpThread()},h.prototype.cancelEdit=function(){this.editCommentForm.$elem.detach(),this.$comment.removeClass("editing")},h.prototype.cancelReply=function(){this.replyCommentForm.$elem.detach()},h.prototype.updateContent=function(e){this.$content.html(e.get("content_rendered")),this.cancelEdit()},h}),define("components/diff/context-expander",["aui","jquery","underscore","components/comments/line-comment"],function(e,t,i,n){var r=function(e,t,i,n,r){this.url=e,this.diff=n,this.identifier=t,this.showComments=!!i,this.commentUrlRoot=r,this.$elem=null};return r.prototype.tipsySettings_={title:function(){return gettext("Show more lines")},delayIn:500,gravity:"s",offset:-3,live:!0},r.prototype.decorate=function(e){this.$elem=e,this.enterDocument(),this.loadHiddenContextComments()},r.prototype.enterDocument=function(){this.$elem.on("click",".skipped-container .ellipsis",t.proxy(this.expand,this)),this.$elem.find(".skipped-container .ellipsis").tooltip(this.tipsySettings_)},r.prototype.loadHiddenContextComments=function(){var e=this.$elem.data("linecommentroots")||{},n=this;i.each(i.keys(e),function(r){if(!t("#comment-{}".format(r)).length){var o=e[r],s=n.$elem.find(".skipped-container"),a=i.find(s,function(e){var i,r=t(e),s=n.data(r);return i=o.line_from?s.above_fnum>o.line_from||!s.above_fnum:s.above_tnum>o.line_to||!s.above_tnum});t(a).find(".ellipsis").trigger("click",o)}})},r.prototype.expand=function(e,i){e.preventDefault(),this.$elem.find(".skipped-container .ellipsis").tooltip("hide");var r=t(e.target).closest(".skipped-container");if(!r.hasClass("disabled")){r.addClass("disabled");var o=setTimeout(function(){r.addClass("loading")},300),s=function(){clearTimeout(o),r.removeClass("disabled loading")},a=this;t.ajax({url:a.url,data:a.data(r,i),dataType:"json",complete:s,statusCode:{200:function(e){var i=r.closest(".bb-udiff"),o=i.attr("data-filename"),s=t(e.lines);if(t(".tipsy").remove(),a.setPermalinks(s),r.replaceWith(s),e.thread_ids){var l=n.decorateThreads(a.commentUrlRoot,e.thread_ids,o);a.diff&&a.diff.acceptLineComments(l)}i.trigger("context-expander/load",e)},204:function(){r.remove()}}})}},r.prototype.data=function(e,t){var i=e.prev().find(".line-numbers"),n=e.next().find(".line-numbers"),r={};
return i.length&&(r.below_fnum=i.data("fnum"),r.below_tnum=i.data("tnum")),n.length&&(r.above_fnum=n.data("fnum"),r.above_tnum=n.data("tnum")),t&&(t.line_from&&(r.include_fnum=t.line_from),t.line_to&&(r.include_tnum=t.line_to)),this.showComments||(r.nocomments=!0),r},r.prototype.setPermalinks=function(e){var i=/(F\d+)?(T\d+)?$/,n=this.identifier;e.find(".line-numbers").each(function(){var e=t(this).closest(".gutter"),r=e.attr("id"),o=r.match(i);if(o[1]||o[2]){var s="L"+n;o[1]&&(s+=o[1]),o[2]&&(s+=o[2]),e.attr({id:s,href:"#"+s})}})},r}),define("components/editor/commit-merge-error",["backbone","jquery","underscore","utils/mustache"],function(e,t,i,n){return e.View.extend({template:"commit-merge-error-template",initialize:function(e){i.bindAll(this,"render"),this.repository=e.repository,this.commit=e.commit,this.path=e.path},render:function(){var e={owner:this.repository.get("owner").get("username"),slug:this.repository.get("slug"),hash:this.commit.get("hash"),path:this.path,branch:this.commit.get("branch").get("name"),encodedBranch:encodeURIComponent(this.commit.get("branch").get("name"))};return this.$el.html(n.toHtml(this.template,e)),this}})}),define("data/current-pr",["jquery"],function(e){var t=e(document.body).data("currentPr")||{};return t}),function(e){define("jquery-plugins/jquery.chosen",[],function(){return function(){(function(){var e;e=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName.toUpperCase()?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,i,n,r,o,s;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:e.label,children:0,disabled:e.disabled}),o=e.childNodes,s=[],n=0,r=o.length;r>n;n++)i=o[n],s.push(this.add_option(i,t,e.disabled));return s},e.prototype.add_option=function(e,t,i){return"OPTION"===e.nodeName.toUpperCase()?(""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,data:e.dataset,attributes:e.attributes,html:e.innerHTML,selected:e.selected,disabled:i===!0?i:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},e}(),e.select_to_array=function(t){var i,n,r,o,s;for(n=new e,s=t.childNodes,r=0,o=s.length;o>r;r++)i=s[r],n.add_node(i);return n.parsed},this.SelectParser=e}).call(this),function(){var e,t;t=this,e=function(){function e(t,i){this.form_field=t,this.options=null!=i?i:{},e.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.finish_setup())}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=this.options.single_backstroke_delete||!1,this.max_selected_options=this.options.max_selected_options||1/0,this.result_formatter=this.options.result_formatter||function(e){return"<span>"+e.html+"</span>"},this.inherit_select_classes=this.options.inherit_select_classes||!1},e.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||e.default_multiple_text:this.options.placeholder_text_single||this.options.placeholder_text||e.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||e.default_no_result_text},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(){var e=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return e.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},e.prototype.input_blur=function(){var e=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return e.blur_test()},100))},e.prototype.result_add_option=function(e){var t,i;return e.disabled?"":(e.dom_id=this.container_id+"_o_"+e.array_index,t=e.selected&&this.is_multiple?[]:["active-result"],e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),i=""!==e.style.cssText?' style="'+e.style+'"':"",'<li id="'+e.dom_id+'" class="'+t.join(" ")+'"'+i+' data-value="'+AJS.escapeHtml(e.value)+'">'+e.html+"</li>")},e.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.result_single_selected=null,this.results_build()},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.choices_count=function(){var e,t,i,n;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,n=this.form_field.options,t=0,i=n.length;i>t;t++)e=n[t],e.selected&&(this.selected_option_count+=1);return this.selected_option_count},e.prototype.choices_click=function(e){return e.preventDefault(),this.results_showing?void 0:this.results_show()},e.prototype.keyup_checker=function(e){var t,i;switch(t=null!=(i=e.which)?i:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},e.prototype.generate_field_id=function(){var e;return e=this.generate_random_id(),this.form_field.id=e,e},e.prototype.generate_random_char=function(){var e,t,i;return e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=Math.floor(Math.random()*e.length),t=e.substring(i,i+1)},e.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},e.browser_is_supported=function(){var e;return"Microsoft Internet Explorer"===window.navigator.appName?null!==(e=document.documentMode)&&e>=8:!0},e.default_multiple_text="Select Some Options",e.default_single_text="Select an Option",e.default_no_result_text="No results match",e}(),t.AbstractChosen=e}.call(this),function(){var e,t,i,n,r={}.hasOwnProperty,o=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};i=this,e=jQuery,e.fn.extend({chosen:function(i){return AbstractChosen.browser_is_supported()?this.each(function(){var n;return n=e(this),n.hasClass("chzn-done")?void 0:n.data("chosen",new t(this,i))}):this}}),t=function(t){function r(){return n=r.__super__.constructor.apply(this,arguments)}return o(r,t),r.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chzn-rtl")},r.prototype.finish_setup=function(){return this.form_field_jq.addClass("chzn-done")},r.prototype.set_up_html=function(){var t,i;return this.container_id=this.form_field.id.length?this.form_field.id.replace(/[^\w]/g,"_"):this.generate_field_id(),this.container_id+="_chzn",t=["chzn-container"],t.push("chzn-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chzn-rtl"),i={id:this.container_id,"class":t.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.container=e("<div />",i),this.container.html(this.is_multiple?'<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop"><ul class="chzn-results"></ul></div>':'<a href="javascript:void(0)" class="chzn-single chzn-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chzn-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chzn-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chzn-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chzn-search").first(),this.selected_item=this.container.find(".chzn-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("liszt:ready",{chosen:this})},r.prototype.register_observers=function(){var e=this;return this.container.mousedown(function(t){e.container_mousedown(t)}),this.container.mouseup(function(t){e.container_mouseup(t)}),this.container.mouseenter(function(t){e.mouse_enter(t)}),this.container.mouseleave(function(t){e.mouse_leave(t)}),this.search_results.mouseup(function(t){e.search_results_mouseup(t)}),this.search_results.mouseover(function(t){e.search_results_mouseover(t)}),this.search_results.mouseout(function(t){e.search_results_mouseout(t)}),this.search_results.bind("mousewheel DOMMouseScroll",function(t){e.search_results_mousewheel(t)}),this.form_field_jq.bind("liszt:updated",function(t){e.results_update_field(t)}),this.form_field_jq.bind("liszt:activate",function(t){e.activate_field(t)}),this.form_field_jq.bind("liszt:open",function(t){e.container_mousedown(t)}),this.search_field.blur(function(t){e.input_blur(t)}),this.search_field.keyup(function(t){e.keyup_checker(t)}),this.search_field.keydown(function(t){e.keydown_checker(t)}),this.search_field.focus(function(t){e.input_focus(t)}),this.is_multiple?this.search_choices.click(function(t){e.choices_click(t)}):this.container.click(function(e){e.preventDefault()})},r.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chzn-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus",this.activate_action),this.close_field()):(this.container.removeClass("chzn-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus",this.activate_action))},r.prototype.container_mousedown=function(t){return this.is_disabled||(t&&"mousedown"===t.type&&!this.results_showing&&t.preventDefault(),null!=t&&e(t.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!t||e(t.target)[0]!==this.selected_item[0]&&!e(t.target).parents("a.chzn-single").length||(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(document).click(this.click_test_action),this.results_show()),this.activate_field())},r.prototype.container_mouseup=function(e){return"ABBR"!==e.target.nodeName||this.is_disabled?void 0:this.results_reset(e)},r.prototype.search_results_mousewheel=function(e){var t,i,n;return t=-(null!=(i=e.originalEvent)?i.wheelDelta:void 0)||(null!=(n=e.originialEvent)?n.detail:void 0),null!=t?(e.preventDefault(),"DOMMouseScroll"===e.type&&(t=40*t),this.search_results.scrollTop(t+this.search_results.scrollTop())):void 0},r.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chzn-container-active")?this.close_field():void 0},r.prototype.close_field=function(){return e(document).unbind("click",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chzn-container-active"),this.winnow_results_clear(),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},r.prototype.activate_field=function(){return this.container.addClass("chzn-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},r.prototype.test_active_click=function(t){return e(t.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()},r.prototype.results_build=function(){var e,t,n,r,o;for(this.parsing=!0,this.selected_option_count=null,this.results_data=i.SelectParser.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.selected_item.addClass("chzn-default").find("span").text(this.default_text),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?this.container.addClass("chzn-container-single-nosearch"):this.container.removeClass("chzn-container-single-nosearch")),e="",o=this.results_data,n=0,r=o.length;r>n;n++)t=o[n],t.group?e+=this.result_add_group(t):t.empty||(e+=this.result_add_option(t),t.selected&&this.is_multiple?this.choice_build(t):t.selected&&!this.is_multiple&&(this.selected_item.removeClass("chzn-default").find("span").attr("data-value",t.value).text(t.text),this.allow_single_deselect&&this.single_deselect_control_build()));return this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.search_results.html(e),this.parsing=!1},r.prototype.result_add_group=function(t){return t.disabled?"":(t.dom_id=this.container_id+"_g_"+t.array_index,'<li id="'+t.dom_id+'" class="group-result">'+e("<div />").text(t.label).html()+"</li>")},r.prototype.result_do_highlight=function(e){var t,i,n,r,o;if(e.length){if(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),n=parseInt(this.search_results.css("maxHeight"),10),o=this.search_results.scrollTop(),r=n+o,i=this.result_highlight.position().top+this.search_results.scrollTop(),t=i+this.result_highlight.outerHeight(),t>=r)return this.search_results.scrollTop(t-n>0?t-n:0);if(o>i)return this.search_results.scrollTop(i)}},r.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},r.prototype.results_show=function(){if(null!=this.result_single_selected)this.result_do_highlight(this.result_single_selected);else if(this.is_multiple&&this.max_selected_options<=this.choices_count())return this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1;return this.container.addClass("chzn-with-drop"),this.form_field_jq.trigger("liszt:showing_dropdown",{chosen:this}),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results()},r.prototype.results_hide=function(){return this.result_clear_highlight(),this.container.removeClass("chzn-with-drop"),this.form_field_jq.trigger("liszt:hiding_dropdown",{chosen:this}),this.results_showing=!1},r.prototype.set_tab_index=function(){var e;return this.form_field_jq.attr("tabindex")?(e=this.form_field_jq.attr("tabindex"),this.form_field_jq.attr("tabindex",-1),this.search_field.attr("tabindex",e)):void 0},r.prototype.set_label_behavior=function(){var t=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=e("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.click(function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field()}):void 0},r.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},r.prototype.search_results_mouseup=function(t){var i;return i=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),i.length?(this.result_highlight=i,this.result_select(t),this.search_field.focus()):void 0},r.prototype.search_results_mouseover=function(t){var i;return i=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),i?this.result_do_highlight(i):void 0},r.prototype.search_results_mouseout=function(t){return e(t.target).hasClass("active-result")?this.result_clear_highlight():void 0},r.prototype.choice_build=function(t){var i,n,r=this;return i=e("<li />",{"class":"search-choice"}).html(this.result_formatter(t)),t.disabled?i.addClass("search-choice-disabled"):(n=e("<a />",{href:"#","class":"search-choice-close",rel:t.array_index}),n.click(function(e){return r.choice_destroy_link_click(e)}),i.append(n)),this.search_container.before(i)},r.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),t.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(e(t.target))},r.prototype.choice_destroy=function(e){return this.result_deselect(e.attr("rel"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()):void 0},r.prototype.results_reset=function(){return this.form_field.options[0].selected=!0,this.selected_option_count=null,this.selected_item.find("span").text(this.default_text),this.selected_item.find("span").removeAttr("data-value"),this.is_multiple||this.selected_item.addClass("chzn-default"),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},r.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},r.prototype.result_select=function(e){var t,i,n,r;return this.result_highlight?(t=this.result_highlight,i=t.attr("id"),this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1):(this.is_multiple?this.result_deactivate(t):(this.search_results.find(".result-selected").removeClass("result-selected"),this.result_single_selected=t,this.selected_item.removeClass("chzn-default")),t.addClass("result-selected"),r=i.substr(i.lastIndexOf("_")+1),n=this.results_data[r],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(n):(this.selected_item.find("span").first().attr("data-value",n.value).text(n.text),this.allow_single_deselect&&this.single_deselect_control_build()),(e.metaKey||e.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())):void 0},r.prototype.result_activate=function(e){return e.addClass("active-result")},r.prototype.result_deactivate=function(e){return e.removeClass("active-result")},r.prototype.result_deselect=function(t){var i,n;return n=this.results_data[t],this.form_field.options[n.options_index].disabled?!1:(n.selected=!1,this.form_field.options[n.options_index].selected=!1,this.selected_option_count=null,i=e("#"+this.container_id+"_o_"+t),i.removeClass("result-selected").addClass("active-result").show(),this.result_clear_highlight(),this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[n.options_index].value}),this.search_field_scale(),!0)},r.prototype.single_deselect_control_build=function(){return this.allow_single_deselect&&this.selected_item.find("abbr").length<1?this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'):void 0},r.prototype.winnow_results=function(){var t,i,n,r,o,s,a,l,c,d,h,u,f,p,m,g,v,b;for(this.no_results_clear(),c=0,d=this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html(),s=this.search_contains?"":"^",o=new RegExp(s+d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),f=new RegExp(d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),b=this.results_data,p=0,g=b.length;g>p;p++)if(i=b[p],!i.disabled&&!i.empty)if(i.group)e("#"+i.dom_id).css("display","none");else if(!this.is_multiple||!i.selected){if(t=!1,l=i.dom_id,a=e("#"+l),o.test(i.html))t=!0,c+=1;else if(this.enable_split_word_search&&(i.html.indexOf(" ")>=0||0===i.html.indexOf("["))&&(r=i.html.replace(/\[|\]/g,"").split(" "),r.length))for(m=0,v=r.length;v>m;m++)n=r[m],o.test(n)&&(t=!0,c+=1);t?(d.length?(h=i.html.search(f),u=i.html.substr(0,h+d.length)+"</em>"+i.html.substr(h+d.length),u=u.substr(0,h)+"<em>"+u.substr(h)):u=i.html,a.html(u),this.result_activate(a),null!=i.group_array_index&&e("#"+this.results_data[i.group_array_index].dom_id).css("display","list-item")):(this.result_highlight&&l===this.result_highlight.attr("id")&&this.result_clear_highlight(),this.result_deactivate(a))}return 1>c&&d.length?this.no_results(d):this.winnow_results_set_highlight()},r.prototype.winnow_results_clear=function(){var t,i,n,r,o;for(this.search_field.val(""),i=this.search_results.find("li"),o=[],n=0,r=i.length;r>n;n++)t=i[n],t=e(t),o.push(t.hasClass("group-result")?t.css("display","auto"):this.is_multiple&&t.hasClass("result-selected")?void 0:this.result_activate(t));return o},r.prototype.winnow_results_set_highlight=function(){var e,t;return this.result_highlight||(t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first(),null==e)?void 0:this.result_do_highlight(e)},r.prototype.no_results=function(t){var i;return i=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),i.find("span").first().html(t),this.search_results.append(i)},r.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},r.prototype.keydown_arrow=function(){var t,i;return this.result_highlight?this.results_showing&&(i=this.result_highlight.nextAll("li.active-result").first(),i&&this.result_do_highlight(i)):(t=this.search_results.find("li.active-result").first(),t&&this.result_do_highlight(e(t))),this.results_showing?void 0:this.results_show()},r.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},r.prototype.keydown_backstroke=function(){var e;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(e=this.search_container.siblings("li.search-choice").last(),e.length&&!e.hasClass("search-choice-disabled")?(this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},r.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},r.prototype.keydown_checker=function(e){var t,i;switch(t=null!=(i=e.which)?i:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:this.keydown_arrow()}},r.prototype.search_field_scale=function(){var t,i,n,r,o,s,a,l;if(this.is_multiple){for(i=0,s=0,r="position:absolute; left: -1000px; top: -1000px; display:none;",o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],a=0,l=o.length;l>a;a++)n=o[a],r+=n+":"+this.search_field.css(n)+";";return t=e("<div />",{style:r}),t.text(this.search_field.val()),e("body").append(t),s=t.width()+25,t.remove(),this.f_width||(this.f_width=this.container.outerWidth()),s>this.f_width-10&&(s=this.f_width-10),this.search_field.css({width:s+"px"})}},r.prototype.generate_random_id=function(){var t;for(t="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();e("#"+t).length>0;)t+=this.generate_random_char();return t},r}(AbstractChosen),i.Chosen=t}.call(this)}.apply(e,arguments)})}(this),define("utils/create-reviewer-autocomplete",["jquery","underscore","components/mentions/typeahead-user-model","components/mentions/user-data-set","components/mentions/user-suggestions","components/typeahead/typeahead-completion","data/current-pr","data/current-user","jquery-plugins/jquery.chosen"],function(e,t,i,n,r,o,s,a){return function(l){function c(t,i){var n=t.find(".error");n&&0!==n.length||(n=e('<div class="error"></div>'),t.append(n));var r=e("<div></div>");r.text(i),n.append(r)}function d(t){b.append(e("<option></option>").attr({value:t.username,"data-avatar-url":t.avatar,selected:"selected"}).text(t.display_name)),f()}function h(t){var i=_.replace(":reviewer_name",t);if(y.length){var n=y.val().split("/");i=i.replace(":dest_username",n[0]).replace(":dest_slug",n[1])}v.find("li[data-username="+t+"]").addClass("hidden"),g.push(t),e.ajax({dataType:"json",url:i,success:function(e){d(e),l.find(".error").empty()},error:function(e){var t,i;try{t=JSON.parse(e.responseText)}catch(n){t=[]}i=t.error||"An unexpected error occurred",l.find(".error").empty(),c(l,i),f()}})}function u(e,i){var n=i.deselected;g=t.without(g,n),b.find("option[value="+n+"]").remove(),v.find("li[data-username="+n+"]").removeClass("hidden"),setTimeout(function(){f()},0)}function f(){b.trigger("liszt:updated");var t=v.find("li:not(.hidden)").length>0;e("#suggested").toggleClass("hidden",!t)}function p(t){h(e(t.target).closest("li").attr("data-username"))}function m(t){t.html=t.html.trim();var i=t.disabled?"You cannot remove somebody who has already contributed":"";return e("<div>").append(e("<img>").addClass("avatar avatar16").attr("src",t.attributes["data-avatar-url"].value).attr("title",i).attr("alt",t.html+" avatar")).html()+e("<div>").append(e("<span>").text(t.html).attr("title",i)).html()}var g=[],v=l.find("#suggested ul"),b=l.find("#participants"),_=l.data("api-url"),y=e("#id_dest_repo"),w=s.author?s.author.username:a.username;b.find("option").each(function(t,i){g.push(e(i).val())}),g.push(w),g.forEach(function(e){v.find("li[data-username="+e+"]").addClass("hidden")}),f(),b.chosen({placeholder_text:"Start typing to search for a user",result_formatter:m}).on("liszt:showing_dropdown",function(t,i){e(i.chosen.dropdown).addClass("hidden")}).on("change",u),e("#participants_chzn .chzn-choices").addClass("text").find(".search-field input").addClass("bb-reviewer-typeahead"),v.on("click","li",p);var x=i.extend({matches:function(e,t){return-1!==g.indexOf(this.id)?!1:i.prototype.matches.call(this,e,t)}}),k=o.extend({className:"bb-reviewer-typeahead",events:function(){var e=o.prototype.events.call(this);return e["keyup ."+this.className]="onKeyUp",e},initialize:function(i){o.prototype.initialize.call(this,t.extend({results:r,hide:!1,focus:!1},i)),this.$chzn=e("#participants_chzn"),this.$chznChoices=this.$chzn.find(".chzn-choices"),this.$searchInput=this.$chzn.find("li.search-field input"),this.lastHeight=this.$chzn.height(),this.$dialog=e("#"+this.results.$el.attr("id"))},onKeyDown:function(e){var t=this;setTimeout(function(){var i=e.target.value;e.which!==t.BACKSPACE||i?o.prototype.onKeyDown.call(t,e):t.hideSuggestions(e.target)},0)},onKeyUp:function(){var e=+this.$dialog.css("top").slice(0,-2),t=e+this.$chzn.height()-this.lastHeight;this.$dialog.css({top:t}),this.lastHeight=this.$chzn.height()},showSuggestions:function(e){this.isWithinCodeBlock(e)||this.shouldSuppressSuggestions()||(this.setShowingState(e,!0),this.results.$el.is(":visible")||this.$chznChoices.attr({"aria-owns":this.results.$el.attr("id"),"aria-haspopup":"true"}).addClass("aui-dropdown2-trigger").trigger("aui-button-invoke"))},onToggleDropdownVisibility:function(e){this.setShowingState(this.$chznChoices,"aui-dropdown2-show"===e.type)},complete:function(e){o.prototype.complete.call(this,e),h(this.results.replacementText());var t=this.$searchInput;t.blur(),setTimeout(function(){t.focus()},0)}});if(e("#mention-result").length){var C=t.map(v.find("li"),function(t){var i=e(t);return new x({username:i.attr("data-username"),display_name:i.attr("data-display-name"),avatar_url:i.find("img").attr("src")})}),$=new n(C,{model:x,matcher:x.matcher,queryEndpoint:"/xhr/user-mention",queryParamKey:"term"});new k({source:$,el:e("#participants_chzn")[0]}).render()}}}),define("components/editor/commit-form",["aui","backbone","jquery","underscore","api/models/branch","api/models/commit","api/models/pullrequest","api/models/pullrequest-target","components/editor/commit-merge-error","data/current-user","utils/create-reviewer-autocomplete","utils/mustache"],function(e,t,i,n,r,o,s,a,l,c,d,h){return t.View.extend({template:"commit-form-template",events:{"keyup #id_path":"checkPath","click #id_create-pullrequest":"createPullRequestHandler","focusout #id_branch-name":"slugifyBranchName","click .create-pull-request-link":"createPullRequest","submit .commit-form":"commitChanges","click .commit-button":"commitChanges","click .cancel-link":"hide"},initialize:function(r){n.bindAll(this,"createPullRequestHandler","slugifyBranchName","createPullRequest","commitChanges","hide","updateCreatePRCheckbox");var o=new e.Dialog({width:700,height:"auto",id:"commit-form"}),s=i(h.toHtml(this.template,{}));o.addHeader(s.attr("data-title")),o.addPanel("main","","commit-form-body"),o.addButton(s.attr("data-cta-label"),null,"commit-button"),o.addLink(s.attr("data-cancel-label"),null,"cancel-link"),this.dialog=o,this.setElement(o.popup.element[0]),this.$commitFormBody=this.$(".commit-form-body"),this.$cancelLinkTemplate=this.$(".cancel-link").clone(),this.$cancelPlaceholderTemplate=i('<span class="cancel-placeholder" />').text(this.$cancelLinkTemplate.text()),this.originalRepository=r.repository,this.destinationRepository=r.destinationRepository,this.localID=r.localID,this.isDelete=r.isDelete,this.isCreate=r.isCreate,this.isRename=r.isRename,this.isWriter=r.isWriter,this.hasPushAccess=r.hasPushAccess,this.isPullRequest=r.isPullRequest,this.originalHash=r.hash,this.originalBranch=r.branch,this.originalPath=r.path,this.sourceUrl=r.sourceUrl,this.state=new t.Model,this.state.on("change:createPullRequest",this.updateCreatePRCheckbox)},render:function(){var e={owner:this.originalRepository.get("owner").get("username"),slug:this.originalRepository.get("slug"),path:this.originalPath,filename:this.originalPath.split("/").pop(),isCreate:this.isCreate,isDelete:this.isDelete,isRename:this.isRename,isWriter:this.isWriter,hasPushAccess:this.hasPushAccess,isPullRequest:this.isPullRequest};
this.$commitFormBody.html(h.toHtml(this.template,e)),this.$error=this.$(".aui-message.error"),this.$info=this.$(".aui-message.info"),this.$path=this.$("#id_path"),this.$prFields=this.$("#pr-fields"),this.$commitButton=this.$(".commit-button");var t=this.$(".commit-form");return this.defaultMessage=t.attr("data-default-message"),this.forkError=t.attr("data-fork-error"),this.commitError=t.attr("data-commit-error"),this.pullRequestError=t.attr("data-pull-request-error"),this.updateError=t.attr("data-update-error"),this.branchConflictError=t.attr("data-branch-conflict-error"),this.forkingMessage=t.attr("data-forking-message"),this.committingMessage=t.attr("data-committing-message"),this.mergingMessage=t.attr("data-merging-message"),this.creatingPRMessage=t.attr("data-creating-pr-message"),this.updatingPRMessage=t.attr("data-updating-pr-message"),this.$commitButton.addClass("aui-button"),this.$("#id_message").val(this.defaultMessage),this.$message||(i('<div class="message" />').prependTo(this.$(".dialog-button-panel")),this.$message=this.$(".dialog-button-panel").find(".message")),this.state.set({autocompleteInitialized:!1,createPullRequest:!this.isWriter||!this.hasPushAccess}),this.updateCreatePRCheckbox(this.state,this.state.get("createPullRequest")),this},getPath:function(){return this.$path.val()&&this.$path.val().trim()||this.originalPath},getMessage:function(){return this.$("#id_message").val()||this.defaultMessage},getCommit:function(){var e=new o({repository:this.originalRepository,parents:[this.originalHash],branch:new r({repository:this.originalRepository,name:this.originalBranch})});return this.isRename?(e.addFile({path:this.originalPath,content:null}),e.addFile({path:this.getPath(),content:this.content})):e.addFile({path:this.originalPath,content:this.content}),e},getPullRequest:function(){var e=this.getMessage(),t=this.commit.get("repository").id!==this.originalRepository.id?!1:!0;return new s({source:new a({repository:this.commit.get("repository"),branch:this.commit.get("branch")}),destination:new a({repository:this.originalRepository,branch:new r({repository:this.originalRepository,name:this.originalBranch})}),title:e.split("\n")[0],description:e,close_source_branch:t})},setContent:function(e){return this.content=e,this},generateBranchName:function(){return"{}/{}".format(c.username,this.getMessage().replace(/[^\w\s]/g,"").substring(0,40).replace(/\s+/g,"-").toLowerCase()+"-"+Date.now())},slugify:function(e){return e.replace(/[^\w\s/-]/g,"").replace(/\s+/g,"-")},slugifyBranchName:function(e){var t=i(e.target);t.val(this.slugify(t.val()))},redirect:function(e){var t=e.html.href;i(window).off(".editor"),window.location=t},commit:function(){var e=function(){this.isWriter?this.saveCommit(t):this.forkAndCommit(t)}.bind(this),t=this.getCommit();if(this.disable(),t.set({message:this.getMessage()}),this.state.get("createPullRequest")){var i=this.$("#id_branch-name").val();t.setBranch(i||this.generateBranchName()),t.get("branch").fetch().fail(e.bind(this)).done(function(){this.enable().showError(this.branchConflictError)}.bind(this))}else e()},saveCommit:function(e){this.showMessage(this.committingMessage),e.save(null,{success:function(){this.commit=e,this.state.get("createPullRequest")?this.createPullRequest():this.isPullRequest?this.updatePullRequest():this.redirect(e.get("links"))}.bind(this),error:function(t,i){this.state.get("createPullRequest")||409!==i.status?this.showError(this.commitError).enable():this.branchAndMerge(e)}.bind(this)})},updatePullRequest:function(){this.showMessage(this.updatingPRMessage);var e=this.getPullRequest();e.set({local_id:this.localID}),e.get("destination").set({repository:this.destinationRepository}),e.updateRef().done(function(e){i(window).off(".editor"),window.location=e}).fail(function(){this.hide(),this.showError(this.updateError)}.bind(this))},forkAndCommit:function(e){this.showMessage(this.forkingMessage),this.originalRepository.fork().done(function(t){e.set({repository:t}),this.saveCommit(e)}.bind(this)).fail(function(){this.showError(this.forkError).enable()}.bind(this))},branchAndMerge:function(e){this.showMessage(this.mergingMessage),e.setBranch(this.generateBranchName()).save(null,{success:function(){this.commit=e;var t={hash:e.get("hash").slice(0,13),branch:this.originalBranch,message:e.get("message")},i=h.toHtml("merge-message-template",t);this.commit.merge(this.originalBranch,i).done(function(e){this.isPullRequest?this.updatePullRequest():this.redirect(e.links)}.bind(this)).fail(function(){this.showError(new l({repository:this.originalRepository,commit:this.commit,path:this.originalPath}).render().$el.html()),this.$commitButton.removeClass("loading")}.bind(this))}.bind(this),error:function(){this.showError(this.commitError).enable()}.bind(this)})},createPullRequest:function(e){e&&(e.preventDefault(),this.enable(),this.$("#id_create-pullrequest").prop("checked",!0),this.disable()),this.showMessage(this.creatingPRMessage);var t=this.getPullRequest();t.set({reviewers:this.$("#participants").val()}),t.save(null,{success:function(e){this.redirect(e.get("links"))}.bind(this),error:function(){this.showError(this.pullRequestError).enable()}.bind(this)})},disable:function(e){return this.disabled=!0,this.$commitButton.addClass("loading"),e?this.$commitButton.attr({disabled:"disabled","aria-disabled":!0}):(this.$(":input").attr({disabled:"disabled","aria-disabled":!0}),this.$(".cancel-link").replaceWith(this.$cancelPlaceholderTemplate.clone())),this},enable:function(){return this.disabled=!1,this.$commitButton.removeClass("loading"),this.$(":input").removeAttr("disabled aria-disabled"),this.$(".cancel-placeholder").replaceWith(this.$cancelLinkTemplate.clone()),this},showError:function(e){return this.hideMessage().$error.removeClass("hidden").find(".message").html(e),this},hideError:function(){return this.$error.addClass("hidden"),this},showMessage:function(e){return this.$message.stop().fadeOut(200,function(){this.$message.html("{}&hellip;".format(e)),this.$message.fadeIn(200)}.bind(this)),this},hideMessage:function(){return this.$message.stop().hide(),this},updateCreatePRCheckbox:function(e,t){this.$("#id_create-pullrequest").prop("checked",t),this.$prFields&&this.$prFields.length&&(t?(this.$prFields.slideDown(200).find("#id_branch-name").val(this.generateBranchName()),this.isPullRequest||this.state.get("autocompleteInitialized")||n.defer(function(){d(this.$("#reviewers-group")),this.state.set({autocompleteInitialized:!0})}.bind(this))):this.$prFields.slideUp(200))},createPullRequestHandler:function(e){this.state.set({createPullRequest:i(e.target).is(":checked")})},commitChanges:function(e){e&&e.preventDefault(),this.disabled||this.commit()},show:function(e){e&&e.preventDefault(),this.render().checkPath(),this.dialog.show()},hide:function(e){e&&e.preventDefault(),this.dialog.hide()},checkPath:n.debounce(function(){if(this.isRename){this.$("#path-error").remove(),this.disable(!0);var e=this.$path.val().trim();if(e===this.originalPath)return void this.$commitButton.removeClass("loading");if(""===e)return i('<span class="error" id="path-error">You must specify a path.</span>').insertAfter(this.$path),void this.$commitButton.removeClass("loading");var t=this.sourceUrl.slice(0,this.sourceUrl.lastIndexOf("/")+1);i.get(t+e).always(function(e,t){"success"===t?(i('<span class="error" id="path-error">A file with this name already exists.</span>').insertAfter(this.$path),this.$commitButton.removeClass("loading")):this.enable()}.bind(this))}},100)})}),define("components/editor/edit-form",["aui","backbone","jquery","underscore","api/cache/repositories","components/confirm-dialog","components/diff/context-expander","components/editor/commit-form","utils/gaq-push"],function(e,t,i,n,r,o,s,a,l){return t.View.extend({events:{"change #id_syntax-mode":"setSyntaxMode","change #id_indent-mode":"setIndentMode","change #id_indent-size":"setIndentSize","click button":"copyContent","click .save-button":"saveChanges","click .preview-button":"previewChanges","click .cancel-link":"checkForChanges","click .next-hunk-button":"nextHunk","click .prev-hunk-button":"prevHunk"},initialize:function(e){require(["components/editor/code-editor"],function(t){n.bindAll(this,"setSyntaxMode","setIndentMode","setIndentSize","copyContent","saveChanges","previewChanges","checkForChanges","nextHunk","prevHunk","toggleButtons","toggleHunkButtons","ready");var s,c,d,h,u=this.$el.data("local-id"),f=this.$el.data("is-pull-request"),p=this.$el.data("is-writer"),m=this.$el.data("is-create"),g=this.$el.data("has-push-access"),v=this.$el.attr("data-path");if(f){var b=i("#compare"),_="{}/{}".format(b.attr("data-owner"),b.attr("data-slug")),y="{}/{}".format(b.attr("data-destination-owner"),b.attr("data-destination-slug"));s=r.load(_),c=r.load(y),d=b.attr("data-hash"),h=b.attr("data-dest-rev")}else s=r.load(this.$el.attr("data-repository")),d=this.$el.attr("data-hash");var w=function(){return i(window).height()-125};this.codeEditor=new t({el:this.$("#id_source"),height:m?400:w(),source:e.source,path:v}),this.codeEditor.editor.on("change",this.toggleButtons),this.setSyntaxMode(),this.setIndentMode(),this.setIndentSize(),this.commitForm=new a({repository:s,destinationRepository:c,localID:u,isCreate:m,isWriter:this.$el.data("is-writer"),hasPushAccess:this.$el.data("has-push-access"),isPullRequest:f,hash:d,branch:this.$el.attr("data-branch"),path:v}),this.$previewButton=this.$(".preview-button"),this.$fileEditor=this.$(".file-editor"),this.$previewPane=this.$(".preview-pane"),this.$editorControls=this.$(".footer-toolbar .primary"),this.$editPath=this.$(".edit-path"),this.previewError=this.$el.attr("data-preview-error"),this.unsavedChangesError=this.$el.attr("data-unsaved-changes-error"),this.$hunkNav=this.$(".hunk-nav"),this.$hunkNav.hide(),this.currentLine=-1,this.$nextButton=this.$(".next-hunk-button"),this.$prevButton=this.$(".prev-hunk-button"),this.$nextButton.tooltip(),this.$prevButton.tooltip(),this.nextDisabled=!0,this.prevDisabled=!0,this.commitEnabled=!0,this.isCreate=m,this.previewing=!1,this.isPullRequest=f,this.isWriter=p,this.hasPushAccess=g,i(window).on("resize.editor",function(){this.codeEditor.editor.setSize(null,w())}.bind(this)),i(window).on("beforeunload.editor",function(){return this.codeEditor.contentHasChanged()?this.unsavedChangesError:void 0}.bind(this));var x=function(){var e=i(".pjax-trigger");e.off(".editor"),e.on("click.editor",function(e){var t=i(e.target);return f&&t.hasClass("edit-button")||!this.codeEditor.contentHasChanged()?void 0:(o(this.unsavedChangesError).done(function(){l(["atl._trackEvent","Online editing","Abandon changes"]),this.remove(),t.click()}.bind(this)),!1)}.bind(this))}.bind(this);if(x(),i(document).on("branchDialogReady",x.bind(this)),f){var k=s.pullRequests.load(u);k.fetch().done(function(){k.sourceDiff().done(function(e){var t=e.diff[v];if(t){this.codeEditor.showDiff(t,this.toggleHunkButtons.bind(this)),this.$hunkNav.show(),this.codeEditor.editor.setCursor({line:0,ch:0}),null===this.codeEditor.getCurrentHunk().line&&this.codeEditor.nextHunk(),this.toggleHunkButtons(),this.codeEditor.editor.on("cursorActivity",function(e){var t=e.getCursor().line;t!==this.currentLine&&(this.toggleHunkButtons(),this.currentLine=t)}.bind(this));var n=i(".CodeMirror-gutters").width()-5;this.codeEditor.editor.on("renderLine",function(e,t){var r=e.lineInfo(t);r.gutterMarkers&&r.gutterMarkers["diff-gutter"]&&i(".CodeMirror-diff-gutter").width(n+"px")}),i(".CodeMirror-diff-gutter").width(n+"px")}}.bind(this)).always(this.ready)}.bind(this)).fail(this.ready)}else this.ready()}.bind(this))},refresh:function(){var e;this.codeEditor.refresh(),e=i(".CodeMirror-gutters").width()-5,i(".CodeMirror-diff-gutter").width(e+"px"),this.codeEditor.focus()},setPath:function(e){return this.commitForm.originalPath=e,0===e.indexOf("/")&&(e=e.slice(1)),this.$editPath.text(e),this},ready:function(){this.trigger("ready")},remove:function(){i(window).off(".editor"),i(".pjax-trigger").off(".editor"),t.View.prototype.remove.call(this)},setSyntaxMode:function(e){e?this.codeEditor.editor.setOption("mode",i(e.target).val()):this.$("#id_syntax-mode").val(this.codeEditor.editor.getOption("mode"))},updatePathBasedSyntax:function(e){var t=this.codeEditor.guessMode(e);return this.codeEditor.editor.setOption("mode",t),this.$("#id_syntax-mode").val(t),this},setIndentMode:function(e){var t;e?(t="tabs"===i(e.target).val(),this.codeEditor.editor.setOption("indentWithTabs",t)):(t=this.codeEditor.editor.getOption("indentWithTabs"),this.$("#id_indent-mode").val(t?"tabs":"spaces")),t?this.$("#indent-size").hide():this.$("#indent-size").show()},setIndentSize:function(e){e?this.codeEditor.editor.setOption("indentUnit",parseInt(i(e.target).val(),10)):this.$("#id_indent-size").val(this.codeEditor.editor.getOption("indentUnit"))},setCommitEnabled:function(e){return this.commitEnabled=!!e,this.toggleButtons(),this},disable:function(){return this.$previewButton.addClass("loading"),this.codeEditor.disable(),this.disableButtons(),this},enable:function(){return this.$previewButton.removeClass("loading"),this.codeEditor.enable(),this.enableButtons(),this.resetHunkNavButtons(),this},disableButtons:function(){return this.$("button").attr({disabled:"disabled","aria-disabled":!0}),this},enableButtons:function(){return this.$("button").removeAttr("disabled aria-disabled"),this},hasCommittableContent:function(){return this.commitEnabled&&(this.isCreate||this.codeEditor.contentHasChanged())},toggleButtons:function(){this.hasCommittableContent()?this.enableButtons():this.disableButtons(),this.resetHunkNavButtons()},copyContent:function(){this.commitForm.setContent(this.codeEditor.getContent())},saveChanges:function(e){e&&e.preventDefault(),this.commitForm.show(),l(["atl._trackEvent","Online editing","Save changes"])},previewChanges:function(t){if(t&&t.preventDefault(),this.previewing)return this.previewing=!1,this.$previewButton.removeAttr("aria-pressed").html(this.$previewButton.attr("data-preview-label")),this.$previewPane.hide(),this.$fileEditor.show(),this.$editorControls.show(),this.isPullRequest&&this.$hunkNav.show(),this.trigger("recenter"),void this.codeEditor.focus();l(["atl._trackEvent","Online editing","Preview changes"]);var n=this.commitForm.getCommit();n.set({"transient":!0,message:"Preview"}),this.disable(),i.ajax({type:"POST",url:this.$el.attr("data-preview-url"),data:JSON.stringify(n.toJSON()),dataType:"html",contentType:"application/json; charset=utf-8"}).done(function(e){this.previewing=!0,this.$previewButton.attr("aria-pressed",!0).html(this.$previewButton.attr("data-edit-label")),this.$previewPane.html(e);var t=this.$previewPane.find(".bb-udiff"),i=t.attr("data-filename");new s(t.attr("data-expand-context-url")+encodeURI(i),t.attr("data-identifier"),!1).decorate(t),this.$(".bb-udiff").removeClass("maskable"),this.$fileEditor.hide(),this.$hunkNav.hide(),this.$previewPane.show(),this.$editorControls.hide(),this.enable()}.bind(this)).error(function(){e.messages.error({body:this.previewError}),this.enable()}.bind(this))},checkForChanges:function(e){return this.codeEditor.contentHasChanged()?(o(this.unsavedChangesError).done(function(){this.codeEditor.resetContent(),i(e.target).click()}.bind(this)),!1):void 0},resetHunkNavButtons:function(){this.nextDisabled&&this.$nextButton.attr({disabled:"disabled","aria-disabled":!0}),this.prevDisabled&&this.$prevButton.attr({disabled:"disabled","aria-disabled":!0})},toggleHunkButtons:function(){var e=(this.codeEditor.getCurrentHunk(),this.codeEditor.getNextHunk()),t=this.codeEditor.getPrevHunk();null!==e.line?this.nextDisabled&&(this.$nextButton.removeAttr("disabled aria-disabled"),this.nextDisabled=!1):this.nextDisabled||(this.$nextButton.attr({disabled:"disabled","aria-disabled":!0}),this.nextDisabled=!0,this.$nextButton.tooltip("hide")),null!==t.line?this.prevDisabled&&(this.$prevButton.removeAttr("disabled aria-disabled"),this.prevDisabled=!1):this.prevDisabled||(this.$prevButton.attr({disabled:"disabled","aria-disabled":!0}),this.prevDisabled=!0,this.$prevButton.tooltip("hide"))},nextHunk:function(e){e&&e.preventDefault(),this.codeEditor.nextHunk()},prevHunk:function(e){e&&e.preventDefault(),this.codeEditor.prevHunk()}})}),define("repo/source/create-file",["backbone","jquery","on-ready","underscore","components/code-editor/modes","components/editor/edit-form","utils/mustache","utils/query-params","utils/ready","jquery-plugins/jquery.pjax"],function(e,t,i,n,r,o,s,a){return i(function(){var i=t("#editor-container"),l=i.attr("data-owner"),c=i.attr("data-slug"),d=i.data("is-writer"),h=i.data("has-push-access"),u=i.attr("data-hash"),f=i.attr("data-branch"),p=i.attr("data-path"),m=i.attr("data-source-url"),g=t(s.toHtml("edit-form-template",{owner:l,slug:c,isCreate:!0,isWriter:d,hasPushAccess:h,hash:u,branch:f,path:p,encodedPath:encodeURIComponent(this.path),content:"",syntaxes:n.sortBy(r,function(e){return e.label.toLowerCase()})})).appendTo(i),v=new o({el:g,source:""}),b=new e.Collection,_=e.View.extend({id:"path",events:{"keydown #filename":"keydownHandler","keyup #filename":"keyupHandler"},initialize:function(e){this.editForm=e.editForm,this.initialPath=e.initialPath,this.sourceUrl=e.sourceUrl},render:function(){var e=this.collection;return this.$(".path-part").each(function(){e.add({path:t(this).text()})}),new y({el:this.$(".path-parts"),collection:this.collection}),this.$filename=this.$("#filename"),this.$filename.focus(),(this.collection.length||a.get("filename"))&&this.editForm.on("ready",this.updatePath.bind(this)),this},getFilename:function(){return this.$filename.val()},getFullPath:function(){var e=this.collection.pluck("path");return e.push(this.getFilename()),this.initialPath+e.join("/")},keydownHandler:function(e){this.checkForSlash(e),this.checkForDelete(e)},keyupHandler:function(){this.updatePath()},checkForSlash:function(e){if(191===e.keyCode){e.preventDefault();var t=this.$filename.val();t&&(this.collection.add({path:t}),this.$filename.val(""))}},checkForDelete:function(e){if(8===e.keyCode&&!this.$filename.val()){var t=this.collection.pop();t&&(e.preventDefault(),this.$filename.val(t.get("path")))}},updatePath:function(){var e=this.getFullPath();this.updateEditorPath(e),this.editForm.setCommitEnabled(!0),e&&this.getFilename()?this.checkForPathExistence(e):(this.$("#duplicate-file-error").remove(),this.editForm.setCommitEnabled(!1))},updateEditorPath:function(e){return this.editForm.setPath(e),this.editForm.updatePathBasedSyntax(e),this},checkForPathExistence:n.debounce(function(e){t.ajax({url:this.sourceUrl+e,type:"GET"}).always(function(e,i){if(this.$("#duplicate-file-error").remove(),"success"===i){var n=gettext("A file with this name already exists.");t('<span class="error" id="duplicate-file-error"/>').text(n).insertAfter(this.$filename),this.editForm.setCommitEnabled(!1)}}.bind(this))},100)}),y=e.View.extend({tagName:"ul",className:"path-parts",initialize:function(e){this.collection=e.collection,this.collection.on("add remove",this.render.bind(this))},render:function(){return this.$el.empty().append(this.collection.map(function(e){return new w({model:e}).render().el})),this}}),w=e.View.extend({tagName:"li",className:"path-part",render:function(){return this.$el.text(this.model.get("path")),this}});new _({el:t("#path"),collection:b,editForm:v,initialPath:p,sourceUrl:m}).render(),v.on("ready",function(){i.removeClass("has-mask")})})}),define("repo/source/delete-file",["jquery","on-ready","api/cache/repositories","components/editor/commit-form","utils/gaq-push"],function(e,t,i,n,r){return t(function(){e("#editor-container").find(".delete-link").click(function(){var t=e("#editor-container"),o=i.load("{}/{}".format(t.attr("data-owner"),t.attr("data-slug"))),s=t.attr("data-hash"),a=(t.attr("data-branch"),t.data("is-writer")),l=t.data("has-push-access"),c=t.attr("data-path"),d=new n({repository:o,isDelete:!0,isWriter:a,hasPushAccess:l,hash:s,branch:t.attr("data-branch"),path:c});d.show(),r(["atl._trackEvent","Online editing","Delete file"])})})}),define("components/changeset-selector",["aui","jquery","data/current-repo","utils/api-helper","utils/localize","utils/mustache"],function(e,t,i,n,r,o){return function(s,a,l){function c(){x||k||(x=!0,p.addClass("loading"),t.ajax({url:y,data:{page:w},dataType:"json",success:function(e){var i,n=e.changesets?e.changesets:e;if(!n.length){var s=l.noMoreText||gettext("No more commits");return i=t('<li class="end"></li>').text(s),k=!0,p.removeClass("loading"),void p.append(i)}for(var a=0,c=n.length;c>a;a++){{var d=n[a];d.author}d.selected=_&&(_.startsWith(d.node)||d.node.startsWith(_)),d.path=b,i=t("<li></li>").html(o.toHtml("source-changeset",d)),m.before(i),w++}p.removeClass("loading"),r()},error:function(t,i){var n;n=C[t.status]?C[t.status]:i,f.hide(),p.remove(),p=null,e.messages.error({body:"{!esc}".format(n)})},complete:function(){x=!1}}))}function d(e,i,n){return p&&p.length?void(n&&n()):(p=t("<ul></ul>").addClass("file-history-widget"),m=t("<li></li>").addClass("loading-item"),p.append(m),e.append(p),c(),p.scroll(function(){p[0].scrollHeight-p.scrollTop()<=p.outerHeight()&&c()}),p.on("click","a",function(e){if(l.onSelect){var i=t(e.target).closest("a"),n=i.attr("data-hash"),s=_;if(e.preventDefault(),i.hasClass("highlight"))return;_=n;var a=l.onSelect(i);if(a){var c={hash:n.substring(0,7),utctimestamp:i.find("time").attr("datetime"),avatar:i.find("img").attr("src"),display_name:i.find("author").text()};p.find(".highlight").removeClass("highlight"),i.addClass("highlight"),g.html(t(o.toHtml("source-changeset-trigger",c))),r()}else _=s}f.hide()}),void(n&&n()))}function h(){f=e.InlineDialog(g,a,d)}function u(){return _}l=l||{};var f,p,m,g=t(s),v=g.data("changeset"),b=g.data("path"),_=g.data("current"),y=l.url||n.concat("repositories",i.owner.username,i.slug,"filehistory",v)+b,w=0,x=!1,k=!1,C={500:gettext("An error occurred while processing your request."),404:gettext("Unable to find changesets for this file.")};return{init:h,getSelectedChangeset:u}}}),define("repo/source/diff-file",["jquery","on-ready","components/changeset-selector","jquery-plugins/jquery.pjax"],function(e,t,i){return t(function(){function t(){var t=n.getSelectedChangeset(),i=r.getSelectedChangeset();return t.startsWith(i)||i.startsWith(t)?(l.removeClass("hidden"),l.find(".message").text("You cannot diff the same commit."),!1):(l.text(""),e.pjax({container:"#source-container",url:window.location.pathname,data:{diff1:t,diff2:i,at:c||""},success:function(t){e("#source-container").html(t)}}),!0)}var n,r,o=e("#source-diff"),s=o.find("#diff1-history-trigger"),a=o.find("#diff2-history-trigger"),l=o.find(".error"),c=o.data("at");n=i(s,"diff-dialog-diff1",{onSelect:t}),n.init(),r=i(a,"diff-dialog-diff2",{onSelect:t}),r.init()})}),define("components/editor/editable",["aui","backbone","jquery","underscore","components/confirm-dialog","components/editor/edit-form","components/code-editor/modes","utils/gaq-push","utils/mustache"],function(e,t,i,n,r,o,s,a,l){var c=null;return i(document).on("pjax:end",function(){c=null}),t.View.extend({events:{"click .edit-button":"toggle","click .cancel-link":"toggle"},initialize:function(e){n.bindAll(this,"toggle","recenter"),this.owner=e.owner,this.slug=e.slug,this.destinationOwner=e.destinationOwner,this.destinationSlug=e.destinationSlug,this.localID=e.localID,this.isWriter=e.isWriter,this.hasPushAccess=e.hasPushAccess,this.isPullRequest=e.isPullRequest,this.hash=e.hash,this.branch=e.branch,this.path=e.path,this.sourceUrl=e.sourceUrl,this.multipleError=e.multipleError,this.createFile=e.createFile,this.editing=!1},toggle:function(e){e&&e.preventDefault(),this.isPullRequest&&c&&c!==this?r(this.multipleError).done(function(){c.toggle(),this.toggle(e)}.bind(this)):this.editing?(this.viewOriginal(e),this.editing=!1,this.$el.trigger("stop.editable")):(this.editFile(e),this.editing=!0,this.$el.trigger("start.editable"))},editFile:function(e){function t(e){l.clear("edit-form-template"),e=e||{};var t=e.mimetype?e.mimetype.type:"text/plain",a=e.data||"",c=i(l.toHtml("edit-form-template",{owner:this.owner,slug:this.slug,destinationOwner:this.destinationOwner,destinationSlug:this.destinationSlug,localID:this.localID,isCreate:!1,isWriter:this.isWriter,hasPushAccess:this.hasPushAccess,isPullRequest:this.isPullRequest,hash:this.hash,branch:this.branch,path:this.path,encodedPath:encodeURIComponent(this.path),mimetype:t,content:a,syntaxes:n.sortBy(s,function(e){return e.label.toLowerCase()})})).appendTo(this.$el);c.hide(),this.editForm=new o({el:c,source:a}),this.editForm.on("recenter",this.recenter.bind(this)),this.editForm.on("ready",function(){this.showEditor(r)}.bind(this))}var r=i(e.target);c=this,a(["atl._trackEvent","Online editing","Load editor"]),r.attr({disabled:"disabled","aria-disabled":!0}),this.$el.addClass("has-mask"),this.createFile?t.bind(this)():i.ajax({url:this.sourceUrl,type:"GET",dataType:"json"}).done(t.bind(this)).fail(function(){r.removeAttr("disabled aria-disabled"),this.$el.removeClass("has-mask"),c=null,this.toggle()}.bind(this))},recenter:function(){i("html, body").stop().animate({scrollTop:this.$el.offset().top-10},250)},showEditor:function(e){e.removeAttr("disabled aria-disabled"),this.$el.removeClass("has-mask"),this.getOriginal().hide(),this.editForm.$el.show(),this.editForm.refresh(),this.recenter()},getOriginal:function(){return null},viewOriginal:function(){this.editForm&&this.editForm.remove(),this.getOriginal().show(),c=null}})}),define("components/editor/editable-source",["jquery","components/editor/editable"],function(e,t){return t.extend({getOriginal:function(){return this.$("#source-view")}})}),define("repo/source/editor",["jquery","on-ready","components/editor/editable-source"],function(e,t,i){return t(function(){var t=e("#editor-container"),n=t.data("owner"),r=t.data("slug"),o=t.data("is-writer"),s=t.data("has-push-access"),a=t.data("hash"),l=t.data("branch"),c=t.data("path"),d=t.data("source-url"),h=t.data("create-file");new i({el:t,owner:n,slug:r,isWriter:o,hasPushAccess:s,hash:a,branch:l,path:c,sourceUrl:d,createFile:h})})}),define("repo/source/embed",["aui","jquery","on-ready","utils/dialog-positions","utils/mustache"],function(e,t,i,n,r){return i(function(){function i(e,i,n){var o=t(i);if(!e.find(".embed").length){var s=r.toHtml("embed-template",{url:o.attr("href")});e.append(s)}n&&n(),setTimeout(function(){t("#embed-code").select()},0)}var o=t("#embed-link");e.InlineDialog(o,"embed-dialog",i,{calculatePositions:n.alignRight()})})}),define("repo/source/list",["jquery","on-ready","utils/localize"],function(e,t,i){return t(function(){var t=e("#source-list"),n=t.find(".date.deferred").first();n.length<1||(n.addClass("loading"),e.ajax({url:t.attr("data-lastmod-url"),success:function(n){e(n).each(function(){var i,n,r;return i=e(this),r=i.data("for"),r?(n=t.find(r),n.removeClass("deferred"),n.html(i)):void 0}),i()},complete:function(){n.removeClass("loading")}}))})}),define("repo/source/rename-file",["jquery","on-ready","api/cache/repositories","components/editor/commit-form","utils/gaq-push"],function(e,t,i,n,r){return t(function(){e("#editor-container").find(".rename-link").click(function(){var t=e("#editor-container"),o=i.load("{}/{}".format(t.attr("data-owner"),t.attr("data-slug"))),s=t.attr("data-hash"),a=(t.attr("data-branch"),t.data("is-writer")),l=t.data("has-push-access"),c=t.attr("data-path"),d=t.attr("data-source-url");e.ajax({url:d,type:"GET",dataType:"json"}).done(function(e){var i=new n({repository:o,isRename:!0,isWriter:a,hasPushAccess:l,hash:s,branch:t.attr("data-branch"),path:c,sourceUrl:d});i.setContent(e.data),i.show()}),r(["atl._trackEvent","Online editing","Rename file"])})})}),define("repo/source/view-file",["jquery","on-ready","components/changeset-selector","jquery-plugins/jquery.pjax"],function(e,t,i){return t(function(){var t=e("#source-view"),n=t.find("#file-history-trigger"),r=i(n,"changesets-dialog");r.init(),t.find(".edit-button-overlay").tooltip()})}),define("components/tabbed-filter",["jquery","utils/quick-filter"],function(e,t){return function(i){function n(t){var i=e(t.target).closest("a"),n=i.closest("div.tabbed-filter-widget"),r=i.closest("div.filter-tabs"),o=n.find("input.filter-box"),s=i.attr("href").substring(1),a=n.find("#"+s),l=a.data("filter-placeholder");t.preventDefault(),r.find("li.active-tab").removeClass("active-tab"),i.closest("li").addClass("active-tab"),n.find(".tab-pane.active-pane").removeClass("active-pane"),a.addClass("active-pane"),o.attr("placeholder",l),o.val()&&o.val()!==o.attr("placeholder")&&o.trigger("input")}function r(e){e.on("click",".filter-tabs li.menu-item a",n),t(e)}r(i)}}),define("utils/compare-branches",[],function(){return function(e,t){return e.mainbranch&&!t.mainbranch?-1:!e.mainbranch&&t.mainbranch?1:e.name>t.name?1:e.name<t.name?-1:0}}),define("components/branch-dialog",["aui","jquery","on-ready","components/key-navigation","components/tabbed-filter","utils/compare-branches","utils/mustache"],function(e,t,i,n,r,o,s){return i(function(){function i(e,i,l){if(!e.find(".branch-dialog").length){e.addClass("loading");var c=function(e){return t.each(e,function(i,n){e[i].safeName=encodeURIComponent(n.name),n.heads&&n.heads.length>1&&(e[i].hasMultipleHeads=!0),e[i].hasMultipleHeads&&t.each(n.heads,function(t,n){e[i].heads[t]={changeset:n,shortChangeset:n.slice(0,7)}})}),e};t.getJSON(a.data("branches-tags-url")).success(function(i){i.branches=c(i.branches),i.branches.sort(o),a.data("ignoreTags")?i.ignoreTags=!0:(i.tags=c(i.tags),i.ignoreTags=!1);var l="branch-dialog-template";s.clear(l),e.removeClass("loading").html(s.toHtml(l,i)),r(e),t(document).trigger("branchDialogReady");var d=e.find("input.filter-box");d.focus(),n.tabbedFilter(d,e)}).error(function(){e.removeClass("loading").html("<p>Could not load branches and tags</p>")})}l&&l(),setTimeout(function(){e.find("input.filter-box").focus()},0)}var a=t(".branch-dialog-trigger");e.InlineDialog(a,"branch-dialog",i,{hideDelay:null})})}),define("data/current-cset",["jquery"],function(e){var t=e(document.body).attr("data-current-cset");return t}),function(e){define("diff-match-patch",[],function(){return function(){return function(){function e(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}e.prototype.diff_main=function(e,t,i,n){if("undefined"==typeof n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];"undefined"==typeof i&&(i=!0);var r=i,o=this.diff_commonPrefix(e,t);i=e.substring(0,o),e=e.substring(o),t=t.substring(o);var o=this.diff_commonSuffix(e,t),s=e.substring(e.length-o);return e=e.substring(0,e.length-o),t=t.substring(0,t.length-o),e=this.diff_compute_(e,t,r,n),i&&e.unshift([0,i]),s&&e.push([0,s]),this.diff_cleanupMerge(e),e},e.prototype.diff_compute_=function(e,t,i,n){if(!e)return[[1,t]];if(!t)return[[-1,e]];var r=e.length>t.length?e:t,o=e.length>t.length?t:e,s=r.indexOf(o);return-1!=s?(i=[[1,r.substring(0,s)],[0,o],[1,r.substring(s+o.length)]],e.length>t.length&&(i[0][0]=i[2][0]=-1),i):1==o.length?[[-1,e],[1,t]]:(r=this.diff_halfMatch_(e,t))?(o=r[0],e=r[1],s=r[2],t=r[3],r=r[4],o=this.diff_main(o,s,i,n),i=this.diff_main(e,t,i,n),o.concat([[0,r]],i)):i&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},e.prototype.diff_lineMode_=function(e,t,i){var n=this.diff_linesToChars_(e,t);e=n.chars1,t=n.chars2,n=n.lineArray,e=this.diff_main(e,t,!1,i),this.diff_charsToLines_(e,n),this.diff_cleanupSemantic(e),e.push([0,""]);for(var r=n=t=0,o="",s="";t<e.length;){switch(e[t][0]){case 1:r++,s+=e[t][1];break;case-1:n++,o+=e[t][1];break;case 0:if(n>=1&&r>=1){for(e.splice(t-n-r,n+r),t=t-n-r,n=this.diff_main(o,s,!1,i),r=n.length-1;r>=0;r--)e.splice(t,0,n[r]);t+=n.length}n=r=0,s=o=""}t++}return e.pop(),e},e.prototype.diff_bisect_=function(e,t,i){for(var n=e.length,r=t.length,o=Math.ceil((n+r)/2),s=o,a=2*o,l=Array(a),c=Array(a),d=0;a>d;d++)l[d]=-1,c[d]=-1;
l[s+1]=0,c[s+1]=0;for(var d=n-r,h=0!=d%2,u=0,f=0,p=0,m=0,g=0;o>g&&!((new Date).getTime()>i);g++){for(var v=-g+u;g-f>=v;v+=2){var b,_=s+v;b=v==-g||v!=g&&l[_-1]<l[_+1]?l[_+1]:l[_-1]+1;for(var y=b-v;n>b&&r>y&&e.charAt(b)==t.charAt(y);)b++,y++;if(l[_]=b,b>n)f+=2;else if(y>r)u+=2;else if(h&&(_=s+d-v,_>=0&&a>_&&-1!=c[_])){var w=n-c[_];if(b>=w)return this.diff_bisectSplit_(e,t,b,y,i)}}for(v=-g+p;g-m>=v;v+=2){for(_=s+v,w=v==-g||v!=g&&c[_-1]<c[_+1]?c[_+1]:c[_-1]+1,b=w-v;n>w&&r>b&&e.charAt(n-w-1)==t.charAt(r-b-1);)w++,b++;if(c[_]=w,w>n)m+=2;else if(b>r)p+=2;else if(!h&&(_=s+d-v,_>=0&&a>_&&-1!=l[_]&&(b=l[_],y=s+b-_,w=n-w,b>=w)))return this.diff_bisectSplit_(e,t,b,y,i)}}return[[-1,e],[1,t]]},e.prototype.diff_bisectSplit_=function(e,t,i,n,r){var o=e.substring(0,i),s=t.substring(0,n);return e=e.substring(i),t=t.substring(n),o=this.diff_main(o,s,!1,r),r=this.diff_main(e,t,!1,r),o.concat(r)},e.prototype.diff_linesToChars_=function(e,t){function i(e){for(var t="",i=0,o=-1,s=n.length;o<e.length-1;){o=e.indexOf("\n",i),-1==o&&(o=e.length-1);var a=e.substring(i,o+1),i=o+1;(r.hasOwnProperty?r.hasOwnProperty(a):void 0!==r[a])?t+=String.fromCharCode(r[a]):(t+=String.fromCharCode(s),r[a]=s,n[s++]=a)}return t}var n=[],r={};n[0]="";var o=i(e),s=i(t);return{chars1:o,chars2:s,lineArray:n}},e.prototype.diff_charsToLines_=function(e,t){for(var i=0;i<e.length;i++){for(var n=e[i][1],r=[],o=0;o<n.length;o++)r[o]=t[n.charCodeAt(o)];e[i][1]=r.join("")}},e.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,o=0;r>i;)e.substring(o,r)==t.substring(o,r)?o=i=r:n=r,r=Math.floor((n-i)/2+i);return r},e.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,o=0;r>i;)e.substring(e.length-r,e.length-o)==t.substring(t.length-r,t.length-o)?o=i=r:n=r,r=Math.floor((n-i)/2+i);return r},e.prototype.diff_commonOverlap_=function(e,t){var i=e.length,n=t.length;if(0==i||0==n)return 0;if(i>n?e=e.substring(i-n):n>i&&(t=t.substring(0,i)),i=Math.min(i,n),e==t)return i;for(var n=0,r=1;;){var o=e.substring(i-r),o=t.indexOf(o);if(-1==o)return n;r+=o,(0==o||e.substring(i-r)==t.substring(0,r))&&(n=r,r++)}},e.prototype.diff_halfMatch_=function(e,t){function i(e,t,i){for(var n,r,o,a,l=e.substring(i,i+Math.floor(e.length/4)),c=-1,d="";-1!=(c=t.indexOf(l,c+1));){var h=s.diff_commonPrefix(e.substring(i),t.substring(c)),u=s.diff_commonSuffix(e.substring(0,i),t.substring(0,c));d.length<u+h&&(d=t.substring(c-u,c)+t.substring(c,c+h),n=e.substring(0,i-u),r=e.substring(i+h),o=t.substring(0,c-u),a=t.substring(c+h))}return 2*d.length>=e.length?[n,r,o,a,d]:null}if(0>=this.Diff_Timeout)return null;var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(4>n.length||2*r.length<n.length)return null;var o,s=this,a=i(n,r,Math.ceil(n.length/4)),n=i(n,r,Math.ceil(n.length/2));if(!a&&!n)return null;o=n?a&&a[4].length>n[4].length?a:n:a;var l;return e.length>t.length?(a=o[0],n=o[1],r=o[2],l=o[3]):(r=o[0],l=o[1],a=o[2],n=o[3]),o=o[4],[a,n,r,l,o]},e.prototype.diff_cleanupSemantic=function(e){for(var t=!1,i=[],n=0,r=null,o=0,s=0,a=0,l=0,c=0;o<e.length;)0==e[o][0]?(i[n++]=o,s=l,a=c,c=l=0,r=e[o][1]):(1==e[o][0]?l+=e[o][1].length:c+=e[o][1].length,r&&r.length<=Math.max(s,a)&&r.length<=Math.max(l,c)&&(e.splice(i[n-1],0,[-1,r]),e[i[n-1]+1][0]=1,n--,n--,o=n>0?i[n-1]:-1,c=l=a=s=0,r=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;)-1==e[o-1][0]&&1==e[o][0]&&(t=e[o-1][1],i=e[o][1],n=this.diff_commonOverlap_(t,i),r=this.diff_commonOverlap_(i,t),n>=r?(n>=t.length/2||n>=i.length/2)&&(e.splice(o,0,[0,i.substring(0,n)]),e[o-1][1]=t.substring(0,t.length-n),e[o+1][1]=i.substring(n),o++):(r>=t.length/2||r>=i.length/2)&&(e.splice(o,0,[0,t.substring(0,r)]),e[o-1][0]=1,e[o-1][1]=i.substring(0,i.length-r),e[o+1][0]=-1,e[o+1][1]=t.substring(r),o++),o++),o++},e.prototype.diff_cleanupSemanticLossless=function(t){function i(t,i){if(!t||!i)return 6;var n=t.charAt(t.length-1),r=i.charAt(0),o=n.match(e.nonAlphaNumericRegex_),s=r.match(e.nonAlphaNumericRegex_),a=o&&n.match(e.whitespaceRegex_),l=s&&r.match(e.whitespaceRegex_),n=a&&n.match(e.linebreakRegex_),r=l&&r.match(e.linebreakRegex_),c=n&&t.match(e.blanklineEndRegex_),d=r&&i.match(e.blanklineStartRegex_);return c||d?5:n||r?4:o&&!a&&l?3:a||l?2:o||s?1:0}for(var n=1;n<t.length-1;){if(0==t[n-1][0]&&0==t[n+1][0]){var r=t[n-1][1],o=t[n][1],s=t[n+1][1],a=this.diff_commonSuffix(r,o);if(a)var l=o.substring(o.length-a),r=r.substring(0,r.length-a),o=l+o.substring(0,o.length-a),s=l+s;for(var a=r,l=o,c=s,d=i(r,o)+i(o,s);o.charAt(0)===s.charAt(0);){var r=r+o.charAt(0),o=o.substring(1)+s.charAt(0),s=s.substring(1),h=i(r,o)+i(o,s);h>=d&&(d=h,a=r,l=o,c=s)}t[n-1][1]!=a&&(a?t[n-1][1]=a:(t.splice(n-1,1),n--),t[n][1]=l,c?t[n+1][1]=c:(t.splice(n+1,1),n--))}n++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,i=[],n=0,r=null,o=0,s=!1,a=!1,l=!1,c=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(l||c)?(i[n++]=o,s=l,a=c,r=e[o][1]):(n=0,r=null),l=c=!1):(-1==e[o][0]?c=!0:l=!0,r&&(s&&a&&l&&c||r.length<this.Diff_EditCost/2&&3==s+a+l+c)&&(e.splice(i[n-1],0,[-1,r]),e[i[n-1]+1][0]=1,n--,r=null,s&&a?(l=c=!0,n=0):(n--,o=n>0?i[n-1]:-1,l=c=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},e.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,i=0,n=0,r=0,o="",s="";i<e.length;)switch(e[i][0]){case 1:r++,s+=e[i][1],i++;break;case-1:n++,o+=e[i][1],i++;break;case 0:n+r>1?(0!==n&&0!==r&&(t=this.diff_commonPrefix(s,o),0!==t&&(i-n-r>0&&0==e[i-n-r-1][0]?e[i-n-r-1][1]+=s.substring(0,t):(e.splice(0,0,[0,s.substring(0,t)]),i++),s=s.substring(t),o=o.substring(t)),t=this.diff_commonSuffix(s,o),0!==t&&(e[i][1]=s.substring(s.length-t)+e[i][1],s=s.substring(0,s.length-t),o=o.substring(0,o.length-t))),0===n?e.splice(i-r,n+r,[1,s]):0===r?e.splice(i-n,n+r,[-1,o]):e.splice(i-n-r,n+r,[-1,o],[1,s]),i=i-n-r+(n?1:0)+(r?1:0)+1):0!==i&&0==e[i-1][0]?(e[i-1][1]+=e[i][1],e.splice(i,1)):i++,n=r=0,s=o=""}for(""===e[e.length-1][1]&&e.pop(),n=!1,i=1;i<e.length-1;)0==e[i-1][0]&&0==e[i+1][0]&&(e[i][1].substring(e[i][1].length-e[i-1][1].length)==e[i-1][1]?(e[i][1]=e[i-1][1]+e[i][1].substring(0,e[i][1].length-e[i-1][1].length),e[i+1][1]=e[i-1][1]+e[i+1][1],e.splice(i-1,1),n=!0):e[i][1].substring(0,e[i+1][1].length)==e[i+1][1]&&(e[i-1][1]+=e[i+1][1],e[i][1]=e[i][1].substring(e[i+1][1].length)+e[i+1][1],e.splice(i+1,1),n=!0)),i++;n&&this.diff_cleanupMerge(e)},e.prototype.diff_xIndex=function(e,t){var i,n=0,r=0,o=0,s=0;for(i=0;i<e.length&&(1!==e[i][0]&&(n+=e[i][1].length),-1!==e[i][0]&&(r+=e[i][1].length),!(n>t));i++)o=n,s=r;return e.length!=i&&-1===e[i][0]?s:s+(t-o)},e.prototype.diff_prettyHtml=function(e){for(var t=[],i=/&/g,n=/</g,r=/>/g,o=/\n/g,s=0;s<e.length;s++){var a=e[s][0],l=e[s][1],l=l.replace(i,"&amp;").replace(n,"&lt;").replace(r,"&gt;").replace(o,"&para;<br>");switch(a){case 1:t[s]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case-1:t[s]='<del style="background:#ffe6e6;">'+l+"</del>";break;case 0:t[s]="<span>"+l+"</span>"}}return t.join("")},e.prototype.diff_text1=function(e){for(var t=[],i=0;i<e.length;i++)1!==e[i][0]&&(t[i]=e[i][1]);return t.join("")},e.prototype.diff_text2=function(e){for(var t=[],i=0;i<e.length;i++)-1!==e[i][0]&&(t[i]=e[i][1]);return t.join("")},e.prototype.diff_levenshtein=function(e){for(var t=0,i=0,n=0,r=0;r<e.length;r++){var o=e[r][0],s=e[r][1];switch(o){case 1:i+=s.length;break;case-1:n+=s.length;break;case 0:t+=Math.max(i,n),n=i=0}}return t+=Math.max(i,n)},e.prototype.diff_toDelta=function(e){for(var t=[],i=0;i<e.length;i++)switch(e[i][0]){case 1:t[i]="+"+encodeURI(e[i][1]);break;case-1:t[i]="-"+e[i][1].length;break;case 0:t[i]="="+e[i][1].length}return t.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(e,t){for(var i=[],n=0,r=0,o=t.split(/\t/g),s=0;s<o.length;s++){var a=o[s].substring(1);switch(o[s].charAt(0)){case"+":try{i[n++]=[1,decodeURI(a)]}catch(l){throw Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var c=parseInt(a,10);if(isNaN(c)||0>c)throw Error("Invalid number in diff_fromDelta: "+a);a=e.substring(r,r+=c),i[n++]="="==o[s].charAt(0)?[0,a]:[-1,a];break;default:if(o[s])throw Error("Invalid diff operation in diff_fromDelta: "+o[s])}}if(r!=e.length)throw Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return i},e.prototype.match_main=function(e,t,i){if(null==e||null==t||null==i)throw Error("Null input. (match_main)");return i=Math.max(0,Math.min(i,e.length)),e==t?0:e.length?e.substring(i,i+t.length)==t?i:this.match_bitap_(e,t,i):-1},e.prototype.match_bitap_=function(e,t,i){function n(e,n){var r=e/t.length,s=Math.abs(i-n);return o.Match_Distance?r+s/o.Match_Distance:s?1:r}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r=this.match_alphabet_(t),o=this,s=this.Match_Threshold,a=e.indexOf(t,i);-1!=a&&(s=Math.min(n(0,a),s),a=e.lastIndexOf(t,i+t.length),-1!=a&&(s=Math.min(n(0,a),s)));for(var l,c,d,h=1<<t.length-1,a=-1,u=t.length+e.length,f=0;f<t.length;f++){for(l=0,c=u;c>l;)n(f,i+c)<=s?l=c:u=c,c=Math.floor((u-l)/2+l);u=c,l=Math.max(1,i-c+1);var p=Math.min(i+c,e.length)+t.length;for(c=Array(p+2),c[p+1]=(1<<f)-1;p>=l;p--){var m=r[e.charAt(p-1)];if(c[p]=0===f?(c[p+1]<<1|1)&m:(c[p+1]<<1|1)&m|((d[p+1]|d[p])<<1|1)|d[p+1],c[p]&h&&(m=n(f,p-1),s>=m)){if(s=m,a=p-1,!(a>i))break;l=Math.max(1,2*i-a)}}if(n(f+1,i)>s)break;d=c}return a},e.prototype.match_alphabet_=function(e){for(var t={},i=0;i<e.length;i++)t[e.charAt(i)]=0;for(i=0;i<e.length;i++)t[e.charAt(i)]|=1<<e.length-i-1;return t},e.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var i=t.substring(e.start2,e.start2+e.length1),n=0;t.indexOf(i)!=t.lastIndexOf(i)&&i.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,i=t.substring(e.start2-n,e.start2+e.length1+n);n+=this.Patch_Margin,(i=t.substring(e.start2-n,e.start2))&&e.diffs.unshift([0,i]),(n=t.substring(e.start2+e.length1,e.start2+e.length1+n))&&e.diffs.push([0,n]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+n.length,e.length2+=i.length+n.length}},e.prototype.patch_make=function(t,i,n){var r;if("string"==typeof t&&"string"==typeof i&&"undefined"==typeof n)r=t,i=this.diff_main(r,i,!0),2<i.length&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(t&&"object"==typeof t&&"undefined"==typeof i&&"undefined"==typeof n)i=t,r=this.diff_text1(i);else if("string"==typeof t&&i&&"object"==typeof i&&"undefined"==typeof n)r=t;else{if("string"!=typeof t||"string"!=typeof i||!n||"object"!=typeof n)throw Error("Unknown call format to patch_make.");r=t,i=n}if(0===i.length)return[];n=[],t=new e.patch_obj;for(var o=0,s=0,a=0,l=r,c=0;c<i.length;c++){var d=i[c][0],h=i[c][1];switch(!o&&0!==d&&(t.start1=s,t.start2=a),d){case 1:t.diffs[o++]=i[c],t.length2+=h.length,r=r.substring(0,a)+h+r.substring(a);break;case-1:t.length1+=h.length,t.diffs[o++]=i[c],r=r.substring(0,a)+r.substring(a+h.length);break;case 0:h.length<=2*this.Patch_Margin&&o&&i.length!=c+1?(t.diffs[o++]=i[c],t.length1+=h.length,t.length2+=h.length):h.length>=2*this.Patch_Margin&&o&&(this.patch_addContext_(t,l),n.push(t),t=new e.patch_obj,o=0,l=r,s=a)}1!==d&&(s+=h.length),-1!==d&&(a+=h.length)}return o&&(this.patch_addContext_(t,l),n.push(t)),n},e.prototype.patch_deepCopy=function(t){for(var i=[],n=0;n<t.length;n++){var r=t[n],o=new e.patch_obj;o.diffs=[];for(var s=0;s<r.diffs.length;s++)o.diffs[s]=r.diffs[s].slice();o.start1=r.start1,o.start2=r.start2,o.length1=r.length1,o.length2=r.length2,i[n]=o}return i},e.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var i=this.patch_addPadding(e);t=i+t+i,this.patch_splitMax(e);for(var n=0,r=[],o=0;o<e.length;o++){var s,a=e[o].start2+n,l=this.diff_text1(e[o].diffs),c=-1;if(l.length>this.Match_MaxBits?(s=this.match_main(t,l.substring(0,this.Match_MaxBits),a),-1!=s&&(c=this.match_main(t,l.substring(l.length-this.Match_MaxBits),a+l.length-this.Match_MaxBits),-1==c||s>=c)&&(s=-1)):s=this.match_main(t,l,a),-1==s)r[o]=!1,n-=e[o].length2-e[o].length1;else if(r[o]=!0,n=s-a,a=-1==c?t.substring(s,s+l.length):t.substring(s,c+this.Match_MaxBits),l==a)t=t.substring(0,s)+this.diff_text2(e[o].diffs)+t.substring(s+l.length);else if(a=this.diff_main(l,a,!1),l.length>this.Match_MaxBits&&this.diff_levenshtein(a)/l.length>this.Patch_DeleteThreshold)r[o]=!1;else{this.diff_cleanupSemanticLossless(a);for(var d,l=0,c=0;c<e[o].diffs.length;c++){var h=e[o].diffs[c];0!==h[0]&&(d=this.diff_xIndex(a,l)),1===h[0]?t=t.substring(0,s+d)+h[1]+t.substring(s+d):-1===h[0]&&(t=t.substring(0,s+d)+t.substring(s+this.diff_xIndex(a,l+h[1].length))),-1!==h[0]&&(l+=h[1].length)}}}return t=t.substring(i.length,t.length-i.length),[t,r]},e.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,i="",n=1;t>=n;n++)i+=String.fromCharCode(n);for(n=0;n<e.length;n++)e[n].start1+=t,e[n].start2+=t;var n=e[0],r=n.diffs;if(0==r.length||0!=r[0][0])r.unshift([0,i]),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t;else if(t>r[0][1].length){var o=t-r[0][1].length;r[0][1]=i.substring(r[0][1].length)+r[0][1],n.start1-=o,n.start2-=o,n.length1+=o,n.length2+=o}return n=e[e.length-1],r=n.diffs,0==r.length||0!=r[r.length-1][0]?(r.push([0,i]),n.length1+=t,n.length2+=t):t>r[r.length-1][1].length&&(o=t-r[r.length-1][1].length,r[r.length-1][1]+=i.substring(0,o),n.length1+=o,n.length2+=o),i},e.prototype.patch_splitMax=function(t){for(var i=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=i)){var r=t[n];t.splice(n--,1);for(var o=r.start1,s=r.start2,a="";0!==r.diffs.length;){var l=new e.patch_obj,c=!0;for(l.start1=o-a.length,l.start2=s-a.length,""!==a&&(l.length1=l.length2=a.length,l.diffs.push([0,a]));0!==r.diffs.length&&l.length1<i-this.Patch_Margin;){var a=r.diffs[0][0],d=r.diffs[0][1];1===a?(l.length2+=d.length,s+=d.length,l.diffs.push(r.diffs.shift()),c=!1):-1===a&&1==l.diffs.length&&0==l.diffs[0][0]&&d.length>2*i?(l.length1+=d.length,o+=d.length,c=!1,l.diffs.push([a,d]),r.diffs.shift()):(d=d.substring(0,i-l.length1-this.Patch_Margin),l.length1+=d.length,o+=d.length,0===a?(l.length2+=d.length,s+=d.length):c=!1,l.diffs.push([a,d]),d==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(d.length))}a=this.diff_text2(l.diffs),a=a.substring(a.length-this.Patch_Margin),d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin),""!==d&&(l.length1+=d.length,l.length2+=d.length,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=d:l.diffs.push([0,d])),c||t.splice(++n,0,l)}}},e.prototype.patch_toText=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e[i];return t.join("")},e.prototype.patch_fromText=function(t){var i=[];if(!t)return i;t=t.split("\n");for(var n=0,r=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;n<t.length;){var o=t[n].match(r);if(!o)throw Error("Invalid patch string: "+t[n]);var s=new e.patch_obj;for(i.push(s),s.start1=parseInt(o[1],10),""===o[2]?(s.start1--,s.length1=1):"0"==o[2]?s.length1=0:(s.start1--,s.length1=parseInt(o[2],10)),s.start2=parseInt(o[3],10),""===o[4]?(s.start2--,s.length2=1):"0"==o[4]?s.length2=0:(s.start2--,s.length2=parseInt(o[4],10)),n++;n<t.length;){o=t[n].charAt(0);try{var a=decodeURI(t[n].substring(1))}catch(l){throw Error("Illegal escape in patch_fromText: "+a)}if("-"==o)s.diffs.push([-1,a]);else if("+"==o)s.diffs.push([1,a]);else if(" "==o)s.diffs.push([0,a]);else{if("@"==o)break;if(""!==o)throw Error('Invalid patch mode "'+o+'" in: '+a)}n++}}return i},e.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},e.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,e=["@@ -"+e+" +"+t+" @@\n"];var i;for(t=0;t<this.diffs.length;t++){switch(this.diffs[t][0]){case 1:i="+";break;case-1:i="-";break;case 0:i=" "}e[t+1]=i+encodeURI(this.diffs[t][1])+"\n"}return e.join("").replace(/%20/g," ")},this.diff_match_patch=e,this.DIFF_DELETE=-1,this.DIFF_INSERT=1,this.DIFF_EQUAL=0}(),e.diff_match_patch=diff_match_patch}.apply(e,arguments)})}(this),define("components/diff/block-loader",["jquery","data/current-cset","data/current-repo","utils/api-helper"],function(e,t,i,n){function r(o,s,a){if(!(this instanceof r))return new r(o,s,a);this.pagesPerBlock_=s,this.linesPerPage_=a,this.blocks_={from:[],to:[]},this.filename_={from:"",to:""},this.incremental_=[];var l=n.concat("repositories",i.owner.username,i.slug,"changesets",t,"diff");return e("#compare")&&e("#compare").data("compare-files-url")&&(l=e("#compare").data("compare-files-url")),this.url_=o||l.toString(),this}return r.prototype=function(){var t=r.prototype;return t.queueBlocks_=function(t,i){for(var n=0;n<i.length;n++){var r=i[n],o=this.blocks_[t];e.inArray(r,o)<0&&o.push(r)}},t.from=function(e,t){return this.queueBlocks_("from",e),this.filename_.from=t,this},t.to=function(e,t){return this.queueBlocks_("to",e),this.filename_.to=t,this},t.incremental=function(e){return this.incremental_.push(e),this},t.load=function(t){if(this.complete_=t,0===this.blocks_.from.length&&0===this.blocks_.to.length)t&&t();else{var i=this.filename_.from||this.filename_.to;e(document).trigger("diff-load-start",[i]),e.ajax({type:"GET",url:this.url_,data:{linesPerPage:this.linesPerPage_,fromBlock:this.blocks_.from.shift(),toBlock:this.blocks_.to.shift(),filename:i},dataType:"json",success:e.proxy(this.success_,this)})}},t.success_=function(t){var i=this.filename_.from||this.filename_.to;e(document).trigger("diff-load-end",[i]);for(var n=t[0],r=n.from_file,o=n.to_file,s=0;s<this.incremental_.length;s++)this.incremental_[s](r,o);this.load(this.complete_)},t}(),r}),define("components/diff/permalinker",[],function(){var e=function(){this.baseUrl_=window.top.location.href.replace(location.hash,"")};return e.prototype.regex_=/^#chg_(.*)_(newline|oldline)(\d+)$/,e.prototype.parse=function(e){var t=this.regex_.exec(e);return t?{path:t[1],file:"oldline"===t[2]?"from":"to",line:parseInt(t[3],10)}:void 0},e.prototype.url=function(e,t,i){return this.baseUrl_+"#chg_"+encodeURIComponent(t)+"_"+("from"===e?"oldline":"newline")+i},e}),define("components/diff/range",[],function(){var e=function(t,i){return this instanceof e?(this.low=t,this.high=i,this.length=i-t+1,this):new e(t,i)};return e.ofLength=function(t,i){return new e(t,t+i-1)},e.ofLine=function(t){return e.ofLength(t,1)},e.ofLines=function(t,i){return new e(t,i)},e.pointAfterLine=function(t){return new e(t,t-1)},e.pointBeforeLine=function(t){return e.pointAfterLine(t-1)},e.prototype={constructor:e,isPoint:function(){return this.low-1===this.high},before:function(e){return this.isPoint()&&e.isPoint()?this.high<e.low:this.isPoint()?this.low<=e.low-1:e.isPoint()?this.high<=e.low:this.high<e.low},after:function(e){return e.before(this)},overlaps:function(e){return this.isPoint()&&e.isPoint()?this.equals(e):this.isPoint()?e.overlaps(this):e.isPoint()?this.low-1<=e.low&&e.low<=this.high:this.low<=e.high&&e.low<=this.high},adjacent:function(e){return this.isPoint()&&e.isPoint()?this.equals(e):this.isPoint()?this.low+1===e.low||this.low===e.high:e.isPoint()?e.adjacent(this):this.high+1===e.low||e.low+1===this.high},expand:function(t){if(0===t)return this;var i,n;return this.isPoint()?(i=Math.max(1,this.low-(t-1)),n=this.low+t):(i=Math.max(1,this.low-t),n=this.high+t),new e(i,n)},merge:function(t){if(this.isPoint()&&t.isPoint())return this.equals(t)?this:null;if(this.isPoint())return t.merge(this);if(t.isPoint())return this.overlaps(t)||this.adjacent(t)?this:null;if(this.overlaps(t)||this.adjacent(t)){var i=Math.min(this.low,t.low),n=Math.max(this.high,t.high);return new e(i,n)}return null},equals:function(e){return this.low===e.low&&this.high==e.high},toString:function(){return"["+this.low+", "+this.high+"]"}},e}),define("components/diff/file",["jquery","components/diff/permalinker","components/diff/range"],function(e,t,i){function n(t){"undefined"==typeof o&&(o=e(".gutter-box"));for(var i=0,n=o.length;n>i;++i)t(i,o.eq(i))}function r(e,t,i,n){if(!(this instanceof r))return new r(e,t,rawFileData,n);var o=i.meta;return this.numLines||(this.numLines=0),o?(this.name=o.name,this.filename=o.filename,this.position=o.position,this.numLines=o.numLines,this.maxLineNum=o.numLines,this.longestLine=o.longestLine,this.longestRevisionBlameLength=o.longestRevisionBlameLength,this.longestAuthorBlameLength=o.longestAuthorBlameLength,this.pagesPerBlock=e,this.linesPerPage=t,this.gutterWidths=o.gutterWidths,this.zeroContextRanges_=n,this.blocks={},this.blocksRendered={},this.merge(i),this.scrollBoxDom=null,this.numbersBoxDom=null,this.revisionBlameBoxDom=null,this.lineHeightPx=null,this):null}var o;return r.DELIMITER=">",r.prototype=function(){function o(t){return t.scrollBoxDom||(t.scrollBoxDom=e("#"+t.name+"-box")[0]),t.scrollBoxDom}function s(t){return t.numbersBoxDom||(t.numbersBoxDom=e("#"+t.name+"-numbers-box")[0]),t.numbersBoxDom}function a(t){return t.revisionBlameBoxDom||(t.revisionBlameBoxDom=e("#"+t.name+"-revision-blame-box")[0]),t.revisionBlameBoxDom}function l(t){return t.authorBlameBoxDom||(t.authorBlameBoxDom=e("#"+t.name+"-auth-blame-box")[0]),t.authorBlameBoxDom}function c(e,t,i,n,r){e.id=t.name+"-"+r+"-"+i+"-"+n}function d(e,t,i){return e.pageDom_(t,i),e.blocks[t][i].numbersDom}function h(e,t,i){return e.pageDom_(t,i),e.blocks[t][i].revBlameDom}function u(e,t,i){return e.pageDom_(t,i),e.blocks[t][i].authBlameDom}function f(e,t,i,n){return e.pageDom_(t,i),e.blocks[t][i].gutterDom[n]}var p=r.prototype;p.isUnified=function(){return!1},p.numContext=function(){return-1},p.exists=function(){return!!this.blocks},p.merge=function(e){var t=e.block_num;t>=0&&(this.blocks[t]=e.pages)},p.queueBlocks=function(e,t){var i=this;e[i.name](i.blocksToFetch(t),i.filename).incremental(function(e,t){i.merge("from"===i.name?e:t)})},p.ensureVisible=function(e){if(this.numLines>0)for(var t=this.pagesPerBlock*this.linesPerPage,i=Math.floor((e.low-1)/t),n=Math.floor((e.high-1)/t),r=i;n>=r;r++)for(var o=r*t,s=e.low-1-o,a=Math.min(e.high-1-o,(r+1)*t-1),l=Math.floor(s/this.linesPerPage),c=Math.floor(a/this.linesPerPage),d=l;c>=d;d++)(this.isNotInDom_(r,d)||!this.pageDom_(r,d).parentNode)&&this.insertPage_(r,d)},p.blocksToFetch=function(e){for(var t=this.linesPerPage*this.pagesPerBlock,i=Math.floor(e.low/t),n=Math.floor(e.high/t),r=[],o=i;n>=o;o++)this.blocks[o]||(this.blocks[o]=this.blocksToFetch.loadingSentinel,r.push(o));return r},p.blocksToFetch.loadingSentinel={loading:!0},p.isNotInDom_=function(e,t){return this.blocks[e]&&this.blocks[e][t]&&(!this.blocksRendered[e]||!this.blocksRendered[e][t])},p.zeroContextRanges=function(){return this.zeroContextRanges_},p.coords_=function(e){var t=e-1,i=this.pagesPerBlock*this.linesPerPage,n=Math.floor(t/i),r=t%i,o=Math.floor(r/this.linesPerPage),s=r%this.linesPerPage;return{block:n,page:o,lineIndex:s}},p.insertPage_=function(t,i){var r=e(o(this)),c=e(s(this)),p=e(a(this)),m=e(l(this)),g=(t*this.pagesPerBlock+i)*this.linesPerPage*this.lineHeightPx;r[0].appendChild(e(this.pageDom_(t,i)).css("top",g).css("width",r.data("width"))[0]),c[0].appendChild(e(d(this,t,i)).css("top",g)[0]),0!==p.length&&p.children(".content-box")[0].appendChild(e(h(this,t,i)).css("top",g)[0]),0!==m.length&&m.children(".content-box")[0].appendChild(e(u(this,t,i)).css("top",g)[0]),n(function(n,r){r.children(".content-box")[0].appendChild(e(f(this,t,i,n)).css("top",g)[0])})},p.pageDom_=function(e,t){var i=this.blocks[e];if(this.isNotInDom_(e,t)){var n=this.evalPage_(e,t),r=this.createPageDom_(n),o=m(this,e,t,n),s=e*this.pagesPerBlock+t;r.className+=0===s?" page-first ":"",o.className+=0===s?" page-first ":"",c(r,this,e,s,"page"),c(o,this,e,s,"numbers");var d;a(this)?(d=g(this,e,t,n),c(d,this,e,s,"revision-blame")):d=document.createElement("div");var h;l(this)?(h=v(this,e,t,n),c(h,this,e,s,"auth-blame")):h=document.createElement("div");var u=b(this,e,t,n);i[t]={pageDom:r,numbersDom:o,revBlameDom:d,authBlameDom:h,gutterDom:u}}return i[t].pageDom},p.evalPage_=function(t,n){for(var r=(t*this.pagesPerBlock+n)*this.linesPerPage+1,o=i.ofLength(r,this.linesPerPage),s=e.grep(this.zeroContextRanges(),function(e){return o.overlaps(e)}),a=this.blocks[t][n],l=0;l<s.length;l++){var c=s[l];if(c.linesHtml)for(var d=0;d<c.length;d++){var h=c.low+d,u=h-r;u>=0&&u<this.linesPerPage&&(a[h-r].html=c.linesHtml[d])}}return this.blocksRendered[t]=this.blocksRendered[t]||{},this.blocksRendered[t][n]=!0,a},p.createPageDom_=function(e){var t=document.createElement("div");t.className="page";for(var i=0,n=e.length;n>i;i++)t.appendChild(_(e[i]));return t},p.permalinker_=new t;var m=function(e,t,i,n){var r=document.createElement("div"),o=(t*e.pagesPerBlock+i)*e.linesPerPage+1;r.className="page line-numbers";for(var s=0,a=n.length;a>s;s++){var l=o+s,c=e.permalinker_.url(e.name,e.filename,l),d=_(n[s],'<a href="'+c+'">'+l+"</a>");r.appendChild(d)}return r},g=function(){return function(e,t,i,n){var r=document.createElement("div");r.className="page revision-blame";for(var o=0,s=n.length;s>o;o++){var a=_(n[o],"<span>"+(n[o].start?n[o].revision:"&nbsp;")+"</span>",[n[o].blameclass]);r.appendChild(a)}return r}}(),v=function(){return function(e,t,i,n){var r=document.createElement("div");r.className="page author-blame";for(var o=0,s=n.length;s>o;o++){var a=_(n[o],"<span>"+(n[o].start?n[o].author:"&nbsp;")+"</span>");r.appendChild(a)}return r}}(),b=function(){return function(e,t,i,n){for(var r=[],o=0;o<n[0].gutters.length;++o){r[o]=document.createElement("div");for(var s=0,a=n.length;a>s;s++){var l=_(n[s],n[s].gutters[o]);r[o].appendChild(l)}}return r}}(),_=function(){var t=["addition","change","deletion","conflict","start","end"],i=null,n=null;if(i=function(){var e=document.createElement("div");return"undefined"!=typeof e.innerText?"innerText":"textContent"}(),e.browser.msie){var r=document.createElement("div");n=function(e){var t=r;return t.innerHTML="<pre>"+e+"</pre>",t.removeChild(t.firstChild)}}else n=function(e){var t=document.createElement("pre");return t.innerHTML=e,t};return function(e,i,r){for(var o=n((i||e.html)+"\n"),s=[],a=0,l=t.length;l>a;a++){var c=t[a];e[c]&&s.push(c)}for(r=r||[],a=0,l=r.length;l>a;a++)s.push(r[a]);var d=s.join(" ");return d&&(o.className=d),o}}();return p.longestLineDom=function(){return _(this.longestLine)},p}(),r}),define("components/diff/hidden-file",[],function(){function e(t){return this instanceof e?(this.file_=t,this.name=this.file_.name,this.filename=this.file_.filename,this.position=this.file_.position,this.numLines=this.file_.numLines,this.maxLineNum=this.file_.maxLineNum,this.pagesPerBlock=this.file_.pagesPerBlock,this.linesPerPage=this.file_.linesPerPage,this.blocks=this.file_.blocks,this.lineHeightPx=this.file_.lineHeightPx,this):new e(t)}return e.of=function(t){return t instanceof e?t:new e(t)},e.prototype=function(){var t=e.prototype;return t.isUnified=function(){return this.file_.isUnified()},t.numContext=function(){return this.file_.numContext()},t.exists=function(){return!1},t.merge=function(e){return this.file_.merge(e)},t.queueBlocks=function(e,t){return this.file_.queueBlocks(e,t)},t.ensureVisible=function(){},t.pageDom_=function(e,t){return this.file_.pageDom_(e,t)},t.coords_=function(e){return this.file_.coords_(e)},t.blocksToFetch=function(e){return this.file_.blocksToFetch(e)},t.longestLineDom=function(){return this.file_.longestLineDom()},t.zeroContextRanges=function(){return this.file_.zeroContextRanges()},t}(),e}),define("components/diff/ranges",["components/diff/range"],function(e){var t={unzip:function(e){for(var t=[],i=[],n=0;n<e.length;n++){var r=e[n];t.push(r.fromRange),i.push(r.toRange)}return[t,i]},nonEmpty:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];n.length>0&&t.push(n)}return t},expand:function(e,i){for(var n=[],r=0;r<e.length;r++)n.push(e[r].expand(i));return t.merge(n)},mergeAdjacent:function(t,i,n){var r,o,s,a;return t[0].low>1?0===i?(r=[new e(1,t[0].high)],r.concat(t.slice(1))):i===t.length?(o=t[t.length-1],r=t.slice(0,t.length-1),r.push(new e(o.low,n)),r):(r=t.slice(0,i-1),s=t[i-1],a=t[i],r.push(new e(s.low,a.high)),r.concat(t.slice(i+1))):i===t.length-1?(o=t[t.length-1],r=t.slice(0,t.length-1),r.push(new e(o.low,n)),r):(r=t.slice(0,i),s=t[i],a=t[i+1],r.push(new e(s.low,a.high)),r.concat(t.slice(i+2)))},expandAtIndex:function(i,n,r,o){var s,a,l,c,d;return i[0].low>1?0===n?(a=new e(Math.max(1,i[0].low-r),i[0].high),[a].concat(i.slice(1))):n===i.length?(l=i[i.length-1],s=i.slice(0,i.length-1),s.push(new e(l.low,Math.min(l.high+r,o))),s):(s=i.slice(0,n-1),c=i[n-1],d=i[n],s.push(new e(c.low,Math.min(c.high+r,o))),s.push(new e(Math.max(d.low-r,Math.min(c.high+r,o)),d.high)),t.merge(s.concat(i.slice(n)))):n===i.length-1?(l=i[i.length-1],s=i.slice(0,i.length-1),s.push(new e(l.low,Math.min(l.high+r,o))),s):(s=i.slice(0,n),c=i[n],d=i[n+1],s.push(new e(c.low,Math.min(c.high+r,o))),s.push(new e(Math.max(d.low-r,Math.min(c.high+r,o)),d.high)),t.merge(s.concat(i.slice(n+2))))},merge:function(e){var t,i=[];if(e.length>0){for(var n=e[0],r=1;r<e.length;r++){var o=e[r];null!==(t=n.merge(o))?n=t:(i.push(n),n=o)}i.push(n)}return i}};return t}),define("components/diff/context-file",["jquery","components/diff/file","components/diff/hidden-file","components/diff/range","components/diff/ranges"],function(e,t,i,n,r){function o(e,t){if(!(this instanceof o))return new o(e,n);if("number"==typeof t){var n=Math.max(0,t);this.rangesWithContext_=r.expand(e.zeroContextRanges(),n)}else this.rangesWithContext_=t;return this.file_=i.of(e),this.viewport2file=this.calculateViewport2File(),this.file2viewport=this.calculateFile2Viewport(this.viewport2file),this.name=e.name,this.filename=e.filename,this.position=null,this.pagesPerBlock=e.pagesPerBlock,this.linesPerPage=e.linesPerPage,this.numLines=this.viewport2file.length-1,this.maxLineNum=this.viewport2file[this.viewport2file.length-1],"number"!=typeof this.maxLineNum&&(this.maxLineNum=this.viewport2file[this.viewport2file.length-2]),this.lineHeightPx=this.file_.lineHeightPx,this.blocks={},this}return o.prototype=function(){function i(e,t,i,n,r){e.id=t.name+"-"+r+"-"+i+"-"+n}var r=o.prototype;return r.isUnified=function(){return this.file_.isUnified()},r.numContext=function(){return this.context},r.calculateViewport2File=function(){for(var e=this.rangesWithContext_,t=[0],i=0,n=0;n<e.length;n++){var r=e[n];0===n&&r.low>1&&t.push({type:"top",index:i++});for(var o=0;o<r.length;o++)r.low+o<=this.file_.numLines&&t.push(r.low+o);n===e.length-1?r.high<this.file_.numLines&&t.push({type:"bottom",index:i++}):e.length>1&&t.push({type:"skipped",index:i++})}return t},r.calculateFile2Viewport=function(e){var t,i,n,r,o=[0];for(n=1;n<e.length;n++){var s=e[n];if("number"==typeof s)o[s]=n;else if("top"===s.type)for(i=e[n+1],r=1;i>r;r++)o[r]=1;else if("skipped"===s.type)for(t=e[n-1],i=e[n+1],r=t+1;i>r;r++)o[r]=n;else if("bottom"===s.type)for(t=e[n-1],r=t+1;r<=this.file_.numLines;r++)o[r]=n}return o},r.exists=function(){return this.file_.file_.exists()},r.merge=function(e){return this.file_.merge(e)},r.fileRange_=function(e){var t=this.viewport2file[e];"number"!=typeof t&&(t=this.viewport2file[e.low+1]);var i=this.viewport2file[Math.min(e.high,this.numLines)];return"number"!=typeof i&&(i=this.viewport2file[Math.min(e.high-1,this.numLines-1)]),new n(t,i)},r.queueBlocks=function(e,t){var i=Math.max(1,Math.floor(t.low/this.linesPerPage)*this.linesPerPage),r=Math.ceil(t.high/this.linesPerPage)*this.linesPerPage,o=this.fileRange_(new n(i,r));return this.file_.queueBlocks(e,o)},r.ensureVisible=function(e){try{return t.prototype.ensureVisible.call(this,e)}catch(i){}},r.insertPage_=function(e,i){return t.prototype.insertPage_.call(this,e,i)},r.isNotInDom_=function(e,t){return!this.blocks[e]||!this.blocks[e][t]
},r.zeroContextRanges=function(){return this.file_.zeroContextRanges()},r.pageDom_=function(t,n){this.blocks[t]=this.blocks[t]||[];var r=this.blocks[t],o=(t*this.pagesPerBlock+n)*this.linesPerPage+1,s=Math.min(o+this.linesPerPage-1,this.numLines);if(this.isNotInDom_(t,n)){var a=document.createElement("div"),l=document.createElement("div"),c=t*this.pagesPerBlock+n;i(a,this,t,c,"page"),i(l,this,t,c,"numbers"),a.className="page"+(0===c?" page-first ":""),l.className="page line-numbers"+(0===c?" page-first ":"");for(var d=o;s>=d;d++){var h=this.viewport2file[d];if("number"==typeof h){var u=this.file_.coords_(h),f=e(this.file_.pageDom_(u.block,u.page)),p=f.children()[u.lineIndex].cloneNode(!0);a.appendChild(p);var m=e(this.file_.blocks[u.block][u.page].numbersDom),g=m.children()[u.lineIndex].cloneNode(!0);l.appendChild(g)}else"top"===h.type?(a.appendChild(e('<div class="skipped-container skipped-top"><span> </span></div>')[0]),l.appendChild(e('<div class="skipped-container skipped-top"><span class="ellipsis skipped" data-skipped-index="'+h.index+'" data-page-index="'+(d-o)+'"> </span></div>')[0])):"skipped"===h.type?(a.appendChild(e('<div class="skipped-container skipped-middle"><span> </span></div>')[0]),l.appendChild(e('<div class="skipped-container skipped-middle"><span class="ellipsis skipped" data-skipped-index="'+h.index+'" data-page-index="'+(d-o)+'"> </span></div>')[0])):"bottom"===h.type&&(a.appendChild(e('<div class="skipped-container skipped-bottom"><span> </span></div>')[0]),l.appendChild(e('<div class="skipped-container skipped-bottom"><span class="ellipsis skipped" data-skipped-index="'+h.index+'" data-page-index="'+(d-o)+'"> </span></div>')[0]))}r[n]={pageDom:a,numbersDom:l,revBlameDom:document.createElement("div"),authBlameDom:document.createElement("div"),gutterDom:document.createElement("div")}}return r[n].pageDom},r.coords_=function(e){return t.prototype.coords_.call(this,e)},r.longestLineDom=function(){return this.file_.longestLineDom()},r}(),o}),define("components/diff/hunk",["components/diff/range"],function(e){var t=function(e,i,n,r){return this instanceof t?(this.fromRange=e,this.toRange=i,this.fromLines=n,this.toLines=r,this.conflict_=!1,this):new t(e,i)};return t.ofLengths=function(i,n,r,o,s,a){return new t(e.ofLength(i,n),e.ofLength(r,o),s,a)},t.addition=function(i,n,r){return new t(e.pointAfterLine(i),n,[],r)},t.change=function(e,i,n,r){return new t(e,i,n,r)},t.deletion=function(i,n,r){return new t(i,e.pointAfterLine(n),r,[])},t.prototype=function(){function e(e,t){for(var i=0,n=e.length-1;n>=i;){var r=Math.floor((i+n)/2),o=e[r];if(t.overlaps(o))return r;if(t.before(o))n=r-1;else{if(!t.after(o))return-1;i=r+1}}return-1}var i=t.prototype;return i.isAddition=function(){return 0===this.fromRange.length},i.isChange=function(){return this.fromRange.length>0&&this.toRange.length>0},i.isDeletion=function(){return 0===this.toRange.length},i.conflict=function(){return this.conflict_=!0,this},i.isConflict=function(){return this.conflict_},i.before=function(e){return this.fromRange.before(e.fromRange)&&this.toRange.before(e.toRange)},i.after=function(e){return this.fromRange.after(e.fromRange)&&this.toRange.after(e.toRange)},i.overlaps=function(e){return this.fromRange.overlaps(e.fromRange)||this.toRange.overlaps(e.toRange)},i.overlapping=function(t){var i=[],n=e(t,this);if(n>=0){var r,o,s;for(o=n-1;o>=0&&(r=t[o]).overlaps(this);o-=1)i.push(r);for(i.push(t[n]),o=n+1,s=t.length;s>o&&(r=t[o]).overlaps(this);o++)i.push(r)}return i},i.equals=function(e){return this.fromRange.equals(e.fromRange)&&this.toRange.equals(e.toRange)},i.toString=function(){function e(e){return 1===e.length?e.low+"":e.low+","+e.length}return function(){return"-"+e(this.fromRange)+" +"+e(this.toRange)}}(),i}(),t}),define("components/diff/unified-file",["jquery","components/diff/file","components/diff/hidden-file","components/diff/hunk","components/diff/range"],function(e,t,i,n,r){function o(e,t,n,r,s){return this instanceof o?(this.diffHunks_=e,this.unifiedMap=t,this.from2unified_=this.calculateLineMappings_(t,0),this.to2unified_=this.calculateLineMappings_(t,1),this.zeroContextRanges_=null,this.from_=i.of(n),this.to_=i.of(r),this.renderFile_=this.from_.name===s?this.from_:this.to_,this.name=this.renderFile_.name,this.filename=this.renderFile_.filename,this.position=this.renderFile_.position,this.pagesPerBlock=this.renderFile_.pagesPerBlock,this.linesPerPage=this.renderFile_.linesPerPage,this.numLines=this.unifiedMap.length-1,this.maxLineNum=Math.max(this.from_.maxLineNum,this.to_.maxLineNum),this.lineHeightPx=this.to_.lineHeightPx,this.blocks={},this):new o(e,t,n,r,s)}return o.prototype=function(){var i=o.prototype;return i.isUnified=function(){return!0},i.numContext=function(){return this.renderFile_.numContext()},i.calculateLineMappings_=function(e,t){for(var i=[0],n=1;n<e.length;n++){var r=e[n][t];r&&(i[r]=n)}return i},i.exists=function(){return!0},i.merge=function(){},i.queueBlocks=function(e,t){var i=this,n=Math.max(1,Math.floor(t.low/this.linesPerPage)*this.linesPerPage),o=Math.ceil(t.high/this.linesPerPage)*this.linesPerPage,s=i.diffHunk_(new r(n,o));e.from(i.from_.blocksToFetch(s.fromRange),i.from_.filename).to(i.to_.blocksToFetch(s.toRange),i.to_.filename).incremental(function(e,t){i.from_.merge(e),i.to_.merge(t)})},i.diffHunk_=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=Number.MAX_VALUE,s=Number.MIN_VALUE,a=Math.min(this.renderFile_.numLines,e.high),l=e.low;a>=l;l++){var c=this.unifiedMap[l],d=c[0],h=c[1];d&&(t=t>d?d:t,i=d>i?d:i),h&&(o=o>h?h:o,s=h>s?h:s)}return t===Number.MAX_VALUE&&(t=0,i=0),o===Number.MAX_VALUE&&(o=0,s=0),new n(new r(t,i),new r(o,s))},i.ensureVisible=function(e){try{return t.prototype.ensureVisible.call(this,e)}catch(i){}},i.insertPage_=function(e,i){return t.prototype.insertPage_.call(this,e,i)},i.isNotInDom_=function(e,t){return!this.blocks[e]||!this.blocks[e][t]},i.zeroContextRanges=function(){if(null===this.zeroContextRanges_){for(var e=[],t=0;t<this.diffHunks_.length;t++){var i,n=this.diffHunks_[t],o=n.fromRange,s=n.toRange;n.isDeletion()?i=new r(this.from2unified_[o.low],this.from2unified_[o.high]):n.isChange()?i=new r(this.from2unified_[o.low],this.to2unified_[s.high]):n.isAddition()&&(i=new r(this.to2unified_[s.low],this.to2unified_[s.high])),e.push(i)}this.zeroContextRanges_=e}return this.zeroContextRanges_},i.pageDom_=function(t,i){this.blocks[t]=this.blocks[t]||[];var n=this.blocks[t],r=(t*this.pagesPerBlock+i)*this.linesPerPage+1,o=r+this.linesPerPage-1;if(this.isNotInDom_(t,i)){var s=document.createElement("div"),a=document.createElement("div"),l=t*this.pagesPerBlock+i;s.className+="page"+(0===l?" page-first ":""),a.className+="page line-numbers"+(0===l?" page-first ":"");for(var c=r;o>=c;c++){var d=this.unifiedMap[c];if(d){var h=null,u=null;(u=d[0])?h=this.from_:(u=d[1])&&(h=this.to_);var f=h.coords_(u),p=e(h.pageDom_(f.block,f.page)),m=p.children()[f.lineIndex].cloneNode(!0);/\bchange\b/.test(m.className)&&(m.className+=" "+h.name),s.appendChild(m);var g=d["from"===this.renderFile_.name?0:1];if(g){var v=this.renderFile_.coords_(g);this.renderFile_.pageDom_(v.block,v.page);var b=e(this.renderFile_.blocks[v.block][v.page].numbersDom),_=b.children()[v.lineIndex].cloneNode(!0);/\bchange\b/.test(_.className)&&(_.className+=" "+this.renderFile_.name),1!==c&&1===g&&e(_).removeClass("start"),a.appendChild(_)}else{var y="from"===this.renderFile_.name?this.to_:this.from_,w=d["from"===this.renderFile_.name?1:0],x=y.coords_(w);y.pageDom_(x.block,x.page);var k=e(y.blocks[x.block][x.page].numbersDom),C=k.children()[x.lineIndex].cloneNode(!0);C.innerHTML=" ",/\bchange\b/.test(C.className)&&(C.className+=" "+y.name),1!==c&&1===w&&e(C).removeClass("start"),a.appendChild(C)}}}n[i]={pageDom:s,numbersDom:a,revBlameDom:document.createElement("div"),authBlameDom:document.createElement("div"),gutterDom:document.createElement("div")}}return n[i].pageDom},i.coords_=function(e){return t.prototype.coords_.call(this,e)},i.longestLineDom=function(){var t=e(this.from_.longestLineDom()),i=e(this.to_.longestLineDom());return t.text().length>i.text().length?t[0]:i[0]},i}(),o}),define("components/diff/diff",["jquery","diff-match-patch","components/diff/block-loader","components/diff/context-file","components/diff/file","components/diff/hunk","components/diff/range","components/diff/ranges","components/diff/unified-file"],function(e,t,i,n,r,o,s,a,l){var c=function(i,n,r,o,s,a,l,d){if(!(this instanceof c))return new c(i,n,r,o,s,a,l,d);if(this.hunks=i,this.pagesPerBlock=n,this.linesPerPage=r,this.from=o,this.to=s,this.unifiedMap=a,this.note=l,this.url=d,this.elem_=null,!(e.browser.msie&&e.browser.version<9))try{this.diffHighlighting_(new t,i)}catch(h){}return this};return c.sideBySideFromData=function(e){for(var t=[],i=0,n=e.hunks.length;n>i;i++){var l,d=e.hunks[i];l="add"===d.type?new o(s.pointBeforeLine(d.from_start),s.ofLength(d.to_start,d.to_count),d.from_lines,d.to_lines):"mod"===d.type?o.ofLengths(d.from_start,d.from_count,d.to_start,d.to_count,d.from_lines,d.to_lines):new o(s.ofLength(d.from_start,d.from_count),s.pointBeforeLine(d.to_start),d.from_lines,d.to_lines),d.conflict&&l.conflict(),t[i]=l}var h=e.from_pages_per_block,u=e.from_lines_per_page,f=a.unzip(t),p=new r(h,u,e.from_file,f[0]),m=new r(h,u,e.to_file,f[1]),g=e.unified_map,v=e.note;return new c(t,h,u,p,m,g,v)},c.unified=function(e){return new c(e.hunks,e.pagesPerBlock,e.linesPerPage,new l(e.hunks,e.unifiedMap,e.from,e.to,"from"),new l(e.hunks,e.unifiedMap,e.from,e.to,"to"),e.unifiedMap,e.note,e.url)},c.ofContext=function(e,t){t=Math.max(0,t);var i=new n(e.to,t);if(e.from.exists()){var r=new n(e.from,t),o=e.contextScrollPositions_(r,i);r.position=o[0],i.position=o[1]}var s=e.hunks,a=new c(e.from.exists()?e.hunksWithContext_(s,r,i):e.hunks,e.pagesPerBlock,e.linesPerPage,e.from.exists()?r:{exists:function(){return!1}},i,e.unifiedMap,e.note,e.url);return a.zeroContextHunks=s,a},c.expandSkippedSection=function(e,t){var i=e.from,r=e.to,o=new n(i.file_,a.expandAtIndex(i.rangesWithContext_,t,10,e.isUnified()?e.unifiedMap.length:i.maxLineNum)),s=new n(r.file_,a.expandAtIndex(r.rangesWithContext_,t,10,e.isUnified()?e.unifiedMap.length:r.maxLineNum)),l=e.contextScrollPositions_(o,s);o.position=l[0],s.position=l[1];var d=e.zeroContextHunks,h=new c(e.hunksWithContext_(d,o,s),e.pagesPerBlock,e.linesPerPage,o,s,e.unifiedMap,e.note,e.url);return h.zeroContextHunks=d,h},c.expandToInclude=function(t,i,n){function r(e){return e.overlaps(s.ofLine(l))}var o=t.to.file_.file_,a="from"===i?o.from2unified_:o.to2unified_,l=a[n],d=t[i].rangesWithContext_;if(e.grep(d,r).length>0)return t;for(var h=0,u=0;u<d.length;u++){var f=d[u];if(l<f.low)break;h+=1}return c.expandToInclude(c.expandSkippedSection(t,h),i,n)},c.CONTEXT_LOW=3,c.CONTEXT_MED=20,c.CONTEXT_FULL=-1,c.prototype=function(){var t=c.prototype;return t.setElement=function(e){this.elem_=e},t.getElement=function(){return this.elem_},t.ensureVisible=function(e,t){var n=this,r=new i(n.url,n.pagesPerBlock,n.linesPerPage);n.from.exists()&&n.from.queueBlocks(r,e.fromRange),n.to.queueBlocks(r,e.toRange),r.load(function(){n.from.exists()&&n.from.ensureVisible(e.fromRange),n.to.ensureVisible(e.toRange),t&&t()})},t.isUnified=function(){return this.to.isUnified()},t.filename=function(){return this.from.filename||this.to.filename},t.hasConflicts=function(){for(var e=this.zeroContextHunks||this.hunks,t=0;t<e.length;t++)if(e[t].isConflict())return!0;return!1},t.hasNote=function(){return!!this.note},t.hasDiffContent=function(){return this.hunks.length>0},t.numContext=function(){return this.from.numContext()},t.contextScrollPositions_=function(e,t){var i,n,r=[0],o=[0];for(i=1;i<=e.numLines;i++)if(n=e.viewport2file[i],"number"==typeof n){var s=e.file_.position[n];r[i]=t.file2viewport[s]}else r[i]=r[i-1]+1;for(i=1;i<=t.numLines;i++)if(n=t.viewport2file[i],"number"==typeof n){var a=t.file_.position[n];o[i]=e.file2viewport[a]}else o[i]=o[i-1]+1;return[r,o]},t.hunksWithContext_=function(e,t,i){for(var n=t.file2viewport,r=i.file2viewport,a=[],l=0;l<e.length;l++){var c=e[l],d=c.fromRange,h=c.toRange;a.push(new o(new s(n[d.low],n[d.high]),new s(r[h.low],r[h.high])))}return a},t.diffHighlighting_=function(t,i){function n(e){return r.html(e),r.text()}for(var r=e("<div>"),o=0;o<i.length;o++){var s=i[o];if(s.fromLines&&s.toLines&&s.isChange()&&!s.isConflict()){var a=t.diff_main(n(s.fromLines.join("\n")),n(s.toLines.join("\n")));t.diff_cleanupSemantic(a),s.fromRange.linesHtml=e.map(e.grep(a,e.proxy(this.isFrom_,this)),e.proxy(this.markup_,this)).join("").split("\n"),s.toRange.linesHtml=e.map(e.grep(a,e.proxy(this.isTo_,this)),e.proxy(this.markup_,this)).join("").split("\n")}}},t.isFrom_=function(e){var t=e[0];return t===DIFF_DELETE||t===DIFF_EQUAL},t.isTo_=function(e){var t=e[0];return t===DIFF_EQUAL||t===DIFF_INSERT},t.markup_=function(t){var i=t[0];return i===DIFF_EQUAL?_.escape(t[1]):e.map(t[1].split("\n"),i===DIFF_DELETE?e.proxy(this.markupRemoved_,this):e.proxy(this.markupAdded_,this)).join("\n")},t.markupRemoved_=function(e){return"<del>"+_.escape(e)+"</del>"},t.markupAdded_=function(e){return"<ins>"+_.escape(e)+"</ins>"},t.hunkBefore=function(t){var i=e.inArray(t,this.hunks);return 0>=i?null:this.hunks[i-1]},t.hunkAfter=function(t){var i=e.inArray(t,this.hunks);return 0>i||i===this.hunks.length-1?null:this.hunks[i+1]},t.hunkAfterFromLine=function(e){return this.searchHunksAfter_(function(t){return e<t.fromRange.low})},t.hunkBeforeFromLine=function(e){return this.searchHunksBefore_(function(t){return t.fromRange.low<e})},t.hunkAfterToLine=function(e){return this.searchHunksAfter_(function(t){return e<t.toRange.low})},t.hunkBeforeToLine=function(e){return this.searchHunksBefore_(function(t){return t.toRange.low<e})},t.searchHunksAfter_=function(e){for(var t=this.zeroContextHunks||this.hunks,i=0,n=t.length-1,r=null;n>=i;){var o=Math.floor((i+n)/2),s=t[o];e(s)?(r=s,n=o-1):i=o+1}return r},t.searchHunksBefore_=function(e){for(var t=this.zeroContextHunks||this.hunks,i=0,n=t.length-1,r=null;n>=i;){var o=Math.floor((i+n)/2),s=t[o];e(s)?(r=s,i=o+1):n=o-1}return r},t}(),c}),define("components/diff/heading-renderer",["jquery"],function(e){var t=function(e,t){this.filename_=e,this.conflicts_=t};return t.prototype.createDom=function(){var t=this.filename_.split("/");t=t.join('<span class="slash">/</span>'),this.$elem_=e(['<div class="heading">',"<h1></h1>","</div>"].join("")),this.$elem_.attr("id","chg-"+this.filename_).toggleClass("conflicts",this.conflicts_).find("h1").html(t)},t.prototype.render=function(e){this.createDom(),this.$elem_.appendTo(e),this.enterDocument()},t.prototype.enterDocument=function(){},t.prototype.exitDocument=function(){},t}),define("components/diff/note-renderer",["jquery"],function(e){var t=function(e){this.note_=e,this.$elem_=null};return t.prototype.createDom=function(){this.$elem_=e(['<div class="message">',"<p></p>","</div>"].join("")),this.setNote(this.note_)},t.prototype.render=function(e){this.createDom(),this.$elem_.appendTo(e),this.enterDocument()},t.prototype.enterDocument=function(){},t.prototype.exitDocument=function(){},t.prototype.setNote=function(e){this.note_=e,this.$elem_&&this.$elem_.find("p").text(e)},t}),function(e){define("jquery-plugins/jquery.getscrollbarwidth",[],function(){return function(){!function(e){var t=0;e.getScrollbarWidth=function(){if(!t)if(e.browser.msie){var i=e('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body"),n=e('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body");t=i.width()-n.width(),i.add(n).remove()}else{var r=e("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:-1e3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});t=100-r.width(),r.parent().remove()}return t}}(jQuery)}.apply(e,arguments)})}(this),define("components/diff/hunk-map",["jquery","underscore","jquery-plugins/jquery.getscrollbarwidth"],function(e,t){var i=function(e,i,n,r){this.hunks=t.filter(e,function(e){return"from"===i?e.isDeletion()||e.isChange():e.isAddition()||e.isChange()}),this.numLines=n,this.lineHeight=r,this.side=i,this.$window_=null,this.$elem_=null};return i.prototype.createDom=function(){this.$window_=e(window),this.$elem_=e('<div class="hunk-map">');for(var t="from"===this.side,i=t?"<del>":"<ins>",n=0;n<this.hunks.length;n++){var r=this.hunks[n],o=t?r.fromRange:r.toRange,s=e(i).toggleClass("change",r.isChange()).toggleClass("conflict",r.isConflict()).css({top:this.percent(o.low-1)+"%",height:this.percent(o.length)+"%"});this.$elem_.append(s)}},i.prototype.percent=function(e){return e/this.numLines*100},i.prototype.render=function(e){this.createDom(),e.append(this.$elem_),this.enterDocument()},i.prototype.enterDocument=function(){this.$elem_.bind("click.hunk-map",e.proxy(this.onClick_,this))},i.prototype.exitDocument=function(){this.$elem_.unbind("click.hunk-map")},i.prototype.onClick_=function(t){var i=t.clientY-(this.$elem_.offset().top-this.$window_.scrollTop()),n=Math.round(i/this.$elem_.height()*this.numLines);n=Math.min(Math.max(1,n),this.numLines),e(this).trigger("hunk-map/click",[n])},i.prototype.scrollbars=function(t,i){var n=this.$elem_.parent().height(),r=e.getScrollbarWidth(),o=i?r:0,s=o+(t?r:0);this.$elem_.css({marginTop:o,height:Math.min(this.numLines*this.lineHeight,n-o-s)})},i}),define("components/diff/pane",["jquery","components/diff/range"],function(e,t){var i=function(e,t){this.contentWidth=e,this.contentHeight=t,this.scrollLeft_=0,this.scrollTop_=0,this.maxScrollLeft_=0,this.maxScrollTop_=0,this.ignoreHorizontalScrolls_=0,this.ignoreVerticalScrolls_=0,this.$elem_=null,this.$scroller_=null,this.$content_=null};return i.template_=['<div class="aperture-pane">','<div class="aperture-pane-scroller">','<div class="aperture-pane-content"></div>',"</div>","</div>"].join(""),i.prototype.createDom=function(){this.$elem_=e(i.template_),this.$scroller_=this.$elem_.find(".aperture-pane-scroller"),this.$content_=this.$scroller_.find(".aperture-pane-content")},i.prototype.render=function(e){this.createDom(),e.append(this.$elem_),"number"!=typeof this.contentWidth&&(this.$content().append(this.contentWidth),this.contentWidth=this.$elem_.width(),this.$content().empty()),this.$content().width(this.contentWidth),"number"!=typeof this.contentHeight&&(this.$content().append(this.contentHeight),this.contentHeight=this.$elem_.height(),this.$content().empty()),this.$content().height(this.contentHeight),this.setScrollBounds_(),this.enterDocument()},i.prototype.setPaneWidth=function(e){this.$elem_.width(e),this.setScrollBounds_()},i.prototype.setPaneHeight=function(){this.$elem_.height(height),this.setScrollBounds_()},i.prototype.scrollx=function(){return this.maxScrollLeft_>0},i.prototype.scrolly=function(){return this.maxScrollTop_>0},i.prototype.setScrollBounds_=function(){this.$scroller_.scrollLeft(this.contentWidth).scrollTop(this.contentHeight),this.maxScrollLeft_=this.$scroller_.scrollLeft(),this.maxScrollTop_=this.$scroller_.scrollTop(),this.$scroller_.scrollLeft(0).scrollTop(0)},i.prototype.enterDocument=function(){this.$scroller_.bind("scroll.pane",e.proxy(this.onScroll_,this))},i.prototype.exitDocument=function(){this.$scroller_.unbind("scroll.pane")},i.prototype.$content=function(){return this.$content_},i.prototype.onScroll_=function(){var t=this.$scroller_.scrollLeft(),i=this.$scroller_.scrollTop(),n=t!==this.scrollLeft_,r=i!==this.scrollTop_;this.scrollLeft_=t,this.scrollTop_=i,this.ignoreHorizontalScrolls_||this.ignoreVerticalScrolls_?(this.ignoreHorizontalScrolls_&&n&&(this.ignoreHorizontalScrolls_-=1),this.ignoreVerticalScrolls_&&r&&(this.ignoreVerticalScrolls_-=1)):e(this).trigger("aperture-pane/scroll",[t,i])},i.prototype.setScrollLeftNoEvent=function(e){return e=Math.max(0,Math.min(this.maxScrollLeft_,e)),this.scrollLeft_!==e&&(this.ignoreHorizontalScrolls_+=1,this.$scroller_.scrollLeft(e)),e},i.prototype.setScrollTopNoEvent=function(e){return e=Math.max(0,Math.min(this.maxScrollTop_,e)),this.scrollTop_!==e&&(this.ignoreVerticalScrolls_+=1,this.$scroller_.scrollTop(e)),e},i.prototype.isVisible=function(){return!0},i.prototype.visibleRange=function(){return t.ofLength(this.$scroller_.scrollTop(),this.$elem_.height())},i}),define("components/diff/lined-pane",["jquery","components/diff/pane","components/diff/range"],function(e,t,i){var n=function(e,t,i,n){this.numLines=t,this.lineHeight=n,this.pane_=new e(i,t*n)};return n.window=function(e,t,i){return new n(WindowPane,e,t,i)},n.scrollable=function(e,i,r){return new n(t,e,i,r)},n.prototype.createDom=function(){},n.prototype.render=function(e){this.createDom(),this.pane_.render(e),this.$elem_=this.pane_.$elem_,this.enterDocument()},n.prototype.enterDocument=function(){e(this.pane_).bind("aperture-pane/scroll",e.proxy(this.onScroll_,this))},n.prototype.exitDocument=function(){e(this.pane_).unbind("aperture-pane/scroll"),this.pane_.exitDocument()},n.prototype.$content=function(){return this.pane_.$content()},n.prototype.onScroll_=function(t,i,n){var r=Math.floor(n/this.lineHeight)+1,o=n-this.lineTopPx(r);e(this).trigger("aperture-lined-pane/scroll",[r,i,o])},n.prototype.setPaneWidth=function(e){this.pane_.setPaneWidth(e)},n.prototype.scrollx=function(){return this.pane_.scrollx()},n.prototype.scrolly=function(){return this.pane_.scrolly()},n.prototype.lineTopPx=function(e){return(e-1)*this.lineHeight},n.prototype.scrollToLine=function(e,t,i){var n=this.pane_.setScrollLeftNoEvent(t),r=this.pane_.setScrollTopNoEvent(this.lineTopPx(e)+i);return[Math.floor(r/this.lineHeight)+1,n,r%this.lineHeight]},n.prototype.isVisible=function(){return this.pane_.isVisible()},n.prototype.visibleRange=function(){var e=this.pane_.visibleRange();if(null===e)return null;var t=Math.floor(e.low/this.lineHeight)+1,n=Math.min(this.numLines,Math.ceil(e.high/this.lineHeight));return new i(t,n)},n}),define("components/diff/scrollable-file-pane",["jquery","components/diff/lined-pane"],function(e,t){var i=function(e,i){this.file_=e,this.lineHeight=i,this.numLines=e.numLines;var n=35;this.numbers_=t.scrollable(e.numLines,n,i),this.lines_=t.scrollable(e.numLines,this.file_.longestLineDom(),i),this.$elem_=null};return i.prototype.createDom=function(){this.$elem_=e('<div class="scrollable-file-pane">')},i.prototype.render=function(e){this.createDom(),e.append(this.$elem_),this.numbers_.render(this.$elem_),this.lines_.render(this.$elem_),this.numbers_.$elem_.addClass("scrollable-file-pane-numbers"),this.numbers_.$content().addClass("file-numbers"),this.lines_.$elem_.addClass("scrollable-file-pane-lines"),this.lines_.$content().addClass("file-lines"),this.file_.lineHeightPx=this.lineHeight,this.file_.numbersBoxDom=this.numbers_.$content()[0],this.file_.scrollBoxDom=this.lines_.$content()[0],this.enterDocument()},i.prototype.setPaneWidth=function(e){var t=35;this.numbers_.setPaneWidth(t),this.lines_.setPaneWidth(e-t)},i.prototype.scrollx=function(){return this.lines_.scrollx()},i.prototype.scrolly=function(){return this.lines_.scrolly()},i.prototype.enterDocument=function(){e(this.lines_).bind("aperture-lined-pane/scroll",e.proxy(this.onScroll_,this))},i.prototype.exitDocument=function(){e(this.lines_).unbind("aperture-lined-pane/scroll"),this.numbers_.exitDocument(),this.lines_.exitDocument()},i.prototype.onScroll_=function(t,i,n,r){this.numbers_.scrollToLine(i,n,r),e(this).trigger("scrollable-file-pane/scroll",[i,n,r])},i.prototype.scrollToLine=function(e,t,i){var n=this.lines_.scrollToLine(e,t,i);return this.numbers_.scrollToLine(n[0],n[1],n[2]),n},i.prototype.scrollToLineAndFire=function(t,i,n){var r=this.scrollToLine(t,i,n);e(this).trigger("scrollable-file-pane/scroll",r)},i.prototype.visibleRange=function(){return this.lines_.visibleRange()},i}),define("components/diff/segment-pane",["jquery"],function(e){var t=window.SegmentPane=function(e,t){this.sbsdiff=e,this.lineHeight=t,this.width=null,this.$elem_=null,this.canvas_=null,this.visiblePaths_=[]};return t.prototype.createDom=function(){this.$elem_=e('<div class="segment-pane">');var t=document.createElement("canvas");this.$elem_.append(t),this.canvas_=t,null!==this.width&&this.setPaneWidth(this.width)},t.prototype.render=function(e){this.createDom(),e.append(this.$elem_),this.enterDocument()},t.prototype.enterDocument=function(){},t.prototype.exitDocument=function(){},t.prototype.setPaneWidth=function(e){this.width=e,null!==this.$elem_&&(this.$elem_.width(e),this.height=this.$elem_.height(),this.canvas_.width=e,this.canvas_.height=this.$elem_.height())},t.STROKE="#ccc",t.prototype.add_={stroke:"#ccffcc",fill:"#ccffcc"},t.prototype.del_={stroke:"#ffdddd",fill:"#ffdddd"},t.prototype.mod_={stroke:"#f4f4f4",fill:"#f4f4f4"},t.prototype.con_={stroke:"#ffffe0",fill:"#ffffe0"},t.prototype.border_={stroke:"#ccc",fill:"#ccc"},t.prototype.rangeY=function(e,t,i){var n=this.lineHeight,r=(e.low-t)*n-i+1,o=(e.high-t)*n-i+1+n;return r===o&&(r+=n,o=r),[r,o]},t.prototype.draw=function(e,t,i,n,r){var o,s,a=this.canvas_.getContext("2d"),l=this.width,c=this.height;for(a.clearRect(0,0,l+1,c+1),a.setTransform(1,0,0,1,-.5,-.5),o=0,s=e.length;s>o;o++){var d=e[o],h=(d.fromRange,d.toRange,this.rangeY(d.fromRange,t,i)),u=this.rangeY(d.toRange,n,r);if(d.isConflict()){var f=this.sbsdiff.hunkBefore(d),p=this.sbsdiff.hunkAfter(d);if(d.isConflictStart=p&&p.isConflict()&&p.isChange(),d.isEntireConflict=!(f&&f.isConflict()&&f.isChange()||p&&p.isConflict()&&p.isChange()),d.isConflictStart){var m=this.rangeY(p.fromRange,t,i),g=this.rangeY(p.toRange,n,r);h[1]=m[1],u[1]=g[1]}else if(!d.isEntireConflict)continue}a.fillStyle=d.isConflict()?this.con_.fill:d.isAddition()?this.add_.fill:d.isDeletion()?this.del_.fill:this.mod_.fill,a.strokeStyle=this.border_.stroke,a.beginPath(),a.moveTo(0,h[0]),a.bezierCurveTo(l/2,h[0],l/2,u[0],l+1,u[0]),a.lineTo(l+1,u[1]),a.bezierCurveTo(l/2,u[1],l/2,h[1],0,h[1]),a.lineTo(0,h[0]),a.fill(),a.beginPath(),a.moveTo(0,h[0]),a.bezierCurveTo(l/2,h[0],l/2,u[0],l+1,u[0]),a.moveTo(l+1,u[1]),a.bezierCurveTo(l/2,u[1],l/2,h[1],0,h[1]),a.stroke()}},t}),define("components/diff/side-by-side-diff",["jquery","components/diff/hunk","components/diff/hunk-map","components/diff/scrollable-file-pane","components/diff/segment-pane"],function(e,t,i,n,r){var o=function(e,t){this.sbsdiff_=e,this.lineHeight=t,this.focusOffset=5,this.width_=null,this.height_=null,this.fromHunkMap_=new i(this.sbsdiff_.hunks,"from",this.sbsdiff_.from.numLines,t),this.fromFile_=new n(this.sbsdiff_.from,t),this.segments_=new r(e,t),this.toFile_=new n(this.sbsdiff_.to,t),this.toHunkMap_=new i(this.sbsdiff_.hunks,"to",this.sbsdiff_.to.numLines,t),this.$elem_=null};return o.prototype.createDom=function(){this.$elem_=e('<div class="diffract diffract-sbsdiff">'),null!==this.height_&&this.setHeight(this.height_)},o.prototype.render=function(e){this.createDom(),e.append(this.$elem_),this.fromHunkMap_.render(this.$elem_),this.fromFile_.render(this.$elem_),this.segments_.render(this.$elem_),this.toFile_.render(this.$elem_),this.toHunkMap_.render(this.$elem_),this.setWidth(this.width_),this.enterDocument()},o.prototype.setWidth=function(e){if(this.width_=e,this.$elem_){var t=30,i=18,n=e-t-i;this.fromFile_.setPaneWidth(Math.floor(n/2)-1),this.segments_.setPaneWidth(t),this.toFile_.setPaneWidth(Math.ceil(n/2)-1),1===this.$elem_.parent().length&&this.scrollbars()}},o.prototype.setHeight=function(e){this.height_=e,this.$elem_&&(this.$elem_.height(e),1===this.$elem_.parent().length&&this.scrollbars())},o.prototype.scrollbars=function(){this.fromHunkMap_.scrollbars(this.fromFile_.scrollx(),this.fromFile_.scrolly()),this.toHunkMap_.scrollbars(this.toFile_.scrollx(),this.toFile_.scrolly()),this.fromFile_.$elem_.toggleClass("all-lines-visible",!this.fromFile_.scrolly()),this.toFile_.$elem_.toggleClass("all-lines-visible",!this.toFile_.scrolly())},o.prototype.enterDocument=function(){e([this.fromFile_,this.toFile_]).bind("scrollable-file-pane/scroll",e.proxy(this.onScroll_,this)),e([this.fromHunkMap_,this.toHunkMap_]).bind("hunk-map/click",e.proxy(this.onHunkMapClick_,this))},o.prototype.exitDocument=function(){e([this.fromFile_,this.toFile_]).unbind("scrollable-file-pane/scroll"),e([this.fromHunkMap_,this.toHunkMap_]).unbind("hunk-map/click"),this.fromHunkMap_.exitDocument(),this.fromFile_.exitDocument(),this.segments_.exitDocument(),this.toFile_.exitDocument(),this.toHunkMap_.exitDocument()},o.prototype.onScroll_=function(e,i,n,r){var o=e.target,s=o===this.fromFile_?this.toFile_:this.fromFile_,a=o.file_.position,l=Math.min(i+this.focusOffset,o.numLines),c=a[l],d=a[l-1]===c,h=d?this.lineHeight:r,u=Math.max(d?0:1,c-this.focusOffset),f=s.scrollToLine(u,n,h);u=f[0],h=f[2];var p=new t(this.fromFile_.visibleRange(),this.toFile_.visibleRange());this.sbsdiff_.ensureVisible(p);var m=o===this.fromFile_;this.segments_.draw(p.overlapping(this.sbsdiff_.hunks),m?i:u,m?r:h,m?u:i,m?h:r)},o.prototype.onHunkMapClick_=function(e,t){var i=e.target===this.fromHunkMap_?this.fromFile_:this.toFile_;i.scrollToLineAndFire(t-this.focusOffset,0,0)},o.prototype.scrollToFirstHunk=function(){var e=this.sbsdiff_.hunks[0];e.isAddition()?this.toFile_.scrollToLineAndFire(e.toRange.low-this.focusOffset,0,0):this.fromFile_.scrollToLineAndFire(e.fromRange.low-this.focusOffset,0,0)},o}),define("components/diff/bitbucket-side-by-side-diff",["jquery","components/diff/heading-renderer","components/diff/note-renderer","components/diff/side-by-side-diff"],function(e,t,i,n){var r=function(e){this.diff_=e,this.heading_=new t(e.filename(),e.hasConflicts()),this.note_=e.hasNote()?new i(e.note):null,this.sbsDiff_=new n(e,18),this.$elem_=null};return r.prototype.createDom=function(){this.$elem_=e('<section class="bb-sbs-diff"></section>')},r.prototype.render=function(e){this.createDom(),this.$elem_.appendTo(e),this.heading_.render(this.$elem_),this.note_&&this.note_.render(this.$elem_),this.sbsDiff_.render(this.$elem_),this.enterDocument()},r.prototype.enterDocument=function(){e(document).bind("diff-load-start",e.proxy(this.loadingStart_,this)).bind("diff-load-end",e.proxy(this.loadingEnd_,this))},r.prototype.exitDocument=function(){},r.prototype.loadingStart_=function(e,t){t===this.diff_.filename()&&this.$elem_.addClass("loading-diff")},r.prototype.loadingStart_=function(e,t){t===this.diff_.filename()&&this.$elem_.removeClass("loading-diff")},r.prototype.setWidth=function(e){this.sbsDiff_.setWidth(e)},r.prototype.setHeight=function(e){this.sbsDiff_.setHeight(e)},r.prototype.scrollToFirstHunk=function(){this.sbsDiff_.scrollToFirstHunk()},r}),function(e){define("jquery-plugins/jquery.fancybox",[],function(){return function(){!function(e,t,i,n){var r=i(e),o=i(t),s=i.fancybox=function(){s.open.apply(this,arguments)},a=!1,l=null,c=t.createTouch!==n,d=function(e){return"string"===i.type(e)},h=function(e){return d(e)&&e.indexOf("%")>0},u=function(e,t){return t&&h(e)&&(e=s.getViewport()[t]/100*parseInt(e,10)),Math.round(e)+"px"};i.extend(s,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!c,autoCenter:!c,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!1,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(i.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:300,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:300,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}},onCancel:i.noop,beforeLoad:i.noop,afterLoad:i.noop,beforeShow:i.noop,afterShow:i.noop,beforeClose:i.noop,afterClose:i.noop},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){s.close(!0),e&&!i.isArray(e)&&(e=e instanceof i?i(e).get():[e]),s.isActive=!0,s.opts=i.extend(!0,{},s.defaults,t),i.isPlainObject(t)&&t.keys!==n&&(s.opts.keys=t.keys?i.extend({},s.defaults.keys,t.keys):!1),s.group=e,s._start(s.opts.index||0)
},cancel:function(){s.coming&&!1===s.trigger("onCancel")||(s.coming=null,s.hideLoading(),s.ajaxLoad&&s.ajaxLoad.abort(),s.ajaxLoad=null,s.imgPreload&&(s.imgPreload.onload=s.imgPreload.onabort=s.imgPreload.onerror=null))},close:function(e){s.cancel(),s.current&&!1!==s.trigger("beforeClose")&&(s.unbindEvents(),!s.isOpen||e&&e[0]===!0?(i(".fancybox-wrap").stop().trigger("onReset").remove(),s._afterZoomOut()):(s.isOpen=s.isOpened=!1,i(".fancybox-item, .fancybox-nav").remove(),s.wrap.stop(!0).removeClass("fancybox-opened"),s.inner.css("overflow","hidden"),s.transitions[s.current.closeMethod]()))},play:function(e){var t=function(){clearTimeout(s.player.timer)},n=function(){t(),s.current&&s.player.isActive&&(s.player.timer=setTimeout(s.next,s.current.playSpeed))},r=function(){t(),i("body").unbind(".player"),s.player.isActive=!1,s.trigger("onPlayEnd")},o=function(){s.current&&(s.current.loop||s.current.index<s.group.length-1)&&(s.player.isActive=!0,i("body").bind({"afterShow.player onUpdate.player":n,"onCancel.player beforeClose.player":r,"beforeLoad.player":t}),n(),s.trigger("onPlayStart"))};s.player.isActive||e&&e[0]===!1?r():o()},next:function(){s.current&&s.jumpto(s.current.index+1)},prev:function(){s.current&&s.jumpto(s.current.index-1)},jumpto:function(e){s.current&&(e=parseInt(e,10),s.group.length>1&&s.current.loop&&(e>=s.group.length?e=0:0>e&&(e=s.group.length-1)),s.group[e]!==n&&(s.cancel(),s._start(e)))},reposition:function(e,t){var i;s.isOpen&&(i=s._getPosition(t),e&&"scroll"===e.type?(delete i.position,s.wrap.stop(!0,!0).animate(i,200)):s.wrap.css(i))},update:function(e){s.isOpen&&(a||(l=setTimeout(function(){var t=s.current,i=!e||e&&"orientationchange"===e.type;if(a){if(a=!1,!t)return;(!e||"scroll"!==e.type||i)&&(t.autoSize&&"iframe"!==t.type&&(s.inner.height("auto"),t.height=s.inner.height()),(t.autoResize||i)&&s._setDimension(),t.canGrow&&"iframe"!==t.type&&s.inner.height("auto")),(t.autoCenter||i)&&s.reposition(e),s.trigger("onUpdate")}},200)),a=!0)},toggle:function(){s.isOpen&&(s.current.fitToView=!s.current.fitToView,s.update())},hideLoading:function(){o.unbind("keypress.fb"),i("#fancybox-loading").remove()},showLoading:function(){s.hideLoading(),o.bind("keypress.fb",function(e){27===e.keyCode&&(e.preventDefault(),s.cancel())}),i('<div id="fancybox-loading"><div></div></div>').click(s.cancel).appendTo("body")},getViewport:function(){return{x:r.scrollLeft(),y:r.scrollTop(),w:c&&e.innerWidth?e.innerWidth:r.width(),h:c&&e.innerHeight?e.innerHeight:r.height()}},unbindEvents:function(){s.wrap&&s.wrap.unbind(".fb"),o.unbind(".fb"),r.unbind(".fb")},bindEvents:function(){var e=s.current,t=e.keys;e&&(r.bind("resize.fb orientationchange.fb"+(e.autoCenter&&!e.fixed?" scroll.fb":""),s.update),t&&o.bind("keydown.fb",function(e){var n,r=e.target||e.srcElement;e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||r&&(r.type||i(r).is("[contenteditable]"))||(n=e.keyCode,i.inArray(n,t.close)>-1?(s.close(),e.preventDefault()):i.inArray(n,t.next)>-1?(s.next(),e.preventDefault()):i.inArray(n,t.prev)>-1&&(s.prev(),e.preventDefault()))}),i.fn.mousewheel&&e.mouseWheel&&s.group.length>1&&s.wrap.bind("mousewheel.fb",function(e,t){var i=e.target||null;0===t||i&&0!==i.clientHeight&&(i.scrollHeight!==i.clientHeight||i.scrollWidth!==i.clientWidth)||(e.preventDefault(),s[t>0?"prev":"next"]())}))},trigger:function(e,t){var n,r=t||s[i.inArray(e,["onCancel","beforeLoad","afterLoad"])>-1?"coming":"current"];if(r){if(i.isFunction(r[e])&&(n=r[e].apply(r,Array.prototype.slice.call(arguments,1))),n===!1)return!1;r.helpers&&i.each(r.helpers,function(t,n){n&&i.isPlainObject(s.helpers[t])&&i.isFunction(s.helpers[t][e])&&s.helpers[t][e](n,r)}),i.event.trigger(e+".fb")}},isImage:function(e){return d(e)&&e.match(/\.(jpe?g|gif|png|bmp)((\?|#).*)?$/i)},isSWF:function(e){return d(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t,n,r,o,a,l={},c=s.group[e]||null;if(c&&(c.nodeType||c instanceof i)&&(t=!0,i.metadata&&(l=i(c).metadata())),l=i.extend(!0,{},s.opts,{index:e,element:c},i.isPlainObject(c)?c:l),i.each(["href","title","content","type"],function(e,n){l[n]=s.opts[n]||t&&i(c).attr(n)||l[n]||null}),"number"==typeof l.margin&&(l.margin=[l.margin,l.margin,l.margin,l.margin]),l.modal&&i.extend(!0,l,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),s.coming=l,!1===s.trigger("beforeLoad"))return void(s.coming=null);switch(r=l.type,n=l.href||c,r||(t&&(r=i(c).data("fancybox-type"),r||(o=c.className.match(/fancybox\.(\w+)/),r=o?o[1]:null)),!r&&d(n)&&(s.isImage(n)?r="image":s.isSWF(n)?r="swf":n.match(/^#/)&&(r="inline")),r||(r=t?"inline":"html"),l.type=r),"inline"===r||"html"===r?(l.content||(l.content="inline"===r?i(d(n)?n.replace(/.*(?=#[^\s]+$)/,""):n):c),l.content&&l.content.length||(r=null)):n||(r=null),"ajax"===r&&d(n)&&(a=n.split(/\s+/,2),n=a.shift(),l.selector=a.shift()),l.href=n,l.group=s.group,l.isDom=t,r){case"image":s._loadImage();break;case"ajax":s._loadAjax();break;case"inline":case"iframe":case"swf":case"html":s._afterLoad();break;default:s._error("type")}},_error:function(e){s.hideLoading(),i.extend(s.coming,{type:"html",autoSize:!0,minWidth:0,minHeight:0,padding:15,hasError:e,content:s.coming.tpl.error}),s._afterLoad()},_loadImage:function(){var e=s.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,s.coming.width=this.width,s.coming.height=this.height,s._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,s._error("image")},e.src=s.coming.href,e.complete!==n&&e.complete||s.showLoading()},_loadAjax:function(){s.showLoading(),s.ajaxLoad=i.ajax(i.extend({},s.coming.ajax,{url:s.coming.href,error:function(e,t){s.coming&&"abort"!==t?s._error("ajax",e):s.hideLoading()},success:function(e,t){"success"===t&&(s.coming.content=e,s._afterLoad())}}))},_preloadImages:function(){var e,t,n,r=s.group,o=s.current,a=r.length,l=Math.min(o.preload,a-1);if(o.preload&&!(r.length<2))for(n=1;l>=n;n+=1)e=r[(o.index+n)%a],t=e.href||i(e).attr("href")||e,("image"===e.type||s.isImage(t))&&((new Image).src=t)},_afterLoad:function(){return s.hideLoading(),s.coming&&!1!==s.trigger("afterLoad",s.current)?(s.isOpened?(i(".fancybox-item, .fancybox-nav").remove(),s.wrap.stop(!0).removeClass("fancybox-opened"),s.inner.css("overflow","hidden"),s.transitions[s.current.prevMethod]()):(i(".fancybox-wrap").stop().trigger("onReset").remove(),s.trigger("afterClose")),s.unbindEvents(),s.isOpen=!1,s.current=s.coming,s.wrap=i(s.current.tpl.wrap).addClass("fancybox-"+(c?"mobile":"desktop")+" fancybox-type-"+s.current.type+" fancybox-tmp "+s.current.wrapCSS).appendTo("body"),s.skin=i(".fancybox-skin",s.wrap).css("padding",u(s.current.padding)),s.outer=i(".fancybox-outer",s.wrap),s.inner=i(".fancybox-inner",s.wrap),void s._setContent()):void(s.coming=!1)},_setContent:function(){var e,t=s.current,n=t.content,r=t.type,o=t.minWidth,a=t.minHeight,l=t.maxWidth,d=t.maxHeight;switch(r){case"inline":case"ajax":case"html":t.selector?n=i("<div>").html(n).find(t.selector):n instanceof i&&(n.parent().hasClass("fancybox-inner")&&n.parents(".fancybox-wrap").unbind("onReset"),n=n.show().detach(),i(s.wrap).bind("onReset",function(){n.appendTo("body").hide()})),t.autoSize&&(e=i('<div class="fancybox-wrap '+s.current.wrapCSS+' fancybox-tmp"></div>').appendTo("body").css({minWidth:u(o,"w"),minHeight:u(a,"h"),maxWidth:u(l,"w"),maxHeight:u(d,"h")}).append(n),t.width=e.width(),t.height=e.height(),e.width(s.current.width),e.height()>t.height&&(e.width(t.width+1),t.width=e.width(),t.height=e.height()),n=e.contents().detach(),e.remove());break;case"image":n=t.tpl.image.replace("{href}",t.href),t.aspectRatio=!0;break;case"swf":n=t.tpl.swf.replace(/\{width\}/g,t.width).replace(/\{height\}/g,t.height).replace(/\{href\}/g,t.href);break;case"iframe":n=i(t.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",t.scrolling).attr("src",t.href),t.scrolling=c?"scroll":"auto"}("image"===r||"swf"===r)&&(t.autoSize=!1,t.scrolling="visible"),"iframe"===r&&t.autoSize?(s.showLoading(),s._setDimension(),s.inner.css("overflow",t.scrolling),n.bind({onCancel:function(){i(this).unbind(),s._afterZoomOut()},load:function(){s.hideLoading();try{this.contentWindow.document.location&&(s.current.height=i(this).contents().find("body").height())}catch(e){s.current.autoSize=!1}s[s.isOpen?"_afterZoomIn":"_beforeShow"]()}}).appendTo(s.inner)):(s.inner.append(n),s._beforeShow())},_beforeShow:function(){s.coming=null,s.trigger("beforeShow"),s._setDimension(),s.wrap.hide().removeClass("fancybox-tmp"),s.bindEvents(),s._preloadImages(),s.transitions[s.isOpened?s.current.nextMethod:s.current.openMethod]()},_setDimension:function(){var e,t,n=s.wrap,r=s.inner,o=s.current,a=s.getViewport(),l=o.margin,c=2*o.padding,d=o.width,f=o.height,p=o.maxWidth+c,m=o.maxHeight+c,g=o.minWidth+c,v=o.minHeight+c;if(a.w-=l[1]+l[3],a.h-=l[0]+l[2],h(d)&&(d=(a.w-c)*parseFloat(d)/100),h(f)&&(f=(a.h-c)*parseFloat(f)/100),e=d/f,d+=c,f+=c,o.fitToView&&(p=Math.min(a.w,p),m=Math.min(a.h,m)),o.aspectRatio?(d>p&&(d=p,f=(d-c)/e+c),f>m&&(f=m,d=(f-c)*e+c),g>d&&(d=g,f=(d-c)/e+c),v>f&&(f=v,d=(f-c)*e+c)):(d=Math.max(g,Math.min(d,p)),f=Math.max(v,Math.min(f,m))),d=Math.round(d),f=Math.round(f),i(n.add(r)).width("auto").height("auto"),r.width(d-c).height(f-c),n.width(d),t=n.height(),d>p||t>m)for(;(d>p||t>m)&&d>g&&t>v;)f-=10,o.aspectRatio?(d=Math.round((f-c)*e+c),g>d&&(d=g,f=(d-c)/e+c)):d-=10,r.width(d-c).height(f-c),n.width(d),t=n.height();o.dim={width:u(d),height:u(t)},o.canGrow=o.autoSize&&f>v&&m>f,o.canShrink=!1,o.canExpand=!1,d-c<o.width||f-c<o.height?o.canExpand=!0:(d>a.w||t>a.h)&&d>g&&f>v&&(o.canShrink=!0),s.innerSpace=t-c-r.height()},_getPosition:function(e){var t=s.current,i=s.getViewport(),n=t.margin,r=s.wrap.width()+n[1]+n[3],o=s.wrap.height()+n[0]+n[2],a={position:"absolute",top:n[0]+i.y,left:n[3]+i.x};return t.autoCenter&&t.fixed&&!e&&o<=i.h&&r<=i.w&&(a={position:"fixed",top:n[0],left:n[3]}),a.top=u(Math.max(a.top,a.top+(i.h-o)*t.topRatio)),a.left=u(Math.max(a.left,a.left+.5*(i.w-r))),a},_afterZoomIn:function(){var e=s.current,t=e?e.scrolling:"no";e&&(s.isOpen=s.isOpened=!0,s.wrap.addClass("fancybox-opened"),s.inner.css("overflow","yes"===t?"scroll":"no"===t?"hidden":t),s.trigger("afterShow"),s.update(),(e.closeClick||e.nextClick)&&s.inner.css("cursor","pointer").bind("click.fb",function(t){i(t.target).is("a")||i(t.target).parent().is("a")||s[e.closeClick?"close":"next"]()}),e.closeBtn&&i(e.tpl.closeBtn).appendTo(s.skin).bind("click.fb",s.close),e.arrows&&s.group.length>1&&((e.loop||e.index>0)&&i(e.tpl.prev).appendTo(s.outer).bind("click.fb",s.prev),(e.loop||e.index<s.group.length-1)&&i(e.tpl.next).appendTo(s.outer).bind("click.fb",s.next)),s.opts.autoPlay&&!s.player.isActive&&(s.opts.autoPlay=!1,s.play()))},_afterZoomOut:function(){var e=s.current;s.wrap.trigger("onReset").remove(),i.extend(s,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,skin:null,outer:null,inner:null}),s.trigger("afterClose",e)}}),s.transitions={getOrigPosition:function(){var e,t=s.current,n=t.element,r=t.padding,o=i(t.orig),a={},l=50,c=50;return!o.length&&t.isDom&&i(n).is(":visible")&&(o=i(n).find("img:first"),o.length||(o=i(n))),o.length?(a=o.offset(),o.is("img")&&(l=o.outerWidth(),c=o.outerHeight())):(e=s.getViewport(),a.top=e.y+.5*(e.h-c),a.left=e.x+.5*(e.w-l)),a={top:u(a.top-r),left:u(a.left-r),width:u(l+2*r),height:u(c+2*r)}},step:function(e,t){var i,n,r=t.prop;("width"===r||"height"===r)&&(i=Math.ceil(e-2*s.current.padding),"height"===r&&(n=(e-t.start)/(t.end-t.start),t.start>t.end&&(n=1-n),i-=s.innerSpace*n),s.inner[r](i))},zoomIn:function(){var e=s.wrap,t=s.current,n=t.openEffect,r="elastic"===n,o=t.dim,a=i.extend({},o,s._getPosition(r)),l=i.extend({opacity:1},a);delete l.position,r?(a=this.getOrigPosition(),t.openOpacity&&(a.opacity=0),s.outer.add(s.inner).width("auto").height("auto")):"fade"===n&&(a.opacity=0),e.css(a).show().animate(l,{duration:"none"===n?0:t.openSpeed,easing:t.openEasing,step:r?this.step:null,complete:s._afterZoomIn})},zoomOut:function(){var e=s.wrap,t=s.current,i=t.openEffect,n="elastic"===i,r={opacity:0};n&&("fixed"===e.css("position")&&e.css(s._getPosition(!0)),r=this.getOrigPosition(),t.closeOpacity&&(r.opacity=0)),e.animate(r,{duration:"none"===i?0:t.closeSpeed,easing:t.closeEasing,step:n?this.step:null,complete:s._afterZoomOut})},changeIn:function(){var e=s.wrap,t=s.current,i=t.nextEffect,n="elastic"===i,r=s._getPosition(n),o={opacity:1};r.opacity=0,n&&(r.top=u(parseInt(r.top,10)-200),o.top="+=200px"),e.css(r).show().animate(o,{duration:"none"===i?0:t.nextSpeed,easing:t.nextEasing,complete:s._afterZoomIn})},changeOut:function(){var e=s.wrap,t=s.current,n=t.prevEffect,r={opacity:0},o=function(){i(this).trigger("onReset").remove()};e.removeClass("fancybox-opened"),"elastic"===n&&(r.top="+=200px"),e.animate(r,{duration:"none"===n?0:t.prevSpeed,easing:t.prevEasing,complete:o})}},s.helpers.overlay={overlay:null,update:function(){var e,n,s;this.overlay.width("100%").height("100%"),i.browser.msie||c?(n=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth),s=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),e=s>n?r.width():n):e=o.width(),this.overlay.width(e).height(o.height())},beforeShow:function(e){this.overlay||(e=i.extend(!0,{},s.defaults.helpers.overlay,e),this.overlay=i('<div id="fancybox-overlay"></div>').css(e.css).appendTo("body"),e.closeClick&&this.overlay.bind("click.fb",s.close),s.current.fixed&&!c?this.overlay.addClass("overlay-fixed"):(this.update(),this.onUpdate=function(){this.update()}),this.overlay.fadeTo(e.speedIn,e.opacity))},afterClose:function(e){this.overlay&&this.overlay.fadeOut(e.speedOut||0,function(){i(this).remove()}),this.overlay=null}},s.helpers.title={beforeShow:function(e){var t,n=s.current.title;n&&(t=i('<div class="fancybox-title fancybox-title-'+e.type+'-wrap">'+n+"</div>").appendTo("body"),"float"===e.type&&(t.width(t.width()),t.wrapInner('<span class="child"></span>'),s.current.margin[2]+=Math.abs(parseInt(t.css("margin-bottom"),10))),t.appendTo("over"===e.type?s.inner:"outside"===e.type?s.wrap:s.skin))}},i.fn.fancybox=function(e){var t,n=i(this),r=this.selector||"",a=function(o){var a,l,c=this,d=t;o.ctrlKey||o.altKey||o.shiftKey||o.metaKey||i(c).is(".fancybox-wrap")||(o.preventDefault(),a=e.groupAttr||"data-fancybox-group",l=i(c).attr(a),l||(a="rel",l=c[a]),l&&""!==l&&"nofollow"!==l&&(c=r.length?i(r):n,c=c.filter("["+a+'="'+l+'"]'),d=c.index(this)),e.index=d,s.open(c,e))};return e=e||{},t=e.index||0,r?o.undelegate(r,"click.fb-start").delegate(r,"click.fb-start",a):n.unbind("click.fb-start").bind("click.fb-start",a),this},i(t).ready(function(){s.defaults.fixed=i.support.fixedPosition||!(i.browser.msie&&i.browser.version<=6)&&!c})}(window,document,jQuery)}.apply(e,arguments)})}(this),define("components/diff/diff-actions",["jquery","underscore","data/current-cset","data/current-repo","components/diff/bitbucket-side-by-side-diff","utils/gaq-push","jquery-plugins/jquery.fancybox"],function(e,t,i,n,r,o){var s=function(e,i){this.diff_=e,this.filename_=i,this.sbsDiff_=new r(e),this.id_=t.uniqueId("side-by-side-"),this.$elem_=null,this.$container_=null};return s.prototype.createDom=function(){var t=gettext("side-by-side diff"),r=gettext("view file");this.$elem_=e(['<div class="diff-actions">',"<ul>",'<li class="sbs-item"><a class="execute click sbs" href="#',this.id_,'">{}</a></li>','<li class="view-file-item"><a class="view-file">{}</a></li>',"</ul>",'<div class="bb-patch" id="',this.id_,'"></div>',"</div>"].join("").format(t,r));var o=i||"tip";this.$elem_.find("a.view-file").attr("href","/"+n+"/src/"+o+"/"+this.filename_),this.$container_=this.$elem_.children("div").hide()},s.prototype.render=function(e){this.createDom(),this.$elem_.appendTo(e),this.enterDocument()},s.prototype.enterDocument=function(){var t=this;this.$elem_.find("a.sbs").fancybox({autoSize:!1,margin:30,width:"97%",height:"97%",scrolling:"no",afterShow:function(){e(this.element).trigger("sbsOpen")},afterClose:function(){e(this.element).trigger("sbsClose")},helpers:{overlay:{opacity:.7}}}).bind("sbsOpen",function(){t.onDialogOpen_.apply(t)}).bind("sbsClose",function(){t.onDialogClose_.apply(t)})},s.prototype.exitDocument=function(){},s.prototype.onDialogOpen_=function(){o(["atl._trackEvent","Code","Invoke SBS diff"]),e("#fancybox-wrap").css({position:"fixed",top:15,left:15}),this.$container_.show(),this.sbsDiff_.setHeight(this.$container_.parent().height()-60-(this.diff_.hasNote()?59:0)),this.sbsDiff_.setWidth(this.$container_.parent().width()),0===this.$container_.children().length&&this.sbsDiff_.render(this.$container_),setTimeout(e.proxy(this.sbsDiff_.scrollToFirstHunk,this.sbsDiff_),0)},s.prototype.onDialogClose_=function(){this.$container_.hide()},s}),define("components/diff/file-numbers",["jquery"],function(e){var t=function(e,t){this.file_=e,this.lineHeight=t,this.$elem_=null};return t.prototype.createDom=function(){this.$elem_=e('<div class="file-numbers">'),this.file_.lineHeightPx=this.lineHeight,this.file_.numbersBoxDom=this.$elem_[0],this.file_.scrollBoxDom=e("<div>")[0]},t.prototype.render=function(e){this.createDom(),e.append(this.$elem_),this.enterDocument()},t.prototype.enterDocument=function(){},t.prototype.exitDocument=function(){},t}),define("components/diff/unified-diff",["jquery","components/diff/file-numbers","components/diff/hunk","components/diff/lined-pane","components/diff/scrollable-file-pane"],function(){var e=function(e,t){this.udiff_=e,this.numLines_=this.udiff_.to.numLines,this.lineHeight=t,this.focusOffset=5,this.pane_=LinedPane.window(this.numLines_,928,t),this.fromNumbers_=new FileNumbers(this.udiff_.from,t),this.unifiedLines_=new ScrollableFilePane(this.udiff_.to,t),this.$elem_=null};return e.prototype.createDom=function(){},e.prototype.render=function(e){this.createDom(),this.pane_.render(e),this.$elem_=this.pane_.$content().addClass("diffract diffract-udiff"),e.append(this.$elem_),this.fromNumbers_.render(this.pane_.$content()),this.unifiedLines_.render(this.pane_.$content());var t=35;this.unifiedLines_.setPaneWidth(928-t-1),this.unifiedLines_.scrollx()&&this.$elem_.css("margin-bottom",$.getScrollbarWidth()),this.showVisibleLines_(),this.enterDocument()},e.prototype.enterDocument=function(){$(this.pane_).bind("aperture-lined-pane/scroll",$.proxy(this.showVisibleLines_,this)),this.fromNumbers_.$elem_.add(this.unifiedLines_.$elem_).delegate(".skipped","click.skipped",$.proxy(this.expandSkipped_,this))},e.prototype.exitDocument=function(){$(this.pane_).unbind("aperture-lined-pane/scroll"),$([this.fromNumbers_.$elem_,this.unifiedLines_.$elem_]).undelegate("click.skipped"),this.fromNumbers_.exitDocument(),this.unifiedLines_.exitDocument(),this.pane_.exitDocument()},e.prototype.showVisibleLines_=function(){var e=this.pane_.visibleRange();e&&this.udiff_.ensureVisible(new Hunk(e,e))},e.prototype.expandSkipped_=function(e){var t=$(e.target).closest(".skipped");$(this).trigger("diffract-skipped/click",[t,t.data("skipped-index")])},e.prototype.contextFile_=function(){return this.udiff_.to},e.prototype.unifiedFile_=function(){return this.contextFile_().file_.file_},e.prototype.scrollToFromLine=function(e){var t=this.unifiedFile_().from2unified_[e];return this.scrollToUnifiedLine(t)},e.prototype.scrollToToLine=function(e){var t=this.unifiedFile_().to2unified_[e];return this.scrollToUnifiedLine(t)},e.prototype.scrollToUnifiedLine=function(e){var t=this.contextFile_(),i=t.file2viewport[e],n=t.viewport2file[i];return"number"==typeof n?(i=Math.max(1,i-this.focusOffset),this.pane_.scrollToLine(i,0,0),!0):!1},e}),define("components/diff/bitbucket-unified-diff",["aui","jquery","components/diff/diff","components/diff/heading-renderer","components/diff/diff-actions","components/diff/note-renderer","components/diff/unified-diff","utils/gaq-push"],function(e,t,i,n,r,o,s,a){var l=function(e){var a=i.ofContext(i.unified(e),l.CONTEXT),c=a.filename();this.sbsdiff=e,this.diff_=a,this.heading_=new n(c,a.hasConflicts()),this.sbsbutton_=t.browser.msie&&t.browser.version<9?null:new r(e,c),this.note_=a.hasNote()?new o(a.note):null,this.unifiedDiff_=new s(a,18),this.hoverTimeout_=null,this.$elem_=null};return l.CONTEXT=3,l.prototype.createDom=function(){this.$elem_=t('<section class="bb-udiff iterable-item"></section>')},l.prototype.render=function(e){this.createDom(),e.append(this.$elem_),this.heading_.render(this.$elem_),this.sbsbutton_&&this.sbsbutton_.render(this.heading_.$elem_),this.note_&&this.note_.render(this.$elem_),this.unifiedDiff_.render(this.$elem_),this.enterDocument()},l.prototype.enterDocument=function(){t(this.unifiedDiff_).bind("diffract-skipped/click",t.proxy(this.expandSkipped,this)),this.unifiedDiff_.$elem_.on("mouseenter",".skipped",t.proxy(this.mouseenter_,this)),this.unifiedDiff_.$elem_.on("mouseleave",".skipped",t.proxy(this.mouseleave_,this))},l.prototype.exitDocument=function(){t(this.unifiedDiff_).unbind("diffract-skipped/click")},l.prototype.replaceDiff_=function(e){this.unifiedDiff_.exitDocument(),this.unifiedDiff_.$elem_.remove(),this.diff_=e,this.unifiedDiff_=new s(this.diff_,18),this.unifiedDiff_.render(this.$elem_),this.enterDocument()},l.prototype.expandSkipped=function(e,t,n){a(["atl._trackEvent","Code","Expand unified diff"]),t.tooltip("hide"),this.replaceDiff_(i.expandSkippedSection(this.diff_,n))},l.prototype.mouseenter_=function(e){var i=t(e.target).closest(".skipped");this.hoverTimeout_=setTimeout(_.bind(this.hover_,this,i),200)},l.prototype.hover_=function(e){e.tooltip(this.tipsySettings_),e.tooltip("show")},l.prototype.mouseleave_=function(e){clearTimeout(this.hoverTimeout_);var i=t(e.target).closest(".skipped");i.tooltip("hide")},l.prototype.tipsySettings_={title:function(){return gettext("Show more lines")},gravity:"s",trigger:"manual"},l.prototype.scrollToFromLine=function(e){e>=1&&e<=this.sbsdiff.from.numLines&&(this.unifiedDiff_.scrollToFromLine(e)||(this.replaceDiff_(i.expandToInclude(this.diff_,"from",e)),this.scrollToFromLine(e)))},l.prototype.scrollToToLine=function(e){e>=1&&e<=this.sbsdiff.to.numLines&&(this.unifiedDiff_.scrollToToLine(e)||(this.replaceDiff_(i.expandToInclude(this.diff_,"to",e)),this.scrollToToLine(e)))},l}),define("components/diff/deferred-diff",["jquery","components/diff/heading-renderer","components/diff/note-renderer"],function(e,t,i){var n=function(e,n){this.filename=e,this.url=n,this.heading_=new t(e,!1),this.note_=new i("Click to load."),this.$elem_=null};return n.prototype.createDom=function(){this.$elem_=e('<section class="bb-deferred-diff iterable-item"></section>')},n.prototype.render=function(e){this.createDom(),this.$elem_.appendTo(e),this.heading_.render(this.$elem_),this.note_.render(this.$elem_),this.enterDocument()},n.prototype.enterDocument=function(){this.note_.$elem_.bind("click.deferred-diff",e.proxy(this.load_,this))},n.prototype.exitDocument=function(){this.note_.$elem_.unbind("click.deferred-diff")},n.prototype.load_=function(){this.isLoading()||(this.note_.$elem_.addClass("loading"),this.note_.setNote("Loading..."),e(this).trigger("deferred-diff/load",[this.filename]))},n.prototype.isLoading=function(){return this.note_.$elem_.hasClass("loading")},n}),define("components/diff/note-only-diff",["jquery","components/diff/heading-renderer","components/diff/note-renderer"],function(e,t,i){var n=function(e){this.heading_=new t(e.filename(),e.hasConflicts()),this.note_=new i(e.note),this.$elem_=null};return n.prototype.createDom=function(){this.$elem_=e('<section class="bb-udiff iterable-item"></section>')},n.prototype.render=function(e){this.createDom(),this.$elem_.appendTo(e),this.heading_.render(this.$elem_),this.note_.render(this.$elem_),this.enterDocument()},n.prototype.enterDocument=function(){},n.prototype.exitDocument=function(){},n}),define("components/diff/bitbucket-patch",["jquery","data/current-repo","data/current-cset","components/diff/bitbucket-unified-diff","components/diff/deferred-diff","components/diff/diff","components/diff/note-only-diff","components/diff/permalinker","utils/api-helper"],function(e,t,i,n,r,o,s,a,l){var c=function(n,s){var a=this;this.filenames_={},this.diffs_=[],this.deferred_=[],this.waitForDiffToLoad=e.Deferred(),this.diffEndpoint=s||l.concat("repositories",t.owner.username,t.slug,"changesets",i,"diff").toString(),e.ajax({type:"GET",url:this.diffEndpoint,dataType:"json",success:function(t){n.each(function(i,n){var l=e(n),c=l.hasClass("deferred");if(c){var d=l.attr("data-filename"),h=new r(d,a.diffEndpoint);a.deferred_.push(h),a.filenames_[d]=h}else{var u,f=o.sideBySideFromData(t[i]);s&&(f.url=s),u=a.newDiffRenderer(f,c),a.diffs_.push(u),a.filenames_[f.filename()]=u,this.$elem_=null}}),a.waitForDiffToLoad.resolve()}}),this.$elem_=null};return c.prototype.newDiffRenderer=function(e){return e.hasNote()&&!e.hasDiffContent()?new s(e):new n(e)},c.prototype.createDom=function(){this.$elem_=e('<div class="bb-patch">')},c.prototype.render=function(e){var t=this;this.waitForDiffToLoad.done(function(){t.createDom(),t.$elem_.appendTo(e);for(var i=0;i<t.diffs_.length;i++)t.diffs_[i].render(t.$elem_);for(i=0;i<t.deferred_.length;i++)t.deferred_[i].render(t.$elem_);t.enterDocument(),t.scrollToPermalink_()})},c.prototype.enterDocument=function(){e(this.deferred_).bind("deferred-diff/load",e.proxy(this.fetchDeferred_,this)),e(document).bind("diff-load-start",e.proxy(this.loadingStart_,this)).bind("diff-load-end",e.proxy(this.loadingEnd_,this)),e(window).bind("hashchange",e.proxy(this.scrollToPermalink_,this))},c.prototype.exitDocument=function(){e(this.deferred_).unbind("deferred-diff/load")},c.prototype.fetchDeferred_=function(t,i){var n=this.filenames_[i],r=this.diffEndpoint.toString();e.ajax({type:"GET",url:n.url||r.toString(),data:{filename:i,meta:!0},dataType:"json",success:e.proxy(this.insertDeferred_,this)})},c.prototype.insertDeferred_=function(t){var i=o.sideBySideFromData(t[0]),n=this.newDiffRenderer(i),r=this.filenames_[i.filename()];r.exitDocument(),r.$elem_.empty();var s=e.inArray(this.deferred_,i.filename());s>=0&&delete this.deferred_[s],n.render(r.$elem_),r.$elem_.replaceWith(n.$elem_),this.filenames_[i.filename()]=n;var l=(new a).parse(window.location.hash);l&&l.path===i.filename()&&this.scrollToPermalink_()},c.prototype.loadingStart_=function(e,t){var i=this.filenames_[t];i&&i.$elem_.addClass("loading-diff")},c.prototype.loadingEnd_=function(e,t){var i=this.filenames_[t];i&&i.$elem_.removeClass("loading-diff")},c.prototype.scrollToPermalink_=function(t){var i=(new a).parse(window.top.location.hash);if(i){var n=this.filenames_[i.path];if(n instanceof r)this.fetchDeferred_(null,i.path);else if(n){var o=!t,s=e.browser.webkit,l="from"===i.file?n.scrollToFromLine:n.scrollToToLine;o&&s?setTimeout(function(){l.call(n,i.line)},200):l.call(n,i.line)}}},c}),define("components/diff/commentable-diff",["aui","jquery","underscore","components/comments/comment","components/comments/comment-form","components/comments/line-comment"],function(e,t,i,n,r,o){var s=e.sidebar(".aui-sidebar"),a=function(e,t,i,n,s){this.endPoint=e,this.filename=t,this.anchor=n,this.destrev=s,this.commentForm=new r,this.$elem=null,this.threads=o.decorateThreads(e.toString(),i,t)};return a.prototype.decorate=function(e){return this.$elem=e,this.enterDocument(),this},a.prototype.calculateListWidth=function(){var e=this.$elem.find(".comment-thread-container:first");if(!e.length)return!1;var t=parseInt(e.css("padding-left").replace("px",""),10),i=parseInt(e.css("padding-right").replace("px",""),10),n=e.find(".comments-list"),r=parseInt(n.css("border-left-width").replace("px",""),10),o=parseInt(n.css("border-right-width").replace("px",""),10);return this.listWidth=this.$elem.width()-t-i-r-o,this.listWidth},a.prototype.setListWidth=function(){this.$elem.find(".comments-list").width(this.calculateListWidth())},a.prototype.enterDocument=function(){this.$elem.on("click",".add-line-comment",t.proxy(this.showForm,this)),t(this.commentForm).bind("comment-form/cancel",t.proxy(this.hideForm,this));var e=this;i.each(this.threads,function(i){t(i).bind("line-comment/thread-deleted",t.proxy(e.cleanUpThreads,e))}),this.$elem.find(".comments-list").width(this.calculateListWidth()),t(window).on("resize",this.setListWidth.bind(this)),s.on("expand-end collapse-end",this.setListWidth.bind(this))},a.prototype.showForm=function(e){e.preventDefault(),this.hideForm();var r=t(e.target).closest("a.add-line-comment"),o={content:"",filename:this.filename,anchor:this.anchor,dest_rev:this.destrev},s=r.siblings(".line-numbers").data("fnum"),a=r.siblings(".line-numbers").data("tnum");s&&a||s?o.line_from=s:o.line_to=a;var l=new n(o,{urlRoot:this.endPoint.toString()});this.commentForm.comment=l,l.on("sync",i.once(this.insertNewComment),this);var c=r.closest(r.hasClass("add-file-comment")?".heading":".udiff-line"),d=c.next(".comment-thread-container");d.length||(d=t('<div class="comment-thread-container"><ol class="comments-list"></ol></div>').insertAfter(c),d.find(".comments-list").width(this.listWidth?this.listWidth:this.calculateListWidth())),d.removeClass("existing-comment");var h=d.find(".comments-list");this.commentForm.$elem?this.commentForm.$elem.prependTo(h):this.commentForm.render(h),this.commentForm.showAndFocus()},a.prototype.insertNewComment=function(e){var i=this.commentForm.$elem.parent(".comments-list"),n=new o(e).render(i);t(n).bind("line-comment/thread-deleted",t.proxy(this.cleanUpThreads,this)),this.threads.push(n),this.hideForm(),n.scrollTo(),this.commentForm.clearContents(),t(document).trigger("comment-added")},a.prototype.acceptLineComments=function(e){var n=this;i.each(e,function(e){t(e).bind("line-comment/thread-deleted",t.proxy(n.cleanUpThreads,n)),n.threads.push(e)})},a.prototype.cleanUpThreads=function(){i.each(this.$elem.find(".comment-thread-container:not(:has(li.comment))"),function(e){t(e).remove()})},a.prototype.hideForm=function(){if(this.commentForm.$elem){var e=this.commentForm.$elem.parent(".comments-list");if(this.commentForm.$elem.detach(),!e.children().length){var t=e.parent(".comment-thread-container");t.remove()}}},a}),define("components/diff/diff-actions-2",["jquery","underscore","components/diff/diff","components/diff/bitbucket-side-by-side-diff","utils/gaq-push","jquery-plugins/jquery.fancybox"],function(e,t,i,n,r){var o=function(e,i){this.filename_=e,this.endpoint=i,this.id_=t.uniqueId("side-by-side-")};return o.prototype.decorate=function(t){this.$elem_=t,this.$elem_.attr("id",this.id_),this.$container_=e('<div class="bb-sbs-patch"></div>').appendTo(this.$elem_),this.$container_.attr("id",this.id_+"-content"),this.enterDocument()},o.prototype.withDiff=function(t){if(this.diff_)t(this.diff_);else{var n=this;e.ajax({type:"GET",data:{filename:n.filename_,meta:!0},dataType:"json",url:n.endpoint,success:function(e){n.diff_=i.sideBySideFromData(e[0]),n.diff_.url=n.endpoint,t(n.diff_)}})}},o.prototype.withSbsDiff=function(e){this.withDiff(function(t){e(new n(t))})},o.prototype.enterDocument=function(){var t=this;this.$elem_.find("a.sbs").attr("href","#"+t.id_+"-content").fancybox({autoSize:!1,margin:30,width:"97%",height:"97%",scrolling:"no",afterShow:function(){e(this.element).trigger("sbsOpen")},afterClose:function(){e(this.element).trigger("sbsClose")},helpers:{overlay:{opacity:.7}}}).bind("sbsOpen",function(){t.onDialogOpen_.apply(t)}).bind("sbsClose",function(){t.onDialogClose_.apply(t)})},o.prototype.onDialogOpen_=function(){var t=this;r(["atl._trackEvent","Code","Invoke SBS diff"]),e("#fancybox-wrap").css({position:"fixed",top:15,left:15}),t.withSbsDiff(function(i){t.withDiff(function(n){t.$container_.show(),i.setHeight(t.$container_.parent().height()-60-(n.hasNote()?59:0)),i.setWidth(t.$container_.parent().width()),0===t.$container_.children().length&&i.render(t.$container_),setTimeout(e.proxy(i.scrollToFirstHunk,i),0)})})},o.prototype.onDialogClose_=function(){this.$container_.hide()},o}),define("components/comments/comment-count-indicator",["jquery"],function(e){var t=function(e,t){this.$countElem=e,this.$commentContainer=t
};return t.prototype.decorate=function(){this.$commentContainer.on("comment-count/create",e.proxy(this.updateCount,this)),this.$commentContainer.on("comment-count/delete",e.proxy(this.updateCount,this))},t.prototype.updateCount=function(){var e=this.$commentContainer.find("li.comment:not(.deleted)").length,t=this.$commentContainer.find(".eclipsedcount span").text();t&&(e+=parseInt(t)),this.$countElem.html(e),0===e?this.$countElem.closest(".count-badge").addClass("zero"):this.$countElem.closest(".count-badge").removeClass("zero")},t}),define("components/diff/deferred-large-diff",["jquery","underscore","components/comments/comment-count-indicator","components/diff/commentable-diff","components/diff/context-expander","components/diff/diff-actions-2","utils/mustache"],function(e,t,i,n,r,o,s){var a={};return a.setupDeferredDiffMarkers=function(a,l,c){e("#commit-files-summary li.truncated").each(function(i,n){t.defer(function(t){var i=e(t),n=i.data("file-identifier"),r=i.find("a.execute").text(),o=i.hasClass("file-conflicts"),l=i.find(".count-badge .count").text(),c={diffidentifier:n,filename:r,conflicts:o};"0"!==l&&(c.eclipsedcount=l);var d=e(s.toHtml("diff-too-big-template",c));a.append(d),i.on("click",function(){d.find(".load-diff").click()})},n)}),a.on("click",".load-diff",function(s){s.preventDefault();var a=e(s.target),d=a.closest(".bb-udiff"),h=d.data("identifier"),u=e('#commit-files-summary li[data-file-identifier="{}"]'.format(h)),f=e('<div class="mask">'),p=e("#compare"),m=p.attr("data-anchor"),g=p.attr("data-dest-rev");d.find(".too-big-message .title").append(f),f.show(),e.ajax({type:"GET",url:window.location,data:{file:h},dataType:"html",success:function(s){var a,f=e(s),p=f.find('section[data-identifier="{}"]'.format(h)),v=f.find('#commit-files-summary li[data-file-identifier="{}"]'.format(h)),b=p.data("filename"),_=p.data("compare-files-url"),y=t.keys(p.data("linecommentroots")||{});return p.length?(d.replaceWith(p),u.replaceWith(v),l&&(new i(v.find(".count-badge .count"),p).decorate(),a=new n(c,b,y,m,g).decorate(p)),new o(b,_).decorate(p.find(".diff-actions")),new r(p.data("expand-context-url")+encodeURI(b),p.data("identifier"),!0,a,c?c.toString():"").decorate(p),void p.trigger("deferred-large-diff/load",s)):(d.find(".too-big-message .try-again").hide(),d.find(".too-big-message .try-again-failed").show(),void d.find(".mask").remove())}})})},a}),define("components/comments/general-comment-form",["jquery","underscore","components/comments/comment","components/comments/comment-form","components/comments/line-comment"],function(e,t,i,n,r){var o=function(e,t){this.endPoint=e,this.comment=this.newModel(),this.commentForm=new n(this.comment),this.insertWhere=t?"before":"after",this.$elem=null};return o.prototype.newModel=function(){var e=new i({content:""},{urlRoot:this.endPoint.toString()});return e.on("sync",t.once(this.insertNewComment),this),e},o.prototype.decorate=function(e){return this.$elem=e,this.commentForm.decorate(e),this.enterDocument(),this},o.prototype.enterDocument=function(){},o.prototype.insertNewComment=function(t){new r(t).render(this.$elem,this.insertWhere),e(document).trigger("comment-added"),this.comment=this.newModel(),this.commentForm.comment=this.comment,this.commentForm.shrinkSize(),this.commentForm.clearContents()},o}),define("components/diff/index",["jquery","data/current-cset","data/current-repo","components/diff/bitbucket-patch","components/diff/commentable-diff","components/diff/diff-actions-2","components/diff/context-expander","components/diff/deferred-large-diff","components/comments/comment-count-indicator","components/comments/general-comment-form","components/comments/line-comment","utils/api-helper"],function(e,t,i,n,r,o,s,a,l,c,d,h){var u=function(){var u=e("#changeset-diff"),f=e(".file-diff-placeholder");if(1===u.length&&f.length)new n(f).render(u);else if(1==u.length&&!e("#pullrequest").length){var p=e("#comment-info"),m=p.data("comment-url"),g=p.data("general-thread-ids"),v=p.data("file-line-thread-ids"),b=u.find(".bb-patch-unified");if(b.find(".bb-udiff, .comment-content .bb-udiff").each(function(){var n,a=e(this),l=a.data("filename"),c=a.data("compare-files-url"),d=a.parent().is(".comment-content");if(v){var u=v[l]||[];n=new r(m,l,u).decorate(a)}var f=h.concat("repositories",i.owner.username,i.slug,"changesets",t,"comments").toString();new o(l,c).decorate(a.find(".diff-actions")),new s(a.data("expand-context-url")+encodeURI(l),a.data("identifier"),!d,n,f).decorate(a)}),g){new c(m,!0).decorate(e("#comments-list.line-commenting > li.new-comment")),d.decorateThreads(m,g);var _=e("#general-comments .comment-count"),y=e("#comments-list");new l(_,y).decorate()}e("#commit-files-summary").on("click",".comments-link",function(t){var i=e(t.target).data("file-path"),n=e(document.getElementById("chg-"+i)),r=n.find("li.comment").first().data("modelobj");r&&(r.scrollTo(),t.preventDefault())}),e("#commit-files-summary .count-badge").each(function(t,i){var n=e(i),r=n.find(".count"),o=e(document.getElementById("chg-"+n.find(".comments-link").data("file-path")));new l(r,o).decorate()}),a.setupDeferredDiffMarkers(b,g,m)}};e(u),e(document).on("pjax:end",u)}),define("repo/source/index",["aui","jquery","on-ready","components/branches/checkout-dialog","utils/dialog-positions","utils/localize","utils/mustache","utils/ready","utils/gaq-push","repo/index","repo/source/create-file","repo/source/delete-file","repo/source/diff-file","repo/source/editor","repo/source/embed","repo/source/list","repo/source/rename-file","repo/source/view-file","components/branch-dialog","components/diff/index"],function(e,t,i,n,r,o,s,a,l){return i(function(){var i=t(document),c=t("#source-container");a("#new-file-button",function(e){e.on("click",function(){l(["atl._trackEvent","Online editing","New file"])})}),a("#inline-image",function(e){function i(i){var r=t('<img src="" alt="">');r.attr("src",n.attr("href")),r.prependTo(e),n.remove(),i.preventDefault()}var n=e.find("a.show-image");n.click(i)});var d={container:"#source-container",timeout:5e3};c.pjax(".pjax-trigger",d),c.on("pjax:send",function(){c.addClass("has-mask")}),c.on("pjax:complete",function(){c.removeClass("has-mask")}),i.pjax("#inline-dialog-changesets-dialog .file-history-widget a",d),i.pjax("#inline-dialog-branch-dialog .filter-list a",d),i.on("pjax:start",function(){t("#inline-dialog-branch-dialog").remove(),t("#inline-dialog-changesets-dialog").remove(),t("#inline-dialog-diff-dialog-diff1").remove(),t("#inline-dialog-diff-dialog-diff2").remove()}),i.on("pjax:timeout",function(){l(["atl._trackEvent","Source Browser","pjax timeout"])}),i.on("pjax:end",function(){o(),t(".tipsy:last").remove()}),a("#embed-link",function(i){function n(e,i,n){var r=t(i);if(!e.find(".embed").length){var o=s.toHtml("embed-template",{url:r.attr("href")});e.append(o)}n&&n(),setTimeout(function(){t("#embed-code").select()},0)}e.InlineDialog(i,"embed-dialog",n,{calculatePositions:r.alignRight()})}),a("#source-path",function(e){e.find(".add-file-link").tooltip({gravity:"w"})}),a("#checkout-branch-button",function(e){n(e,function(){return e.closest(".aui-buttons").find(".branch-dialog-trigger").attr("title")})})})}),define("repo/commits/pjax-options",[],function(){return{timeout:5e4}}),define("utils/create-comment-handler",["jquery","underscore","aui","data/current-user","utils/localize","utils/mustache"],function(e,t,i,n,r,o){return function(s,a){function l(){var t=w.children(".new-comment");t.find("textarea").val(""),t.find(".comment_id").val(""),t.find(".parent_id").val(""),w.find("button[type=submit]").removeAttr("disabled").removeAttr("aria-disabled");var i,n=window.location.hash,r=e("#comments-json");i=r.data("user-comments"),i&&i.length&&c(i,null,null,w),/^#comment-/.test(n)&&v(e(n).closest(".comment")),h()}function c(e,i,n,r){return t.each(e,function(t){if(t.parent_id===i){var o=d(t),s=c(e,t.comment_id,n,o.find(".child-comments"));!s&&t.deleted||"admin"!==y&&t.is_spam||(r.find(".new-comment").length?r.find(".new-comment").before(o):r.append(o))}}),t.any(e,function(e){return e.parent_id===i&&!e.deleted})}function d(t){var i;return t.deleted||("admin"!==y&&t.is_spam||_++,t.isAuthenticated=n.isAuthenticated,t.isEditable=n.username===t.username,t.isAdmin="admin"===y,t.utc_created_on=t.utc_created_on.replace(" ","T")),i=e("<li></li>").html(o.toHtml("comment-template",t)),i.addClass("comment"),i.find("time").data("title",!0).localize(),r(),i}function h(){e("#comments-count").text(_)}function u(){t.each(w.children(),f)}function f(t){for(var i=e(t),n=i.children(".deleted")&&1===i.children(".deleted").length,r=i.children(".child-comments").children(),o=!1,s=0;s<r.length;s++)f(r[s])||(o=!0);return n&&!o?(i.remove(),!0):!1}function p(e,t){e.find("p.err0r").text(t)}function m(e){p(e,"")}function g(e){p(e,"Comments can't be empty! Please enter some text.")}function v(e){w.find(".highlight").removeClass("highlight"),e.addClass("highlight")}function b(){w.find(".highlight").removeClass("highlight"),w.find(".focused").removeClass("focused"),w.find(".editor textarea").blur(),w.find(".comment .editing").each(function(){e(this).removeClass("editing")}),w.find(".comment .replying").each(function(){e(this).removeClass("replying")})}var _=0,y=e("#user-repo-privilege-data").data().priv,w=a.find("#comments-list:not(.line-commenting)");return w.delegate(".reply-link","click",function(t){var i,n;b(),i=e(this).closest(".comment article"),n=i.next(".child-comments");var r;0==n.children(".new-comment").length?(r=w.children(".new-comment").clone(),n.prepend(r)):r=n.children(".new-comment"),i.addClass("replying"),r.find(".parent_id").val(i.data("commentId")),m(i),r.find("textarea").focus(),t.preventDefault()}),w.delegate(".edit-link","click",function(t){var i,n,r,o;b(),o=e(this).closest(".comment article"),r=o.data("content"),0==o.children(".editor").length?(i=w.children(".new-comment").find(".editor").clone(),o.find(".comment-content").after(i)):i=o.children(".editor"),n=i.find("textarea"),n.data("originalComment",r),n.val(r),i.find(".comment_id").val(o.data("commentId")),o.addClass("editing"),m(o),n.focus(),t.preventDefault()}),w.bind("keydown",function(e){var t=i.keyCode;e.keyCode===t.ESCAPE&&(b(),e.preventDefault())}),w.find(".editor").on("keydown",'button[type="submit"]',function(t){13===t.keyCode&&e(this).closest("form.editor").submit()}).on("submit",function(t){var i,n,r=e(this),o=r.closest("form.editor"),a=o.find(".parent_id").val(),l=o.find(".comment_id").val(),c=o.find("textarea"),u=c.val();if(r.attr("aria-disabled",!0).attr("disabled",!0),null==u||""===u)return g(o),c.focus(),r.removeAttr("aria-disabled").removeAttr("disabled"),void t.preventDefault();m(o);var f={parent_id:a,content:u};l?(i="PUT",n=s.toString(l)):(i="POST",n=s.toString()),e.ajax({type:i,url:n,data:f,dataType:"json",success:function(t){if(l){var i=e("#comment-"+l);i.find(".comment-content").html(t.content_rendered),i.removeClass("editing")}else{var n,o=d(t);if(o.hide(),a){var s=e("#comment-"+a);n=s.next(".child-comments"),n.append(o),s.removeClass("replying")}else n=w.children(".new-comment"),n.before(o);v(o),o.fadeIn("fast")}c.val(""),r.removeAttr("aria-disabled").removeAttr("disabled"),w.find(".focused").removeClass("focused"),h()},error:function(){p(o,"An error occurred while submitting this comment."),r.removeAttr("aria-disabled").removeAttr("disabled")}}),t.preventDefault()}),w.delegate(".delete-link","click",function(t){if(confirm("Are you sure you want to remove this comment?")){var i=e(this).closest("article").data("commentId");e.ajax({type:"DELETE",url:s.toString(i),dataType:"json",success:function(){var t=e("#comment-"+i);t.replaceWith('<div class="deleted">Comment deleted</div>'),u(),_--,h()},error:function(){alert("There was an error removing the comment.")}})}t.preventDefault()}),w.delegate(".editor","focus",function(){var t=e(this).closest(".editor");w.find(".focused").removeClass("focused"),t.addClass("focused")}),w.delegate(".permlink","click",function(){v(e(this).closest(".comment"))}),{initializeComments:l}}}),define("repo/commits/comments",["jquery","on-ready","data/current-cset","data/current-repo","utils/api-helper","utils/create-comment-handler"],function(e,t,i,n,r,o){return t(function(){var t=e("#commit");o(r.concat("repositories",n.owner.username,n.slug,"changesets",i,"comments"),t).initializeComments()})}),define("components/participants/approve-button",["aui","backbone","data/current-user","utils/gaq-push"],function(e,t,i,n){var r=i.username;return t.View.extend({initialize:function(){this.$button=this.$el,this.collection.bind("reset",this.render,this),this.collection.bind("participants:refresh",_.bind(this.render,this))},events:{click:"toggle"},toggle:function(t){t.preventDefault();var i=this.$button,n=this.collection,o=n.approved(r);if(!i.hasClass("disabled")){i.addClass("disabled"),i.prop("disabled",!0),i.attr("aria-disabled",!0);var s=setTimeout(function(){i.addClass("loading")},300),a={success:function(){n.fetch({reset:!0,complete:function(){clearTimeout(s),i.removeClass("disabled loading"),i.prop("disabled",!1),i.attr("aria-disabled",!1)}}),n.trigger("approved",!o)},error:function(t,i){e.messages.error({body:i.responseText})},wait:!0};o?(this.analytics(!1),n.find(function(e){return e.get("username")==r}).destroy(a)):(this.analytics(!0),n.create({username:r},a))}},render:function(){var e=this.collection.approved(r);this.$button.find("span").text(gettext(e?"Unapprove":"Approve"))},analytics:function(e){n(["atl._trackEvent","Approvals",this.collection.noun,e?"Approved":"Unapproved"])}})}),define("utils/api-utc-to-date",[],function(){return function(e){var t={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},i=/(\d{4})-(\d{2})-(\d{2})[ |T](\d{2}):(\d{2}):(\d{2})(\+\d{2}:\d{2})?/,n=e.match(i);return new Date("{} {} {} {}:{}:{} UTC".format(n[3],t[n[2]],n[1],n[4],n[5],n[6]))}}),define("components/participants/participant",["backbone","jquery","underscore","utils/api-utc-to-date","jquery-plugins/jquery.localize"],function(e,t,i,n){return e.Model.extend({idAttribute:"username",isNew:function(){return!this.get("last_updated_on")},parse:function(e){return e.user?i.extend({last_updated_on:(new Date).toISOString(),approved:e.user.approved,reviewers:!0,avatar:e.user.links.avatar.href},e.user):e},toJSON:function(){var i=e.Model.prototype.toJSON.call(this);return i.date=this.get("last_updated_on")?t.localize(n(this.get("last_updated_on"))):void 0,i.hasComments=!!this.get("comments"),i},url:function(){return this.collection.likesUrl}})}),define("components/participants/participants",["backbone","underscore","components/participants/participant","utils/api-utc-to-date"],function(e,t,i,n){return e.Collection.extend({model:i,initialize:function(e,t){t=t||{},this.url=t.url,this.likesUrl=t.likesUrl,this.noun=t.noun},comparator:function(e){var t=(new Date).getTime(),i=e.get("last_updated_on");return[e.get("approved")?1:0,i?n(i).getTime():t]},includes:function(e,i){return i=i||this,t.any(i,function(t){return t.get("username")===e})},approved:function(e){return this.some(function(t){return t.get("username")===e&&t.get("approved")})},lastNParticipants:function(e,i,n){function r(e){return e.get("username")===i}var o=this.filter(n);if(o.length<=e)return o;var s=t.tail(o,o.length-e),a=i&&this.includes(i,o);return a&&!t.find(s,r)&&(s.shift(),s.unshift(t.find(o,r))),s},remainingParticipants:function(e,i,n){function r(e){return e.get("username")===i}function o(e){return e.get("username")!==i}var s=this.filter(n);return s.length<=e?[]:(t.find(s,r)&&(s=t.filter(s,o),e-=1),t.initial(s,e))}})}),define("components/participants/helpers",["jquery","underscore","components/participants/participants","utils/api-utc-to-date","utils/dialog-positions","utils/mustache"],function(e,t,i,n,r,o){return{showParticipantsDialog:function(i,n,r,o){i.html(""),i.addClass("show-participants-dialog");var s=e("<ol></ol>");i.append(s),t.each(n,function(e){s.append(this.participantHtml(e,r))},this),o&&o()},participantHtml:function(t,i,r){var s=t.attributes;return s.date=t.get("last_updated_on")?e.localize(n(t.get("last_updated_on"))):void 0,s.size=r||"small",s.noun=i,e(o.toHtml("participant-template",s))},collectionFrom:function(t,n){var r=e.Deferred(),o=new i([],{url:t.data("participants-url"),likesUrl:t.data("likes-url"),noun:t.data("noun")});return n=n||24,o.fetch({reset:!0,data:{avatar_size:n},success:function(e){r.resolve(e)}}),r},centerAlignDialogOptions:{width:"auto",calculatePositions:r.alignCenter()},rightAlignDialogOptions:{width:"auto",calculatePositions:r.alignRight()},leftAlignDialogOptions:{width:"auto",arrowOffsetX:-8}}}),define("components/participants/participants-strip",["backbone","underscore","components/participants/helpers","utils/mustache"],function(e,t,i,n){return e.View.extend({initialize:function(e){this.condition=e.condition||function(){return!0},this.auiAvatarSize=e.auiAvatarSize,this.emptyTemplate=e.emptyTemplate,this.collection.bind("reset",this.render,this),this.collection.bind("participants:refresh",t.bind(this.refreshParticipants,this))},refreshParticipants:function(){this.collection.fetch({reset:!0})},render:function(){return this.renderAvatars(),this},processParticipantsList:function(e){return e},renderAvatarsCompleted:function(){},renderAvatars:function(){this.$el.empty(),this.$el.removeClass("loading");var e=this.collection.filter(this.condition),i=this.processParticipantsList(e);i.length?(this.$el.removeClass("empty"),i.reverse(),t.each(i,this.addAvatar,this)):(this.$el.addClass("empty"),this.emptyTemplate&&this.$el.append(n.toHtml(this.emptyTemplate))),this.renderAvatarsCompleted(e)},addAvatar:function(e){var t=i.participantHtml(e,this.collection.noun,this.auiAvatarSize);this.$el.append(t)}})}),define("components/participants/participants-strip-truncated",["aui","jquery","data/current-user","components/participants/helpers","components/participants/participants-strip"],function(e,t,i,n,r){return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),this.avatarLimit=e.avatarLimit||5,this.align=e.align},events:{"show-all.participants":"showAll"},processParticipantsList:function(e){var t=i.username,n=e.length>this.avatarLimit;return n&&(e=this.collection.lastNParticipants(this.avatarLimit-1,t,this.condition)),e},renderAvatarsCompleted:function(i){var r,o=this.$el,s=i.length-(this.avatarLimit-1);s>1&&(o.append(t('<li><a class="truncated-count aui-badge" href="#">{}</a></li>'.format(s))),r="right"===this.align?n.rightAlignDialogOptions:"center"===this.align?n.centerAlignDialogOptions:n.leftAlignDialogOptions,e.InlineDialog(o.find(".truncated-count"),"remaining-participants",function(e,t,i){o.trigger("show-all.participants",{container:e,callback:i})},r))},showAll:function(e,t){var r=this.collection.remainingParticipants(this.avatarLimit-1,i.username,this.condition),o=t.container,s=t.callback;n.showParticipantsDialog(o,r,this.collection.noun,s)}})}),define("repo/commits/commit-header",["aui","jquery","on-ready","components/participants/approve-button","components/participants/helpers","components/participants/participants-strip-truncated","components/diff/index"],function(e,t,i,n,r,o){return i(function(){var i=t("#commit-header"),s=t("#watch-commit-icon"),a=i.find(".participants");r.collectionFrom(a).done(function(e){new o({el:i.find("#participants").find("ol"),collection:e,avatarLimit:6,align:"right"}).render(),new n({el:i.find(".approve-button"),collection:e}).render(),e.bind("approved",function(e){e&&i.find("a.follow").trigger("toggle-follow",{type:"commit",isNowFollowing:!0})}),t(document).on("comment-added",function(){e.trigger("participants:refresh"),i.find("a.follow").trigger("toggle-follow",{type:"commit",isNowFollowing:!0})})}),i.on("follow:commit","a.follow",function(e,t){s.toggleClass("aui-iconfont-watch",t).toggleClass("aui-iconfont-unwatch",!t)});var l=["parents","branches","tags"];t.each(l,function(i,n){e.InlineDialog(t(".truncated-"+n+"-count"),"extra-"+this,function(e,i,r){e.append(t(".extra-"+n)),r&&r()})})})}),define("components/filter/search",["jquery","utils/query-params","jquery-plugins/jquery.pjax"],function(e,t){return function(i){var n,r=i.$pjaxContainer,o=i.$controls,s=o.find('input[type="search"]'),a=e.extend({},{timeout:3e4},i.pjaxOptions);s.on("keyup",function(t){clearTimeout(n);var i=e(this);if(13!=t.keyCode&&i.val()!=e("#corrected-search").attr("data-value")){var r=i.closest("form");n=setTimeout(function(){r.submit()},300)}}),e.browser.webkit&&s.on("search",function(){var t=e(this);t.val()||t.closest("form").submit()}),r.on("pjax:start",function(){r.find(".maskable").addClass("has-mask")}).on("pjax:end",function(){r.find(".maskable").removeClass("has-mask"),s.focus()}),t.ignore(i.ignoreQuery),o.on("submit",function(i){i.preventDefault();var n=e(this),o=n.attr("data-url"),s=n.find("input").val(),l=n.attr("data-search-term");e.pjax(e.extend({},a||{},{container:r,url:t.update(l,s).asUrl(o)}))})}}),define("repo/commits/filter",["jquery","on-ready","components/filter/search","repo/commits/pjax-options"],function(e,t,i,n){return t(function(){var t=e("#commit-filter"),r=t.find("a.help"),o=e("#commit-filter-help");i({$pjaxContainer:e("#commits").find(".commits-container .pjax"),$controls:t,pjaxOptions:n,ignoreQuery:"page"}),r.on("click",function(t){t.preventDefault(),o.toggleClass("hidden"),e(t.target).toggleClass("bb-inline-dialog-anchor")}),t.on("submit",function(){o.addClass("hidden"),r.find("span").removeClass("bb-inline-dialog-anchor"),e(".more-action-menu.active").trigger("aui-button-invoke")})})}),define("utils/svg",[],function(){return function(e,t){function i(e,t,i){var n=document.createElementNS(d,"linearGradient"),r=c.querySelector("defs")||c.insertBefore(document.createElementNS(d,"defs"),c.firstChild);t=t||{},n.setAttribute("id",e),n.setAttribute("spreadMethod","pad"),n.setAttribute("gradientUnits","userSpaceOnUse");for(var o in t)t.hasOwnProperty(o)&&n.setAttribute(o,t[o]);for(var s=0;s<i.length;s++){var a=i[s],l=document.createElementNS(d,"stop");for(var h in a)a.hasOwnProperty(h)&&l.setAttribute(h,a[h]);n.appendChild(l)}return r.appendChild(n)}function n(e,t,i,n){var r=document.createElementNS(d,"circle");return r.setAttribute("cx",t||75),r.setAttribute("cy",i||75),r.setAttribute("r",e),r.setAttribute("fill",n||h.fill),c.appendChild(r),r}function r(e,t){var n,r=document.createElementNS(d,"path");return r.setAttributeNS(null,"d",e),t.stops&&(n="gradient-"+u++,i(n,t.coords,t.stops),t="url(#"+n+")"),r.setAttribute("fill","none"),r.setAttribute("stroke-width","1"),r.setAttribute("stroke",t||h.stroke),c.appendChild(r),r}function o(e,t){return"M"+e+","+t}function s(e,t){return"L"+e+","+t}function a(e,t,i,n){var r=e,o=(n-t)/2+t,s=i,a=n-(n-t)/2;return"C"+r+","+o+" "+s+","+a+" "+i+","+n}function l(e,t,i){var n=e[0],l=e[1],c=t[0],d=t[1],h=[];return h.push(o(n,l)),h.push(n===c||l===d?s(c,d):a(n,l,c,d)),r.call(this,h.join(" "),i)}var c=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=c.namespaceURI,h={fill:"#707070",stroke:"#999999"},u=0;return c.setAttribute("id",e),t&&t.appendChild(c),{circle:n,connect:l,get:function(){return this.svg},gradient:i,path:r}}}),define("repo/commits/graph",["jquery","utils/svg"],function(e,t){return function(i){var n=[[153,153,0],[0,153,0],[0,153,153],[0,0,153],[153,0,153],[153,153,0],[0,0,0]],r=[[191,191,64],[64,191,64],[64,191,191],[64,64,191],[191,64,191],[191,191,64],[64,64,64]];this.offset=i.offset||0,this.svg=t(i.id||"commit-graph-svg",document.getElementById("commit-graph")),this.columns=0,this.bg=[0,4],this.cell=[2,0],this.topPadding=i.topPadding||2,this.rowHeight=i.rowHeight||19,this.columnWidth=i.columnWidth||8,this.isLegacy=!!i.useLegacyRendering,this.getColor=function(e,t){var i=t?n:r,o=i[e%i.length];return"rgb("+o.join(", ")+")"},this.getWidth=function(){return this.columnWidth*this.columns},this.drawCircle=function(e){return this.svg.circle(e.radius,e.x,e.y,this.getColor(e.color,!1))},this.drawPath=function(e){this.svg.connect(e.from,e.to,e.color)},this.getRowElement=function(t){return e("#chg_"+t+" :first-child")},this.drawEdge=function(e,t,i,n){var r,o=this.getRowElement(e),s=o.position().top+this.topPadding,a=this.offset+this.columnWidth*t,l=s+o.outerHeight()+1,c=this.offset+this.columnWidth*i;return this.isLegacy&&(a=400-a,c=400-c),0===e?(s-=20,r={coords:{x1:c,y1:l,x2:a,y2:s}}):e===this.commitCount-1&&(l+=20,r={coords:{x1:a,y1:s,x2:c,y2:l}}),r&&(r.stops=[{offset:0,"stop-color":this.getColor(n,!0),"stop-opacity":1},{offset:"80%","stop-color":this.getColor(n,!0),"stop-opacity":0}]),this.drawPath({from:[a,s+1],to:[c,l],color:r||this.getColor(n,!0)}),this},this.drawNode=function(e,t,i,n){var r=3,o=this.getRowElement(t),s=o.position().top+this.topPadding,a=this.offset+this.columnWidth*i;return this.isLegacy&&(a=400-a),this.drawCircle({radius:r,x:a,y:s,color:n}).setAttribute("title",e),this},this.render=function(t){var i=e("#commit-graph-svg"),n=t.length;i.empty(),this.commitCount=n;for(var r=0;n>r;++r){var o=t[r];if(o){var s=o[0],a=o[1],l=a[0],c=a[1],d=o[2],h=this.getRowElement(r);this.cell[1]+=h.outerHeight(),this.bg[1]+=this.rowHeight,this.columns=this.columns<d.length?d.length:this.columns;for(var u=0,f=d.length;f>u;++u){var p=d[u],m=p[0],g=p[1],v=this.colorIdx||p[2];this.drawEdge(r,m,g,v)}0!=r&&this.drawNode(s,r,l,c)}}return i.attr("width",this.getWidth()),this}}}),define("repo/commits/list",["aui","jquery","on-ready","components/branches/checkout-dialog","repo/commits/graph","utils/mustache"],function(e,t,i,n,r,o){function s(e,i){var n,o,s=i.parent().height()+80,l="commit-graph-svg",c={id:l,topPadding:16,offset:5};a=JSON.parse(i.attr("data-graph")),a&&a.length&&(i.height(s),n=new r(c).render(a,e.hasClass("expandable")),o=n.getWidth(),t("#"+l).attr("height",s).attr("width",o),e.width(o+10))}var a;return i(function(){function i(e,i,n){r.refresh(),e.html(o.toHtml("unmapped-author-dialog",{link:t(i).attr("href"),raw_author:t(i).data("raw-author")})),n&&n()}var r,a=t(".commit-list"),l=t("#checkout-branch-button");r=e.InlineDialog(a.find("a.unmapped-user"),"unmapped-user",i),n(l,function(){return l.closest(".aui-buttons").find(".branch-dialog-trigger .name").text()}),s(t("#commit-graph-container"),t("#commit-graph"))})}),define("repo/commits/index",["aui","jquery","on-ready","repo/commits/pjax-options","utils/localize","components/branch-dialog","repo/index","repo/commits/comments","repo/commits/commit-header","repo/commits/filter","repo/commits/list","jquery-plugins/jquery.pjax"],function(e,t,i,n,r){return i(function(){var i=t("#commits"),o=i.find(".pjax"),s=t("#commit-filter");n.container=o,i.pjax(".paginator a",n),i.pjax(".commit-list .commit-labels a",n),i.pjax("#show-all",n),i.pjax("#branches-list a.branch-name",n),t(document).pjax("#inline-dialog-branch-dialog .filter-list a",n),t(document).bind("pjax:start",function(){o.addClass("has-mask"),t("#inline-dialog-branch-dialog").remove()}),t(document).bind("pjax:timeout",function(){e.messages.error({body:"Request has timed out. Refreshing..."})}),t(document).bind("pjax:end",function(e){o.removeClass("has-mask"),a(t(e.relatedTarget)),r()});var a=function(e){if(s.addClass("hidden").removeClass("front-filter"),e.closest(".branch-selector").length&&s.find("input").val(""),!o.find("#show-all").length){s.removeClass("hidden").addClass("front-filter");var i=t("#corrected-search").attr("data-value"),n=s.find("input");i&&"tip"!=i&&!n.is(":focus")&&n.val(i)}}})}),define("utils/format-select2-with-title-text",["underscore"],function(e){return function(t,i){return i.attr("title",t.text),e.escape(t.text)}}),define("utils/parse-compare-spec",[],function(){return function(e){var t=e.split(":");return{repo:t.shift(),hash:t.shift()||null,branch:t.join(":")||null}}}),define("repo/branches/compare",["aui","jquery","on-ready","underscore","components/merge-dialog","data/current-repo","utils/format-select2-with-title-text","utils/mustache","utils/parse-compare-spec"],function(e,t,i,n,r,o,s,a,l){return i(function(){function e(e,i){return s(e,i),a.toHtml("repo-avatar-template",{name:e.text,size:16,avatar_url:t(e.element).attr("data-avatar-url")})+e.text}function i(e,t,i){i.removeAttr("id").hide().filter('[data-repo="{}"]'.format(t)).attr("id","id_{}".format(e)).prev(".select2-container").show()}function n(e,i){var n=l(t("#id_{}".format(i)).val());e.find(".branch[data-field={}] .branch-badge".format(i)).find(".repo-name").attr("title",n.repo).html(a.toHtml("repo-avatar-template",{name:n.repo,size:16,avatar_url:t("#id_{}_repo option:selected".format(i)).attr("data-avatar-url")})+n.repo).end().find(".branch-name").attr("title",n.branch).text(n.branch)}function c(e){var t=e.find("#id_source option:selected"),i=e.find("#id_dest option:selected"),n=l(t.val()),r=l(i.val()),s=t.data("multiple-heads")?n.hash:n.branch,a=i.data("multiple-heads")?r.hash:r.branch;return s=encodeURIComponent(s),a=encodeURIComponent(a),(n.repo!==r.repo||n.repo!==o.fullslug)&&(s="{}:{}".format(n.repo,s),a="{}:{}".format(r.repo,a)),"{}..{}".format(s,a)}var d,h=t(".branch-compare"),u=h.attr("data-compare-url"),f=h.find(".compare-form"),p=f.data("auto-reload");f.find(".repo-select").auiSelect2({formatResult:e,formatSelection:e,dropdownAutoWidth:!0,dropdownCssClass:"select2-drop-wide",escapeMarkup:function(e){return e}}),f.find(".branch-select").auiSelect2({formatResult:s,dropdownAutoWidth:!0,dropdownCssClass:"select2-drop-wide"}),f.find(".branch").each(function(){var e=t(this),r=e.attr("data-field"),o=e.find(".repo-select"),s=e.find(".branch-select"),a=e.find("select.repo-select").val();i(r,a,s),o.on("change",function(){i(r,t(this).val(),s),n(f,r),p&&f.trigger("submit")}),s.on("change",function(){n(f,r),p&&f.trigger("submit")}),e.on("click",".toggle-link",function(n){t(n.target).remove(),e.find(".branch-badge").hide(),e.find(".select-lists").removeClass("hidden"),i(r,a,s)})}),f.find(".branch").on("click",".toggle-link",function(e){e.preventDefault()}),f.on("click",".swap-button",function(e){e.preventDefault();{var n=f.find(".branch.source"),r=f.find(".branch.destination"),o=n.find(".branch-badge").html(),s=r.find(".branch-badge").html(),a=t("#id_source_repo"),c=a.val(),d=t("#id_source").val(),h=(l(d),t("#id_dest_repo")),u=h.val(),m=t("#id_dest").val();l(m)}a.auiSelect2("val",u),i("source",u,n.find(".branch-select")),t("#id_source").auiSelect2("val",m),n.find(".branch-badge").html(s),h.auiSelect2("val",c),i("dest",c,r.find(".branch-select")),t("#id_dest").auiSelect2("val",d),r.find(".branch-badge").html(o),p&&f.submit()}),f.on("submit",function(e){e.preventDefault(),d=c(f),h.addClass("has-mask").on("pjax:end",function(){h.removeClass("has-mask")}),t.pjax({url:u.replace("::spec",d),container:h,timeout:3e4})});var m=h.find(".content-container"),g=m.find(".merge-button"),v=m.find(".sync-link"),b=m.attr("data-source-repo"),_=m.attr("data-dest-repo"),y=m.attr("data-source-repo-avatar"),w=m.attr("data-dest-repo-avatar"),x=m.attr("data-source-branch"),k=m.attr("data-dest-branch"),C=m.data("source-is-mainbranch"),$=m.data("dest-is-mainbranch"),D=(m.data("has-source-access"),m.data("has-dest-access"),m.data("can-delete-dest")),T=m.attr("data-compare-source-value"),j=m.attr("data-compare-dest-value"),E=m.attr("data-merge-url"),S=m.attr("data-sync-url"),q=m.attr("data-sync-conflict-url");r(g,{getData:function(){return commitMessageSlug=b===_?x:C&&$?b:"{}/{}".format(b,x),{action:E,source:T,sourceBranch:x,sourceRepo:b,sourceAvatar:y,sourceAvatarAltText:b,dest:j,destBranch:k,destRepo:_,destAvatar:w,destAvatarAltText:_,sameRepo:b===_,canCloseBranch:b===_&&!C&&D,hasConflicts:!1,mergeCommands:t("#merge-commands-content").html(),commitMessageSlug:commitMessageSlug}}}),r(v,{conflictUrl:q,getData:function(){return commitMessageSlug=b===_?k:C&&$?_:"{}/{}".format(_,k),{syncBranch:!0,action:S,source:j,sourceBranch:k,sourceRepo:_,sourceAvatar:w,sourceAvatarAltText:_,dest:T,destBranch:x,destRepo:b,destAvatar:y,destAvatarAltText:b,sameRepo:b===_,canCloseBranch:!1,hasConflicts:!1,mergeCommands:t("#merge-commands-content").html(),commitMessageSlug:commitMessageSlug}
}})})}),define("repo/branches/compare-metadata",["aui","jquery","on-ready","components/participants/participants","components/participants/participants-strip-truncated","data/current-repo","utils/dialog-positions","utils/exists"],function(e,t,i,n,r,o,s,a){return i(function(){function i(e,t,i,n,r){var o=e.closest("dd");return o.offset().left+o.outerWidth()-i+r.offsetX}var l=t(".content-container"),c=l.find(".compare-metadata"),d=t("#participants").find("ol"),h=("{}/{}".format(o.owner.username,o.slug),c.data("contributors"));new r({el:d,collection:new n(h),avatarLimit:5,avatarSize:24,align:"center"}).render(),a(".pr-dialog-trigger",function(t){e.InlineDialog(t,"pr-dialog",function(e,t,i){return c.find(".pr-dialog").appendTo(e).show(),i(),!1},{width:"auto",calculatePositions:s.alignTo(i)})}),a(".issue-dialog-trigger",function(t){e.InlineDialog(t,"issue-dialog",function(e,t,i){return c.find(".issue-dialog").appendTo(e).show(),i(),!1},{width:"auto",calculatePositions:s.alignTo(i)})}),c.find(".restrictions span").tooltip()})}),define("repo/branches/compare-tabs",["jquery","on-ready","components/diff/context-expander","components/diff/diff-actions-2","utils/mustache","utils/query-params"],function(e,t,i,n,r,o){return t(function(){function t(){if(!l.data("has-changes"))return void l.removeClass("has-mask").html("<p>There are no changes.</p>");var t=e.ajax({url:"{}?file={}".format(l.attr("data-diff-url"),o.get("file")),type:"GET",dataType:"html"});t.done(function(t){l.removeClass("has-mask").html(t),l.find(".bb-patch-unified .bb-udiff").each(function(){var t=e(this),r=t.data("filename"),o=t.data("compare-files-url");new n(r,o).decorate(t.find(".diff-actions")),new i(t.data("expand-context-url")+encodeURI(r),t.data("identifier"),!1).decorate(t)})}),t.fail(function(){l.removeClass("has-mask").html("<h2>Error</h2><p>We were unable to load this page.</p>")})}var s=e("#commit-list-container").data("changesets-limited"),a=e("#diff-tab"),l=e("#diff-content");a.one("click","a",function(){s?(l.removeClass("has-mask"),l.append(r.toHtml("diff-too-large-template",{sourceHash:l.attr("data-source-hash"),destHash:l.attr("data-dest-hash")}))):t()}),"#diff"===window.location.hash&&a.find("a").click()})}),define("components/alert-dialog",["jquery","components/modal-dialog"],function(e,t){var i={title:"Error"};return function(n){var r,o=e.Deferred();return r="string"==typeof n?{content:n}:n,t(e.extend(i,r),o).show(),o.promise()}}),define("components/branches/delete",["jquery","data/current-repo","components/confirm-dialog"],function(e,t,i){return function(n,r){var o,s=new e.Deferred;return n.on("click",function(n){if(n.preventDefault(),!e(n.target).hasClass("disabled")){var a;"hg"==t.scm?(o=gettext("Close branch"),a=gettext("Are you sure you want to close %(branch_name)s?")):(o=gettext("Delete branch"),a=gettext("Are you sure you want to delete %(branch_name)s?")),i({title:o,content:interpolate(a,{branch_name:r.branch},!0)}).done(function(){e.ajax(r.apiUrl,{dataType:"json",type:"DELETE"}).done(function(){s.resolve(r.branch)}).fail(function(){s.reject(r.branch)})})}}),s}}),define("components/branches/merge",["components/merge-dialog"],function(e){return function(t,i){var n=new $.Deferred;return e(t,{id:"merge-"+i.destination,conflictUrl:i.conflictUrl,getData:function(){return{action:i.action,mergeEvent:i.mergeEvent||!1,source:i.source||"{}::{}".format(i.repository,i.sourceBranch),sourceBranch:i.sourceBranch,sourceRepo:i.repository,dest:i.dest||"{}::{}".format(i.repository,i.destBranch),destBranch:i.destBranch,destRepo:i.repository,sameRepo:!0,canCloseBranch:!1,hasConflicts:!1,mergeCommands:"",commitMessageSlug:i.sourceBranch,syncBranch:!!i.syncBranch}},success:function(){n.resolve(i.destBranch,i.sourceBranch)}}),n}}),define("repo/branches/detail",["jquery","on-ready","components/alert-dialog","components/merge-dialog","components/branches/checkout-button","components/branches/checkout-dialog","components/branches/delete","components/branches/merge","data/current-repo","data/current-user","utils/exists","utils/message-helper","utils/mustache","jquery-plugins/jquery.pjax"],function(e,t,i,n,r,o,s,a,l,c,d,h){return t(function(){var t=e(".content-container"),u=t.attr("data-merge-url"),f=t.attr("data-sync-url"),p=t.attr("data-compare-source-value"),m=t.attr("data-compare-dest-value"),g="{}/{}".format(l.owner.username,l.slug),v=t.attr("data-source-branch"),b=t.attr("data-source-hash"),y=t.data("has-multiple-heads"),w=t.attr("data-dest-branch"),x=t.data("has-source-access"),k=t.data("has-dest-access"),C=t.data("can-delete"),$=t.data("has-conflicts");d(".blank-slate-checkout-button",function(e){r(e,{cloneUrl:e.attr(c.isSshEnabled?"data-ssh-url":"data-https-url"),branchName:v,scm:l.scm})}),d(".checkout-button",function(e){o(e,function(){return v})}),k&&n(t.find(".merge-button"),{id:"merge-"+w,conflictUrl:t.attr("data-merge-conflict-url"),getData:function(){return{action:u,mergeEvent:"detail:merge",source:p,sourceBranch:v,sourceRepo:g,dest:m,destBranch:w,destRepo:g,sameRepo:!0,canCloseBranch:C,hasConflicts:$,mergeCommands:$&&e("#merge-commands-content").html(),commitMessageSlug:y?"{} ({})".format(v,b):v}}}),x&&d(".sync-link",function(e){a(e,{action:f,mergeEvent:"detail:sync",repository:g,dest:p,destBranch:v,source:m,sourceBranch:w,conflictUrl:t.attr("data-sync-conflict-url"),syncBranch:!0}).done(function(){h.addMessage("{} successfully synced with {}.".format(v,w)),window.location.reload(!0)})}),C&&s(e(".delete-link"),{branch:v,apiUrl:t.attr("data-delete-url")}).done(function(e){var i;i="hg"===l.scm?"{} successfully closed.".format(e):"{} successfully deleted.".format(e),h.addMessage(i),window.location=t.attr("data-branch-list-url")}).fail(function(e){var t;t="hg"===l.scm?"Failed to close {}.".format(e):"Failed to delete {}.".format(e),i(t)}),e(".compare-choices .branch.destination").on("click",".toggle-link",function(i){i.preventDefault();var n=e(i.delegateTarget),r=t.attr("data-branches-api-url"),o=t.attr("data-branch-detail-url"),s=e("<select/>");n.addClass("loading"),e.getJSON(r).done(function(t){s.append(_.map(t,function(t){return t===w?e('<option selected="selected"/>').text(t)[0]:e("<option/>").text(t)[0]})),n.removeClass("loading").empty().append(s),s.auiSelect2()}),s.on("change",function(){var t=e("#branch-detail");t.addClass("has-mask").on("pjax:end",function(){t.removeClass("has-mask")}),e.pjax({url:"{}?dest={}".format(o,encodeURIComponent(e(this).val())),container:t,timeout:3e4})})})})}),define("repo/branches/list",["on-ready","jquery","underscore","components/branches/delete","components/branches/merge","data/current-repo","components/alert-dialog","utils/message-helper","utils/mustache"],function(e,t,i,n,r,o,s,a,l){return e(function(){function e(){var e,n=t(".ahead .value, .behind .value");n.length&&(e=t(i.max(n,function(e){return t(e).data("value")})).data("value"),n.each(function(){var i=t(this),n=100*Math.sqrt(i.data("value")/e);i.siblings(".graph").animate({width:n+"%"})}))}function c(){t.ajax({url:m}).done(function(n){"calculating"===n.status?i.delay(function(){c()},1e3):"ready"===n.status&&(d.find("tbody > tr").each(function(){var e=t(this),r=e.attr("data-branch-name"),o="{}:{}".format(r,e.attr("data-branch-hash")),s=n.data[o],a=i.extend(s,{mainbranch:p,name:r,aheadOrBehind:s.ahead>0||s.behind>0}),c=l.toHtml("behind-cell-template",a),d=l.toHtml("ahead-cell-template",a);e.find(".behind").replaceWith(c),e.find(".ahead").replaceWith(d)}),e(),h.removeClass("hidden"))})}var d=t("#list-branches"),h=t("#branch-filters");d.find("a.close-branch").each(function(e,i){var r=t(i);n(r,{branch:r.attr("data-branch"),apiUrl:r.attr("data-api-url")}).done(function(e){var t;t="hg"==o.scm?"{} successfully closed.".format(e):"{} successfully deleted.".format(e),a.addMessage(t);var i=d.find(".paginator .prev-page");0===i.length||d.find("li.branch").length>1?window.location.reload(!0):window.location.href=i.attr("href")}).fail(function(e){var t;t="hg"==o.scm?"Failed to close {}.".format(e):"Failed to delete {}.".format(e),s(t)})});var u=d.attr("data-compare-url"),f=d.attr("data-compare-slug"),p=d.attr("data-main-branch"),m=d.attr("data-meta-url"),g=d.data("has-cache");d.find("a.sync-branch").each(function(e,i){var n=t(i);r(n,{action:u,mergeEvent:"list:sync",repository:f,dest:n.attr("data-compare-value"),destBranch:n.attr("data-branch"),sourceBranch:p,conflictUrl:n.attr("data-conflict-url"),syncBranch:!0}).done(function(e,t){a.addMessage("{} successfully synced with {}.".format(e,t)),window.location.reload(!0)})}),d.find("a.merge-branch").each(function(e,i){var n=t(i);r(n,{action:u,mergeEvent:"list:merge",repository:f,destBranch:p,source:n.attr("data-compare-value"),sourceBranch:n.attr("data-branch"),conflictUrl:n.attr("data-conflict-url")}).done(function(e,t){a.addMessage("{} successfully merged into {}.".format(e,t)),window.location.reload(!0)})}),g?e():c(),h.find("a").tooltip()})}),define("components/filter/status",["jquery","utils/query-params","jquery-plugins/jquery.pjax"],function(e,t){return function(i){var n=i.$container,r=i.$pjaxContainer,o=e.extend({},{timeout:3e4},i.pjaxOptions);r.on("pjax:send",function(){r.find(".maskable").addClass("has-mask")}),r.on("pjax:complete",function(){r.find(".maskable").removeClass("has-mask")}),r.on("pjax:end",function(){var t=r.find("[data-current-status]").attr("data-current-status");n.find(".filter-control li").removeAttr("aria-pressed"),e("[data-status={}]".format(t)).parent("li").attr("aria-pressed","true")}),t.ignore(i.ignoreQuery),e.support.pjax&&n.on("click",".filter-control a",function(n){var s=e(this),a=s.attr("data-status"),l=s.attr("href");e.pjax.click(n,e.extend({},o,{container:r,url:t.update(i.filterTerm,a).asUrl(l)}))})}}),define("components/paginate",["jquery","jquery-plugins/jquery.pjax"],function(){return function(e,t){t=t||{},t.container=t.$pjaxContainer&&t.$pjaxContainer.length?t.$pjaxContainer:e,e.pjax(".aui-nav-pagination a",t).on("click",".aui-nav-pagination a",function(e){$(e.target).attr("aria-disabled")&&e.preventDefault()}),t.setMask!==!1&&e.on("pjax:send",function(){t.container.find(".maskable").addClass("has-mask")}).on("pjax:complete",function(){t.container.find(".maskable").removeClass("has-mask")})}}),define("repo/branches/filter",["on-ready","jquery","components/filter/status","components/filter/search","components/paginate","jquery-plugins/jquery.pjax"],function(e,t,i,n,r){return e(function(){var e=t("#list-branches"),o=t("#branch-pjax");i({$container:e,$pjaxContainer:o,filterTerm:e.find(".filter-control").attr("data-filter-term"),ignoreQuery:"page"}),n({$pjaxContainer:o,$controls:t("#branch-search"),ignoreQuery:"page"}),r(e,{$pjaxContainer:o,setMask:!1})})}),define("repo/branches/index",["repo/branches/compare","repo/branches/compare-metadata","repo/branches/compare-tabs","repo/branches/detail","repo/branches/list","repo/branches/filter"],function(){}),function(e,t){"function"==typeof define&&define.amd?define("utils/disable",["jquery"],t):t(e.jQuery)}(this,function(e){e.fn.disable=function(t){var i=e(this);return t=void 0===t?i.prop("disabled"):!!t,t?i.addClass("disabled").attr("disabled",!0).attr("aria-disabled",!0):i.removeClass("disabled").removeAttr("disabled aria-disabled"),this}}),define("components/branch-selector",["jquery","jquery-plugins/jquery.chosen"],function(e){return function(t,i){function n(){var n=i.filter('[data-repo="{0}"]'.format(t.val()));i.each(function(){e(this).removeAttr("name").findWidget().hide()}),n.attr({name:n.attr("data-field")}).findWidget().show(),n.trigger("bb:branch:change")}e.fn.findWidget=function(){var t=this.attr("id");if(!t)return this;var i=e("#"+t+"_chzn");return i.length?i:this},t.on("change",function(){e(this).trigger("bb:repo:change")}),i.on("change",function(){e(this).trigger("bb:branch:change")}),t.on("bb:repo:change",n),t.chosen({width:"100%"}),i.chosen({width:"100%"}),t.change()}}),define("components/compare",["jquery","data/current-repo","components/branch-selector","components/merge-dialog","components/diff/diff-actions-2","components/diff/context-expander","utils/api-helper","utils/parse-compare-spec","utils/gaq-push","jquery-plugins/jquery.chosen","jquery-plugins/jquery.pjax"],function(e,t,i,n,r,o,s,a,l){function c(e,t,i,n){return t!==e||n?"{0}{1}{2}".format(t,n?"+":":",encodeURIComponent(i)):encodeURIComponent(i)}var d=e("#compare-toolbar"),h=e("#compare-form"),u=function(e,t){var i='[data-repo="{0}"]'.format();return e.filter(i(t))},f=function(e,t,i){var n=a(t),r=a(i),o=h.find("#id_source_repo"),s=h.find("#id_dest_repo"),l=e.find('[data-field="source"]'),c=e.find('[data-field="dest"]'),d=u(l,n.repo),f=u(c,r.repo);d.val(t).trigger("liszt:updated"),f.val(i).trigger("liszt:updated"),o.val(n.repo).trigger("bb:repo:change").trigger("liszt:updated"),s.val(r.repo).trigger("bb:repo:change").trigger("liszt:updated")};e(".compare-widget-form:not(.deleted)").each(function(){var t=e(this),n=t.find(".repo-field"),r=t.find(".repo-avatar-link"),o=t.find(".branch-field"),s='[data-repo="{0}"]'.format();n.on("bb:compare:repo:change",function(){r.hide().filter(s(n.val())).show()}),n.on("bb:repo:change",function(){e(this).trigger("bb:compare:repo:change")}),o.on("bb:branch:change",function(){e(this).trigger("bb:compare:change")}),i(n.filter(":visible"),o),n.change()});var p=function(e,i,n){var r="{0}/{1}".format(t.owner.username,t.slug),o=a(i.val()),s=a(n.val()),l=i.data("multiple-heads")?o.hash:o.branch,d=n.data("multiple-heads")?s.hash:s.branch;return d?"{0}{1}..{2}".format(e,c(r,o.repo,l),c(r,s.repo,d)):"{0}{1}..{2}".format(e,c(r,o.repo,l,!0),s.repo)},m=e(".compare-widget-container"),g=e("#compare-content"),v=null,b=!0;g.on("pjax:error",function(e){e.preventDefault()}),g.on("pjax:start",function(){g.addClass("has-mask")}),g.on("pjax:end",function(){g.removeClass("has-mask"),g.find(".bb-patch-unified .bb-udiff, .comment-content .bb-udiff").each(function(){var t=e(this),i=t.data("filename"),n=t.data("compare-files-url");new r(i,n).decorate(t.find(".diff-actions")),new o(t.data("expand-context-url")+encodeURI(i),t.data("identifier"),!1).decorate(t)}),m.trigger("bb:compare:loaded"),e(document).trigger("bb:compare")}),m.bind("bb:compare:change",function(){var t=e(this),i=g.attr("data-full-url"),n=t.find('[name="source"] option:selected'),r=t.find('[name="dest"] option:selected');if(!i){if(!n.val()||!r.val()||t.data("compare-view-disabled"))return;i=p(g.attr("data-base-url"),n,r)}if(i+=window.location.hash,d.removeClass("has-conflicts"),m.data("pjax")&&e.support.pjax)e.pjax({container:"#compare-content",url:i,push:!b,scrollTo:null,timeout:0,state:{source:n.val(),dest:r.val()}});else{v&&v.readyState<4&&(v.onreadystatechange=e.noop,v.abort());var o=function(){g.trigger("pjax:start")},s=function(){g.trigger("pjax:end")},a=function(t){g.html(t),g.trigger("pjax:success"),e(document).trigger("bb:compare")};v=e.ajax({url:i,dataType:"html",beforeSend:o,complete:s,success:a})}b=!1});var _=function(e,t){var i=e.find('.menu-item a[href="{}"]'.format(t)).closest(".menu-item");0!==i.length&&(e.find(".menu-item.active-tab").removeClass("active-tab"),e.find(".tabs-pane.active-pane").removeClass("active-pane"),i.addClass("active-tab"),e.find(t+".tabs-pane").addClass("active-pane"))};e(window).on("hashchange",function(){_(e("#compare-tabs"),window.location.hash)}),e(document).bind("bb:compare",function(){e(function(){{var i=e("#compare-tabs"),n=e("#compare-content"),r=e("#changeset-diff"),o=e(".file-diff-placeholder"),a=m.find('[name="source"] option:selected'),c=m.find('[name="dest"] option:selected'),h=s.concat("repositories",t.owner.username,t.slug,"comparefiles").toString(),u=n.attr("data-files-url")||p(h,a,c),f=e("#compare-metadata"),g=f.data("has-conflicts");f.data("hasChanges")}1===m.length&&o.length&&new BitbucketPatch(o,u).render(r),e("#compare-toolbar .conflict-warning").tooltip(),d.toggleClass("has-conflicts",g),window.location.hash&&_(i,window.location.hash),AJS.tabs.setup(),i.find(".menu-item a").on("click",function(){window.location.hash=e(this).attr("href")}),i.on("click",'a[href="#diff"]',function(){l(["atl._trackEvent","Compare","Diff tab"])}).on("click",'a[href="#commits"]',function(){l(["atl._trackEvent","Compare","Commits tab"])})})});var y=e("#compare-create-pr"),w=e("#compare-merge"),x=m.data("pr-source-choices")||[],k=m.data("pr-dest-choices")||[],C=function(e,t){for(var i=a(e),n=null,r=0;r<t.length;++r){var o=t[r],s=a(o);if(i.repo==s.repo){if(i.hash==s.hash&&i.branch==s.branch)return o;null===n&&i.branch==s.branch&&(n=o)}}return n};e(document).bind("bb:compare",function(){var t=e(this),i=t.find('[name="source"]').val(),n=t.find('[name="dest"]').val(),r=e("#compare-metadata").data("hasChanges");if(0!==y.length&&x&&k){var o=C(i,x),s=C(n,k);o&&s&&r?(y[0].search="source={0}&dest={1}".format(o,s),y.removeClass("disabled").removeAttr("aria-disabled")):(y[0].search="",y.addClass("disabled").attr("aria-disabled",!0))}}),e(document).bind("bb:compare",function(){var t=e("#compare-metadata"),i=t.data("hasChanges"),n=t.data("hasWrite"),r=t.data("has-branch-write");n&&i&&r?w.removeClass("disabled").removeAttr("aria-disabled"):w.addClass("disabled").attr("aria-disabled",!0)}),y.bind("click",function(t){e(this).hasClass("disabled")&&t.preventDefault()}),w.length&&n(w,{getData:function(){var t,i=function(e){return e.find('[value="{}"]'.format(e.val()))},n=function(e,t){return e.filter('[data-repo="{}"]'.format(t)).find("img")},r=h.find('[name="source"]'),o=e("#compare-metadata"),s=i(r),a=s.text(),l=h.find("#id_source_repo").val(),c=h.find('[name="dest"]'),d=i(c),u=d.text(),f=h.find("#id_dest_repo").val(),p=h.find('label[for="id_source_repo"] .repo-avatar-link'),m=n(p,l),g=h.find('label[for="id_dest_repo"] .repo-avatar-link'),v=n(g,f),b=o.data("has-conflicts"),_=!o.data("has-branch-close"),y=!1;return t=l==f?a:d.data("mainbranch")&&a==u?l:"{}/{}".format(l,a),l!=f||s.data("mainbranch")||_||(y=!0),{action:document.location.pathname,source:r.val(),sourceBranch:a,sourceRepo:l,sourceAvatar:m.attr("src"),sourceAvatarAltText:m.attr("alt"),dest:c.val(),destBranch:u,destRepo:f,destAvatar:v.attr("src"),destAvatarAltText:v.attr("alt"),sameRepo:l==f,canCloseBranch:y,hasConflicts:b,mergeCommands:b&&e("#merge-commands-content").html(),commitMessageSlug:t}}}),h.find("#compare-swap-link a").click(function(e){e.preventDefault();var t=h.find('[name="source"]').val(),i=h.find('[name="dest"]').val();f(h,i,t),m.trigger("bb:compare:change")}),m.trigger("bb:compare:change")}),define("repo/pullrequests/form",["jquery","underscore","on-ready","data/current-repo","config/markitup","utils/check-task","utils/parse-compare-spec","utils/create-reviewer-autocomplete","utils/exists","utils/disable","components/compare","jquery-plugins/jquery.markitup"],function(e,t,i,n,r,o,s,a,l){return i(function(){function i(i){var n=u.find("select[name=source]"),r=h.find("select[name=dest]");if(!(i&&e(i.target).parents("#pull-into .branch-field-container").length||0===n.length||0===r.length)){var o=s(n.val()).branch,a=r.val();if(r.find('option[value$="::"]').remove(),0===r.find('option[value$=":'+o+'"]').length){var l='<option value="{0}::">{1} (new branch)</option>'.format(),c=e(l(m.val(),o)),d=t.sortedIndex(r.find("option").get(),c.get(),function(t){return e(t).text()});0===d?c.insertBefore(r.find("option").get(0)):c.insertAfter(r.find("option").get(d-1))}r.val(a).trigger("liszt:updated")}}function c(t,i){var n=t.find(".error");n&&0!==n.length||(n=e('<div class="error"></div>'),t.append(n));var r=e("<div></div>");r.text(i),n.append(r)}var d=e("#pullrequest-form"),h=d.find("#pull-into"),u=d.find("#pull-from"),f=d.find(".compare-widget-container"),p=d.find("#id_source_repo"),m=d.find("#id_dest_repo"),g=d.find("textarea");if(g.markItUp(r()),p.prop({disabled:!0}).trigger("liszt:updated").prop({disabled:!1}),function(){var t=e("#id_title"),i=e("#id_description");if(t.length&&i.length){var n=function(e){var t=e.data();return t.val=e.val(),function(i){e.val(t.val=i)}},r=n(t),o=n(i);e(document).bind("bb:compare",function(){var n=e("#compare-metadata"),s=0!==n.data("commit-count");if(d.find("button:submit").attr({disabled:!s,"aria-disabled":!s}),!d.hasClass("update")&&!d.data("has-errors")&&t.val()===t.data("val")&&i.val()===i.data("val")){var a=f.find('[name="source"]').val(),l=f.find('[name="dest"]').val(),c='ul[data-source="{0}"][data-dest="{1}"] li'.format(a,l),h=e(c,"#updateable-prs");1===h.length?(r(h.data("title")),o(h.data("description"))):1===n.data("commit-count")?(r(e("#compare-content").find(".commit-list td.text").text().trim()),o("")):(r(""),o(""))}})}}(),f.change(i),i(),e("#id_new_branch").prop("checked")===!0){var v=u.find("select[name=source]"),b=h.find("select[name=dest]");v.length&&b.length&&(b.val(b.find('option[value$="::"]').val()),b.change())}h.on("change","select[name=dest]",function(){var t=s(e(this).val()).branch;e("#id_new_branch").prop({checked:!t})}),l("#updateable-prs",function(t){var i=t.children("ul");if(0!==i.length){var n=function(){var n=e(this),r=n.find('[name="source"]').val(),o=n.find('[name="dest"]').val();if(r&&o){var s=i.filter('[data-source="'+r+'"]').filter('[data-dest="'+o+'"]');i.not(s).hide(),s.show(),s=s.children();var a=s.length;d.find("input:submit").val(1===a?"Update pull request #"+s.data("local-id"):"Send pull request"),t.addClass("hidden"),a&&t.removeClass("hidden").find("strong").text(a>1?a+" existing pull requests will be superseded":"An existing pull request will be updated")}};f.change(n).change()}}),l("#id_reviewers_group",function(e){a(e)}),d.on("submit",function(){var i=d.find("#participants"),n=i.find(".non-reviewer").detach(),r=d.serialize(),s=d.attr("action"),a=d.find("#submitPrButton"),l=d.find("#global-errors");return a.addClass("loading").disable(!0),d.find(".error:not(#global-errors)").empty(),l.addClass("hidden"),e.ajax({type:"POST",url:s,data:r,dataType:"json"}).done(function(r){r.errors?(t.each(r.errors,function(r,o){if("__all__"==o){l.removeClass("hidden");var s=l.find(".messages").empty();t.each(r,function(t){s.append(e("<li>").text(t))})}else{var a=d.find("#id_{}_group".format(o));t.each(r,function(e){i.prepend(n),c(a,e)})}}),a.removeClass("loading").disable(!1)):r.result?window.location=r.result:setTimeout(function(){o(r.url).fail(function(e){c(a.closest(".buttons-container"),e),a.removeClass("loading").disable(!1)})},1e3)}).fail(function(){c(a.closest(".buttons-container"),gettext("Something went wrong while creating your pull request.")),a.removeClass("loading").disable(!1)}),!1}),l("#id_close_anchor_branch",function(i){function r(e){l=i.prop("checked"),i.prop({checked:!1,disabled:!0}),a.addClass("disabled").attr({title:e})}var o=e("#pullrequest-form"),a=i.next("label"),l=null,c=function(){var c=s(o.find("select[name=source]").val()),d=e("#compare-metadata"),h=o.find("select[name=dest]"),u=(s(h.val()),!d.data("hasBranchClose"));if(a.html('Close <span class="branch-name">'+t.escape(c.branch)+"</span> after the pull request is merged"),u)r("Branch deletion is disabled for this branch");else{var f=c.branch===n.mainbranch.name;f?r("You're not permitted to close the main branch"):(i.prop({disabled:!1}),null!==l&&(i.prop("checked",l),l=null),a.removeClass("disabled").removeAttr("title"))}};f.bind("bb:compare:loaded",c),r("Loading pull request details")})})}),define("repo/pullrequests/list",["on-ready","jquery","components/filter/status"],function(e,t,i){return e(function(){var e=t("#list-pullrequests");i({$container:e,$pjaxContainer:t("#pullrequest-pjax"),filterTerm:e.find(".filter-control").attr("data-filter-term")})})}),define("components/editor/editable-diff",["components/editor/editable"],function(e){return e.extend({getOriginal:function(){return this.$(".diff-container")}})}),define("components/outdated-comments",["aui","underscore","components/comments/line-comment","components/diff/context-expander","utils/api-helper","data/current-repo","data/current-pr","utils/gaq-push"],function(e,t,i,n,r,o,s,a){function l(t,i){var n=new e.Dialog({width:1e3,height:"auto",id:"eclipsed-dialog-{}".format(i),closeOnOutsideClick:!0});return n.addHeader(gettext("Comments on prior versions"),"eclipsed-comments-heading"),n.addPanel(gettext("Comments on prior versions"),t,"eclipsed-comments-panel-body"),n.addLink(gettext("Close"),function(e){e.hide()}),n}function c(e,n){e.length&&t.each(e.data("value"),function(e){t.each(e,function(e,r){n&&(e=t.intersection(e,n)),i.decorateThreads(u.toString(),e,r)})})}function d(e,t){e.html(t).removeClass("has-mask");var i=e.find(".pr-line-thread-ids"),r=e.find(".iterable-item"),o=r.map(function(){return $(this).data("commentId")});c(i,o),e.find(".bb-patch-unified .bb-udiff, .comment-content .bb-udiff").each(function(){var e=$(this),t=e.data("filename"),i=e.parent().is(".comment-content");new n(e.data("expand-context-url")+encodeURI(t),e.data("identifier"),!i,!1,u.toString()).decorate(e)})}function h(e){a(["atl._trackEvent","Pull Request","Eclipsed Comments","Viewed"]);var t=e.data("dialog"),i=new $.Deferred;if(t)return t.show(),i.resolve(),i;var n=e.closest(".commentable-diff"),r=n.data("filename"),o=n.data("eclipsed-comment-view-url"),s=$("<div>").addClass("maskable has-mask");return $.ajax({url:o,data:{file:r},dataType:"html"}).done(function(e){d(s,e),i.resolve()}).fail(function(){i.reject()}),t=l(s,r),e.data("dialog",t),t.show(),i}var u=r.concat("repositories",o.owner.username,o.slug,"pullrequests",s.localId,"comments");return h}),function(e){var t="object"==typeof exports&&exports,i="object"==typeof module&&module&&module.exports==t&&module,n="object"==typeof global&&global;(n.global===n||n.window===n)&&(e=n);var r={},o=r.hasOwnProperty,s=function(e,t){if(!e)return t;var i,n={};for(i in t)n[i]=o.call(e,i)?e[i]:t[i];return n},a=/[\x20-\x2C\x2E\x2F\x3B-\x40\x5B-\x5E\x60\x7B-\x7E]/,l=/[\x20\x21\x23-\x26\x28-\x2C\x2E\x2F\x3B-\x40\x5B\x5D\x5E\x60\x7B-\x7E]/,c=/(^|\\+)?(\\[A-F0-9]{1,6})\x20(?![a-fA-F0-9\x20])/g,d=function(e,t){t=s(t,d.options),"single"!=t.quotes&&"double"!=t.quotes&&(t.quotes="single");for(var i,n,r,o,h="double"==t.quotes?'"':"'",u=t.isIdentifier,f=e.charAt(0),p="",m=0,g=e.length;g>m;)n=e.charAt(m++),r=n.charCodeAt(),32>r||r>126?(r>=55296&&56319>=r&&g>m&&(o=e.charCodeAt(m++),56320==(64512&o)?r=((1023&r)<<10)+(1023&o)+65536:m--),i="\\"+r.toString(16).toUpperCase()+" "):i=t.escapeEverything?a.test(n)?"\\"+n:"\\"+r.toString(16).toUpperCase()+" ":/[\t\n\f\r\x0B:]/.test(n)?u||":"!=n?"\\"+r.toString(16).toUpperCase()+" ":n:"\\"==n||!u&&('"'==n&&h==n||"'"==n&&h==n)||u&&l.test(n)?"\\"+n:n,p+=i;return u&&(/^_/.test(p)?p="\\_"+p.slice(1):/^-[-\d]/.test(p)?p="\\-"+p.slice(1):/\d/.test(f)&&(p="\\3"+f+" "+p.slice(1))),p=p.replace(c,function(e,t,i){return t&&t.length%2?e:(t||"")+i}),!u&&t.wrap?h+p+h:p};d.options={escapeEverything:!1,isIdentifier:!1,quotes:"single",wrap:!1},d.version="0.1.0","function"==typeof define&&"object"==typeof define.amd&&define.amd?define("cssesc",[],function(){return d}):t&&!t.nodeType?i?i.exports=d:t.cssesc=d:e.cssesc=d}(this),define("repo/pullrequests/helpers",["jquery","utils/mustache"],function(e,t){return{showUpdatesDialog:function(){var i,n,r="bb-last-seen-changeset",o=localStorage&&localStorage.getItem(r),s=e("#edit-pullrequest"),a=s.attr("data-changed"),l=s.attr("data-newest-changeset");a&&o!==l&&(n=e("#pullrequest-updates-dialog, #rebase-necessitates-update"),i=e(t.toHtml("pullrequest-update-dialog-template",{mostRecent:l})),n.length?n.replaceWith(i):s.after(i),s.addClass("bb-inline-dialog-anchor"),i.on("click",".close",function(e){e.preventDefault(),localStorage&&localStorage.setItem(r,l),i.remove(),s.removeClass("bb-inline-dialog-anchor")}))}}}),define("components/participants/live-update-participant",["backbone","utils/mustache"],function(e,t){return e.View.extend({tagName:"li",events:{click:"renderNextComment"},initialize:function(e){this.noun=e.noun,this.auiAvatarSize=e.auiAvatarSize,this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();return e.size=this.auiAvatarSize||"medium",this.$el.html(t.toHtml("participant-liveupdate-template",e)),this},renderNextComment:function(e){e.preventDefault(),this.model.get("comments")?this.trigger("render-next-comment",this.model.id):this.model.get("approved")&&this.trigger("show-approvals",this.model.id)}})}),define("components/participants/live-update",["components/participants/participants-strip","components/participants/live-update-participant"],function(e,t){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.collection.bind("add",this.addParticipant,this),this.collection.bind("add",this.toggleEmptyClass,this),this.collection.bind("destroy",this.toggleEmptyClass,this)},addParticipant:function(e){var i=new t({model:e,noun:this.collection.noun,auiAvatarSize:this.auiAvatarSize}).render();this.$el.append(i.$el),i.on("render-next-comment",this.renderUserComment,this),i.on("show-approvals",this.showApprovals,this)},toggleEmptyClass:function(){this.$el.toggleClass("empty",!this.collection.length)},renderUserComment:function(e){this.trigger("render-user-comment",e)},showApprovals:function(e){this.trigger("show-approvals",e)}})}),define("repo/pullrequests/live-update",["jquery","underscore","data/current-repo","data/current-pr","components/comments/comment","components/comments/line-comment","components/participants/participants","components/participants/live-update","repo/pullrequests/helpers","utils/api-helper","utils/mustache"],function(e,t,i,n,r,o,s,a,l,c,d){function h(){return F.find("li").length?!1:!H.hasClass("updated")}function u(){e.ajax({url:A,data:{since:L},dataType:"json"}).done(f)}function f(e){L=e.lastModified,(e.prDetailsModified||e.anchorMoved||e.destRevMoved)&&(H.addClass("updated"),I.removeClass("hidden")),g(e.viewers),p(e),v(e),b(),$(e)}function p(e){t.each(e.commentsAdded,function(e){W.push(e)}),t.each(e.commentsReplied,function(e){W.push(e)}),t.each(e.commentsEdited,function(e){var i=t.find(W,function(t){return e.comment.comment_id===t.comment.comment_id});i?W.splice(W.indexOf(i),1,e):D(e.comment)}),t.each(e.commentsDeleted,function(e){var i=t.find(W,function(t){return e.evt.reference_id===t.comment.comment_id});i?W.splice(W.indexOf(i),1):j(e.evt.reference_id)})}function m(e){e.set("last_updated_on",null),e.destroy()}function g(e){t.each(e,function(e){e.viewing=!0,U.add(e,{merge:!0})}),t.each(U.models,function(i){var n=t.find(e,function(e){return e.username===i.id});n||(i.get("comments")?i.set("viewing",!1):m(i))})}function v(e){t.each(e.approvalsRemoved,function(e){var t=e.user,i=U.get(t.username);i&&i.set("approved",!1)}),t.each(e.approvalsAdded,function(e){e.user.approved=!0,U.add(e.user,{merge:!0})}),(e.approvalsAdded.length||e.approvalsRemoved.length)&&M.trigger("approval-changed.pullrequest")}function b(){var e={};t.each(W,function(t){var i=t.user.username;e[i]=e[i]||{count:0,commentEvent:t},e[i].count++}),t.each(e,function(e,t){var i=U.get(t);if(i)i.set({comments:e.count,last_updated_on:e.commentEvent.comment.utc_last_updated});else{var n=e.commentEvent.user;n.comments=e.count,n.last_updated_on=e.commentEvent.comment.utc_last_updated,U.add(n)}}),t.each(U.models,function(t){e[t.get("username")]||(t.get("viewing")?t.set("comments",0):m(t))}),q()}function _(i){var n=t.find(W,function(e){return e.user.username===i});if(n){if(!e("#pr-tab-content-wrapper").hasClass("diff"))return void S(n.comment.comment_id);k(n.comment),W=t.reject(W,function(e){return e===n}),b()}}function y(t){return t.parent_id?w(t):t.filename?x(t):e("#comments-list")}function w(i){var n=e("#comment-"+i.parent_id);if(!n.length){var r=t.find(W,function(e){return e.comment.comment_id===i.parent_id});if(!r){var o=e("#compare"),s=o.attr("data-anchor"),a=o.attr("data-dest-rev"),l="CompareRevisions(anchor=u'{}', destrev=u'{}')".format(s,a),c=o.find(".pr-line-thread-ids").data("value"),d=t.reject(c,function(e,t){return t===l}).reduce(function(e,t){return e.concat(t[i.filename]||[])},[]),h=t.any(d,function(e){return e===i.parent_id});
return h?e('[data-filename="{}"] a.eclipsedcount'.format(i.filename)).click():S(i.comment_id),null}n=k(r.comment),W=t.reject(W,function(e){return e===r})}return n.parents(".aui-dialog").length&&e('[data-filename="{}"] a.eclipsedcount'.format(i.filename)).click(),n.siblings(".child-comments")}function x(t){var i=e("#compare");if(i.attr("data-anchor")!==t.anchor||i.attr("data-dest-rev")!==t.dest_rev)return S(t.comment_id),null;var n=e('[data-filename="{}"]'.format(t.filename)),r=n.find("[data-tnum={line_to}], [data-fnum={line_from}]".format({line_to:t.line_to,line_from:t.line_from})),o=n.find(".heading");if((t.line_to||t.line_from)&&!r.length)return S(t.comment_id),null;var s=r.length?r.parents(".udiff-line"):o,a=s.next();return a.hasClass("comment-thread-container")||(a=e('<div class="comment-thread-container"><ol class="comments-list"></ol></div>').insertAfter(s)),a.find(".comments-list")}function k(t){var i=e("#comment-"+t.comment_id),n=y(t),s=r.prototype.parse(t),a=new r(s,{urlRoot:z.toString()}),l=new o(a);return n?("comments-list"===n.attr("id")?l.render(n.find(".new-comment"),"before"):i.length?l.decorate(i,s.filename):l.render(n),l.$elem.addClass("highlight"),l.scrollTo({onAfter:function(){l.$elem.removeClass("highlight")}}),l.$comment):null}function C(t){e.scrollTo(e("#pull-request-header"));var i=U.get(t);i&&(i.get("viewing")?i.set({approved:!1}):m(i)),q()}function $(t){t.changed&&(e("#edit-pullrequest").attr({"data-changed":!0,"data-newest-changeset":t.changed}),l.showUpdatesDialog())}function D(t){var i,n=e("#comment-"+t.comment_id),r=n.find("header");r.find(".comment-deleted").length||(r.find(".comment-changed").remove(),i=e(O({edited:!0})),r.append(i),i.on("click","a",function(e){e.preventDefault(),n.find(".comment-content").html(t.content_rendered),i.remove()}))}function T(e,i){return t.each(e,function(e){i.push(e),T(e.children,i)}),i}function j(t){var i,n=e("#comment-"+t),r=n.find("header");r.find(".comment-changed").remove(),i=e(O({deleted:!0})),r.append(i),i.on("click","a",function(e){e.preventDefault(),E(t),i.remove()}),n.find(".comment-actions [href=#delete]").parent().remove()}function E(i){var n=e("#comment-"+i),r=n.parents(".child-comments").last().siblings("article, .deleted-comment-message"),s=r.length?[r.data("commentId")]:[i],a=o.decorateThreads(z.toString(),s),l=T(a,[]),c=t.find(l,function(e){return e.comment.id===i}),d=c.$elem.parents(".comment-thread-container");c.scrollTo({onAfter:function(){c.removeComment(),d.find("li.comment").length||d.remove()}})}function S(t){t?(W=[],b(),e("#pr-menu-activity").click(),M.one("pjax:end",function(){var i=e("#comment-"+t).parent(".comment");window.location.hash="comment-"+t,i.addClass("highlight"),i.one("transitionend webkitTransitionEnd",function(){i.removeClass("highlight")})})):window.location.reload(!0)}function q(){var e=H.hasClass("updated"),t=e?1:0;t=U.reduce(function(e,t){var i=t.get("comments");return e+=i,t.get("approved")?e+1:e},t),document.title=t>0?"({}) {}".format(t,B):B}var P=function(t,i){function n(){return(new Date).getTime()-d<c.inactivity}function r(){n()||(u=0,s()),d=(new Date).getTime()}function o(e){return Math.min(n()?c.min:e*c.multiplier,c.max)}function s(){h&&clearTimeout(h),h=setTimeout(function(){t(),s()},u=o(u))}var a=1e3,l=60*a,c=e.extend({min:20*a,max:60*l,multiplier:1.25,inactivity:5*l},i),d=(new Date).getTime(),h=null,u=0;return e(window).focus(r),e("body").click(r),{start:function(){s()},stop:function(){clearTimeout(h),h=null}}},M=e(document),R=e("#pullrequest"),I=e("#pr-toolbar"),A=R.attr("data-updates-url"),L=R.attr("data-last-updated"),B=document.title,F=R.find(".qr-notice"),H=F.find(".pr-update-notice"),O=t.partial(d.toHtml,"comment-changed-template"),z=c.concat("repositories",i.owner.username,i.slug,"pullrequests",n.localId,"comments"),U=new s([],{noun:"pull request"}),W=[],N=new a({el:F.find("ol"),collection:U,auiAvatarSize:"medium"}).render();if(N.on("render-user-comment",_),N.on("show-approvals",C),U.on("add",function(){I.removeClass("hidden")}),U.on("destroy",function(){I.toggleClass("hidden",h())}),H.on("click","a",function(e){e.preventDefault(),S()}),A&&L){var V=new P(u);V.start(),u()}}),define("repo/pullrequests/quick-update",["aui","jquery","underscore","utils/check-task"],function(e,t,i,n){t(document).on("click","#quick-update-pr",function(r){r.preventDefault();var o=t(r.target),s=o.attr("href");if(!o.hasClass("loading")){o.addClass("loading");var a=function(n){var r=t("<div></div>"),s="An error occurred while updating.",a="Try refreshing this page or editing the pull request directly.";n&&(t.isArray(n)&&n.length?(i.each(n,function(e){t("<p></p>").text(e).appendTo(r)}),a=r.html()):(s=n,a=null)),e.messages.error({title:s,body:a}),o.removeClass("loading")};t.ajax({type:"POST",url:s,data:{_quick_update:1},dataType:"json",error:function(){a()},success:function(e){e.errors?a(e.errors):e.result?window.location=e.result:setTimeout(function(){n(e.url).fail(a)},1e3)}})}})}),function(e){define("jquery-plugins/jquery.hoverIntent",[],function(){return function(){!function(e){e.fn.hoverIntent=function(t,i){var n={sensitivity:7,interval:100,timeout:0};n=e.extend(n,i?{over:t,out:i}:t);var r,o,s,a,l=function(e){r=e.pageX,o=e.pageY},c=function(t,i){return i.hoverIntent_t=clearTimeout(i.hoverIntent_t),Math.abs(s-r)+Math.abs(a-o)<n.sensitivity?(e(i).unbind("mousemove",l),i.hoverIntent_s=1,n.over.apply(i,[t])):(s=r,a=o,i.hoverIntent_t=setTimeout(function(){c(t,i)},n.interval),void 0)},d=function(e,t){return t.hoverIntent_t=clearTimeout(t.hoverIntent_t),t.hoverIntent_s=0,n.out.apply(t,[e])},h=function(t){var i=jQuery.extend({},t),r=this;r.hoverIntent_t&&(r.hoverIntent_t=clearTimeout(r.hoverIntent_t)),"mouseenter"==t.type?(s=i.pageX,a=i.pageY,e(r).bind("mousemove",l),1!=r.hoverIntent_s&&(r.hoverIntent_t=setTimeout(function(){c(i,r)},n.interval))):(e(r).unbind("mousemove",l),1==r.hoverIntent_s&&(r.hoverIntent_t=setTimeout(function(){d(i,r)},n.timeout)))};return this.bind("mouseenter",h).bind("mouseleave",h)}}(jQuery)}.apply(e,arguments)})}(this),define("repo/pullrequests/view",["aui","jquery","underscore","on-ready","js/pullrequests/events","data/current-pr","data/current-repo","components/form-dialog","components/comments/comment-count-indicator","components/comments/general-comment-form","components/comments/line-comment","components/diff/commentable-diff","components/diff/context-expander","components/diff/deferred-large-diff","components/diff/diff-actions-2","components/editor/editable-diff","components/outdated-comments","components/participants/helpers","components/participants/participants-strip","cssesc","repo/pullrequests/helpers","utils/api-helper","utils/check-task","utils/create-comment-handler","utils/dialog-positions","utils/disable","utils/exists","utils/gaq-push","utils/mustache","repo/pullrequests/live-update","repo/pullrequests/quick-update","jquery-plugins/jquery.fancybox","jquery-plugins/jquery.hoverIntent","jquery-plugins/jquery.pjax"],function(e,t,i,n,r,o,s,a,l,c,d,h,u,f,p,m,g,v,b,_,y,w,x,k,C,$,D,T,j){return n(function(){function n(e){return function(t){(t.isconflicted||t.mergeimpossible)&&e()}}function $(){z.disable(),t("#fulfill-pullrequest").attr("aria-disabled",!0).attr("title","Cannot merge due to conflicts")}function E(e){var i=e.find("#general-thread-ids"),n=t("#activity-list.line-commenting > li.new-comment");if(i.length&&d.decorateThreads(U.toString(),i.data("value")),n.length){var r=!1;new c(U,r).decorate(n)}S(e.find(".pr-line-thread-ids"))}function S(e,t){e.length&&i.each(e.data("value"),function(e){i.each(e,function(e,n){t&&(e=i.intersection(e,t)),d.decorateThreads(U.toString(),e,n)})})}function q(){var e=this.filter(function(e){return e.get("approved")});r.vent.trigger("updateApprovals",e.length)}function P(){this.fetch({reset:!0})}var M=t("#pull-request-attrs"),R=function(){this.$window=null,this.$line=null};R.prototype.regex=/(F\d+)?(T\d+)?$/,R.prototype.oldRegex=/_(oldline|newline)(\d+)$/,R.prototype.cssClass="permalinked",R.prototype.isLinePermalink=function(e){var t=this.regex.exec(e);return!(!t[1]&&!t[2])},R.prototype.translateHash=function(e){var i=this.oldRegex.exec(e);if(i[1]&&i[2]){var n=e.substring("#chg_".length);n=n.substring(0,n.length-(i[1]+i[2]).length-1);var r={oldline:"F",newline:"T"},o="L"+n+r[i[1]]+i[2];if(document.getElementById(o))return o;var s=document.getElementById("chg-"+n);if(s){var a={oldline:"data-fnum",newline:"data-tnum"},l=t(s).find("div.common").filter("[{}={}]".format(a[i[1]],i[2]));if(1===l.length)return l.find(".line-numbers").attr("id")}}return null},R.prototype.decorate=function(e){this.$window=e,this.enterDocument()},R.prototype.enterDocument=function(){this.$window.bind("hashchange",t.proxy(this.highlightLine,this))},R.prototype.highlightLine=function(){var e=window.location.hash;if(this.oldRegex.test(e)){var i=this.translateHash(e);i&&(window.location.hash=i)}else if(this.isLinePermalink(e)){var n=document.getElementById(e.substring(1));n&&(null!==this.$line&&this.$line.removeClass(this.cssClass),this.$line=t(n).addClass(this.cssClass))}};var I=t("#pullrequest.view-pullrequest"),A=k(w.concat("repositories",s.owner.username,s.slug,"pullrequests",o.localId,"comments"),I);A.initializeComments(),I.find(".description img").each(function(e,i){var n=t(i),r=n.attr("src");if(!n.parent().is("a")){var o=t("<a>").addClass("image-link").attr({href:r,rel:"pr-image",target:"_blank","data-fancybox-type":"image"});n.wrap(o)}}),I.find(".description a.image-link").fancybox({loop:!1,nextEffect:"fade",prevEffect:"fade"});var L=t("#fulfill-pullrequest"),B=t("#reject-pullrequest"),F=t.Deferred();if("open"===M.data("status")){var H=t(".menu-item.active-tab a","#pullrequest-navigation").attr("data-tab-link-id");"diff"===H?t(document).one("diff:loaded",function(){F.resolve({isconflicted:t("#compare").data("hasConflicts"),mergeimpossible:t("#pr-tab-info").data("mergeimpossible")})}):F=t.ajax({url:I.attr("data-conflicts-url"),type:"GET",dataType:"json",cache:!1});var O=function(){var e=t("<span>").addClass("aui-icon aui-icon-warning").attr("title","Cannot merge due to conflicts");t("#pullrequest-actions").prepend(e.tooltip())};F.done(n(O)).fail(O)}var z=new a(L,{onUpdateContents:function(e){var i=e.popup.element,r=-(new Date).getTimezoneOffset();i.find('input[name="tzoffset"]').val(r);var o=function(){i.find("form").html(t("#pull-request-header").find(".warning")),i.find(".dialog-button-panel button").prop("disabled",!0).attr({"aria-disabled":!0,title:"Cannot merge due to conflicts"})};F.done(n(o)).fail(o).always(function(){i.find("form.maskable").removeClass("has-mask")})},success:function(e,t){t.result?window.location=t.result:setTimeout(function(){x(t.url).fail(this.error.bind(this))}.bind(this),1e3)},error:function(e){this.complete_(),this.displayError({title:"Unable to merge",body:e,closeable:!1})},complete:function(){},dataType:"json",isStaticContent:!0,width:700}).bind();L.disable(!1);new a(B,{dataType:"json",isStaticContent:!0}).bind();B.disable(!1),y.showUpdatesDialog(),"open"===M.data("status")&&(I.hasClass("conflicts")?$():t(document).bind("bb:compare",function(){t("#compare-metadata").data("has-conflicts")&&(I.addClass("conflicts"),$())}),t(".pullrequest-metadata time").localize());var U=w.concat("repositories",s.owner.username,s.slug,"pullrequests",o.localId,"comments");D("#activity-list",function(){var e=t("#pr-tab-content");E(e)}),v.collectionFrom(I,64).done(function(e){e.on("participants:refresh",q,e),e.on("reset",q,e),r.vent.on("currentUserApproved",P,e),D(".reviewers-group .participants ol",function(t){new b({el:t,collection:e,condition:function(e){return e.get("username")!=o.author.username},auiAvatarSize:"medium",emptyTemplate:"no-reviewers-template"}).render()}),D(".author ol",function(t){new b({el:t,collection:e,condition:function(e){return e.get("username")==o.author.username},auiAvatarSize:"medium"}).render()}),e.bind("approved",function(e){e&&I.find("a.follow").trigger("toggle-follow",{type:"pullrequest",isNowFollowing:!0})}),t(document).on("comment-added approval-changed.pullrequest",function(t){e.trigger("participants:refresh"),"comment-added"==t.type&&I.find("a.follow").trigger("toggle-follow",{type:"pullrequest",isNowFollowing:!0})})}),I.find(".compare-widget-container .compare-widget").each(function(i,n){var r=t(n),o=!1;e.InlineDialog(r,"repo-details-"+i,function(e,i,n){o||e.addClass("pullrequest-branch-details-dialog").append(t(j.toHtml("branch-details-template",{display_name:r.attr("data-user-display-name"),username:r.attr("data-user-name"),user_avatar:r.attr("data-user-avatar"),user_url:r.attr("data-user-url"),repo_name:r.attr("data-repo-name"),repo_avatar:r.attr("data-repo-avatar"),repo_url:r.attr("data-repo-url"),branch_name:r.attr("data-branch-name"),branch_url:r.attr("data-branch-url"),branch_state:r.attr("data-branch-state"),commit_id:r.attr("data-commit-id"),commit_url:r.attr("data-commit-url"),size:24}))),o=!0,n&&n()},{arrowOffsetX:-8,width:"auto"})}),D("#pullrequest-navigation .tabs-menu",function(e){var n=t("#pr-tab-content"),o=e.find(".menu-item"),s=!0;(new R).decorate(t(window));var a=null;n.on("pjax:beforeSend",function(){var e=window.location.hash;null===a&&e&&(a=e)});var v=null,b=function(){var e,s,c=o.filter(".active-tab").find("a").data("tab-link-id"),d=t("#pr-tab-content"),b=t("#pr-tab-content-wrapper"),y=t("#diff-tab-preload"),w=n.find(".pr-line-thread-ids"),x=n.find(".bb-udiff"),k=t("#compare");if(d.trigger("diff:loaded"),null===v&&(v=t("#general-comments")),"diff"===c?(e=k.attr("data-anchor"),s=k.attr("data-dest-rev"),t("#general-comments").length||v.appendTo(y)):v.detach(),d.removeClass("has-mask"),b.removeClass("diff commits activity"),b.addClass(c),a){var C="#"+_(a.substr(1),{isIdentifier:!0}),$=t(C).parent("li.comment");if(document.getElementById(a.substr(1)))$.addClass("highlight"),window.location.hash=a,a=void 0;else if("diff"===c){var D=w.data("value")||{},j=i.any(i.values(D),function(e){return i.any(i.values(e),function(e){return i.any(e,function(e){return"#comment-{}".format(e)===a})})});if(j)return void t("#pr-menu-activity").click()}}var S=k.attr("data-owner"),q=k.attr("data-slug"),P=k.attr("data-destination-owner"),M=k.attr("data-destination-slug"),R=k.data("local-id"),I=k.data("is-writer"),A=k.data("has-push-access"),L=k.attr("data-hash"),B=k.attr("data-branch"),F=k.attr("data-multiple-error");if(x.each(function(){var n,r=t(this),o=r.attr("data-filename"),a=r.attr("data-compare-files-url"),l=!!r.parent(".comment-content").length;if("diff"===c){var d=[],f=r.data("filename");w.length&&i.each(w.data("value"),function(e){d=i.union(d,e[f])}),n=new h(U,f,d,e,s).decorate(r)}new p(o,a).decorate(r.find(".diff-actions")),new u(r.data("expand-context-url")+encodeURI(o),r.data("identifier"),!l,n,U.toString()).decorate(r);var g=r.attr("data-path"),v=r.attr("data-source-url");new m({el:r,owner:S,slug:q,destinationOwner:P,destinationSlug:M,localID:R,isWriter:I,hasPushAccess:A,isPullRequest:!0,hash:L,branch:B,path:g,sourceUrl:v,multipleError:F})}),"diff"===c){t(".comments-link").on("click",function(e){var i=t(e.target).closest("a.comments-link").data("file-path"),n=t(document.getElementById("chg-"+i)),r=n.find(".comment").find("article").first();0===r.length&&(r=n),t(window).scrollTo(r,500,{axis:"y",offset:-50}),e.preventDefault()}),t(".eclipsedcount").hoverIntent({over:t.noop,out:function(){T(["atl._trackEvent","Pull Request","Eclipsed Comments","Hovered icon"])}}).on("click",function(e){e.which>1||e.metaKey||e.ctrlKey||(e.preventDefault(),g(t(e.target)))});var H=t("#general-comments").find(".comment-count"),O=t("#comments-list");new l(H,O).decorate(),t("#commit-files-summary").find(".count-badge").each(function(e,i){var n=t(i),r=n.find(".count"),o=t(document.getElementById("chg-"+n.find(".comments-link").data("file-path")));new l(r,o).decorate()}),f.setupDeferredDiffMarkers(n.find(".bb-patch-unified"),!0,U),r.vent.trigger("diff:loaded")}"activity"===c&&E(n)};if(t("#diff-tab-preload").length){var y=t("#general-thread-ids"),w=t("#comments-list.line-commenting > li.new-comment");if(y.length&&d.decorateThreads(U.toString(),y.data("value")),w.length){var x=!0;new c(U,x).decorate(w)}}n.on("pjax:end",b),n.on("pjax:error",function(e,t,i){return t.readyState>0&&"abort"!==i?(n.html("<h2>Error</h2><p>We were unable to load this page.</p>"),!1):void 0}),n.on("pjax:beforeSend",function(){var e=t("#pr-tab-content-wrapper"),i=t("#pr-tab-content");i.addClass("has-mask"),s||e.removeClass("diff commits activity"),s=!1});var k={container:n,scrollTo:null,timeout:3e4},C=t("#pr-tab-info").data("active-tab-on-load"),$=t("#pr-menu-{}".format(C));if($.length){var D=$.attr("href");t.support.pjax?t.pjax(t.extend({url:D,replace:!0},k)):n.load(D+"?_ajax=1",b)}t.support.pjax&&e.on("click","li a",function(i){i.which>1||i.metaKey||i.ctrlKey||i.shiftKey||i.altKey||(i.preventDefault(),e.find("li").removeClass("active-tab"),t(this).closest(".menu-item").addClass("active-tab"),n.detach().empty(),n.appendTo(t("#pr-tab-content-wrapper")),t.pjax(t.extend({url:t(this).attr("href"),push:!0},k)))})}),I.on("follow:pullrequest",".sidebar a.follow",function(e,i){var n=t(this).siblings(".aui-icon");n.toggleClass("aui-iconfont-watch",i),n.toggleClass("aui-iconfont-unwatch",!i)}),D(".issue-dialog-trigger",function(i){e.InlineDialog(i,1,function(e,i,n){return t(".issue-dialog").appendTo(e).show(),n(),!1},{width:"auto",calculatePositions:C.alignLeft()})})})}),define("js/pullrequests/models/pullrequest",["jquery","backbone","js/pullrequests/events","js/pullrequests/collections/tasks","data/current-repo"],function(e,t,i,n,r){var o=!1;return t.Model.extend({defaults:{approvalCount:0,hasCurrentUserApproved:!1,isWatchedByCurrentUser:!1},urlRoot:"/api/2.0/repositories/{owner}/{slug}/pullrequests/".format({owner:r.owner.username,slug:r.slug}),initialize:function(){this.tasks=new n([],{pullrequest:this}),this.listenTo(i.vent,"updateApprovals",function(e){this.set("approvalCount",e)}),this.on("change:hasCurrentUserApproved",this._updateWatching,this),this.on("change:hasCurrentUserApproved",function(){i.vent.trigger("currentUserApproved")},this)},_sendRequest:function(t,i){return e.ajax({url:this.url()+(t?"/"+t:""),type:i?i:"GET"})},_setWatching:function(e){if(this.get("isWatchedByCurrentUser")!==e){var t=this._sendRequest("watch",e?"POST":"DELETE");return t.done(function(e){this.set("isWatchedByCurrentUser",e.watching)}.bind(this)),this.trigger("loading:isWatchedByCurrentUser",t),t}},_setApproved:function(e){if(this.get("hasCurrentUserApproved")!==e){var t=this._sendRequest("approve",e?"POST":"DELETE");return t.done(function(e){this.set("hasCurrentUserApproved",e.approved)}.bind(this)),this.trigger("loading:hasCurrentUserApproved",t),t}},_updateWatching:function(){var e=this._sendRequest("watch");this.trigger("loading:isWatchedByCurrentUser",e),e.done(function(e){this.set("isWatchedByCurrentUser",e.watching)}.bind(this))},approve:function(){this._setApproved(!0)},unapprove:function(){this._setApproved(!1)},watch:function(){this._setWatching(!0)},unwatch:function(){this._setWatching(!1)},fetchTasksOnce:function(){o||(o=!0,this.trigger("loading:tasks",this.tasks.fetch({remove:!1,data:{pagelen:100,fields:"values.comment.inline"}})))},createTask:function(t){var i=this.tasks.getUnsaved();i?i.trigger("edit"):t.content?this.tasks.create(e.extend({comment:t.comment},t)):this.tasks.add(e.extend({comment:t.comment},t))}})}),define("js/pullrequests/views/approve",["marionette","utils/disable","utils/loading"],function(e){return e.ItemView.extend({template:"#pullrequest-approve-button-template",modelEvents:{"change:hasCurrentUserApproved":"render","change:approvalCount":"render","loading:hasCurrentUserApproved":"loading"},events:{"click @ui.$button":"toggleApproval"},ui:{$button:"#approve-button"},initialize:function(e,t){t=t||{},this.showCount=t.showCount},templateHelpers:function(){return{showApprovalCount:this.showCount}},toggleApproval:function(){this.model.get("hasCurrentUserApproved")?this.model.unapprove():this.model.approve()},setEnabled:function(e){this.ui.$button.disable(!e)},loading:function(e){this.ui.$button.loading(e)}})}),define("js/pullrequests/views/collapsible-task",["underscore","js/pullrequests/events","js/pullrequests/views/task"],function(e,t,i){return i.extend({getClassNames:function(){var e=i.prototype.getClassNames.call(this);return e.push("collapsible collapsed"),e},initialize:function(){this.listenTo(t.vent,"keypress:13",this.toggleCollapseWithEnter),i.prototype.initialize.apply(this,arguments)},collapsed:!0,ui:e.extend(i.prototype.ui,{description:".description"}),events:e.extend(i.prototype.events,{click:"toggleCollapsed"}),onChangeCompleted:function(){this.model.get("completed")&&this.$el.addClass("collapsed"),i.prototype.onChangeCompleted.call(this)},toggleCollapsed:function(t){if(!this.editing&&!this.model.get("completed")){var i=$(t.target),n=[this.ui.contextLink,this.ui.saveLink,this.ui.editLink,this.ui.cancelLink,this.ui.deleteLink],r=[];return e.each(n,function(e){e.selector&&r.push(e.selector)}),i.is(this.ui.status.selector)?(this.collapsed=!0,void this.$el.toggleClass("collapsed",!0)):void(i.closest(r.join(",")).length||(this.collapsed=!this.collapsed,this.$el.toggleClass("collapsed",this.collapsed)))}},toggleCollapseWithEnter:function(e){!this.editing&&this.isFocusedForKBShortcuts()&&this.toggleCollapsed(e)}})}),define("js/pullrequests/views/pullrequest-task-list",["marionette","js/pullrequests/collections/tasks","js/pullrequests/views/collapsible-task","js/pullrequests/views/task-list"],function(e,t,i,n){return e.LayoutView.extend({template:"#pullrequest-task-list-template",regions:{openTasks:"#open-tasks",resolvedTasks:"#resolved-tasks"},initialize:function(){this.listenTo(this.model.tasks,"add remove",this.render)},onRender:function(){this.updateTasks()},templateHelpers:function(){return{hasResolvedTasks:!!this._getTasks({completed:!0}).length}},_getTasks:function(e){return this.model.tasks.where(e)},updateTasks:function(){this.openTasks.show(new n({collection:new t(this._getTasks({completed:!1})),childView:i})),this.resolvedTasks.show(new n({collection:new t(this._getTasks({completed:!0})),childView:i}))}})}),define("utils/dialogs",["aui"],function(e){function t(t,i){var n=e.popup.current;return t||(t=i.createDialog&&i.createDialog()),n?n===t.popup?void(i.hideDialog?i.hideDialog():t.hide()):void(i.hideOtherDialog&&(n.hide(),i.showDialog?i.showDialog():t.show())):void(i.showDialog?i.showDialog():t.show())}return{toggle:t}}),define("js/pullrequests/views/task-dialog",["aui","marionette","js/pullrequests/events","js/pullrequests/views/pullrequest-task-list","utils/dialogs"],function(e,t,i,n,r){return t.ItemView.extend({template:!1,createDialog:function(){this.taskList=new n({model:this.model}),this.dialog=new e.Dialog({id:"task-list-dialog",height:"auto",width:600,closeOnOutsideClick:!0,focusSelector:".task:first"});var t=$("<div>").addClass("dialog-hint").text(gettext("Tip: Use shift + T to open the task list."));return this.dialog.addHeader(gettext("Tasks")),this.dialog.addPanel("task-list",this.taskList.render().$el),this.dialog.addLink(gettext("Close"),function(e){e.hide()}),this.dialog.getCurrentPanel().page.buttonpanel.append(t),this.dialog},showDialog:function(){this.taskList.render(),this.dialog.show()},hideDialog:function(){this.dialog&&this.dialog.hide()},toggleDialog:function(e){e&&e.preventDefault(),r.toggle(this.dialog,this)}})}),define("js/pullrequests/views/open-task-count",["aui","marionette","js/pullrequests/events","utils/loading"],function(e,t,i){return t.ItemView.extend({template:"#pullrequest-tasks-count-template",templateHelpers:function(){return{has_tasks:!!this.model.tasks.length}},events:{"click @ui.link":"handleClick"},modelEvents:{"loading:tasks":"loading"},ui:{link:"a"},initialize:function(){i.vent.once("diff:loaded",function(){this.listenTo(this.model.tasks,"add remove change:completed",this.render)}.bind(this))},handleClick:function(e){e.preventDefault(),i.vent.trigger("unresolvedTaskCountClicked")},onRender:function(){var e=this.model.tasks.where({completed:!1}).length,t=gettext("All tasks resolved");e>0&&(t=interpolate(ngettext("%(taskCount)s unresolved task","%(taskCount)s unresolved tasks",e),{taskCount:e},!0)),this.ui.link.text(t)},loading:function(e){this.ui.link.loading(e)}})}),define("js/pullrequests/views/watch",["marionette","utils/loading"],function(e){return e.ItemView.extend({template:"#pullrequest-watch-template",modelEvents:{"change:isWatchedByCurrentUser":"render","loading:isWatchedByCurrentUser":"loading"},events:{"click a":"toggleWatch"},toggleWatch:function(e){e.preventDefault(),this.model.get("isWatchedByCurrentUser")?this.model.unwatch():this.model.watch()},loading:function(e){this.$el.loading(e)}})}),define("js/pullrequests/index",["jquery","on-ready","marionette","js/pullrequests/app","js/pullrequests/events","js/pullrequests/models/pullrequest","js/pullrequests/views/approve","js/pullrequests/views/task-dialog","js/pullrequests/views/open-task-count","js/pullrequests/views/watch","components/outdated-comments","data/flags","utils/when-i-type"],function(e,t,i,n,r,o,s,a,l,c,d,h,u){return t(function(){function t(t){var i=e('[data-filename="{}"] a.eclipsedcount'.format(t.get("comment").path)),n=d(i);n.done(function(){var e=window.location.hash;window.location.hash=" ",window.location.hash=e})}var i=e("#pullrequest"),f=e("#pullrequest-actions").find(".approve"),p=e("#watch-pullrequest"),m=new o({id:i.attr("data-local-id"),approvalCount:f.data("approvalCount"),hasCurrentUserApproved:f.data("hasCurrentUserApproved"),isWatchedByCurrentUser:p.data("isWatching")});n.addInitializer(function(e){new c({el:p,model:e.pullrequest}).bindUIElements()}),n.addInitializer(function(e){var t=new s({el:f,model:e.pullrequest},{showCount:!0});t.bindUIElements(),t.setEnabled(!0)}),h.prTasks&&(n.addInitializer(function(i){new l({el:e("#pullrequest-task-list"),model:i.pullrequest}).bindUIElements();var n=new a({model:i.pullrequest});r.vent.on("unresolvedTaskCountClicked taskContextLinkClicked",function(e){i.pullrequest.fetchTasksOnce(),n.toggleDialog(),e&&e.get("comment").path&&t(e)}),m.tasks.on("remove",function(){m.tasks.length||n.hideDialog()}),u.fromJSON([{section:gettext("Commits / pull requests"),shortcuts:[{keys:["shift+t"],description:gettext("Show the list of tasks"),op:"execute",params:[function(){i.pullrequest.fetchTasksOnce(),n.toggleDialog()}]}]}]),e(document).on("keypress",function(e){r.vent.trigger("keypress:"+e.keyCode,e)})}),n.addInitializer(function(e){var t=e.pullrequest;r.vent.once("diff:loaded",function(){t.tasks.once("sync add remove",function(e,i,n){n&&n.xhr?n.xhr.done(function(){t.fetchTasksOnce()}):t.fetchTasksOnce()})})})),n.start({pullrequest:m})})}),define("repo/pullrequests/index",["repo/index","repo/pullrequests/form","repo/pullrequests/list","repo/pullrequests/view","js/pullrequests/index"],function(){}),define("repo/issues/attachments",["jquery","on-ready","underscore"],function(e,t,i){return t(function(){var t=e("#attachments"),n=t.find(".attachment-list");e(document).on("change","#id_attachments",function(){n.children(".pending").remove(),n.children(".empty").remove(),"undefined"!=typeof this.files&&i.each(this.files,function(t){e('<li class="pending"></li>').text(t.name).appendTo(n)})}),n.on("click",'a[href="#delete-attachment"]',function(t){if(t.preventDefault(),confirm("Are you sure you want to delete this attachment?")){var i=e(this),r=n.data("deleteUrl");e.ajax({url:r,type:"POST",data:{delete_attachment_id:i.data("id"),csrfmiddlewaretoken:e('input[name="csrfmiddlewaretoken"]').val()},dataType:"html",success:function(){i.closest("li").remove()}})}})})}),define("repo/issues/watching",["jquery"],function(e){function t(t){var i=e("#issue-watch-count"),n=parseInt(i.text(),10);n=t?n+1:n-1,i.text(n).toggleClass("aui-badge-active",t)}function i(i){var n=e("#issue-watch-trigger");i!==n.hasClass("following")&&(i?n.addClass("following").text(n.attr("data-unfollow-text")):n.removeClass("following").text(n.attr("data-follow-text")),t(i))}return{updateWatchingCount:t,toggleWatching:i}}),define("repo/issues/votes",["jquery","repo/issues/watching"],function(e,t){function i(t,i){e("#issue-vote-count").text(t).toggleClass("aui-badge-active",i)}function n(n,r){var o=e("#issue-vote-trigger");r?(o.addClass("following").text(o.attr("data-unvote-text")).data("voted",!0),t.toggleWatching(!0)):o.removeClass("following").text(o.attr("data-vote-text")).data("voted",!1),i(n,r)}function r(){e.ajax({url:e("#issue-vote-trigger").attr("href"),type:"post",dataType:"json"}).success(function(e){n(e.count,e.voted)})}function o(){return e("#issue-vote-trigger").data("voted")}return e(document).on("click","#issue-vote-trigger",function(e){e.preventDefault(),r()}),{updateVoteCount:i,toggleVote:r,toggleVoteUI:n,currentUserHasVoted:o}}),define("repo/issues/comments",["bitbucket","jquery","on-ready","underscore","components/confirm-dialog","config/markitup","data/current-repo","data/current-user","utils/edit-content","utils/mustache","repo/issues/votes","utils/disable"],function(e,t,i,n,r,o,s,a,l,c,d){return i(function(){function i(e){e.find("textarea").val("").markItUpRemove(),e.removeClass("textarea-preview").removeClass("focused"),e.find('a[href="#submit"], button:submit').removeClass("loading").disable(!1),u.hasClass("commentable")&&(e.closest(".comment article").removeClass("editing"),e.closest(".new-comment").length||e.closest("form").detach())}function h(e,t){var n=e.find("textarea").val(),o=/^\s*\+\d+\s*$/;if(!n.match(o))return void t();var s=e.find(".editor");d.currentUserHasVoted()?r({content:gettext("You have already voted on this issue. Would you still like to submit this comment?"),id:"already-voted-vote-suggestion",buttonText:gettext("Yes")}).done(function(){t()}).fail(function(){l(s.find(".cancel"),s),i(s)}):r({content:gettext("Voting on this issue will get it more attention than a +1 alone, click to add your vote instead."),id:"vote-suggestion",buttonText:gettext("Vote"),cancelText:gettext("Comment")}).done(function(){d.toggleVote(),l(s.find(".cancel"),s),i(s),AJS.messages.success({body:gettext("Thank you for voting on this issue.")})}).fail(function(){t()})}var u=t("#issues-comments"),f=t("#issue-view").data(),p=function(){window.location.reload(!0)},m=e.repository(s.owner.username,s.slug);u.find("dd.comment").each(function(){var e=t(this),i=e.text().trim(),r=[/^Duplicate of #\d+[.]$/,/^Issue #\d+ was marked as a duplicate of this issue[.]$/];n.any(r,function(e){return e.test(i)})&&e.nextUntil().remove()}),u.hasClass("commentable")&&u.append(c.toHtml("new-comment-template",{user_avatar_url:a.avatarUrl,display_name:a.displayName,content:""})),u.on("focus",".editor textarea",function(e){var n,r,s=t(e.target).closest(".editor"),a=u.find(".editor.focused");a.each(function(){s[0]!=this&&i(t(this))}),n=t(this).closest(".editor"),u.find(".focused").removeClass("focused"),n.addClass("focused"),r=n.find("textarea"),r.hasClass("markItUpEditor")||(n.addClass("textarea-preview"),r.markItUp(o()),setTimeout(function(){r.trigger("focus")},0))}),u.on("click",".editor .cancel",function(e){e.preventDefault();var n=t(this).closest(".editor");l(t(e.target),n),i(n)});var g=t("#issue-comment, .new-comment");g.on("click keydown",'a[href="#submit"], button:submit',function(e){if("keydown"!==e.type||13===e.keyCode){e.preventDefault();var t=g.find("textarea").val();h(g,function(){g.find('a[href="#submit"], button:submit').addClass("loading").disable(!0),m.create_issue_comment(f.localId,{content:t},p)})}}),u.on("click keydown",".issue-comment .aui-button-primary",function(e){var i=t(e.target).closest(".comment article");if("keydown"!==e.type||13===e.keyCode){e.preventDefault();var n=i.find("textarea").val(),r=i.data("comment-id");h(i,function(){i.find('a[href="#submit"], button:submit').addClass("loading").disable(!0),m.update_issue_comment(f.localId,r,{content:n},{success:p,error:function(e){401===e.status&&alert("You must be logged in to post a comment.")
}})})}}),u.on("click",".edit-comment-link",function(e){e.preventDefault();var i=t(e.target).closest(".comment-content, .comment");if(u.hasClass("commentable")){var n,r,o,s;s=t(this).closest(".comment article"),o=s.attr("data-content");var l=t(c.toHtml("new-comment-template",{user_avatar_url:a.avatarUrl,display_name:a.displayName,content:o,convert_markup:"True"===s.data("convert-markup")}));n=l.find("form"),u.append(n),s.find(".comment-content").after(n),r=n.find("textarea"),r.data("originalComment",o),n.find(".comment_id").val(s.data("commentId")),s.addClass("editing"),r.focus()}else i.addClass("edit-comment-mode"),i.find("article").addClass("editing"),i.find(".editor textarea").focus()}),t(".edit-comment").each(function(){var e=t(this);e.find("a.button, button").click(function(){var t=e.find("textarea").val(),i=e.data("comment-id");m.update_issue_comment(f.localId,i,{content:t},{success:p,error:function(e){401===e.status&&(alert("You must be logged in to post a comment."),p())}})})}),t(".delete-link").click(function(e){e.preventDefault();var i=t(this),n=gettext("This is a destructive operation. Delete comment?");r(n).done(function(){i.closest("form").submit()})}),t(".comment-spam-link").click(function(e){e.preventDefault(),t(this).closest("form").submit()})})}),define("utils/chosen",["jquery","jquery-plugins/jquery.chosen"],function(e){return function(t,i){t.find("select:not(.disable-chzn)").each(function(){var t=e(this);t.hasClass("chzn-done")&&(t.show().removeClass("chzn-done"),e("#"+t.attr("id")+"_chzn").remove()),t.data("placeholder",t.attr("placeholder"));var i=t.find("option").first();i.val()||"---------"!==i.text()||i.text("")}).chosen(i)}}),define("utils/avatars-in-select",["jquery"],function(e){return function(t){e('<style type="text/css">').appendTo("head"),t.find("select option").each(function(){var t=e(this).val(),i=e(this).data("avatar"),n=['.user-select .chzn-container span[data-value="'+t+'"]:before','.user-select .chzn-container li[data-value="'+t+'"]:before'],r="background-image: url("+i+") !important;",o=document.styleSheets[document.styleSheets.length-1];_.each(n,function(e){o.insertRule?o.insertRule(e+"{"+r+"}",o.cssRules.length):o.addRule(e,r)})})}}),define("repo/issues/form",["jquery","on-ready","config/markitup","utils/chosen","utils/avatars-in-select","utils/disable","jquery-plugins/jquery.markitup"],function(e,t,i,n,r){return t(function(){var t=e("#issue-form"),o=t.find("select"),s=t.find("#id_responsible");t.css({position:"absolute",left:-9999}).show(),o.not("#id_responsible").addClass("nosearch"),o.filter("#id_component, #id_milestone, #id_version").each(function(){var t=this.id.replace("id_","");e(this).data().placeholder="Select a {}…".format(t)}),n(t,{allow_single_deselect:!0}),t.removeAttr("style"),t.find("#id_content, #id_comment, .edit-comment textarea, #id_update_comment").markItUp(i()),r(t.find(".user-select")),t.find("#assign-to-me").click(function(t){var i=e(t.target).attr("data-username");t.preventDefault(),s.val(i).trigger("liszt:updated")}),t.on("submit",function(t){e(t.target).find('button[type="submit"]').disable(!0)})})}),define("repo/issues/list",["jquery","on-ready","underscore"],function(e,t,i){return t(function(){var t=e("#issues-list"),n={"~":"contains","^":"starts with",$:"ends with","!":"not"},r={},o=t.find(".issues-list").data("qs");o&&i.each(o.split("&"),function(e){var t,o,s,a;e=e.split("="),o=e[0],a=decodeURIComponent(e[1].replace(/\+/g,"%20")),t=a.substr(0,1),i.has(n,t)?(a=a.substr(1),s=n[t]+" "):s="",a="responsible"!==o||a?s+'"'+a+'"':"!"===t?"someone":"no one",(r[o]||(r[o]=[])).push(a)});var s={q:"query",reported_by:"reporter",responsible:"assignee"},a=i.map(i.keys(r).sort(),function(e){return"<b>{label!esc}:</b>\n{value!esc}".format({label:s[e]||e,value:r[e].sort().join(" or ")})});t.find("#issues-filter-criteria").html(a.join(" "))})}),define("repo/issues/query-builder",["jquery","on-ready","underscore"],function(e,t,i){return t(function(){var t=e("#issues-query-builder"),n=t.find("form.query-form"),r=n.data(),o=t.find("#filters"),s=e("#addfilter"),a=e("#filters"),l={init:function(e,t){var n;if(e)for(n in e)"select"===e[n].type&&e[n].options.length<=0&&s.find('option[value="'+e[n].name+'"]').remove();if(s.bind("change",function(){this.selectedIndex>0&&l.create(this.options[this.selectedIndex].value)}).chosen(),o.html(""),!i.isEmpty(t))for(n in t)for(var r=0;r<t[n].length;r++)l.create(n,t[n][r][0],t[n][r][1])},generate_select:function(e,t,i){""!==t[0].value&&(/^responsible\d+$/.test(e)?t.unshift({text:"unassigned",value:""}):/^(?:component|milestone|version)\d+$/.test(e)&&t.unshift({text:"unset",value:""}));var n=document.createElement("select");n.name=e;for(var r,o=0;o<t.length;o++)"object"==typeof t[o]?(r=new Option(t[o].text,t[o].value),t[o].value===i&&(r.selected=!0)):(r=new Option(t[o],t[o]),t[o]===i&&(r.selected=!0)),n.options[n.options.length]=r,n.className="nosearch";return n},generate_remove_button:function(){var t=e('<a class="icon filter-remove">Remove filter</a>');return t[0]},remove:function(){var t=e(this).parent().parent();if(t.attr("class")===t.next("li").attr("class")){var i=t.find(".filter-header").text();t.next("li").find(".filter-header").text(i)}t.remove()},generate_comp_select:function(e,t,i){var n={text:[{text:"contains",value:"~"},{text:"doesn't contain",value:"!~"},{text:"begins with",value:"^"},{text:"ends with",value:"$"},{text:"is",value:""},{text:"is not",value:"!"}],select:[{text:"is",value:""},{text:"is not",value:"!"}]};return"text"===t||"select"===t?this.generate_select(e,n[t],i):void 0},create:function(t,i,n){var r=c[t],d=!1,h=1;a.find("li").hasClass("filter_"+t)&&(d=!0,h=a.find("li.filter_"+t).length+1);var u=e("<li></li>");u.addClass("filter_"+t);var f=e('<div class="filter-header"></div>');f.text(d?"or":r.header),u.append(f);var p=e('<div class="filter-comp"></div>');if("text"===r.type||"select"===r.type){var m=l.generate_comp_select("comp_"+r.name+h,r.type,i);p.append(m),setTimeout(function(){e(m).chosen()},0)}u.append(p);var g,v=e('<div class="filter-query"></div>');"text"===r.type?(g=e("<input/>"),g.attr("type","text"),g.attr("name",t+h),g.val(n?n:""),g.attr("size",30)):"select"===r.type&&(g=this.generate_select(t+h,r.options,n)),g&&(v.append(g),"select"==r.type&&setTimeout(function(){e(g).chosen()},0)),u.append(v);var b=e("<div></div>"),_=this.generate_remove_button();b.append(_),u.append(b),e(_).click(l.remove),d?(a.find(".filter_"+t+":last").after(u),a.find(".filter_"+t+" div").removeClass("last-of-type"),a.find(".filter_"+t+":last div").addClass("last-of-type")):o.append(u),s.get(0).selectedIndex=0}},c={title:{name:"title",type:"text",header:"Title"},content:{name:"content",type:"text",header:"Description"},version:{name:"version",type:"select",header:"Version",options:r.versions},milestone:{name:"milestone",type:"select",header:"Milestone",options:r.milestones},component:{name:"component",type:"select",header:"Component",options:r.components},kind:{name:"kind",type:"select",header:"Type",options:r.kinds},status:{name:"status",type:"select",header:"Status",options:r.statuses},priority:{name:"priority",type:"select",header:"Priority",options:r.priorities},responsible:{name:"responsible",type:"select",header:"Assignee",options:r.responsibles},reported_by:{name:"reported_by",type:"text",header:"Reported by"}};l.init(c,r.query),t.find("#filters-filters").find(".cancel").click(function(e){e.preventDefault(),window.history.back()})})}),define("utils/select-avatar-formatter",["jquery","utils/mustache"],function(e,t){return function(i){var n=e(i.element),r=n.data("user");return r||(r={display_name:i.text,avatar:n.data("avatar")}),t.toHtml("admin-selector-template",r)}}),define("repo/issues/transition",["aui","bitbucket","jquery","on-ready","config/markitup","data/current-repo","utils/mustache","utils/select-avatar-formatter","jquery-plugins/jquery.markitup"],function(e,t,i,n,r,o,s,a){return n(function(){function n(){d=i(s.toHtml("transition-dialog-template")),h=d.find(".error");var t=d.find("#id_responsible"),n=d.find("#assign-to-me"),o=function(e){h.removeClass("hidden"),h.find(".message").text(e)},c={dataType:"json",success:v,error:function(e){o(404===e.status?gettext("The duplicate issue does not exist"):e.responseText?e.responseText:gettext("An unexpected error occurred."))}};d.submit(function(e){e.preventDefault(),l(d,o,c)});var u=new e.Dialog({width:700,height:"auto",id:"issue-transition-dialog",closeOnOutsideClick:!0});return d.find("#id_transition_comment").markItUp(r()),t.auiSelect2({placeholder:gettext("Select a user..."),allowClear:!0,formatResult:a,formatSelection:a}),n.on("click",function(e){e.preventDefault();var n=i(e.target).attr("data-username");t.auiSelect2("val",n)}),u.addHeader(gettext("Transition issue")),u.addPanel("Transition",d,"panel-body"),u.addButton(gettext("Change"),function(){l(d,o,c)},"aui-button transition-issue-button"),u.addCancel(gettext("Cancel"),function(e){e.hide()}),u}function l(e,t,n){var r=e.find("#id_transition_comment").val(),o=e.find("#id_responsible").val(),s={status:f,responsible:o,comment:r},a=u.popup.element.find(".transition-issue-button");if(a.addClass("loading").attr({"aria-disabled":!0,disabled:!0}),6===f){var l=e.find("#id_duplicate_issue").val(),c=/\d+/.exec(l);if(!c)return t(gettext("Invalid issue number")),void a.removeClass("loading").removeAttr("aria-disabled").removeAttr("disabled");if(+c[0]===g.localId)return t(gettext("Invalid issue number")),void a.removeClass("loading").removeAttr("aria-disabled").removeAttr("disabled");n.type="POST",n.url=e.data("duplicateUrl"),n.dataType="html",n.data=s,s.duplicate=c[0],i.ajax(n)}else b.update_issue(g.localId,s,n)}function c(e){e.preventDefault();var t=i(this),r=t.attr("title");u||(u=n()),f=t.data("transition-to");var o=6==f;d.find(".duplicate").toggle(o),d.find(".comment").toggle(!o),h.addClass("hidden"),u.addHeader(r?r:gettext("Transition issue")),u.show()}var d,h,u,f,p=i("#workflow-dropdown"),m=i("#issue-view"),g=m.data(),v=function(){window.location.reload(!0)},b=t.repository(o.owner.username,o.slug);p.find('[data-transition-to="{curr}"], [data-transition-to="{next}"]'.format({curr:g.status,next:m.find("#change-state").find("a").data("transition-to")})).remove(),p.find("[data-transition-to]").click(c),i("#change-state").click(c)})}),define("repo/issues/view",["aui","jquery","on-ready","components/confirm-dialog","config/markitup","data/current-user","utils/exists","utils/localize","utils/mustache","utils/preferences","repo/issues/votes","repo/issues/watching","jquery-plugins/jquery.markitup","jquery-plugins/jquery.fancybox"],function(e,t,i,n,r,o,s,a,l,c,d,h){return i(function(){function i(){if(f)return f;f=new e.Dialog({width:700,height:"auto",id:"issue-attachment-dialog",closeOnOutsideClick:!0});var i=t(l.toHtml("attachment-dialog-template"));return i.find("textarea").markItUp(r()),f.addHeader("Attach files"),f.addPanel("Attach",i,"panel-body"),f.addButton("Attach",function(){i.submit()}),f.addCancel("Cancel",function(e){e.hide()}),f}var o=t("#issue-view"),d=(o.data(),/[(](BB-\d+)[)]/.exec(t("#issue-title").text())),u=o.find("#jira");u.toggle(location.pathname.startsWith("/site/master/")),u.length&&d&&u.text("View in JIRA").attr({href:"https://bitbucket.atlassian.net/browse/"+d[1]}),o.find("#issue-delete-link").click(function(e){e.preventDefault();var i=t(this),r=gettext("This is a destructive operation. Delete issue?");n(r).done(function(){i.closest("form").submit()})}),o.find("#issue-flag-spam").click(function(e){e.preventDefault(),t(this).closest("form").submit()}),t(document).on("follow:issue","#issue-watch-trigger",function(e,t){h.updateWatchingCount(t)}),t("ul.issue-attachment-list").find("a.image-attachment").fancybox({loop:!1,nextEffect:"fade",prevEffect:"fade"}),s("#jira-issue-box",function(e){var i=e.find("a.close");i.on("click",function(n){n.preventDefault(),c.set("dismiss-jira-box-"+i.attr("data-repo-id"),"True").done(function(){e.animate({opacity:0},200,function(){t(this).animate({height:0},200,function(){e.remove()})})})})});var f;t(".issue-attach-link").click(function(e){e.preventDefault(),i().show()}),a()})}),define("repo/issues/index",["repo/index","repo/issues/attachments","repo/issues/comments","repo/issues/form","repo/issues/list","repo/issues/query-builder","repo/issues/transition","repo/issues/view"],function(){}),define("repo/wiki/edit",["jquery","on-ready","config/markitup","jquery-plugins/jquery.markitup"],function(e,t,i){return t(function(){function t(t){s.attr("data-markup-type",t).find("[class^=markup-type]").removeClass().addClass("markup-type-"+t),d.find("a").text(o[t]).append(l),e("#id_markup_type").val(t)}var n=e("#wiki-edit"),r=n.data("isCreate"),o={markdown:"Markdown",creole:"Creole",rest:"reStructuredText",textile:"Textile"},s=n.find(".textarea-preview"),a=s.data("markup-type");if(e("#id_data").markItUp(i({syntax:a,isWiki:!0})),s.hasClass("wiki-syntax")){var l='<span class="aui-icon-dropdown"></span>',c=e("#dropdown-wiki-lang"),d=e("#markItUpId_data").find(".markItUpButton.language");d.find("a").text(o[a]),d.removeClass("hidden").find("a").append(l).addClass("aui-dropdown2-trigger aui-style-default").attr({"aria-haspopup":"true","aria-owns":"dropdown-wiki-lang","data-container":"#markItUpId_data"}),c.on("click","a",function(i){i.preventDefault();var n=e(this).data("markupLang");t(n)}).on("aui-dropdown2-show",function(){var e=s.attr("data-markup-type");c.find("li a").removeClass("active"),c.find('a[data-markup-lang="'+e+'"]').addClass("active")}),r&&e("#id_path").focus()}})}),define("repo/wiki/index",["repo/index","repo/wiki/edit"],function(){}),define("repo/editor/edit-readme",["jquery","on-ready","config/markitup","jquery-plugins/jquery.markitup"],function(e,t,i){return t(function(t){var n=t.find(".textarea-preview"),r=n.attr("data-markup-type");e("#id_content").markItUp(i({syntax:r}))})}),define("utils/pjax-with-mask",["jquery","jquery-plugins/jquery.pjax"],function(e){e.fn.pjaxWithMask=function(t){var i=e(this);return e.pjax(e.extend(t,{container:i})),i.on("pjax:send",function(){i.addClass("has-mask")}),i.on("pjax:complete",function(){i.removeClass("has-mask")}),i}}),define("repo/editor/readme-edit-button",["jquery","on-ready","jquery-plugins/jquery.pjax","utils/pjax-with-mask"],function(e,t){return t(function(t){var i=e("#readme");t.on("click",function(t){t.preventDefault(),i.pjaxWithMask({push:!1,url:e(this).attr("href"),timeout:3e4})})})}),define("repo/editor/index",["repo/editor/edit-readme","repo/editor/readme-edit-button"],function(){}),define("repo/downloads",["jquery","components/confirm-dialog","utils/exists","utils/disable"],function(e,t,i){var n=e("#downloads"),r=e("#downloads-count"),o=+r.text();n.find("a[data-id]").click(function(i){i.preventDefault();var n=e(this),s=n.data(),a=gettext("Permanently delete %(filename)s?");t({title:gettext("Delete download"),content:interpolate(a,{filename:s.filename},!0)}).done(function(){n.addClass("deleting"),e.post(n.attr("href"),{file_id:s.id},function(){var e=n.closest("tr");e.siblings().length?(e.remove(),r.text(o-=1)):window.location.reload()})})}),i("#upload-captcha-form",function(t){var i=t.attr("action"),n=e("#upload-file-form"),r=e("#captcha-wrong");t.submit(function(){return e.getJSON(i,e(this).serialize(),function(e){"success"===e.status?(n.find('[name="token"]').val(e.token),n.removeClass("hidden"),t.addClass("hidden")):"fail"===e.status&&r.removeClass("hidden")}),!1})}),i("#upload-file-form",function(t){var i=t.find("#file"),n=t.find("#content-type"),r=t.find("#upload-button");r.disable(!1).click(function(e){e.preventDefault(),i.click()}),i.change(function(){var o=i.val().match(/[^\/\\]*$/)[0];n.val(e.ajax({url:"/site/mimeguess/"+o,async:!1,dataType:"json"}).responseText),t.find('input[name="Content-Disposition"]').attr("value","attachment; filename="+o),r.addClass("loading").disable(!0),t.submit()})})}),define("repo/qseries",["jquery","on-ready"],function(e,t){return t(function(){function t(e){e.closest("div.radio").prevAll().addClass("apply")}var i=e("#qseries form"),n=i.find("div.radio input");n.change(function(){var i=e(this);e("div.radio").removeClass("apply"),i.is(":checked")&&t(i)}),t(n.filter(":checked"))})}),define("repo/index",["aui","jquery","on-ready","underscore","data/current-repo","data/current-user","repo/history","utils/event-tracking-helper","clone","components/file-search/dialog","components/repo-watch/setup","components/repo-sidebar","repo/create-branch","repo/share","repo/overview","repo/source/index","repo/commits/index","repo/branches/index","repo/pullrequests/index","repo/issues/index","repo/wiki/index","repo/editor/index","repo/downloads","repo/qseries","jquery-plugins/jquery.cookie"],function(e,t,i,n,r,o,s,a){return i(function(){s.addRepository(r);var e=a("Contextual actions");t("#create-branch-contextual").on("click",function(){e("Create branch")}),t("#create-pull-request-contextual").on("click",function(){e("Create pull request")}),t("#create-issue-contextual").on("click",function(){e("Create issue")}),t("#clone-wiki-contextual").on("click",function(){e("Clone wiki")}),t("#create-page-contextual").on("click",function(){e("Create page")})})});
//# sourceMappingURL=index.js.map